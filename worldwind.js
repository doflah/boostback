/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*
 * Copyright (C) 2014 United States Government as represented by the Administrator of the
 * National Aeronautics and Space Administration. All Rights Reserved.
 */

/*
 * Copyright (C) 2015 United States Government as represented by the Administrator of the
 * National Aeronautics and Space Administration. All Rights Reserved.
 */

/*
 * @license
 * Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
 * Copyright 2014, Google Inc. All Rights Reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice including the dates of first publication and
 * either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
 * shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 * SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
 * IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * Original Code. The Original Code is: OpenGL Sample Implementation,
 * Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
 * Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
 * Copyright in any portions created by third parties is as indicated
 * elsewhere herein. All Rights Reserved.
 */

(function(e,t){typeof define=="function"&&define.amd?define([],t):e.WorldWind=t()})(this,function(){var e,t,n;(function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){var n=p.call(arguments,0);return typeof n[0]!="string"&&n.length===1&&n.push(null),s.apply(r,n.concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,m=[],y=typeof n,E;i=i||e;if(y==="undefined"||y==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(d=0;d<t.length;d+=1){p=o(t[d],i),l=p.f;if(l==="require")m[d]=u.require(e);else if(l==="exports")m[d]=u.exports(e),E=!0;else if(l==="module")s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=n?n.apply(a[e],m):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if(typeof e=="string")return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){l=e,l.deps&&s(l.deps,l.callback);if(!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}})(),n("../tools/almond",function(){}),n("error/AbstractError",[],function(){"use strict";var e=function(e,t){this.name=e,this.message=t};return e.prototype.toString=function(){var e=this.name+": "+this.message;return this.stack&&(e+="\n"+this.stack.toString()),e},e}),n("geom/Angle",[],function(){"use strict";var e={DEGREES_TO_RADIANS:Math.PI/180,RADIANS_TO_DEGREES:180/Math.PI,TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,normalizedDegrees:function(e){var t=e%360;return t>180?t-360:t<-180?360+t:t},normalizedDegreesLatitude:function(e){var t=e%180;return t>90?180-t:t<-90?-180-t:t},normalizedDegreesLongitude:function(e){var t=e%360;return t>180?t-360:t<-180?360+t:t},normalizedRadians:function(e){var t=e%this.TWO_PI;return t>Math.PI?t-this.TWO_PI:t<-Math.PI?this.TWO_PI+t:t},normalizedRadiansLatitude:function(e){var t=e%Math.PI;return t>this.HALF_PI?Math.PI-t:t<-this.HALF_PI?-Math.PI-t:t},normalizedRadiansLongitude:function(e){var t=e%this.TWO_PI;return t>Math.PI?t-this.TWO_PI:t<-Math.PI?this.TWO_PI+t:t},isValidLatitude:function(e){return e>=-90&&e<=90},isValidLongitude:function(e){return e>=-180&&e<=180},toString:function(e){return e.toString()+"°"},toDecimalDegreesString:function(e){return e.toString()+"°"},toDMSString:function(e){var t,n,r,i,s;return t=e<0?-1:1,n=t*e,r=Math.floor(n),n=(n-r)*60,i=Math.floor(n),n=(n-i)*60,s=Math.round(n),s==60&&(i++,s=0),i==60&&(r++,i=0),(t==-1?"-":"")+r+"°"+" "+i+"’"+" "+s+"”"},toDMString:function(e){var t,n,r,i,s,o;return t=e<0?-1:1,n=t*e,r=Math.floor(n),n=(n-r)*60,i=Math.floor(n),n=(n-i)*60,s=Math.round(n),s==60&&(i++,s=0),i==60&&(r++,i=0),o=s==0?i:i+s/60,(t==-1?"-":"")+r+"°"+" "+o+"’"}};return e}),n("util/Logger",[],function(){"use strict";var e={LEVEL_NONE:0,LEVEL_SEVERE:1,LEVEL_WARNING:2,LEVEL_INFO:3,setLoggingLevel:function(e){t=e},getLoggingLevel:function(){return t},log:function(n,r){r&&n>0&&n<=t&&(n===e.LEVEL_SEVERE?console.error(r):n===e.LEVEL_WARNING?console.warn(r):n===e.LEVEL_INFO?console.info(r):console.log(r))},makeMessage:function(e,t,n){var r=this.messageTable[n]?this.messageTable[n]:n;return e+"."+t+": "+r},logMessage:function(e,t,n,r){var i=this.makeMessage(t,n,r);return this.log(e,i),i},messageTable:{abstractInvocation:"The function called is abstract and must be overridden in a subclass.",indexOutOfRange:"The specified index is out of range.",invalidHeight:"The specified height is zero or negative.",invalidWidth:"The specified width is zero or negative.",invalidSize:"The specified size is zero or negative.",missingAltitudeMode:"The specified altitude mode is null or undefined.",missingAttributeName:"The specified DBase attribute file name is null or undefined.",missingArray:"The specified array is null, undefined or of insufficient length.",missingBoundaries:"The specified boundaries array is null or undefined.",missingBuffer:"The specified buffer descriptor is null or undefined.",missingColor:"The specified color is null or undefined.",missingDc:"The specified draw context is null or undefined.",missingDomElement:"The specified DOM element is null or undefined.",missingEntry:"The specified entry is null or undefined.",missingFont:"The specified font is null or undefined.",missingFrustum:"The specified frustum is null or undefined.",missingFunction:"The specified function is null or undefined.",missingGlContext:"The specified WebGL rendering context is null or undefined.",missingGlobe:"The specified globe is null or undefined.",missingImage:"The specified image is null or undefined.",missingIndices:"The specified indices array is null or undefined.",missingKey:"The specified key is null or undefined.",missingLevel:"The specified level is null or undefined.",missingLine:"The specified line is null or undefined.",missingList:"The specified list is null or undefined.",missingListener:"The specified listener is null or undefined",missingLocation:"The specified location is null or undefined.",missingMatrix:"The specified matrix is null or undefined.",missingNavigatorState:"The specified navigator state is null or undefined.",missingOffset:"The specified offset is null or undefined.",missingPath:"The specified path is null or undefined.",missingPlacename:"The specified place name is null or undefined.",missingPlane:"The specified plane is null or undefined.",missingPoint:"The specified point is null or undefined.",missingPoints:"The specified points array is null or undefined.",missingPosition:"The specified position is null or undefined.",missingPositions:"The specified positions array is null or undefined.",missingProgram:"The specified program is null or undefined.",missingProjection:"The specified projection is null or undefined.",missingRectangle:"The specified rectangle is null or undefined.",missingRenderable:"The specified renderable is null or undefined.",missingResource:"The specified resource is null or undefined.",missingResult:"The specified result variable is null or undefined.",missingResults:"The specified results array is null or undefined.",missingSector:"The specified sector is null or undefined.",missingShapeType:"The specified shape type is null or undefined.",missingSize:"The specified size is null or undefined.",missingText:"The specified text is null or undefined.",missingTexture:"The specified texture is null or undefined.",missingTile:"The specified tile is null or undefined.",missingType:"The specified type is null or undefined.",missingUrl:"The specified URL is null or undefined",missingVector:"The specified vector is null or undefined.",missingVertex:"The specified vertex is null or undefined.",missingViewport:"The specified viewport is null or undefined.",missingWorldWindow:"The specified World Window is null or undefined.",notYetImplemented:"This function is not yet implemented"}},t=1;return e}),n("util/Color",["../util/Logger"],function(e){"use strict";var t=function(e,t,n,r){this.red=e,this.green=t,this.blue=n,this.alpha=r};return t.WHITE=new t(1,1,1,1),t.BLACK=new t(0,0,0,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.CYAN=new t(0,1,1,1),t.YELLOW=new t(1,1,0,1),t.MAGENTA=new t(1,0,1,1),t.LIGHT_GRAY=new t(.75,.75,.75,1),t.MEDIUM_GRAY=new t(.5,.5,.5,1),t.DARK_GRAY=new t(.25,.25,.25,1),t.TRANSPARENT=new t(0,0,0,0),t.prototype.set=function(e,t,n,r){return this.red=e,this.green=t,this.blue=n,this.alpha=r,this},t.prototype.copy=function(t){if(!t)throw new ArgumentError(e.logMessage(e.LEVEL_SEVERE,"Color","copy","missingColor"));return this.red=t.red,this.green=t.green,this.blue=t.blue,this.alpha=t.alpha,this},t.prototype.clone=function(){return new t(this.red,this.green,this.blue,this.alpha)},t.prototype.premultipliedComponents=function(e){var t=this.alpha;return e[0]=this.red*t,e[1]=this.green*t,e[2]=this.blue*t,e[3]=t,e},t.colorFromByteArray=function(e){return new t(e[0]/255,e[1]/255,e[2]/255,e[3]/255)},t.colorFromBytes=function(e,n,r,i){return new t(e/255,n/255,r/255,i/255)},t.prototype.nextColor=function(){var e=Math.round(this.red*255),t=Math.round(this.green*255),n=Math.round(this.blue*255);return e<255?this.red=(e+1)/255:t<255?(this.red=0,this.green=(t+1)/255):n<255?(this.red=0,this.green=0,this.blue=(n+1)/255):(this.red=1/255,this.green=0,this.blue=0),this},t.prototype.equals=function(e){var t=Math.round(this.red*255),n=Math.round(this.green*255),r=Math.round(this.blue*255),i=Math.round(this.alpha*255),s=Math.round(e.red*255),o=Math.round(e.green*255),u=Math.round(e.blue*255),a=Math.round(e.alpha*255);return t===s&&n===o&&r===u&&i===a},t.prototype.equalsBytes=function(e){var t=Math.round(this.red*255),n=Math.round(this.green*255),r=Math.round(this.blue*255),i=Math.round(this.alpha*255);return t===e[0]&&n===e[1]&&r===e[2]&&i===e[3]},t.prototype.toByteString=function(){var e=Math.round(this.red*255),t=Math.round(this.green*255),n=Math.round(this.blue*255),r=Math.round(this.alpha*255);return"("+e+","+t+","+n+","+r+")"},t.prototype.toHexString=function(e){var t=Math.ceil(this.red*255).toString(16),n=Math.ceil(this.green*255).toString(16),r=Math.ceil(this.blue*255).toString(16),i=Math.ceil(this.alpha*255).toString(16),s="#";return s+=t.length<2?"0"+t:t,s+=n.length<2?"0"+n:n,s+=r.length<2?"0"+r:r,e&&(s+=i.length<2?"0"+i:i),s},t}),n("error/ArgumentError",["../error/AbstractError"],function(e){"use strict";var t=function(t){e.call(this,"ArgumentError",t);var n;try{throw new Error}catch(r){n=r.stack}this.stack=n};return t.prototype=Object.create(e.prototype),t}),n("util/Font",["../error/ArgumentError","../util/Color","../util/Logger"],function(e,t,n){"use strict";var r=function(t,r,i,s,o,u){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Font","constructor","missingSize"));if(t<=0)throw new e(n.logMessage(n.LEVEL_SEVERE,"Font","constructor","invalidSize"));this._size=t,this.style=r||"normal",this.variant=i||"normal",this.weight=s||"normal",this.family=o||"sans-serif",this.horizontalAlignment=u||"center"};return Object.defineProperties(r.prototype,{size:{get:function(){return this._size},set:function(e){this._fontString=null,this._size=e}},style:{get:function(){return this._style},set:function(e){this._fontString=null,this._style=e}},variant:{get:function(){return this._variant},set:function(e){this._fontString=null,this._variant=e}},weight:{get:function(){return this._weight},set:function(e){this._fontString=null,this._weight=e}},family:{get:function(){return this._family},set:function(e){this._fontString=null,this._family=e}},horizontalAlignment:{get:function(){return this._horizontalAlignment},set:function(e){this._toString=null,this._horizontalAlignment=e}},fontString:{get:function(){return this._fontString||(this._fontString=this._style+" "+this.variant+" "+this._weight+" "+this._size.toString()+"px "+this._family),this._fontString}}}),r.prototype.toString=function(){if(!this._toString||!this._fontString)this._toString=this.fontString+" "+this.horizontalAlignment;return this._toString},r}),n("util/Insets",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n,r,i,s){if(arguments.length!==4)throw new e(t.logMessage(t.LEVEL_SEVERE,"Insets","constructor","invalidArgumentCount"));this._top=n,this._left=r,this._bottom=i,this._right=s};return n.prototype.set=function(e,t,n,r){this._top=e,this._left=t,this._bottom=n,this._right=r},n.prototype.clone=function(){return new n(this._top,this._left,this._bottom,this._right)},n.prototype.toString=function(){return this._top+" "+this._left+" "+this._bottom+" "+this._right},Object.defineProperties(n.prototype,{top:{get:function(){return this._top},set:function(e){this._top=e}},left:{get:function(){return this._left},set:function(e){this._left=e}},bottom:{get:function(){return this._bottom},set:function(e){this._bottom=e}},right:{get:function(){return this._right},set:function(e){this._right=e}}}),n}),n("geom/Vec3",["../util/Logger","../error/ArgumentError"],function(e,t){"use strict";var n=function(t,n,r){this[0]=t,this[1]=n,this[2]=r};return n.prototype=new Float64Array(3),n.ZERO=new n(0,0,0),n.average=function(n,r){if(!n||n.length<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","average","missingArray"));if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","average","missingResult"));var i=n.length,s;r[0]=0,r[1]=0,r[2]=0;for(var o=0,u=n.length;o<u;o++)s=n[o],r[0]+=s[0]/i,r[1]+=s[1]/i,r[2]+=s[2]/i;return r},n.averageOfBuffer=function(n,r){if(!n||n.length<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","averageBuffer","missingArray"));if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","averageBuffer","missingResult"));var i=n.length/3;r[0]=0,r[1]=0,r[2]=0;for(var s=0;s<i;s++)r[0]+=n[s*3]/i,r[1]+=n[s*3+1]/i,r[2]+=n[s*3+2]/i;return r},n.areColinear=function(n,r,i){if(!n||!r||!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","areColinear","missingVector"));var s=r.subtract(n).normalize(),o=i.subtract(r).normalize();return Math.abs(s.dot(o))>.999},n.computeTriangleNormal=function(r,i,s){if(!r||!i||!s)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","areColinear","missingVector"));var o=(i[1]-r[1])*(s[2]-r[2])-(i[2]-r[2])*(s[1]-r[1]),u=(i[2]-r[2])*(s[0]-r[0])-(i[0]-r[0])*(s[2]-r[2]),a=(i[0]-r[0])*(s[1]-r[1])-(i[1]-r[1])*(s[0]-r[0]),f=o*o+u*u+a*a;return f===0?new n(o,u,a):(f=Math.sqrt(f),new n(o/f,u/f,a/f))},n.findThreeIndependentVertices=function(e,t){var r=t&&t>0?t:3;if(!e||e.length<3*r)return null;var i=new n(e[0],e[1],e[2]),s=null,o=null,u=r;for(;u<e.length;u+=r){s=new n(e[u],e[u+1],e[u+2]);if(s[0]!==i[0]||s[1]!==i[1]||s[2]!==i[2])break;s=null}if(!s)return null;for(u+=r;u<e.length;u+=r){o=new n(e[u],e[u+1],e[u+2]);if(!(o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]||o[0]===s[0]&&o[1]===s[1]&&o[2]===s[2])&&!n.areColinear(i,s,o))break;o=null}return o?[i,s,o]:null},n.computeBufferNormal=function(e,t){var r=n.findThreeIndependentVertices(e,t);return r?n.computeTriangleNormal(r[0],r[1],r[2]):null},n.prototype.set=function(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this},n.prototype.copy=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","copy","missingVector"));return this[0]=n[0],this[1]=n[1],this[2]=n[2],this},n.prototype.equals=function(e){return this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2]},n.prototype.add=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","add","missingVector"));return this[0]+=n[0],this[1]+=n[1],this[2]+=n[2],this},n.prototype.subtract=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","subtract","missingVector"));return this[0]-=n[0],this[1]-=n[1],this[2]-=n[2],this},n.prototype.multiply=function(e){return this[0]*=e,this[1]*=e,this[2]*=e,this},n.prototype.divide=function(e){return this[0]/=e,this[1]/=e,this[2]/=e,this},n.prototype.multiplyByMatrix=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","multiplyByMatrix","missingMatrix"));var r=n[0]*this[0]+n[1]*this[1]+n[2]*this[2]+n[3],i=n[4]*this[0]+n[5]*this[1]+n[6]*this[2]+n[7],s=n[8]*this[0]+n[9]*this[1]+n[10]*this[2]+n[11],o=n[12]*this[0]+n[13]*this[1]+n[14]*this[2]+n[15];return this[0]=r/o,this[1]=i/o,this[2]=s/o,this},n.prototype.mix=function(n,r){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","mix","missingVector"));var i=1-r,s=r;return this[0]=this[0]*i+n[0]*s,this[1]=this[1]*i+n[1]*s,this[2]=this[2]*i+n[2]*s,this},n.prototype.negate=function(){return this[0]=-this[0],this[1]=-this[1],this[2]=-this[2],this},n.prototype.dot=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","dot","missingVector"));return this[0]*n[0]+this[1]*n[1]+this[2]*n[2]},n.prototype.cross=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","cross","missingVector"));var r=this[1]*n[2]-this[2]*n[1],i=this[2]*n[0]-this[0]*n[2],s=this[0]*n[1]-this[1]*n[0];return this[0]=r,this[1]=i,this[2]=s,this},n.prototype.magnitudeSquared=function(){return this.dot(this)},n.prototype.magnitude=function(){return Math.sqrt(this.magnitudeSquared())},n.prototype.normalize=function(){var e=this.magnitude(),t=1/e;return this[0]*=t,this[1]*=t,this[2]*=t,this},n.prototype.distanceToSquared=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","distanceToSquared","missingVector"));var r=this[0]-n[0],i=this[1]-n[1],s=this[2]-n[2];return r*r+i*i+s*s},n.prototype.distanceTo=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","distanceTo","missingVector"));return Math.sqrt(this.distanceToSquared(n))},n.prototype.swap=function(e){var t=this[0];return this[0]=e[0],e[0]=t,t=this[1],this[1]=e[1],e[1]=t,t=this[2],this[2]=e[2],e[2]=t,this},n.prototype.toString=function(){return"("+this[0]+", "+this[1]+", "+this[2]+")"},n}),n("geom/Vec2",["../util/Logger","../error/ArgumentError","../geom/Vec3"],function(e,t,n){"use strict";var r=function(t,n){this[0]=t,this[1]=n};return r.prototype=new Float64Array(2),r.prototype.set=function(e,t){return this[0]=e,this[1]=t,this},r.prototype.copy=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","copy","missingVector"));return this[0]=n[0],this[1]=n[1],this},r.prototype.equals=function(e){return this[0]===e[0]&&this[1]===e[1]},r.average=function(n,r){if(!n||n.length<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","average","missingArray"));if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","average","missingResult"));var i=n.length,s;r[0]=0,r[1]=0;for(var o=0,u=n.length;o<u;o++)s=n[o],r[0]+=s[0]/i,r[1]+=s[1]/i;return r},r.prototype.add=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","add","missingVector"));return this[0]+=n[0],this[1]+=n[1],this},r.prototype.subtract=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","subtract","missingVector"));return this[0]-=n[0],this[1]-=n[1],this},r.prototype.multiply=function(e){return this[0]*=e,this[1]*=e,this},r.prototype.divide=function(e){return this[0]/=e,this[1]/=e,this},r.prototype.mix=function(n,r){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","mix","missingVector"));var i=1-r,s=r;return this[0]=this[0]*i+n[0]*s,this[1]=this[1]*i+n[1]*s,this},r.prototype.negate=function(){return this[0]=-this[0],this[1]=-this[1],this},r.prototype.dot=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","dot","missingVector"));return this[0]*n[0]+this[1]*n[1]},r.prototype.magnitudeSquared=function(){return this.dot(this)},r.prototype.magnitude=function(){return Math.sqrt(this.magnitudeSquared())},r.prototype.normalize=function(){var e=this.magnitude(),t=1/e;return this[0]*=t,this[1]*=t,this},r.prototype.distanceToSquared=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","distanceToSquared","missingVector"));var r=this[0]-n[0],i=this[1]-n[1];return r*r+i*i},r.prototype.distanceTo=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","distanceTo","missingVector"));return Math.sqrt(this.distanceToSquared(n))},r.prototype.toVec3=function(){return new n(this[0],this[1],0)},r.prototype.swap=function(e){var t=this[0];return this[0]=e[0],e[0]=t,t=this[1],this[1]=e[1],e[1]=t,this},r.prototype.toString=function(){return"("+this[0]+", "+this[1]+")"},r}),n("util/Offset",["../geom/Vec2"],function(e){"use strict";var t=function(e,t,n,r){this.x=t,this.y=r,this.xUnits=e,this.yUnits=n};return t.prototype.clone=function(){return new t(this.xUnits,this.x,this.yUnits,this.y)},t.prototype.offsetForSize=function(t,n){var r,i;return this.xUnits==WorldWind.OFFSET_FRACTION?r=t*this.x:this.xUnits==WorldWind.OFFSET_INSET_PIXELS?r=t-this.x:r=this.x,this.yUnits==WorldWind.OFFSET_FRACTION?i=n*this.y:this.yUnits==WorldWind.OFFSET_INSET_PIXELS?i=n-this.y:i=this.y,new e(r,i)},t.prototype.toString=function(){return this.xUnits+" "+this.x+" "+this.yUnits+" "+this.y},t}),n("shapes/TextAttributes",["../util/Color","../util/Font","../util/Offset"],function(e,t,n){"use strict";var r=function(r){this._color=r?r._color:new e(1,1,1,1),this._font=r?r._font:new t(14),this._offset=r?r._offset:new n(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,0),this._scale=r?r._scale:1,this._depthTest=r?r._depthTest:!1,this.stateKeyInvalid=!0};return r.prototype.computeStateKey=function(){return"c "+this._color.toHexString(!0)+" f "+this._font.toString()+" o "+this._offset.toString()+" s "+this._scale+" dt "+this._depthTest},Object.defineProperties(r.prototype,{stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}},color:{get:function(){return this._color},set:function(e){this._color=e,this.stateKeyInvalid=!0}},font:{get:function(){return this._font},set:function(e){this._font=e,this.stateKeyInvalid=!0}},offset:{get:function(){return this._offset},set:function(e){this._offset=e,this.stateKeyInvalid=!0}},scale:{get:function(){return this._scale},set:function(e){this._scale=e,this.stateKeyInvalid=!0}},depthTest:{get:function(){return this._depthTest},set:function(e){this._depthTest=e,this.stateKeyInvalid=!0}}}),r}),n("shapes/AnnotationAttributes",["../util/Color","../util/Font","../util/Insets","../shapes/TextAttributes"],function(e,t,n,r){"use strict";var i=function(t){this._cornerRadius=t?t._cornerRadius:0,this._insets=t?t._insets:new n(0,0,0,0),this._backgroundColor=t?t._backgroundColor:e.WHITE,this._leaderGapWidth=t?t._leaderGapWidth:40,this._leaderGapHeight=t?t._leaderGapHeight:30,this._opacity=t?t._opacity:1,this._scale=t?t._scale:1,this._drawLeader=t?t._drawLeader:!0,this._width=t?t._width:200,this._height=t?t._height:100,this._textAttributes=t?t._textAttributes:new r(null),this.stateKeyInvalid=!0};return i.prototype.computeStateKey=function(){return"wi "+this._width+" he "+this._height+" cr "+this._cornerRadius+" in "+this._insets.toString()+" bg "+this.backgroundColor.toHexString(!0)+" dl "+this.drawLeader+" lgw "+this.leaderGapWidth+" lgh "+this.leaderGapHeight+" op "+this.opacity+" ta "+this._textAttributes.stateKey+" sc "+this.scale},Object.defineProperties(i.prototype,{width:{get:function(){return this._width},set:function(e){this._width=e,this.stateKeyInvalid=!0}},height:{get:function(){return this._height},set:function(e){this._height=e,this.stateKeyInvalid=!0}},cornerRadius:{get:function(){return this._cornerRadius},set:function(e){this._cornerRadius=e,this.stateKeyInvalid=!0}},insets:{get:function(){return this._insets},set:function(e){this._insets=e,this.stateKeyInvalid=!0}},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,this.stateKeyInvalid=!0}},textAttributes:{get:function(){return this._textAttributes},set:function(e){this._textAttributes=e,this.stateKeyInvalid=!0}},drawLeader:{get:function(){return this._drawLeader},set:function(e){this._drawLeader=e,this.stateKeyInvalid=!0}},leaderGapWidth:{get:function(){return this._leaderGapWidth},set:function(e){this._leaderGapWidth=e,this.stateKeyInvalid=!0}},leaderGapHeight:{get:function(){return this._leaderGapHeight},set:function(e){this._leaderGapHeight=e,this.stateKeyInvalid=!0}},opacity:{get:function(){return this._opacity},set:function(e){this._opacity=e,this.stateKeyInvalid=!0}},scale:{get:function(){return this._scale},set:function(e){this._scale=e,this.stateKeyInvalid=!0}},stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}}}),i}),n("shaders/GpuShader",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n,r,i){if(r!==n.VERTEX_SHADER&&r!==n.FRAGMENT_SHADER)throw new e(t.logMessage(t.LEVEL_SEVERE,"GpuShader","constructor","The specified shader type is unrecognized."));if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"GpuShader","constructor","The specified shader source is null or undefined."));var s=n.createShader(r);if(!s)throw new e(t.logMessage(t.LEVEL_SEVERE,"GpuShader","constructor","Unable to create shader of type "+(r==n.VERTEX_SHADER?"VERTEX_SHADER.":"FRAGMENT_SHADER.")));if(!this.compile(n,s,r,i)){var o=n.getShaderInfoLog(s);throw n.deleteShader(s),new e(t.logMessage(t.LEVEL_SEVERE,"GpuShader","constructor","Unable to compile shader: "+o))}this.shaderId=s};return n.prototype.compile=function(e,t,n,r){return e.shaderSource(t,r),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)},n.prototype.dispose=function(e){this.shaderId&&(e.deleteShader(this.shaderId),delete this.shaderId)},n}),n("shaders/GpuProgram",["../error/ArgumentError","../util/Color","../shaders/GpuShader","../util/Logger"],function(e,t,n,r){"use strict";var i=function(t,i,s,o){if(!i||!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","constructor","The specified shader source is null or undefined."));var u,a,f;try{a=new n(t,t.VERTEX_SHADER,i),f=new n(t,t.FRAGMENT_SHADER,s)}catch(l){throw a&&a.dispose(t),f&&f.dispose(t),l}u=t.createProgram();if(!u)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","constructor","Unable to create shader program."));t.attachShader(u,a.shaderId),t.attachShader(u,f.shaderId);if(o)for(var c=0,h=o.length;c<h;c++)t.bindAttribLocation(u,c,o[c]);if(!this.link(t,u)){var p=t.getProgramInfoLog(u);throw t.detachShader(u,a.shaderId),t.detachShader(u,f.shaderId),t.deleteProgram(u),a.dispose(t),f.dispose(t),new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","constructor","Unable to link shader program: "+p))}this.programId=u,this.attributeLocations={},this.uniformLocations={},this.vertexShader=a,this.fragmentShader=f,this.size=i.length+s.length,this.scratchArray=new Float32Array(16)};return i.prototype.dispose=function(e){this.programId&&(this.vertexShader&&e.detachShader(this.programId,this.vertexShader.shaderId),this.fragmentShader&&e.detachShader(this.programId,this.fragmentShader.shaderId),e.deleteProgram(this.programId),delete this.programId),this.vertexShader&&(this.vertexShader.dispose(e),delete this.vertexShader),this.fragmentShader&&(this.fragmentShader.dispose(e),delete this.fragmentShader),this.attributeLocations={},this.uniformLocations={}},i.prototype.attributeLocation=function(t,n){if(!n||n.length==0)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","attributeLocation","The specified attribute name is null, undefined or empty."));var i=this.attributeLocations[n];return i||(i=t.getAttribLocation(this.programId,n),this.attributeLocations[n]=i),i},i.prototype.uniformLocation=function(t,n){if(!n||n.length==0)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","uniformLocation","The specified uniform name is null, undefined or empty."));var i=this.uniformLocations[n];return i||(i=t.getUniformLocation(this.programId,n),this.uniformLocations[n]=i),i},i.prototype.link=function(e,t){return e.linkProgram(t),e.getProgramParameter(t,e.LINK_STATUS)},i.prototype.loadUniformMatrix=function(t,n,i){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","loadUniformMatrix","missingMatrix"));var s=n.columnMajorComponents(this.scratchArray);t.uniformMatrix4fv(i,!1,s)},i.prototype.loadUniformColor=function(t,n,i){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","loadUniformColor","missingColor"));var s=n.premultipliedComponents(this.scratchArray);t.uniform4f(i,s[0],s[1],s[2],s[3])},i.prototype.loadUniformColorComponents=function(e,t,n,r,i,s){e.uniform4f(s,t*i,n*i,r*i,i)},i}),n("shaders/BasicTextureProgram",["../error/ArgumentError","../util/Color","../shaders/GpuProgram","../util/Logger"],function(e,t,n,r){"use strict";var i=function(e){var t="attribute vec4 vertexPoint;\nattribute vec4 vertexTexCoord;\nattribute vec4 normalVector;\nuniform mat4 mvpMatrix;\nuniform mat4 mvInverseMatrix;\nuniform mat4 texCoordMatrix;\nuniform bool applyLighting;\nvarying vec2 texCoord;\nvarying vec4 normal;\nvoid main() {gl_Position = mvpMatrix * vertexPoint;\ntexCoord = (texCoordMatrix * vertexTexCoord).st;\nif (applyLighting) {normal = mvInverseMatrix * normalVector;}\n}",r="precision mediump float;\nuniform float opacity;\nuniform vec4 color;\nuniform bool enableTexture;\nuniform bool modulateColor;\nuniform sampler2D textureSampler;\nuniform bool applyLighting;\nvarying vec2 texCoord;\nvarying vec4 normal;\nvoid main() {\nvec4 textureColor = texture2D(textureSampler, texCoord);\nfloat ambient = 0.15; vec4 lightDirection = vec4(0, 0, 1, 0);\nif (enableTexture && !modulateColor)\n    gl_FragColor = textureColor * color * opacity;\nelse if (enableTexture && modulateColor)\n    gl_FragColor = color * floor(textureColor.a + 0.5);\nelse\n    gl_FragColor = color * opacity;\nif (gl_FragColor.a == 0.0) {discard; return;}\nif (applyLighting) {\n    vec4 n = normal * (gl_FrontFacing ? 1.0 : -1.0);\n    gl_FragColor.rgb *= clamp(ambient + dot(lightDirection, n), 0.0, 1.0);\n}\n}",i=["vertexPoint","normalVector","vertexTexCoord"];n.call(this,e,t,r,i),this.vertexPointLocation=this.attributeLocation(e,"vertexPoint"),this.normalVectorLocation=this.attributeLocation(e,"normalVector"),this.vertexTexCoordLocation=this.attributeLocation(e,"vertexTexCoord"),this.mvpMatrixLocation=this.uniformLocation(e,"mvpMatrix"),this.mvInverseMatrixLocation=this.uniformLocation(e,"mvInverseMatrix"),this.colorLocation=this.uniformLocation(e,"color"),this.textureEnabledLocation=this.uniformLocation(e,"enableTexture"),this.modulateColorLocation=this.uniformLocation(e,"modulateColor"),this.textureUnitLocation=this.uniformLocation(e,"textureSampler"),this.textureMatrixLocation=this.uniformLocation(e,"texCoordMatrix"),this.opacityLocation=this.uniformLocation(e,"opacity"),this.applyLightingLocation=this.uniformLocation(e,"applyLighting")};return i.key="WorldWindGpuBasicTextureProgram",i.prototype=Object.create(n.prototype),i.prototype.loadModelviewInverse=function(t,n){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"BasicTextureProgram","loadModelviewInverse","missingMatrix"));this.loadUniformMatrix(t,n,this.mvInverseMatrixLocation)},i.prototype.loadModelviewProjection=function(t,n){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"BasicTextureProgram","loadModelviewProjection","missingMatrix"));this.loadUniformMatrix(t,n,this.mvpMatrixLocation)},i.prototype.loadColor=function(t,n){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"BasicTextureProgram","loadColor","missingColor"));this.loadUniformColor(t,n,this.colorLocation)},i.prototype.loadTextureEnabled=function(e,t){e.uniform1i(this.textureEnabledLocation,t?1:0)},i.prototype.loadModulateColor=function(e,t){e.uniform1i(this.modulateColorLocation,t?1:0)},i.prototype.loadTextureUnit=function(e,t){e.uniform1i(this.textureUnitLocation,t-e.TEXTURE0)},i.prototype.loadTextureMatrix=function(e,t){this.loadUniformMatrix(e,t,this.textureMatrixLocation)},i.prototype.loadOpacity=function(e,t){e.uniform1f(this.opacityLocation,t)},i.prototype.loadApplyLighting=function(e,t){e.uniform1i(this.applyLightingLocation,t)},i}),n("geom/Line",["../error/ArgumentError","../util/Logger","../geom/Vec3"],function(e,t,n){"use strict";var r=function(n,r){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"Line","constructor","Origin is null or undefined."));if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Line","constructor","Direction is null or undefined."));this.origin=n,this.direction=r};return r.fromSegment=function(i,s){if(!i||!s)throw new e(t.logMessage(t.LEVEL_SEVERE,"Line","fromSegment","missingPoint"));var o=new n(i[0],i[1],i[2]),u=new n(s[0]-i[0],s[1]-i[1],s[2]-i[2]);return new r(o,u)},r.prototype.pointAt=function(n,r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Line","pointAt","missingResult."));return r[0]=this.origin[0]+this.direction[0]*n,r[1]=this.origin[1]+this.direction[1]*n,r[2]=this.origin[2]+this.direction[2]*n,r},r}),n("geom/Plane",["../error/ArgumentError","../geom/Line","../util/Logger","../geom/Vec3"],function(e,t,n,r){"use strict";var i=function(e,t,n,i){this.normal=new r(e,t,n),this.distance=i};return i.fromPoints=function(t,s,o){if(!t||!s||!o)throw new e(n.logMessage(n.LEVEL_SEVERE,"Plane","fromPoints","missingVector"));var u=new r(s[0],s[1],s[2]);u.subtract(t);var a=new r(o[0],o[1],o[2]);a.subtract(t),u.cross(a),u.normalize();var f=-u.dot(t);return new i(u[0],u[1],u[2],f)},i.prototype.dot=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Plane","dot","missingVector"));return this.normal.dot(t)+this.distance},i.prototype.distanceToPoint=function(e){return this.dot(e)},i.prototype.transformByMatrix=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Plane","transformByMatrix","missingMatrix"));var r=t[0]*this.normal[0]+t[1]*this.normal[1]+t[2]*this.normal[2]+t[3]*this.distance,i=t[4]*this.normal[0]+t[5]*this.normal[1]+t[6]*this.normal[2]+t[7]*this.distance,s=t[8]*this.normal[0]+t[9]*this.normal[1]+t[10]*this.normal[2]+t[11]*this.distance,o=t[12]*this.normal[0]+t[13]*this.normal[1]+t[14]*this.normal[2]+t[15]*this.distance;return this.normal[0]=r,this.normal[1]=i,this.normal[2]=s,this.distance=o,this},i.prototype.normalize=function(){var e=this.normal.magnitude();return e===0?this:(this.normal.divide(e),this.distance/=e,this)},i.prototype.intersectsSegment=function(e,t){var n=this.dot(e),r=this.dot(t);return n*r<=0},i.prototype.intersectsSegmentAt=function(e,t,n){var r=this.dot(e),i=this.dot(t);if(r===0&&i===0)return n[0]=e[0],n[1]=e[1],n[2]=e[2],!0;if(r===i)return!1;var s=-r/(i-r),o=1-s;return n[0]=s*e[0]+o*t[0],n[1]=s*e[1]+o*t[1],n[2]=s*e[2]+o*t[2],r*i<=0},i.prototype.onSameSide=function(t,r){if(!t||!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"Plane","onSameSide","missingPoint"));var i=this.distanceToPoint(t),s=this.distanceToPoint(r);return i<0&&s<0?-1:i>0&&s>0?1:0},i.prototype.clip=function(i,s){if(!i||!s)throw new e(n.logMessage(n.LEVEL_SEVERE,"Plane","clip","missingPoint"));if(i.equals(s))return null;var o=t.fromSegment(i,s),u=this.normal.dot(o.direction),a,f,l;return u===0?(a=this.dot(o.origin),a===0?[i,s]:null):(f=-this.dot(o.origin)/u,f<0||f>1?null:(l=o.pointAt(f,new r(0,0,0)),u>0?[l,s]:[i,l]))},i}),n("geom/Rectangle",["../util/Logger"],function(e){"use strict";var t=function(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r};return t.prototype.set=function(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r},t.prototype.getMinX=function(){return this.x},t.prototype.getMinY=function(){return this.y},t.prototype.getMaxX=function(){return this.x+this.width},t.prototype.getMaxY=function(){return this.y+this.height},t.prototype.containsPoint=function(e){return e[0]>=this.x&&e[0]<=this.x+this.width&&e[1]>=this.y&&e[1]<=this.y+this.height},t.prototype.intersects=function(e){return e.x+e.width<this.x?!1:e.x>this.x+this.width?!1:e.y+e.height<this.y?!1:e.y>this.y+this.height?!1:!0},t.prototype.intersectsRectangles=function(e){if(e)for(var t=0;t<e.length;t++)if(this.intersects(e[t]))return!0;return!1},t.prototype.toString=function(){return this.x+", "+this.y+", "+this.width+", "+this.height},t}),n("util/WWMath",["../geom/Angle","../error/ArgumentError","../geom/Line","../util/Logger","../geom/Rectangle","../geom/Vec3"],function(e,t,n,r,i,s){"use strict";var o={clamp:function(e,t,n){return e<t?t:e>n?n:e},interpolate:function(e,t,n){return(1-e)*t+e*n},cbrt:function(e){return typeof Math.cbrt=="function"?Math.cbrt(e):Math.pow(e,1/3)},computeEllipsoidalGlobeIntersection:function(e,n,i,s){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeEllipsoidalGlobeIntersection","missingLine"));if(!s)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeEllipsoidalGlobeIntersection","missingResult"));var o=e.direction[0],u=e.direction[1],a=e.direction[2],f=e.origin[0],l=e.origin[1],c=e.origin[2],h=n/i,p=h*h,d=n*n,v=o*o+p*u*u+a*a,m=2*(f*o+p*l*u+c*a),g=f*f+p*l*l+c*c-d,y=m*m-4*v*g,b;return y<0?!1:(b=(-m-Math.sqrt(y))/(2*v),s[0]=f+o*b,s[1]=l+u*b,s[2]=c+a*b,!0)},computeTriangleIntersection:function(e,n,i,s,o){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriangleIntersection","missingLine"));if(!n||!i||!s)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriangleIntersection","missingVertex"));if(!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriangleIntersection","missingResult"));var u=e.direction[0],a=e.direction[1],f=e.direction[2],l=e.origin[0],c=e.origin[1],h=e.origin[2],p=1e-5,d=i[0]-n[0],v=i[1]-n[1],m=i[2]-n[2],g=s[0]-n[0],y=s[1]-n[1],b=s[2]-n[2],w=a*b-f*y,E=f*g-u*b,S=u*y-a*g,x=d*w+v*E+m*S;if(x>-p&&x<p)return!1;var T=1/x,N=l-n[0],C=c-n[1],k=h-n[2],L=T*(N*w+C*E+k*S);if(L<-p||L>1+p)return!1;var A=C*m-k*v,O=k*d-N*m,M=N*v-C*d,_=T*(u*A+a*O+f*M);if(_<-p||L+_>1+p)return!1;var D=T*(g*A+y*O+b*M);return D<0?!1:(o[0]=l+u*D,o[1]=c+a*D,o[2]=h+f*D,!0)},computeIndexedTrianglesIntersection:function(e,n,i,u){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeIndexedTrianglesIntersection","missingLine"));if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeIndexedTrianglesIntersection","missingPoints"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeIndexedTrianglesIntersection","missingIndices"));if(!u)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeIndexedTrianglesIntersection","missingResults"));var a=new s(0,0,0),f=new s(0,0,0),l=new s(0,0,0),c=new s(0,0,0);for(var h=0,p=i.length;h<p;h+=3){var d=3*i[h],v=3*i[h+1],m=3*i[h+2];a[0]=n[d],a[1]=n[d+1],a[2]=n[d+2],f[0]=n[v],f[1]=n[v+1],f[2]=n[v+2],l[0]=n[m],l[1]=n[m+1],l[2]=n[m+2],o.computeTriangleIntersection(e,a,f,l,c)&&(u.push(c),c=new s(0,0,0))}return u.length>0},computeTriStripIntersections:function(e,n,i,o){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingLine"));if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingPoints"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingIndices"));if(!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingResults"));var u=e.direction[0],a=e.direction[1],f=e.direction[2],l=e.origin[0],c=e.origin[1],h=e.origin[2],p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z=1e-5;U=3*i[0],m=n[U++],g=n[U++],y=n[U],U=3*i[1],b=n[U++],w=n[U++],E=n[U];for(var W=2,X=i.length;W<X;W++){p=m,d=g,v=y,m=b,g=w,y=E,U=3*i[W],b=n[U++],w=n[U++],E=n[U],S=m-p,x=g-d,T=y-v,N=b-p,C=w-d,k=E-v,L=a*k-f*C,A=f*N-u*k,O=u*C-a*N,q=S*L+x*A+T*O;if(q>-z&&q<z)continue;R=1/q,M=l-p,_=c-d,D=h-v,j=R*(M*L+_*A+D*O);if(j<-z||j>1+z)continue;P=_*T-D*x,H=D*S-M*T,B=M*x-_*S,F=R*(u*P+a*H+f*B);if(F<-z||j+F>1+z)continue;I=R*(N*P+C*H+k*B),I>=0&&o.push(new s(l+u*I,c+a*I,h+f*I))}},fabs:function(e){return e>=0?e:-e},fmod:function(e,t){return t===0?0:e-Math.floor(e/t)*t},fract:function(e){return e-Math.floor(e)},mod:function(e,t){return(e%t+t)%t},max:function(e,t){return e>t?e:t},localCoordinateAxesAtPoint:function(e,n,i,s,o){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","localCoordinateAxesAtPoint","missingVector"));if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","localCoordinateAxesAtPoint","missingGlobe"));if(!i||!s||!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","localCoordinateAxesAtPoint","missingResult"));var u=e[0],a=e[1],f=e[2];n.surfaceNormalAtPoint(u,a,f,o),n.northTangentAtPoint(u,a,f,s),i.set(s[0],s[1],s[2]),i.cross(o),i.normalize(),s.set(o[0],o[1],o[2]),s.cross(i),s.normalize()},horizonDistanceForGlobeRadius:function(e,n){if(e<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","horizontalDistanceForGlobeRadius","The specified globe radius is negative."));return e>0&&n>0?Math.sqrt(n*(2*e+n)):0},perspectiveNearDistanceForFarDistance:function(e,n,i){if(e<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistanceForFarDistance","The specified distance is negative."));if(n<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistanceForFarDistance","The specified resolution is negative."));if(i<1)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistanceForFarDistance","The specified depth bits is negative."));var s=(1<<i)-1;return e/(s/(1-n/e)-s+1)},perspectiveNearDistance:function(e,n,i){if(e<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistance","invalidWidth"));if(n<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistance","invalidHeight"));if(i<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistance","The specified distance is negative."));var s=n/e;return 2*i/Math.sqrt(s*s+5)},perspectiveFrustumRectangle:function(e,n,s){if(e<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveFrustumRectangle","invalidWidth"));if(n<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveFrustumRectangle","invalidHeight"));if(s<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveFrustumRectangle","The specified distance is negative."));var o=s,u=s*n/e;return new i(-o/2,-u/2,o,u)},perspectivePixelSize:function(e,n,i){if(e<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectivePixelSize","invalidWidth"));if(n<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectivePixelSize","invalidHeight"));if(i<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectivePixelSize","The specified distance is negative."));var s=o.perspectiveFrustumRectangle(e,n,i).height;return s/n},boundingRectForUnitQuad:function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","boundingRectForUnitQuad","missingMatrix"));var n=e,s=n[3],o=n[7],u=n[0]+n[3],a=n[4]+n[7],f=n[1]+n[3],l=n[5]+n[7],c=n[0]+n[1]+n[3],h=n[4]+n[5]+n[7],p=Math.min(Math.min(s,u),Math.min(f,c)),d=Math.max(Math.max(s,u),Math.max(f,c)),v=Math.min(Math.min(o,a),Math.min(l,h)),m=Math.max(Math.max(o,a),Math.max(l,h));return new i(p,v,d-p,m-v)},isPowerOfTwo:function(e){return e!=0&&(e&e-1)===0},signum:function(e){return e>0?1:e<0?-1:0},gudermannianInverse:function(t){return Math.log(Math.tan(Math.PI/4+t*e.DEGREES_TO_RADIANS/2))/Math.PI},epsg3857ToEpsg4326:function(t,n){var r=6378100,i=Math.PI/2-2*Math.atan(Math.exp(-n/r)),s=t/r;return[o.clamp(i*e.RADIANS_TO_DEGREES,-90,90),o.clamp(s*e.RADIANS_TO_DEGREES,-180,180)]}};return o}),n("geom/Location",["../geom/Angle","../error/ArgumentError","../util/Logger","../geom/Plane","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s){"use strict";var o=function(e,t){this.latitude=e,this.longitude=t};return o.ZERO=new o(0,0),o.fromRadians=function(t,n){return new o(t*e.RADIANS_TO_DEGREES,n*e.RADIANS_TO_DEGREES)},o.prototype.copy=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","copy","missingLocation"));return this.latitude=e.latitude,this.longitude=e.longitude,this},o.prototype.set=function(e,t){return this.latitude=e,this.longitude=t,this},o.prototype.equals=function(e){return e&&e.latitude===this.latitude&&e.longitude===this.longitude},o.interpolateAlongPath=function(e,r,i,s,o){if(!i||!s)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateAlongPath","missingLocation"));if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateAlongPath","missingResult"));return e===WorldWind.GREAT_CIRCLE?this.interpolateGreatCircle(r,i,s,o):e&&e===WorldWind.RHUMB_LINE?this.interpolateRhumb(r,i,s,o):this.interpolateLinear(r,i,s,o)},o.interpolateGreatCircle=function(e,r,i,o){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateGreatCircle","missingLocation"));if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateGreatCircle","missingResult"));if(r.equals(i))return o.latitude=r.latitude,o.longitude=r.longitude,o;var u=s.clamp(e,0,1),a=this.greatCircleAzimuth(r,i),f=this.greatCircleDistance(r,i);return this.greatCircleLocation(r,a,u*f,o)},o.greatCircleAzimuth=function(r,i){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleAzimuth","missingLocation"));var s=r.latitude*e.DEGREES_TO_RADIANS,o=i.latitude*e.DEGREES_TO_RADIANS,u=r.longitude*e.DEGREES_TO_RADIANS,a=i.longitude*e.DEGREES_TO_RADIANS,f,l,c;return s==o&&u==a?0:u==a?s>o?180:0:(l=Math.cos(o)*Math.sin(a-u),f=Math.cos(s)*Math.sin(o)-Math.sin(s)*Math.cos(o)*Math.cos(a-u),c=Math.atan2(l,f),isNaN(c)?0:c*e.RADIANS_TO_DEGREES)},o.greatCircleDistance=function(r,i){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleDistance","missingLocation"));var s=r.latitude*e.DEGREES_TO_RADIANS,o=i.latitude*e.DEGREES_TO_RADIANS,u=r.longitude*e.DEGREES_TO_RADIANS,a=i.longitude*e.DEGREES_TO_RADIANS,f,l,c,h;return s==o&&u==a?0:(f=Math.sin((o-s)/2),l=Math.sin((a-u)/2),c=f*f+Math.cos(s)*Math.cos(o)*l*l,h=2*Math.asin(Math.sqrt(c)),isNaN(h)?0:h)},o.greatCircleLocation=function(r,i,s,o){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleLocation","missingLocation"));if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleLocation","missingResult"));if(s==0)return o.latitude=r.latitude,o.longitude=r.longitude,o;var u=r.latitude*e.DEGREES_TO_RADIANS,a=r.longitude*e.DEGREES_TO_RADIANS,f=i*e.DEGREES_TO_RADIANS,l,c;return l=Math.asin(Math.sin(u)*Math.cos(s)+Math.cos(u)*Math.sin(s)*Math.cos(f)),c=a+Math.atan2(Math.sin(s)*Math.sin(f),Math.cos(u)*Math.cos(s)-Math.sin(u)*Math.sin(s)*Math.cos(f)),isNaN(l)||isNaN(c)?(o.latitude=r.latitude,o.longitude=r.longitude):(o.latitude=e.normalizedDegreesLatitude(l*e.RADIANS_TO_DEGREES),o.longitude=e.normalizedDegreesLongitude(c*e.RADIANS_TO_DEGREES)),o},o.interpolateRhumb=function(e,r,i,o){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateRhumb","missingLocation"));if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateRhumb","missingResult"));if(r.equals(i))return o.latitude=r.latitude,o.longitude=r.longitude,o;var u=s.clamp(e,0,1),a=this.rhumbAzimuth(r,i),f=this.rhumbDistance(r,i);return this.rhumbLocation(r,a,u*f,o)},o.rhumbAzimuth=function(r,i){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","rhumbAzimuth","missingLocation"));var o=r.latitude*e.DEGREES_TO_RADIANS,u=i.latitude*e.DEGREES_TO_RADIANS,a=r.longitude*e.DEGREES_TO_RADIANS,f=i.longitude*e.DEGREES_TO_RADIANS,l,c,h;return o==u&&a==f?0:(l=f-a,c=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),s.fabs(l)>Math.PI&&(l=l>0?-(2*Math.PI-l):2*Math.PI+l),h=Math.atan2(l,c),isNaN(h)?0:h*e.RADIANS_TO_DEGREES)},o.rhumbDistance=function(r,i){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","rhumbDistance","missingLocation"));var o=r.latitude*e.DEGREES_TO_RADIANS,u=i.latitude*e.DEGREES_TO_RADIANS,a=r.longitude*e.DEGREES_TO_RADIANS,f=i.longitude*e.DEGREES_TO_RADIANS,l,c,h,p,d;if(o==u&&a==f)return 0;l=u-o,c=f-a,h=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),p=l/h;if(isNaN(h)||isNaN(p))p=Math.cos(o);return s.fabs(c)>Math.PI&&(c=c>0?-(2*Math.PI-c):2*Math.PI+c),d=Math.sqrt(l*l+p*p*c*c),isNaN(d)?0:d},o.rhumbLocation=function(r,i,o,u){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","rhumbLocation","missingLocation"));if(!u)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","rhumbLocation","missingResult"));if(o==0)return u.latitude=r.latitude,u.longitude=r.longitude,u;var a=r.latitude*e.DEGREES_TO_RADIANS,f=r.longitude*e.DEGREES_TO_RADIANS,l=i*e.DEGREES_TO_RADIANS,c=a+o*Math.cos(l),h=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),p=(c-a)/h,d,v;if(isNaN(h)||isNaN(p)||!isFinite(p))p=Math.cos(a);return d=o*Math.sin(l)/p,s.fabs(c)>Math.PI/2&&(c=c>0?Math.PI-c:-Math.PI-c),v=s.fmod(f+d+Math.PI,2*Math.PI)-Math.PI,isNaN(c)||isNaN(v)?(u.latitude=r.latitude,u.longitude=r.longitude):(u.latitude=e.normalizedDegreesLatitude(c*e.RADIANS_TO_DEGREES),u.longitude=e.normalizedDegreesLongitude(v*e.RADIANS_TO_DEGREES)),u},o.interpolateLinear=function(e,r,i,o){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateLinear","missingLocation"));if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateLinear","missingResult"));if(r.equals(i))return o.latitude=r.latitude,o.longitude=r.longitude,o;var u=s.clamp(e,0,1),a=this.linearAzimuth(r,i),f=this.linearDistance(r,i);return this.linearLocation(r,a,u*f,o)},o.linearAzimuth=function(r,i){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","linearAzimuth","missingLocation"));var o=r.latitude*e.DEGREES_TO_RADIANS,u=i.latitude*e.DEGREES_TO_RADIANS,a=r.longitude*e.DEGREES_TO_RADIANS,f=i.longitude*e.DEGREES_TO_RADIANS,l,c,h;return o==u&&a==f?0:(l=f-a,c=u-o,s.fabs(l)>Math.PI&&(l=l>0?-(2*Math.PI-l):2*Math.PI+l),h=Math.atan2(l,c),isNaN(h)?0:h*e.RADIANS_TO_DEGREES)},o.linearDistance=function(r,i){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","linearDistance","missingLocation"));var o=r.latitude*e.DEGREES_TO_RADIANS,u=i.latitude*e.DEGREES_TO_RADIANS,a=r.longitude*e.DEGREES_TO_RADIANS,f=i.longitude*e.DEGREES_TO_RADIANS,l,c,h;return o==u&&a==f?0:(l=u-o,c=f-a,s.fabs(c)>Math.PI&&(c=c>0?-(2*Math.PI-c):2*Math.PI+c),h=Math.sqrt(l*l+c*c),isNaN(h)?0:h)},o.linearLocation=function(r,i,o,u){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","linearLocation","missingLocation"));if(!u)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","linearLocation","missingResult"));if(o==0)return u.latitude=r.latitude,u.longitude=r.longitude,u;var a=r.latitude*e.DEGREES_TO_RADIANS,f=r.longitude*e.DEGREES_TO_RADIANS,l=i*e.DEGREES_TO_RADIANS,c=a+o*Math.cos(l),h;return s.fabs(c)>Math.PI/2&&(c=c>0?Math.PI-c:-Math.PI-c),h=s.fmod(f+o*Math.sin(l)+Math.PI,2*Math.PI)-Math.PI,isNaN(c)||isNaN(h)?(u.latitude=r.latitude,u.longitude=r.longitude):(u.latitude=e.normalizedDegreesLatitude(c*e.RADIANS_TO_DEGREES),u.longitude=e.normalizedDegreesLongitude(h*e.RADIANS_TO_DEGREES)),u},o.locationsCrossDateLine=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","locationsCrossDateline","missingLocation"));var r=null;for(var i=0,o=e.length;i<o;i+=1){var u=e[i];if(r!=null&&s.signum(r.longitude)!=s.signum(u.longitude)){var a=Math.abs(r.longitude-u.longitude);if(a>180&&a<360)return!0}r=u}return!1},o.greatCircleArcExtremeLocations=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleArcExtremeLocations","missingLocation"));var r=null,i=null,s=null;for(var u=0,a=e.length;u<a;u+=1){var f=e[u];if(s!=null){var l=o.greatCircleArcExtremeForTwoLocations(s,f);if(l==null)continue;if(r==null||r.latitude>l[0].latitude)r=l[0];if(i==null||i.latitude<l[1].latitude)i=l[1]}s=f}return[r,i]},o.greatCircleArcExtremeForTwoLocations=function(e,r){if(!e||!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleArcExtremeForTwoLocations","missingLocation"));var i,u,a,f=null,l=null,c=90,h=-90,p=[e,r];for(i=0,u=p.length;i<u;i+=1)a=p[i],c>=a.latitude&&(c=a.latitude,f=a),h<=a.latitude&&(h=a.latitude,l=a);var d=o.greatCircleAzimuth(e,r),v=o.greatCircleDistance(e,r),m=o.greatCircleExtremeLocationsUsingAzimuth(e,d);for(i=0,u=m.length;i<u;i+=1){a=m[i];var g=o.greatCircleAzimuth(e,a),y=o.greatCircleDistance(e,a);s.signum(g)==s.signum(d)&&y>=0&&y<=v&&(c>=a.latitude&&(c=a.latitude,f=a),h<=a.latitude&&(h=a.latitude,l=a))}return[f,l]},o.greatCircleExtremeLocationsUsingAzimuth=function(r,i){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleArcExtremeLocationsUsingAzimuth","missingLocation"));var s=r.latitude,u=i*e.DEGREES_TO_RADIANS,a=-Math.tan(s)/Math.cos(u),f=Math.atan(a),l=f+Math.PI/2,c=f-Math.PI/2;return[o.greatCircleLocation(r,i,l,new o(0,0)),o.greatCircleLocation(r,i,c,new o(0,0))]},o.intersectionWithMeridian=function(e,t,n,s){var o=s.computePointFromLocation(e.latitude,e.longitude,new i(0,0,0)),u=s.computePointFromLocation(t.latitude,t.longitude,new i(0,0,0)),a=s.computePointFromLocation(90,n,new i(0,0,0)),f=s.computePointFromLocation(0,n,new i(0,0,0)),l=r.fromPoints(a,f,i.ZERO),c=new i(0,0,0);if(!l.intersectsSegmentAt(o,u,c))return null;var h=new WorldWind.Position(0,0,0);return s.computePositionFromPoint(c[0],c[1],c[2],h),h.latitude},o.poles={NONE:0,NORTH:1,SOUTH:2},o}),n("geom/Position",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../util/WWMath"],function(e,t,n,r,i){"use strict";var s=function(e,t,n){this.latitude=e,this.longitude=t,this.altitude=n};return s.ZERO=new s(0,0,0),s.fromRadians=function(t,n,r){return new s(t*e.RADIANS_TO_DEGREES,n*e.RADIANS_TO_DEGREES,r)},s.prototype.copy=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","copy","missingPosition"));return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this},s.prototype.equals=function(e){return e&&e.latitude===this.latitude&&e.longitude===this.longitude&&e.altitude===this.altitude},s.interpolateGreatCircle=function(e,s,o,u){if(!s||!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateGreatCircle","missingPosition"));if(!u)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateGreatCircle","missingResult"));var a=i.clamp(e,0,1);return u.altitude=i.interpolate(a,s.altitude,o.altitude),n.interpolateGreatCircle(a,s,o,u),u},s.interpolateRhumb=function(e,s,o,u){if(!s||!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateRhumb","missingPosition"));if(!u)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateRhumb","missingResult"));var a=i.clamp(e,0,1);return u.altitude=i.interpolate(a,s.altitude,o.altitude),n.interpolateRhumb(a,s,o,u),u},s.interpolateLinear=function(e,s,o,u){if(!s||!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateLinear","missingPosition"));if(!u)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateLinear","missingResult"));var a=i.clamp(e,0,1);return u.altitude=i.interpolate(a,s.altitude,o.altitude),n.interpolateLinear(a,s,o,u),u},s.prototype.toString=function(){return"("+this.latitude.toString()+"°, "+this.longitude.toString()+"°, "+this.altitude.toString()},s}),n("render/Texture",["../error/ArgumentError","../util/Logger","../util/WWMath"],function(e,t,n){"use strict";var r=function(r,i){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Texture","constructor","missingGlContext"));if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Texture","constructor","missingImage"));var s=r.createTexture(),o=n.isPowerOfTwo(i.width)&&n.isPowerOfTwo(i.height);this.imageWidth=i.width,this.imageHeight=i.height,this.size=i.width*i.height*4,this.originalImageWidth=this.imageWidth,this.originalImageHeight=this.imageHeight,r.bindTexture(r.TEXTURE_2D,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,o?r.LINEAR_MIPMAP_LINEAR:r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);var u=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");u&&r.texParameteri(r.TEXTURE_2D,u.TEXTURE_MAX_ANISOTROPY_EXT,4),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),o&&r.generateMipmap(r.TEXTURE_2D),this.textureId=s,this.creationTime=new Date};return r.prototype.dispose=function(e){e.deleteTexture(this.textureId),delete this.textureId},r.prototype.bind=function(e){return e.currentGlContext.bindTexture(e.currentGlContext.TEXTURE_2D,this.textureId),e.frameStatistics.incrementTextureLoadCount(1),!0},r}),n("geom/Matrix",["../geom/Angle","../error/ArgumentError","../util/Logger","../geom/Plane","../geom/Position","../geom/Rectangle","../render/Texture","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a){"use strict";var f=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){this[0]=e,this[1]=t,this[2]=n,this[3]=r,this[4]=i,this[5]=s,this[6]=o,this[7]=u,this[8]=a,this[9]=f,this[10]=l,this[11]=c,this[12]=h,this[13]=p,this[14]=d,this[15]=v};return f.prototype=new Float64Array(16),f.fromIdentity=function(){return new f(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},f.principalAxesFromPoints=function(e,r,i,s){if(!e||e.length<1)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","principalAxesFromPoints","missingPoints"));if(!r||!i||!s)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","principalAxesFromPoints","An axis argument is null or undefined."));var o=f.fromIdentity();o.setToCovarianceOfPoints(e),o.eigensystemFromSymmetricMatrix(r,i,s),r.normalize(),i.normalize(),s.normalize()},f.prototype.set=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){return this[0]=e,this[1]=t,this[2]=n,this[3]=r,this[4]=i,this[5]=s,this[6]=o,this[7]=u,this[8]=a,this[9]=f,this[10]=l,this[11]=c,this[12]=h,this[13]=p,this[14]=d,this[15]=v,this},f.prototype.setToIdentity=function(){this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1},f.prototype.copy=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","copy","missingMatrix"));this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15]},f.prototype.equals=function(e){return e&&this[0]==e[0]&&this[1]==e[1]&&this[2]==e[2]&&this[3]==e[3]&&this[4]==e[4]&&this[5]==e[5]&&this[6]==e[6]&&this[7]==e[7]&&this[8]==e[8]&&this[9]==e[9]&&this[10]==e[10]&&this[11]==e[11]&&this[12]==e[12]&&this[13]==e[13]&&this[14]==e[14]&&this[15]==e[15]},f.prototype.columnMajorComponents=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","columnMajorComponents","missingResult"));return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e},f.prototype.setToTranslation=function(e,t,n){return this[0]=1,this[1]=0,this[2]=0,this[3]=e,this[4]=0,this[5]=1,this[6]=0,this[7]=t,this[8]=0,this[9]=0,this[10]=1,this[11]=n,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},f.prototype.setTranslation=function(e,t,n){return this[3]=e,this[7]=t,this[11]=n,this},f.prototype.setToScale=function(e,t,n){return this[0]=e,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=t,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=n,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},f.prototype.setScale=function(e,t,n){return this[0]=e,this[5]=t,this[10]=n,this},f.prototype.setToTransposeOfMatrix=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToTransposeOfMatrix","missingMatrix"));return this[0]=e[0],this[1]=e[4],this[2]=e[8],this[3]=e[12],this[4]=e[1],this[5]=e[5],this[6]=e[9],this[7]=e[13],this[8]=e[2],this[9]=e[6],this[10]=e[10],this[11]=e[14],this[12]=e[3],this[13]=e[7],this[14]=e[11],this[15]=e[15],this},f.prototype.setToMultiply=function(e,r){if(!e||!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToMultiply","missingMatrix"));var i=e,s=r;return this[0]=i[0]*s[0]+i[1]*s[4]+i[2]*s[8]+i[3]*s[12],this[1]=i[0]*s[1]+i[1]*s[5]+i[2]*s[9]+i[3]*s[13],this[2]=i[0]*s[2]+i[1]*s[6]+i[2]*s[10]+i[3]*s[14],this[3]=i[0]*s[3]+i[1]*s[7]+i[2]*s[11]+i[3]*s[15],this[4]=i[4]*s[0]+i[5]*s[4]+i[6]*s[8]+i[7]*s[12],this[5]=i[4]*s[1]+i[5]*s[5]+i[6]*s[9]+i[7]*s[13],this[6]=i[4]*s[2]+i[5]*s[6]+i[6]*s[10]+i[7]*s[14],this[7]=i[4]*s[3]+i[5]*s[7]+i[6]*s[11]+i[7]*s[15],this[8]=i[8]*s[0]+i[9]*s[4]+i[10]*s[8]+i[11]*s[12],this[9]=i[8]*s[1]+i[9]*s[5]+i[10]*s[9]+i[11]*s[13],this[10]=i[8]*s[2]+i[9]*s[6]+i[10]*s[10]+i[11]*s[14],this[11]=i[8]*s[3]+i[9]*s[7]+i[10]*s[11]+i[11]*s[15],this[12]=i[12]*s[0]+i[13]*s[4]+i[14]*s[8]+i[15]*s[12],this[13]=i[12]*s[1]+i[13]*s[5]+i[14]*s[9]+i[15]*s[13],this[14]=i[12]*s[2]+i[13]*s[6]+i[14]*s[10]+i[15]*s[14],this[15]=i[12]*s[3]+i[13]*s[7]+i[14]*s[11]+i[15]*s[15],this},f.prototype.setToCovarianceOfPoints=function(e){if(!e||e.length<1)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToCovarianceOfPoints","missingArray"));var r,i,s,o,a=0,f=0,l=0,c=0,h=0,p=0,d=0,v=new u(0,0,0);r=u.averageOfBuffer(e,new u(0,0,0));for(var m=0,g=e.length/3;m<g;m++)v[0]=e[m*3],v[1]=e[m*3+1],v[2]=e[m*3+2],i=v[0]-r[0],s=v[1]-r[1],o=v[2]-r[2],++a,f+=i*i,l+=s*s,c+=o*o,h+=i*s,p+=i*o,d+=s*o;return this[0]=f/a,this[1]=h/a,this[2]=p/a,this[3]=0,this[4]=h/a,this[5]=l/a,this[6]=d/a,this[7]=0,this[8]=p/a,this[9]=d/a,this[10]=c/a,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=0,this},f.prototype.multiplyByTranslation=function(e,t,n){return this.multiply(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},f.prototype.multiplyByRotation=function(t,n,r,i){var s=Math.cos(i*e.DEGREES_TO_RADIANS),o=Math.sin(i*e.DEGREES_TO_RADIANS);return this.multiply(s+(1-s)*t*t,(1-s)*t*n-o*r,(1-s)*t*r+o*n,0,(1-s)*t*n+o*r,s+(1-s)*n*n,(1-s)*n*r-o*t,0,(1-s)*t*r-o*n,(1-s)*n*r+o*t,s+(1-s)*r*r,0,0,0,0,1),this},f.prototype.multiplyByScale=function(e,t,n){return this.multiply(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},f.prototype.setToUnitYFlip=function(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=-1,this[6]=0,this[7]=1,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},f.prototype.multiplyByLocalCoordinateTransform=function(e,r){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByLocalCoordinateTransform","Origin vector is null or undefined"));if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByLocalCoordinateTransform","missingGlobe"));var i=new u(0,0,0),s=new u(0,0,0),o=new u(0,0,0);return a.localCoordinateAxesAtPoint(e,r,i,s,o),this.multiply(i[0],s[0],o[0],e[0],i[1],s[1],o[1],e[1],i[2],s[2],o[2],e[2],0,0,0,1),this},f.prototype.multiplyByTextureTransform=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByTextureTransform","missingTexture"));var r=e.originalImageWidth/e.imageWidth,i=e.originalImageHeight/e.imageHeight;return this.multiply(r,0,0,0,0,-i,0,i,0,0,1,0,0,0,0,1),this},f.prototype.extractTranslation=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractTranslation","missingResult"));return e[0]=this[3],e[1]=this[7],e[2]=this[11],e},f.prototype.extractRotationAngles=function(r){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractRotationAngles","missingResult"));var i=Math.atan2(this[6],this[10]),s=Math.atan2(-this[2],Math.sqrt(this[0]*this[0]+this[1]*this[1])),o=Math.cos(i),u=Math.sin(i),a=Math.atan2(u*this[8]-o*this[4],o*this[5]-u*this[9]);return r[0]=i*e.RADIANS_TO_DEGREES,r[1]=s*e.RADIANS_TO_DEGREES,r[2]=a*e.RADIANS_TO_DEGREES,r},f.prototype.multiplyByFirstPersonModelview=function(r,i,s,o,f){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByFirstPersonModelview","missingPosition"));if(!f)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByFirstPersonModelview","missingGlobe"));var l,c,h,p,d,v,m,g,y,b,w,E,S,x,T=new u(0,0,0),N=new u(0,0,0),C=new u(0,0,0),k=new u(0,0,0);return l=Math.cos(o*e.DEGREES_TO_RADIANS),c=Math.sin(o*e.DEGREES_TO_RADIANS),this.multiply(l,c,0,0,-c,l,0,0,0,0,1,0,0,0,0,1),l=Math.cos(s*e.DEGREES_TO_RADIANS),c=Math.sin(s*e.DEGREES_TO_RADIANS),this.multiply(1,0,0,0,0,l,c,0,0,-c,l,0,0,0,0,1),l=Math.cos(i*e.DEGREES_TO_RADIANS),c=Math.sin(i*e.DEGREES_TO_RADIANS),this.multiply(l,-c,0,0,c,l,0,0,0,0,1,0,0,0,0,1),f.computePointFromPosition(r.latitude,r.longitude,r.altitude,T),h=T[0],p=T[1],d=T[2],a.localCoordinateAxesAtPoint(T,f,N,C,k),v=N[0],m=N[1],g=N[2],y=C[0],b=C[1],w=C[2],E=k[0],S=k[1],x=k[2],this.multiply(v,m,g,-v*h-m*p-g*d,y,b,w,-y*h-b*p-w*d,E,S,x,-E*h-S*p-x*d,0,0,0,1),this},f.prototype.multiplyByLookAtModelview=function(e,r,i,s,o,u){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByLookAtModelview","missingPosition"));if(r<0)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByLookAtModelview","Range is less than zero"));if(!u)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByLookAtModelview","missingGlobe"));return this.multiplyByTranslation(0,0,-r),this.multiplyByFirstPersonModelview(e,i,s,o,u),this},f.prototype.setToPerspectiveProjection=function(e,r,i,s){if(e<=0)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","invalidWidth"));if(r<=0)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","invalidHeight"));if(i===s)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","Near and far distance are the same."));if(i<=0||s<=0)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","Near or far distance is less than or equal to zero."));var o=a.perspectiveFrustumRectangle(e,r,i),u=o.getMinX(),f=o.getMaxX(),l=o.getMinY(),c=o.getMaxY();return this[0]=2*i/(f-u),this[1]=0,this[2]=(f+u)/(f-u),this[3]=0,this[4]=0,this[5]=2*i/(c-l),this[6]=(c+l)/(c-l),this[7]=0,this[8]=0,this[9]=0,this[10]=-(s+i)/(s-i),this[11]=-2*i*s/(s-i),this[12]=0,this[13]=0,this[14]=-1,this[15]=0,this},f.prototype.setToScreenProjection=function(e,r){if(e<=0)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToScreenProjection","invalidWidth"));if(r<=0)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToScreenProjection","invalidHeight"));return this[0]=2/e,this[1]=0,this[2]=0,this[3]=-1,this[4]=0,this[5]=2/r,this[6]=0,this[7]=-1,this[8]=0,this[9]=0,this[10]=2,this[11]=-1,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},f.prototype.extractEyePoint=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractEyePoint","missingResult"));return e[0]=-(this[0]*this[3])-this[4]*this[7]-this[8]*this[11],e[1]=-(this[1]*this[3])-this[5]*this[7]-this[9]*this[11],e[2]=-(this[2]*this[3])-this[6]*this[7]-this[10]*this[11],e},f.prototype.extractForwardVector=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractForwardVector","missingResult"));return e[0]=-this[8],e[1]=-this[9],e[2]=-this[10],e},f.prototype.extractViewingParameters=function(r,s,o,u){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractViewingParameters","The specified origin is null or undefined."));if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractViewingParameters","missingGlobe"));if(!u)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractViewingParameters","missingResult"));var a=new i(0,0,0),l=f.fromIdentity(),c,h,p,d,v,m,g,y,b;return o.computePositionFromPoint(r[0],r[1],r[2],a),l.copy(this),l.multiplyByLocalCoordinateTransform(r,o),c=-l[11],h=l[10],p=Math.sqrt(l[2]*l[2]+l[6]*l[6]),d=Math.atan2(p,h)*e.RADIANS_TO_DEGREES,v=Math.cos(s*e.DEGREES_TO_RADIANS),m=Math.sin(s*e.DEGREES_TO_RADIANS),g=v*l[0]-m*l[4],y=m*l[5]-v*l[1],b=Math.atan2(y,g)*e.RADIANS_TO_DEGREES,u.origin=a,u.range=c,u.heading=b,u.tilt=d,u.roll=s,u},f.prototype.offsetProjectionDepth=function(e){return this[10]*=1+e,this},f.prototype.multiplyMatrix=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyMatrix","missingMatrix"));var r=this,i=e,s,o,u,a;return s=r[0],o=r[1],u=r[2],a=r[3],r[0]=s*i[0]+o*i[4]+u*i[8]+a*i[12],r[1]=s*i[1]+o*i[5]+u*i[9]+a*i[13],r[2]=s*i[2]+o*i[6]+u*i[10]+a*i[14],r[3]=s*i[3]+o*i[7]+u*i[11]+a*i[15],s=r[4],o=r[5],u=r[6],a=r[7],r[4]=s*i[0]+o*i[4]+u*i[8]+a*i[12],r[5]=s*i[1]+o*i[5]+u*i[9]+a*i[13],r[6]=s*i[2]+o*i[6]+u*i[10]+a*i[14],r[7]=s*i[3]+o*i[7]+u*i[11]+a*i[15],s=r[8],o=r[9],u=r[10],a=r[11],r[8]=s*i[0]+o*i[4]+u*i[8]+a*i[12],r[9]=s*i[1]+o*i[5]+u*i[9]+a*i[13],r[10]=s*i[2]+o*i[6]+u*i[10]+a*i[14],r[11]=s*i[3]+o*i[7]+u*i[11]+a*i[15],s=r[12],o=r[13],u=r[14],a=r[15],r[12]=s*i[0]+o*i[4]+u*i[8]+a*i[12],r[13]=s*i[1]+o*i[5]+u*i[9]+a*i[13],r[14]=s*i[2]+o*i[6]+u*i[10]+a*i[14],r[15]=s*i[3]+o*i[7]+u*i[11]+a*i[15],this},f.prototype.multiply=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this,g,y,b,w;return g=m[0],y=m[1],b=m[2],w=m[3],m[0]=g*e+y*i+b*a+w*h,m[1]=g*t+y*s+b*f+w*p,m[2]=g*n+y*o+b*l+w*d,m[3]=g*r+y*u+b*c+w*v,g=m[4],y=m[5],b=m[6],w=m[7],m[4]=g*e+y*i+b*a+w*h,m[5]=g*t+y*s+b*f+w*p,m[6]=g*n+y*o+b*l+w*d,m[7]=g*r+y*u+b*c+w*v,g=m[8],y=m[9],b=m[10],w=m[11],m[8]=g*e+y*i+b*a+w*h,m[9]=g*t+y*s+b*f+w*p,m[10]=g*n+y*o+b*l+w*d,m[11]=g*r+y*u+b*c+w*v,g=m[12],y=m[13],b=m[14],w=m[15],m[12]=g*e+y*i+b*a+w*h,m[13]=g*t+y*s+b*f+w*p,m[14]=g*n+y*o+b*l+w*d,m[15]=g*r+y*u+b*c+w*v,this},f.prototype.invertMatrix=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","invertMatrix","missingMatrix"));var r=[[],[],[],[]];r[0][0]=e[0],r[0][1]=e[1],r[0][2]=e[2],r[0][3]=e[3],r[1][0]=e[4],r[1][1]=e[5],r[1][2]=e[6],r[1][3]=e[7],r[2][0]=e[8],r[2][1]=e[9],r[2][2]=e[10],r[2][3]=e[11],r[3][0]=e[12],r[3][1]=e[13],r[3][2]=e[14],r[3][3]=e[15];var i=[],s=f.ludcmp(r,i),o,u;for(o=0;o<4;o+=1)s*=r[o][o];if(Math.abs(s)<1e-8)return null;var a=[[],[],[],[]],l=[];for(u=0;u<4;u+=1){for(o=0;o<4;o+=1)l[o]=0;l[u]=1,f.lubksb(r,i,l);for(o=0;o<4;o+=1)a[o][u]=l[o]}return this[0]=a[0][0],this[1]=a[0][1],this[2]=a[0][2],this[3]=a[0][3],this[4]=a[1][0],this[5]=a[1][1],this[6]=a[1][2],this[7]=a[1][3],this[8]=a[2][0],this[9]=a[2][1],this[10]=a[2][2],this[11]=a[2][3],this[12]=a[3][0],this[13]=a[3][1],this[14]=a[3][2],this[15]=a[3][3],this},f.lubksb=function(e,t,n){var r=-1,i,s,o;for(i=0;i<4;i+=1){var u=t[i];o=n[u],n[u]=n[i];if(r!=-1)for(s=r;s<=i-1;s+=1)o-=e[i][s]*n[s];else o!=0&&(r=i);n[i]=o}for(i=3;i>=0;i-=1){o=n[i];for(s=i+1;s<4;s+=1)o-=e[i][s]*n[s];n[i]=o/e[i][i]}},f.ludcmp=function(e,t){var n=1e-20,r=[],i=1,s,o,u,a,f,l,c,h;for(o=0;o<4;o+=1){f=0;for(u=0;u<4;u+=1)(s=Math.abs(e[o][u]))>f&&(f=s);if(f==0)return 0;r[o]=1/f}for(u=0;u<4;u+=1){for(o=0;o<u;o+=1){l=e[o][u];for(a=0;a<o;a+=1)l-=e[o][a]*e[a][u];e[o][u]=l}f=0,c=-1;for(o=u;o<4;o+=1){l=e[o][u];for(a=0;a<u;a++)l-=e[o][a]*e[a][u];e[o][u]=l,(h=r[o]*Math.abs(l))>=f&&(f=h,c=o)}if(u!=c){for(a=0;a<4;a+=1)h=e[c][a],e[c][a]=e[u][a],e[u][a]=h;i=-i,r[c]=r[u]}t[u]=c,e[u][u]==0&&(e[u][u]=n);if(u!=3){h=1/e[u][u];for(o=u+1;o<4;o+=1)e[o][u]*=h}}return i},f.prototype.invertOrthonormalMatrix=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","invertOrthonormalMatrix","missingMatrix"));var r=e;return this[0]=r[0],this[1]=r[4],this[2]=r[8],this[3]=0-r[0]*r[3]-r[4]*r[7]-r[8]*r[11],this[4]=r[1],this[5]=r[5],this[6]=r[9],this[7]=0-r[1]*r[3]-r[5]*r[7]-r[9]*r[11],this[8]=r[2],this[9]=r[6],this[10]=r[10],this[11]=0-r[2]*r[3]-r[6]*r[7]-r[10]*r[11],this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},f.prototype.eigensystemFromSymmetricMatrix=function(e,r,i){if(!e||!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","eigensystemFromSymmetricMatrix","missingResult"));if(this[1]!=this[4]||this[2]!=this[8]||this[6]!=this[9])throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","eigensystemFromSymmetricMatrix","Matrix is not symmetric"));var s=1e-10,o=this[0],u=this[1],f=this[2],l=this[5],c=this[6],h=this[10],p=[[1,0,0],[0,1,0],[0,0,1]],d=32,v,m,g,y,b,w,E,S,x,T,N;for(var C=0;C<d;C++){if(a.fabs(u)<s&&a.fabs(f)<s&&a.fabs(c)<s)break;if(u!=0){v=(l-o)*.5/u,m=v*v,g=m+1,y=g!=m?(v<0?-1:1)*(Math.sqrt(g)-a.fabs(v)):.5/v,b=1/Math.sqrt(y*y+1),w=b*y,o-=y*u,l+=y*u,u=0,E=b*f-w*c,c=w*f+b*c,f=E;for(S=0;S<3;S++)E=b*p[S][0]-w*p[S][1],p[S][1]=w*p[S][0]+b*p[S][1],p[S][0]=E}if(f!=0){v=(h-o)*.5/f,m=v*v,g=m+1,y=g!=m?(v<0?-1:1)*(Math.sqrt(g)-a.fabs(v)):.5/v,b=1/Math.sqrt(y*y+1),w=b*y,o-=y*f,h+=y*f,f=0,E=b*u-w*c,c=w*u+b*c,u=E;for(S=0;S<3;S++)E=b*p[S][0]-w*p[S][2],p[S][2]=w*p[S][0]+b*p[S][2],p[S][0]=E}if(c!=0){v=(h-l)*.5/c,m=v*v,g=m+1,y=g!=m?(v<0?-1:1)*(Math.sqrt(g)-a.fabs(v)):.5/v,b=1/Math.sqrt(y*y+1),w=b*y,l-=y*c,h+=y*c,c=0,E=b*u-w*f,f=w*u+b*f,u=E;for(S=0;S<3;S++)E=b*p[S][1]-w*p[S][2],p[S][2]=w*p[S][1]+b*p[S][2],p[S][1]=E}}x=0,T=1,N=2,o<l&&(E=o,o=l,l=E,E=x,x=T,T=E),l<h&&(E=l,l=h,h=E,E=T,T=N,N=E),o<l&&(E=o,o=l,l=E,E=x,x=T,T=E),e[0]=p[0][x],e[1]=p[1][x],e[2]=p[2][x],r[0]=p[0][T],r[1]=p[1][T],r[2]=p[2][T],i[0]=p[0][N],i[1]=p[1][N],i[2]=p[2][N],e.normalize(),r.normalize(),i.normalize(),e.multiply(o),r.multiply(l),i.multiply(h)},f.prototype.upper3By3=function(){var e=f.fromIdentity();return e[0]=this[0],e[1]=this[1],e[2]=this[2],e[4]=this[4],e[5]=this[5],e[6]=this[6],e[8]=this[8],e[9]=this[9],e[10]=this[10],e},f}),n("pick/PickedObject",[],function(){"use strict";var e=function(e,t,n,r,i){this.color=e,this.userObject=t,this.position=n,this.parentLayer=r,this.isTerrain=i,this.isOnTop=!1};return e}),n("error/UnsupportedOperationError",["../error/AbstractError"],function(e){"use strict";var t=function(t){e.call(this,"UnsupportedOperationError",t);var n;try{throw new Error}catch(r){n=r.stack}this.stack=n};return t.prototype=Object.create(e.prototype),t}),n("render/Renderable",["../util/Logger","../error/UnsupportedOperationError"],function(e,t){"use strict";var n=function(){this.displayName="Renderable",this.enabled=!0,this.pickDelegate=null};return n.prototype.render=function(n){throw new t(e.logMessage(e.LEVEL_SEVERE,"Renderable","render","abstractInvocation"))},n}),n("shapes/Annotation",["../shapes/AnnotationAttributes","../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Font","../util/Insets","../util/Logger","../geom/Matrix","../util/Offset","../pick/PickedObject","../render/Renderable","../shapes/TextAttributes","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){"use strict";var v=function(n,r){if(!n)throw new t(o.logMessage(o.LEVEL_SEVERE,"Annotation","constructor","missingPosition"));l.call(this),this.position=n,this.attributes=r?r:new e(null),this.altitudeMode=WorldWind.ABSOLUTE,this.layer=null,this.lastStateKey=null,this.calloutTransform=u.fromIdentity(),this.calloutOffset=new WorldWind.Offset(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,0),this.label="",this.labelTexture=null,this.labelTransform=u.fromIdentity(),this.placePoint=new p(0,0,0),this.depthOffset=-2.05,this.calloutPoints=null};return v.matrix=u.fromIdentity(),v.screenPoint=new p(0,0,0),v.scratchPoint=new p(0,0,0),v.prototype=Object.create(l.prototype),Object.defineProperties(v.prototype,{text:{get:function(){return this.label},set:function(e){this.label=e,this.lastStateKey=null}}}),v.prototype.renderOrdered=function(e){this.drawOrderedAnnotation(e);if(e.pickingMode){var t=new f(this.pickColor.clone(),this,this.position,this.layer,!1);e.pickPoint&&this.labelBounds.containsPoint(e.navigatorState.convertPointToViewport(e.pickPoint,v.scratchPoint))&&(t.labelPicked=!0),e.resolvePick(t)}},v.prototype.clone=function(){var e=new v(this.position);return e.copy(this),e.pickDelegate=this.pickDelegate?this.pickDelegate:this,e},v.prototype.copy=function(e){return this.position=e.position,this.enabled=e.enabled,this.attributes=e.attributes,this.label=e.label,this.altitudeMode=e.altitudeMode,this.pickDelegate=e.pickDelegate,this.depthOffset=e.depthOffset,this},v.prototype.render=function(e){if(!this.enabled)return;if(!e.accumulateOrderedRenderables)return;if(e.globe.projectionLimits&&!e.globe.projectionLimits.containsLocation(this.position.latitude,this.position.longitude))return;var t;if(this.lastFrameTime!==e.timestamp)t=this.makeOrderedRenderable(e);else{var n=this.clone();t=n.makeOrderedRenderable(e)}if(!t)return;t.layer=e.currentLayer,this.lastFrameTime=e.timestamp,e.addOrderedRenderable(t)},v.prototype.drawOrderedAnnotation=function(e){this.beginDrawing(e);try{this.doDrawOrderedAnnotation(e)}finally{this.endDrawing(e)}},v.prototype.makeOrderedRenderable=function(e){var t,n,r,i,s,o,u,a,f;this.label=e.textSupport.wrap(this.label,this.attributes.width,this.attributes.height,this.attributes.textAttributes.font),e.surfacePointForMode(this.position.latitude,this.position.longitude,this.position.altitude,this.altitudeMode,this.placePoint),this.eyeDistance=e.navigatorState.eyePoint.distanceTo(this.placePoint);if(!e.navigatorState.projectWithDepth(this.placePoint,this.depthOffset,v.screenPoint))return null;var l=this.attributes.textAttributes.font,c=this.label+l.toString();this.labelTexture=e.gpuResourceCache.resourceForKey(c),this.labelTexture||(this.labelTexture=e.textSupport.createTexture(e,this.label,l,!1),e.gpuResourceCache.putResource(c,this.labelTexture,this.labelTexture.size)),t=this.labelTexture.imageWidth,n=this.labelTexture.imageHeight,r=this.attributes.scale,i=this.attributes.insets.left,s=this.attributes.insets.right,o=this.attributes.insets.top,u=this.attributes.insets.bottom,f=this.attributes.leaderGapHeight,a=this.calloutOffset.offsetForSize((t+i+s)*r,(n+o+u)*r),this.calloutTransform.setTranslation(v.screenPoint[0]-a[0],v.screenPoint[1]+f,v.screenPoint[2]),this.labelTransform.setTranslation(v.screenPoint[0]-a[0]+i*r,v.screenPoint[1]+f+u*r,v.screenPoint[2]),this.labelTransform.setScale(t*r,n*r,1),this.labelBounds=d.boundingRectForUnitQuad(this.labelTransform);var h=(t+i+s)*r,p=(n+o+u)*r,m=h/2,g=-f;return this.attributes.drawLeader||(g=0),this.attributes.stateKey!=this.lastStateKey&&(this.calloutPoints=this.createCallout(h,p,m,g,this.attributes.leaderGapWidth,this.attributes.cornerRadius)),this},v.prototype.beginDrawing=function(e){var t=e.currentGlContext,r;e.findAndBindProgram(n),r=e.currentProgram,t.enableVertexAttribArray(r.vertexPointLocation),t.enableVertexAttribArray(r.vertexTexCoordLocation),r.loadModulateColor(t,e.pickingMode)},v.prototype.endDrawing=function(e){var t=e.currentGlContext,n=e.currentProgram;t.disableVertexAttribArray(n.vertexPointLocation),t.disableVertexAttribArray(n.vertexTexCoordLocation),e.bindProgram(null)},v.prototype.drawCorner=function(e,t,n,r,i,s,o,u){if(n<1)return u;var a=(i-r)/(s-1);for(var f=1;f<s-1;f++){var l=r+a*f,c=e+Math.cos(l)*n,h=t+Math.sin(l)*n;o[u++]=c,o[u++]=h}return u},v.prototype.createCallout=function(e,t,n,r,i,s){var o=16,u=2*(12+(s<1?0:4*(o-2))),a=new Float32Array(u),f=0;return a[f++]=e/2+i/2,a[f++]=0,a[f++]=e-s,a[f++]=0,f=this.drawCorner(e-s,s,s,-Math.PI/2,0,o,a,f),a[f++]=e,a[f++]=s,a[f++]=e,a[f++]=t-s,f=this.drawCorner(e-s,t-s,s,0,Math.PI/2,o,a,f),a[f++]=e-s,a[f++]=t,a[f++]=s,a[f++]=t,f=this.drawCorner(s,t-s,s,Math.PI/2,Math.PI,o,a,f),a[f++]=0,a[f++]=t-s,a[f++]=0,a[f++]=s,f=this.drawCorner(s,s,s,Math.PI,Math.PI*1.5,o,a,f),a[f++]=s,a[f++]=0,a[f++]=e/2-i/2,a[f++]=0,a[f++]=n,a[f++]=r,a[f++]=e/2+i/2,a[f]=0,a},v.prototype.doDrawOrderedAnnotation=function(e){var t=e.currentGlContext,n=e.currentProgram,r,i=!1;e.pickingMode&&(this.pickColor=e.uniquePickColor()),n.loadOpacity(t,this.attributes.opacity);var s=this.attributes.stateKey!=this.lastStateKey;if(!this.calloutCacheKey||s)this.calloutCacheKey=e.gpuResourceCache.generateCacheKey();var o=e.gpuResourceCache.resourceForKey(this.calloutCacheKey);o||(o=t.createBuffer(),e.gpuResourceCache.putResource(this.calloutCacheKey,o,this.calloutPoints.length*4),i=!0),s&&this.calloutCacheKey&&e.gpuResourceCache.removeResource(this.calloutCacheKey),this.lastStateKey=this.attributes.stateKey,v.matrix.copy(e.screenProjection),v.matrix.multiplyMatrix(this.calloutTransform),n.loadModelviewProjection(t,v.matrix),t.bindBuffer(t.ARRAY_BUFFER,o),i&&(t.bufferData(t.ARRAY_BUFFER,this.calloutPoints,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1)),n.loadColor(t,e.pickingMode?this.pickColor:this.attributes.backgroundColor),n.loadTextureEnabled(t,!1),t.vertexAttribPointer(n.vertexPointLocation,2,t.FLOAT,!1,0,0),t.vertexAttribPointer(n.vertexTexCoordLocation,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_FAN,0,this.calloutPoints.length/2),v.matrix.copy(e.screenProjection),v.matrix.multiplyMatrix(this.labelTransform),n.loadModelviewProjection(t,v.matrix),n.loadColor(t,e.pickingMode?this.pickColor:this.attributes.textAttributes.color),r=this.labelTexture.bind(e),n.loadTextureEnabled(t,r),t.bindBuffer(t.ARRAY_BUFFER,e.unitQuadBuffer3()),t.vertexAttribPointer(n.vertexPointLocation,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,e.unitQuadBuffer()),t.vertexAttribPointer(n.vertexTexCoordLocation,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,4)},v}),n("shaders/BasicProgram",["../error/ArgumentError","../util/Color","../shaders/GpuProgram","../util/Logger"],function(e,t,n,r){"use strict";var i=function(e){var t="attribute vec4 vertexPoint;\nuniform mat4 mvpMatrix;\nvoid main() {gl_Position = mvpMatrix * vertexPoint;}",r="precision mediump float;\nuniform vec4 color;\nvoid main() {gl_FragColor = color;}";n.call(this,e,t,r),this.vertexPointLocation=this.attributeLocation(e,"vertexPoint"),this.mvpMatrixLocation=this.uniformLocation(e,"mvpMatrix"),this.colorLocation=this.uniformLocation(e,"color")};return i.key="WorldWindGpuBasicProgram",i.prototype=Object.create(n.prototype),i.prototype.loadModelviewProjection=function(t,n){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"BasicProgram","loadModelviewProjection","missingMatrix"));this.loadUniformMatrix(t,n,this.mvpMatrixLocation)},i.prototype.loadColor=function(t,n){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"BasicProgram","loadColor","missingColor"));this.loadUniformColor(t,n,this.colorLocation)},i.prototype.loadColorComponents=function(e,t,n,r,i){this.loadUniformColorComponents(e,t,n,r,i,this.colorLocation)},i}),n("geom/Sector",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s){"use strict";var o=function(e,t,n,r){this.minLatitude=e,this.maxLatitude=t,this.minLongitude=n,this.maxLongitude=r};return o.ZERO=new o(0,0,0,0),o.FULL_SPHERE=new o(-90,90,-180,180),o.prototype.copy=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Sector","copy","missingSector"));return this.minLatitude=e.minLatitude,this.maxLatitude=e.maxLatitude,this.minLongitude=e.minLongitude,this.maxLongitude=e.maxLongitude,this},o.prototype.isEmpty=function(){return this.minLatitude===this.maxLatitude&&this.minLongitude===this.maxLongitude},o.prototype.deltaLatitude=function(){return this.maxLatitude-this.minLatitude},o.prototype.deltaLongitude=function(){return this.maxLongitude-this.minLongitude},o.prototype.centroidLatitude=function(){return.5*(this.minLatitude+this.maxLatitude)},o.prototype.centroidLongitude=function(){return.5*(this.minLongitude+this.maxLongitude)},o.prototype.centroid=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Sector","centroid","missingResult"));return e.latitude=this.centroidLatitude(),e.longitude=this.centroidLongitude(),e},o.prototype.minLatitudeRadians=function(){return this.minLatitude*e.DEGREES_TO_RADIANS},o.prototype.maxLatitudeRadians=function(){return this.maxLatitude*e.DEGREES_TO_RADIANS},o.prototype.minLongitudeRadians=function(){return this.minLongitude*e.DEGREES_TO_RADIANS},o.prototype.maxLongitudeRadians=function(){return this.maxLongitude*e.DEGREES_TO_RADIANS},o.prototype.setToBoundingSector=function(e){if(!e||e.length<2)throw new t(r.logMessage(r.LEVEL_SEVERE,"Sector","setToBoundingSector","missingArray"));var n=90,i=-90,s=180,o=-180;for(var u=0,a=e.length;u<a;u+=1){var f=e[u];if(!f)continue;n=Math.min(n,f.latitude),i=Math.max(i,f.latitude),s=Math.min(s,f.longitude),o=Math.max(o,f.longitude)}return this.minLatitude=n,this.maxLatitude=i,this.minLongitude=s,this.maxLongitude=o,this},o.splitBoundingSectors=function(e){if(!e||e.length<2)throw new t(r.logMessage(r.LEVEL_SEVERE,"Sector","splitBoundingSectors","missingArray"));var n=90,i=180,u=-90,a=-180,f=null;for(var l=0,c=e.length;l<c;l+=1){var h=e[l],p=h.latitude;p<n&&(n=p),p>u&&(u=p);var d=h.longitude;d>=0&&d<i&&(i=d),d<=0&&d>a&&(a=d);if(f!=null){var v=f.longitude;s.signum(d)!=s.signum(v)&&Math.abs(d-v)<180&&(a=0,i=0)}f=h}return n===u&&i===a?null:[new o(n,u,i,180),new o(n,u,-180,a)]},o.prototype.intersects=function(e){return e&&this.minLongitude<=e.maxLongitude&&this.maxLongitude>=e.minLongitude&&this.minLatitude<=e.maxLatitude&&this.maxLatitude>=e.minLatitude},o.prototype.overlaps=function(e){return e&&this.minLongitude<e.maxLongitude&&this.maxLongitude>e.minLongitude&&this.minLatitude<e.maxLatitude&&this.maxLatitude>e.minLatitude},o.prototype.contains=function(e){return e&&this.minLatitude<=e.minLatitude&&this.maxLatitude>=e.maxLatitude&&this.minLongitude<=e.minLongitude&&this.maxLongitude>=e.maxLongitude},o.prototype.containsLocation=function(e,t){return this.minLatitude<=e&&this.maxLatitude>=e&&this.minLongitude<=t&&this.maxLongitude>=t},o.prototype.intersection=function(e){if(!e instanceof o)throw new t(r.logMessage(r.LEVEL_SEVERE,"Sector","intersection","missingSector"));return this.minLatitude<e.minLatitude&&(this.minLatitude=e.minLatitude),this.maxLatitude>e.maxLatitude&&(this.maxLatitude=e.maxLatitude),this.minLongitude<e.minLongitude&&(this.minLongitude=e.minLongitude),this.maxLongitude>e.maxLongitude&&(this.maxLongitude=e.maxLongitude),this.maxLatitude<this.minLatitude&&(this.maxLatitude=this.minLatitude),this.maxLongitude<this.minLongitude&&(this.maxLongitude=this.minLongitude),this},o.prototype.union=function(e){if(!e instanceof o)throw new t(r.logMessage(r.LEVEL_SEVERE,"Sector","union","missingSector"));return this.minLatitude>e.minLatitude&&(this.minLatitude=e.minLatitude),this.maxLatitude<e.maxLatitude&&(this.maxLatitude=e.maxLatitude),this.minLongitude>e.minLongitude&&(this.minLongitude=e.minLongitude),this.maxLongitude<e.maxLongitude&&(this.maxLongitude=e.maxLongitude),this},o}),n("util/AbsentResourceList",[],function(){"use strict";var e=function(e,t){this.maxTrys=e,this.minCheckInterval=t,this.tryAgainInterval=6e4,this.possiblyAbsent={}};return e.prototype.isResourceAbsent=function(e){var t=this.possiblyAbsent[e];if(!t)return!1;if(t.permanent)return!0;var n=Date.now()-t.timeOfLastMark;return n>this.tryAgainInterval?(delete this.possiblyAbsent[e],!1):n<this.minCheckInterval||t.numTrys>this.maxTrys},e.prototype.markResourceAbsent=function(e){var t=this.possiblyAbsent[e];t||(t={timeOfLastMark:Date.now(),numTrys:0},this.possiblyAbsent[e]=t),t.numTrys=t.numTrys+1,t.timeOfLastMark=Date.now()},e.prototype.markResourceAbsentPermanently=function(e){var t=this.possiblyAbsent[e];t||(t={timeOfLastMark:Date.now(),numTrys:0},this.possiblyAbsent[e]=t),t.numTrys=t.numTrys+1,t.timeOfLastMark=Date.now(),t.permanent=!0},e.prototype.unmarkResourceAbsent=function(e){var t=this.possiblyAbsent[e];t&&delete this.possiblyAbsent[e]},e}),n("geom/Frustum",["../error/ArgumentError","../geom/Matrix","../geom/Plane","../util/Logger"],function(e,t,n,r){"use strict";var i=function(t,n,i,s,o,u){if(!t||!n||!i||!s||!o||!u)throw new e(r.logMessage(r.LEVEL_SEVERE,"Frustum","constructor","missingPlane"));this._left=t,this._right=n,this._bottom=i,this._top=s,this._near=o,this._far=u,this._planes=[this._left,this._right,this._top,this._bottom,this._near,this._far]};return Object.defineProperties(i.prototype,{left:{get:function(){return this._left}},right:{get:function(){return this._right}},bottom:{get:function(){return this._bottom}},top:{get:function(){return this._top}},near:{get:function(){return this._near}},far:{get:function(){return this._far}}}),i.prototype.transformByMatrix=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Frustum","transformByMatrix","missingMatrix"));return this._left.transformByMatrix(t),this._right.transformByMatrix(t),this._bottom.transformByMatrix(t),this._top.transformByMatrix(t),this._near.transformByMatrix(t),this._far.transformByMatrix(t),this},i.prototype.normalize=function(){return this._left.normalize(),this._right.normalize(),this._bottom.normalize(),this._top.normalize(),this._near.normalize(),this._far.normalize(),this},i.unitFrustum=function(){return new i(new n(1,0,0,1),new n(-1,0,0,1),new n(0,1,1,1),new n(0,-1,0,1),new n(0,0,-1,1),new n(0,0,1,1))},i.fromProjectionMatrix=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Frustum","fromProjectionMatrix","missingMatrix"));var s,o,u,a,f,l,c,h,p,d,v;return s=t[12]+t[0],o=t[13]+t[1],u=t[14]+t[2],a=t[15]+t[3],f=Math.sqrt(s*s+o*o+u*u),l=new n(s/f,o/f,u/f,a/f),s=t[12]-t[0],o=t[13]-t[1],u=t[14]-t[2],a=t[15]-t[3],f=Math.sqrt(s*s+o*o+u*u),c=new n(s/f,o/f,u/f,a/f),s=t[12]+t[4],o=t[13]+t[5],u=t[14]+t[6],a=t[15]+t[7],f=Math.sqrt(s*s+o*o+u*u),p=new n(s/f,o/f,u/f,a/f),s=t[12]-t[4],o=t[13]-t[5],u=t[14]-t[6],a=t[15]-t[7],f=Math.sqrt(s*s+o*o+u*u),h=new n(s/f,o/f,u/f,a/f),s=t[12]+t[8],o=t[13]+t[9],u=t[14]+t[10],a=t[15]+t[11],f=Math.sqrt(s*s+o*o+u*u),d=new n(s/f,o/f,u/f,a/f),s=t[12]-t[8],o=t[13]-t[9],u=t[14]-t[10],a=t[15]-t[11],f=Math.sqrt(s*s+o*o+u*u),v=new n(s/f,o/f,u/f,a/f),new i(l,c,p,h,d,v)},i.prototype.containsPoint=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Frustum","containsPoint","missingPoint"));return this._far.dot(t)<=0?!1:this._left.dot(t)<=0?!1:this._right.dot(t)<=0?!1:this._top.dot(t)<=0?!1:this._bottom.dot(t)<=0?!1:this._near.dot(t)<=0?!1:!0},i.prototype.intersectsSegment=function(t,n){if(!t||!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"Frustum","containsPoint","missingPoint"));if(this.containsPoint(t)||this.containsPoint(n))return!0;if(t.equals(n))return!1;for(var i=0,s=this._planes.length;i<s;i++){if(this._planes[i].onSameSide(t,n)<0)return!1;if(this._planes[i].clip(t,n)!=null)return!0}return!1},i}),n("error/NotYetImplementedError",["../error/AbstractError"],function(e){"use strict";var t=function(t){e.call(this,"NotYetImplementedError",t);var n;try{throw new Error}catch(r){n=r.stack}this.stack=n};return t.prototype=Object.create(e.prototype),t}),n("util/WWUtil",["../error/ArgumentError","../geom/Line","../util/Logger","../geom/Rectangle","../geom/Vec3"],function(e,t,n,r,i){"use strict";var s={latLonRegex:/^(\-?\d+(\.\d+)?),\s*(\-?\d+(\.\d+)?)$/,suffixForMimeType:function(e){return e==="image/png"?"png":e==="image/jpeg"?"jpg":e==="application/bil16"?"bil":e==="application/bil32"?"bil":null},currentUrlSansFilePart:function(){var e=window.location.protocol,t=window.location.host,n=window.location.pathname,r=n.split("/"),i="";for(var s=0,o=r.length;s<o-1;s++)r[s].length>0&&(i=i+"/"+r[s]);return e+"//"+t+i},worldwindlibLocation:function(){var e=document.getElementsByTagName("script"),t="/worldwindlib.";for(var n=0;n<e.length;n++){var r=e[n].src.indexOf(t);if(r>=0)return e[n].src.substring(0,r)+"/"}return null},urlPath:function(e){if(!e)return"";var t=e.split("/"),n="";for(var r=0,i=t.length;r<i;r++){var s=t[r];if(!s||s.length===0||s.indexOf(":")!=-1||s==="."||s===".."||s==="null"||s==="undefined")continue;n.length!==0&&(n+="/"),n+=s}return n},fillArray:function(e,t){if(!e)return;for(var n=0,r=e.length;n<r;n++)e[n]=t},multiplyArray:function(e,t){if(!e)return;for(var n=0,r=e.length;n<r;n++)e[n]*=t},jsonpCounter:0,jsonp:function(e,t,n){var r="gov_nasa_worldwind_jsonp_"+s.jsonpCounter++;window[r]=function(e){delete window[r],n(e)};var i=e+(e.indexOf("?")===-1?"?":"&");i+=t+"="+r;var o=document.createElement("script");o.async=!0,o.src=i;var u=document.getElementsByTagName("head")[0],a=function(){o.onload=undefined,o.onerror=undefined,u.removeChild(o)};o.onload=a,o.onerror=a,u.appendChild(o)}};return s}),n("geom/BoundingBox",["../error/ArgumentError","../shaders/BasicProgram","../geom/Frustum","../util/Logger","../geom/Matrix","../error/NotYetImplementedError","../geom/Plane","../geom/Sector","../geom/Vec3","../util/WWMath","../util/WWUtil"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(){this.center=new a(0,0,0),this.bottomCenter=new a(-0.5,0,0),this.topCenter=new a(.5,0,0),this.r=new a(1,0,0),this.s=new a(0,1,0),this.t=new a(0,0,1),this.radius=Math.sqrt(3),this.tmp1=new a(0,0,0),this.tmp2=new a(0,0,0),this.tmp3=new a(0,0,0),this.scratchElevations=new Float64Array(9),this.scratchPoints=new Float64Array(3*this.scratchElevations.length)};return c.scratchMatrix=i.fromIdentity(),c.prototype.setToPoints=function(t){if(!t||t.length<3)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","setToPoints","missingArray"));var n=+Number.MAX_VALUE,s=-Number.MAX_VALUE,o=+Number.MAX_VALUE,u=-Number.MAX_VALUE,f=+Number.MAX_VALUE,l=-Number.MAX_VALUE,c=this.r,h=this.s,p=this.t,d=new a(0,0,0),v,m,g,y,b,w,E,S,x,T,N,C,k,L,A;i.principalAxesFromPoints(t,c,h,p);for(var O=0,M=t.length/3;O<M;O++)d[0]=t[O*3],d[1]=t[O*3+1],d[2]=t[O*3+2],v=d.dot(c),n>v&&(n=v),s<v&&(s=v),m=d.dot(h),o>m&&(o=m),u<m&&(u=m),g=d.dot(p),f>g&&(f=g),l<g&&(l=g);return s===n&&(s=n+1),u===o&&(u=o+1),l===f&&(l=f+1),y=s-n,b=u-o,w=l-f,E=s+n,S=u+o,x=l+f,T=.5*c[0]*y,N=.5*c[1]*y,C=.5*c[2]*y,k=.5*(c[0]*E+h[0]*S+p[0]*x),L=.5*(c[1]*E+h[1]*S+p[1]*x),A=.5*(c[2]*E+h[2]*S+p[2]*x),this.center[0]=k,this.center[1]=L,this.center[2]=A,this.topCenter[0]=k+T,this.topCenter[1]=L+N,this.topCenter[2]=A+C,this.bottomCenter[0]=k-T,this.bottomCenter[1]=L-N,this.bottomCenter[2]=A-C,c.multiply(y),h.multiply(b),p.multiply(w),this.radius=.5*Math.sqrt(y*y+b*b+w*w),this},c.prototype.setToSector=function(t,n,i,s){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","setToSector","missingSector"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","setToSector","missingGlobe"));var o=this.scratchElevations,u=this.scratchPoints;l.fillArray(o,s),o[0]=o[2]=o[6]=o[8]=i,n.computePointsForGrid(t,3,3,o,a.ZERO,u);var c=12;this.tmp1.set(u[c],u[c+1],u[c+2]),f.localCoordinateAxesAtPoint(this.tmp1,n,this.r,this.s,this.t);var h=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],p=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],d=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(var v=0,m=u.length;v<m;v+=3)this.tmp1.set(u[v],u[v+1],u[v+2]),this.adjustExtremes(this.r,h,this.s,p,this.t,d,this.tmp1);h[1]-h[0]<p[1]-p[0]&&this.swapAxes(this.r,h,this.s,p),p[1]-p[0]<d[1]-d[0]&&this.swapAxes(this.s,p,this.t,d),h[1]-h[0]<p[1]-p[0]&&this.swapAxes(this.r,h,this.s,p);var g=h[1]-h[0],y=p[1]-p[0],b=d[1]-d[0],w=h[1]+h[0],E=p[1]+p[0],S=d[1]+d[0],x=.5*(this.r[0]*w+this.s[0]*E+this.t[0]*S),T=.5*(this.r[1]*w+this.s[1]*E+this.t[1]*S),N=.5*(this.r[2]*w+this.s[2]*E+this.t[2]*S),C=.5*this.r[0]*g,k=.5*this.r[1]*g,L=.5*this.r[2]*g;return this.center.set(x,T,N),this.topCenter.set(x+C,T+k,N+L),this.bottomCenter.set(x-C,T-k,N-L),this.r.multiply(g),this.s.multiply(y),this.t.multiply(b),this.radius=.5*Math.sqrt(g*g+y*y+b*b),this},c.prototype.translate=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","translate","missingVector"));return this.bottomCenter.add(t),this.topCenter.add(t),this.center.add(t),this},c.prototype.distanceTo=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","distanceTo","missingPoint"));var n=this.center.distanceTo(t)-this.radius;return n>=0?n:-n},c.prototype.effectiveRadius=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","effectiveRadius","missingPlane"));var n=t.normal;return.5*(f.fabs(this.r.dot(n))+f.fabs(this.s.dot(n))+f.fabs(this.t.dot(n)))},c.prototype.intersectsFrustum=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","intersectsFrustum","missingFrustum"));return this.tmp1.copy(this.bottomCenter),this.tmp2.copy(this.topCenter),this.intersectionPoint(t.near)<0?!1:this.intersectionPoint(t.far)<0?!1:this.intersectionPoint(t.left)<0?!1:this.intersectionPoint(t.right)<0?!1:this.intersectionPoint(t.top)<0?!1:this.intersectionPoint(t.bottom)<0?!1:!0},c.prototype.intersectionPoint=function(e){var t=e.normal,n=.5*(Math.abs(this.s.dot(t))+Math.abs(this.t.dot(t)));return this.intersectsAt(e,n,this.tmp1,this.tmp2)},c.prototype.intersectsAt=function(e,t,n,r){var i=e.dot(n),s=i<=-t,o=e.dot(r),u=o<=-t;if(s&&u)return-1;if(s==u)return 0;this.tmp3.copy(n),this.tmp3.subtract(r);var a=(t+i)/e.normal.dot(this.tmp3);return this.tmp3.copy(r),this.tmp3.subtract(n),this.tmp3.multiply(a),this.tmp3.add(n),s?n.copy(this.tmp3):r.copy(this.tmp3),a},c.prototype.adjustExtremes=function(e,t,n,r,i,s,o){var u=o.dot(e);t[0]>u&&(t[0]=u),t[1]<u&&(t[1]=u);var a=o.dot(n);r[0]>a&&(r[0]=a),r[1]<a&&(r[1]=a);var f=o.dot(i);s[0]>f&&(s[0]=f),s[1]<f&&(s[1]=f)},c.prototype.swapAxes=function(e,t,n,r){e.swap(n);var i=t[0];t[0]=r[0],r[0]=i,i=t[1],t[1]=r[1],r[1]=i},c.prototype.render=function(e){var n=e.currentGlContext,r=c.scratchMatrix,i=e.findAndBindProgram(t);try{r.copy(e.navigatorState.modelviewProjection),r.multiply(this.r[0],this.s[0],this.t[0],this.center[0],this.r[1],this.s[1],this.t[1],this.center[1],this.r[2],this.s[2],this.t[2],this.center[2],0,0,0,1),r.multiplyByTranslation(-0.5,-0.5,-0.5),i.loadModelviewProjection(n,r),n.disable(n.CULL_FACE),n.bindBuffer(n.ARRAY_BUFFER,e.unitCubeBuffer()),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.unitCubeElements()),n.enableVertexAttribArray(i.vertexPointLocation),n.vertexAttribPointer(i.vertexPointLocation,3,n.FLOAT,!1,0,0),i.loadColorComponents(n,0,1,0,.6),n.drawElements(n.LINES,24,n.UNSIGNED_SHORT,72),i.loadColorComponents(n,1,1,1,.3),n.drawElements(n.TRIANGLES,36,n.UNSIGNED_SHORT,0)}finally{n.enable(n.CULL_FACE),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}},c}),n("util/Tile",["../error/ArgumentError","../geom/BoundingBox","../util/Logger","../geom/Sector","../geom/Vec3","../util/WWUtil"],function(e,t,n,r,i,s){"use strict";var o=function(t,r,i,s){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","constructor","missingSector"));if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","constructor","The specified level is null or undefined."));if(i<0||s<0)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","constructor","The specified row or column is less than zero."));this.sector=t,this.level=r,this.row=i,this.column=s,this.tileWidth=r.tileWidth,this.tileHeight=r.tileHeight,this.texelSize=r.texelSize,this.tileKey=r.levelNumber.toString()+"."+i.toString()+"."+s.toString(),this.extent=null,this.referencePoint=null,this.opacity=1,this.samplePoints=null,this.sampleElevations=null,this.updateTimestamp=null,this.updateVerticalExaggeration=null,this.updateGlobeStateKey=null};return o.prototype.isEqual=function(e){return e?e.tileKey?this.tileKey==e.tileKey:!1:!1},o.prototype.size=function(){return 828},o.prototype.distanceTo=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","distanceTo","missingVector"));var r=t[0],i=t[1],s=t[2],o,u,a,f=this.samplePoints,l=Number.POSITIVE_INFINITY;for(var c=0,h=f.length;c<h;c+=3)o=r-f[c],u=i-f[c+1],a=s-f[c+2],l=Math.min(l,o*o+u*u+a*a);return Math.sqrt(l)},o.prototype.subdivide=function(t,i){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","subdivide","The specified level is null or undefined."));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","subdivide","The specified tile factory is null or undefined."));var s=this.sector.minLatitude,o=this.sector.maxLatitude,u=this.sector.centroidLatitude(),a=this.sector.minLongitude,f=this.sector.maxLongitude,l=this.sector.centroidLongitude(),c,h,p,d=[];return c=2*this.row,h=2*this.column,p=new r(s,u,a,l),d.push(i.createTile(p,t,c,h)),c=2*this.row,h=2*this.column+1,p=new r(s,u,l,f),d.push(i.createTile(p,t,c,h)),c=2*this.row+1,h=2*this.column,p=new r(u,o,a,l),d.push(i.createTile(p,t,c,h)),c=2*this.row+1,h=2*this.column+1,p=new r(u,o,l,f),d.push(i.createTile(p,t,c,h)),d},o.prototype.subdivideToCache=function(t,r,i){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","subdivideToCache","The specified level is null or undefined."));if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","subdivideToCache","The specified tile factory is null or undefined."));var s=i?i.entryForKey(this.tileKey):null;return s||(s=this.subdivide(t,r),s&&i&&i.putEntry(this.tileKey,s,4*s[0].size())),s},o.prototype.mustSubdivide=function(e,t){var n=e.globe.equatorialRadius*this.texelSize,r=this.distanceTo(e.navigatorState.eyePoint),i=e.navigatorState.pixelSizeAtDistance(r);return n>Math.max(t*i,.5)},o.prototype.update=function(e){var t=e.globe.elevationTimestamp(),n=e.verticalExaggeration,r=e.globeStateKey;if(this.updateTimestamp!=t||this.updateVerticalExaggeration!=n||this.updateGlobeStateKey!=r)this.doUpdate(e),e.frameStatistics.incrementTileUpdateCount(1),this.updateTimestamp=t,this.updateVerticalExaggeration=n,this.updateGlobeStateKey=r},o.prototype.doUpdate=function(e){var n=e.globe,r=e.verticalExaggeration,o=n.minAndMaxElevationsForSector(this.sector),u=o?o[0]*r:0,a=o?o[1]*r:0;u==a&&(u=a+10),this.extent||(this.extent=new t),this.extent.setToSector(this.sector,n,u,a),this.samplePoints||(this.sampleElevations=new Float64Array(9),this.samplePoints=new Float64Array(3*this.sampleElevations.length)),s.fillArray(this.sampleElevations,.5*(u+a)),n.computePointsForGrid(this.sector,3,3,this.sampleElevations,i.ZERO,this.samplePoints),this.referencePoint||(this.referencePoint=new i(0,0,0)),n.computePointFromPosition(this.sector.centroidLatitude(),this.sector.centroidLongitude(),0,this.referencePoint)},o.computeRow=function(e,t){var n=Math.floor((t+90)/e);return t==90&&(n-=1),n},o.computeColumn=function(e,t){var n=Math.floor((t+180)/e);return t==180&&(n-=1),n},o.computeLastRow=function(e,t){var n=Math.ceil((t+90)/e-1);return t+90<e&&(n=0),n},o.computeLastColumn=function(e,t){var n=Math.ceil((t+180)/e-1);return t+180<e&&(n=0),n},o.computeSector=function(t,i,s){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","computeSector","missingLevel"));if(i<0||s<0)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","computeSector","The specified row or column is less than zero."));var o=t.tileDelta.latitude,u=t.tileDelta.longitude,a=-90+i*o,f=-180+s*u,l=a+o,c=f+u;return new r(a,l,f,c)},o.createTilesForLevel=function(t,i,s){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","createTilesForLevel","missingLevel"));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","createTilesForLevel","The specified tile factory is null or undefined"));if(!s)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","createTilesForLevel","missingResult"));var u=t.tileDelta.latitude,a=t.tileDelta.longitude,f=t.sector,l=o.computeRow(u,f.minLatitude),c=o.computeRow(u,f.maxLatitude),h=o.computeColumn(a,f.minLongitude),p=o.computeColumn(a,f.maxLongitude),d=-90+l*u,v=-180+h*a,m=d,g,y,b;for(var w=l;w<=c;w+=1){y=m+u,g=v;for(var E=h;E<=p;E+=1){b=g+a;var S=new r(m,y,g,b),x=i.createTile(S,t,w,E);s.push(x),g=b}m=y}},o}),n("render/TextureTile",["../error/ArgumentError","../util/Logger","../util/Tile"],function(e,t,n){"use strict";var r=function(e,t,r,i){n.call(this,e,t,r,i),this.gpuCacheKey=null};return r.prototype=Object.create(n.prototype),r.prototype.size=function(){return n.prototype.size.call(this)},r.prototype.bind=function(e){var t=e.gpuResourceCache.resourceForKey(this.gpuCacheKey);return t?t.bind(e):!1},r.prototype.applyInternalTransform=function(e,t){},r}),n("render/ImageTile",["../error/ArgumentError","../util/Logger","../render/TextureTile","../util/Tile"],function(e,t,n,r){"use strict";var i=function(r,i,s,o,u){if(!u||u.length<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"ImageTile","constructor","The specified image path is null, undefined or zero length."));n.call(this,r,i,s,o),this.imagePath=u,this.fallbackTile=null,this.gpuCacheKey=u};return i.prototype=Object.create(n.prototype),i.prototype.size=function(){return this.__proto__.__proto__.size.call(this)+this.imagePath.length+8},i.prototype.bind=function(e){var t=this.__proto__.__proto__.bind.call(this,e);return t?!0:this.fallbackTile?this.fallbackTile.bind(e):!1},i.prototype.applyInternalTransform=function(e,t){this.fallbackTile&&!e.gpuResourceCache.resourceForKey(this.imagePath)&&this.applyFallbackTransform(t)},i.prototype.applyFallbackTransform=function(e){var t=this.level.levelNumber-this.fallbackTile.level.levelNumber;if(t<=0)return;var n=this.fallbackTile.sector.deltaLatitude(),r=this.fallbackTile.sector.deltaLongitude(),i=this.sector.deltaLongitude()/r,s=this.sector.deltaLatitude()/n,o=(this.sector.minLongitude-this.fallbackTile.sector.minLongitude)/r,u=(this.sector.minLatitude-this.fallbackTile.sector.minLatitude)/n;e.multiply(i,0,0,o,0,s,0,u,0,0,1,0,0,0,0,1)},i}),n("layer/Layer",["../util/Logger"],function(e){"use strict";var t=function(e){this.displayName=e?e:"Layer",this.enabled=!0,this.pickEnabled=!0,this.opacity=1,this.minActiveAltitude=-Number.MAX_VALUE,this.maxActiveAltitude=Number.MAX_VALUE,this.inCurrentFrame=!1,this.time=null};return t.prototype.refresh=function(){},t.prototype.render=function(e){this.inCurrentFrame=!1;if(!this.enabled)return;if(e.pickingMode&&!this.pickEnabled)return;if(!this.withinActiveAltitudes(e))return;if(!this.isLayerInView(e))return;this.doRender(e)},t.prototype.doRender=function(e){},t.prototype.withinActiveAltitudes=function(e){var t=e.eyePosition;return t?t.altitude>=this.minActiveAltitude&&t.altitude<=this.maxActiveAltitude:!1},t.prototype.isLayerInView=function(e){return!0},t}),n("util/Level",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger"],function(e,t,n,r){"use strict";var i=function(n,i,s){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"Level","constructor","The specified tile delta is null or undefined"));if(!s)throw new t(r.logMessage(r.LEVEL_SEVERE,"Level","constructor","The specified parent level set is null or undefined"));this.levelNumber=n,this.tileDelta=i,this.parent=s,this.texelSize=i.latitude*e.DEGREES_TO_RADIANS/s.tileHeight,this.tileWidth=s.tileWidth,this.tileHeight=s.tileHeight,this.sector=s.sector};return i.prototype.isFirstLevel=function(){return this.parent.firstLevel()==this},i.prototype.isLastLevel=function(){return this.parent.lastLevel()==this},i.prototype.previousLevel=function(){return this.parent.level(this.levelNumber-1)},i.prototype.nextLevel=function(){return this.parent.level(this.levelNumber+1)},i.prototype.compare=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Level","compare","The specified level is null or undefined"));return this.levelNumber<e.levelNumber?-1:this.levelNumber>e.levelNumber?1:0},i}),n("util/LevelSet",["../error/ArgumentError","../util/Level","../geom/Location","../util/Logger"],function(e,t,n,r){"use strict";var i=function(i,s,o,u,a){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","missingSector"));if(!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified level zero delta is null or undefined"));if(s.latitude<=0||s.longitude<=0)throw new e(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified level zero delta is less than or equal to zero."));if(o<1)throw new e(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified number of levels is less than one."));if(u<1||a<1)throw new e(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified tile width or tile height is less than one."));this.sector=i,this.levelZeroDelta=s,this.numLevels=o,this.tileWidth=u,this.tileHeight=a,this.levels=[];for(var f=0;f<o;f+=1){var l=Math.pow(2,f),c=s.latitude/l,h=s.longitude/l,p=new n(c,h),d=new t(f,p,this);this.levels[f]=d}};return i.prototype.level=function(e){return e<0||e>=this.levels.length?null:this.levels[e]},i.prototype.levelForTexelSize=function(e){var t=this.lastLevel();if(t.texelSize>=e)return t;for(var n=0,r=this.levels.length;n<r;n+=1){var i=this.levels[n];if(i.texelSize<=e)return i}return t},i.prototype.firstLevel=function(){return this.levels[0]},i.prototype.lastLevel=function(){return this.levels[this.levels.length-1]},i}),n("cache/MemoryCache",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n,r){if(!n||n<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","constructor","The specified capacity is undefined, zero or negative"));if(!r||r>=n||r<0)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","constructor","The specified low-water value is undefined, greater than or equal to the capacity, or less than 1"));this._capacity=n,this._lowWater=r,this.usedCapacity=0,this.freeCapacity=n,this.entries={},this.listeners=[]};return Object.defineProperties(n.prototype,{capacity:{get:function(){return this._capacity},set:function(n){if(!n||n<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","capacity","Specified cache capacity is undefined, 0 or negative."));var r=this._capacity;this._capacity=n,this._capacity<=this.lowWater&&(this._lowWater=.85*this._capacity),this._capacity<r&&this.makeSpace(0)}},lowWater:{get:function(){return this._lowWater},set:function(n){if(!n||n>=this._capacity||n<0)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","lowWater","Specified cache low-water value is undefined, negative or not less than the current capacity."));this._lowWater=n}}}),n.prototype.entryForKey=function(e){if(!e)return null;var t=this.entries[e];return t?(t.lastUsed=Date.now(),t.entry):null},n.prototype.putEntry=function(n,r,i){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","putEntry","missingKey."));if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","putEntry","missingEntry."));if(i<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","putEntry","The specified entry size is less than 1."));var s=this.entries[n],o;s&&this.removeEntry(n),this.usedCapacity+i>this._capacity&&this.makeSpace(i),this.usedCapacity+=i,this.freeCapacity=this._capacity-this.usedCapacity,o={key:n,entry:r,size:i,lastUsed:Date.now()},this.entries[n]=o},n.prototype.clear=function(e){if(e)for(var t in this.entries)this.entries.hasOwnProperty(t)&&this.removeCacheEntry(t);this.entries={},this.freeCapacity=this._capacity,this.usedCapacity=0},n.prototype.removeEntry=function(e){if(!e)return;var t=this.entries[e];t&&this.removeCacheEntry(t)},n.prototype.removeCacheEntry=function(e){delete this.entries[e.key],this.usedCapacity-=e.size,this.freeCapacity=this._capacity-this.usedCapacity;for(var t=0,n=this.listeners.length;t<n;t++)try{this.listeners[t].entryRemoved(e.key,e.entry)}catch(r){this.listeners[t].removalError(r,e.key,e.entry)}},n.prototype.containsKey=function(e){return e&&this.entries[e]},n.prototype.addCacheListener=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","addCacheListener","missingListener"));if(typeof n.entryRemoved!="function"||typeof n.removalError!="function")throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","addCacheListener","The specified listener does not implement the required functions."));this.listeners.push(n)},n.prototype.removeCacheListener=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","removeCacheListener","missingListener"));var r=this.listeners.indexOf(n);r>-1&&this.listeners.splice(r,1)},n.prototype.makeSpace=function(e){var t=[],n=this.usedCapacity;for(var r in this.entries)this.entries.hasOwnProperty(r)&&t.push(this.entries[r]);t.sort(function(e,t){return e.lastUsed-t.lastUsed});for(var i=0,s=t.length;i<s;i++){if(!(this.usedCapacity>this._lowWater||this.freeCapacity<e))break;this.removeCacheEntry(t[i])}},n}),n("layer/TiledImageLayer",["../util/AbsentResourceList","../error/ArgumentError","../render/ImageTile","../layer/Layer","../util/LevelSet","../util/Logger","../cache/MemoryCache","../render/Texture","../util/Tile","../util/WWUtil"],function(e,t,n,r,i,s,o,u,a,f){"use strict";var l=function(n,u,a,f,l,c,h){if(!n)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","constructor","missingSector"));if(!u)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified level-zero delta is null or undefined."));if(!f)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified image format is null or undefined."));if(!l)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified cache path is null or undefined."));if(!a||a<1)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified number of levels is less than one."));if(!c||!h||c<1||h<1)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified tile width or height is less than one."));r.call(this,"Tiled Image Layer"),this.retrievalImageFormat=f,this.cachePath=l,this.levels=new i(n,u,a,c,h),this.detailControl=1.75,this.expiration=null,this.currentTiles=[],this.currentTilesInvalid=!0,this.tileCache=new o(5e5,4e5),this.currentRetrievals=[],this.absentResourceList=new e(3,5e4),this.pickEnabled=!1};return l.prototype=Object.create(r.prototype),l.prototype.refresh=function(){this.expiration=new Date,this.currentTilesInvalid=!0},l.prototype.prePopulate=function(e){if(!e)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","prePopulate","missingWorldWindow"));var n=e.drawContext;(!this.topLevelTiles||this.topLevelTiles.length===0)&&this.createTopLevelTiles(n);for(var r=0;r<this.topLevelTiles.length;r++){var i=this.topLevelTiles[r];this.isTileTextureInMemory(n,i)||this.retrieveTileImage(n,i)}},l.prototype.isPrePopulated=function(e){if(!e)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","isPrePopulated","missingWorldWindow"));for(var n=0;n<this.topLevelTiles.length;n++)if(!this.isTileTextureInMemory(e.drawContext,this.topLevelTiles[n]))return!1;return!0},l.prototype.createTile=function(e,t,r,i){var s=this.cachePath+"-layer/"+t.levelNumber+"/"+r+"/"+r+"_"+i+"."+f.suffixForMimeType(this.retrievalImageFormat);return new n(e,t,r,i,s)},l.prototype.doRender=function(e){if(!e.terrain)return;if(this.currentTilesInvalid||!this.lasTtMVP||!e.navigatorState.modelviewProjection.equals(this.lasTtMVP)||e.globeStateKey!=this.lastGlobeStateKey){this.currentTilesInvalid=!1;if(e.surfaceOpacity>=1){this.previousTiles={};for(var t=0;t<this.currentTiles.length;t++)this.previousTiles[this.currentTiles[t].imagePath]=this.currentTiles[t];this.assembleTiles(e),this.fadeOutgoingTiles(e)}else this.assembleTiles(e)}this.lasTtMVP=e.navigatorState.modelviewProjection,this.lastGlobeStateKey=e.globeStateKey,this.currentTiles.length>0&&(e.surfaceTileRenderer.renderTiles(e,this.currentTiles,this.opacity,e.surfaceOpacity>=1),e.frameStatistics.incrementImageTileCount(this.currentTiles.length),this.inCurrentFrame=!0)},l.prototype.fadeOutgoingTiles=function(e){var t=(e.timestamp-e.previousRedrawTimestamp)/e.fadeTime,n={};for(var r=0;r<this.currentTiles.length;r++){var i=this.currentTiles[r];n[i.imagePath]=i}for(var s in this.previousTiles)this.previousTiles.hasOwnProperty(s)&&(i=this.previousTiles[s],i.opacity>0&&!n[i.imagePath]&&(i.opacity=Math.max(0,i.opacity-t),i.opacity>0&&(this.currentTiles.push(i),this.currentTilesInvalid=!0,e.redrawRequested=!0)))},l.prototype.isLayerInView=function(e){return e.terrain&&e.terrain.sector&&e.terrain.sector.intersects(this.levels.sector)},l.prototype.createTopLevelTiles=function(e){this.topLevelTiles=[],a.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles)},l.prototype.assembleTiles=function(e){this.currentTiles=[],(!this.topLevelTiles||this.topLevelTiles.length===0)&&this.createTopLevelTiles(e);for(var t=0,n=this.topLevelTiles.length;t<n;t++){var r=this.topLevelTiles[t];r.update(e),this.currentAncestorTile=null,this.isTileVisible(e,r)&&this.addTileOrDescendants(e,r)}},l.prototype.addTileOrDescendants=function(e,t){if(this.tileMeetsRenderingCriteria(e,t)){this.addTile(e,t);return}var n=null;try{if(this.isTileTextureInMemory(e,t)||t.level.levelNumber===0)n=this.currentAncestorTile,this.currentAncestorTile=t;var r=this.levels.level(t.level.levelNumber+1),i=t.subdivideToCache(r,this,this.tileCache);for(var s=0,o=i.length;s<o;s++){var u=i[s];u.update(e),this.levels.sector.intersects(u.sector)&&this.isTileVisible(e,u)&&this.addTileOrDescendants(e,u)}}finally{n&&(this.currentAncestorTile=n)}},l.prototype.addTile=function(e,t){t.fallbackTile=null;var n=e.gpuResourceCache.resourceForKey(t.imagePath);if(n){t.opacity=1,this.currentTiles.push(t),this.expiration&&this.isTextureExpired(n)&&this.retrieveTileImage(e,t);return}this.retrieveTileImage(e,t),this.currentAncestorTile&&this.isTileTextureInMemory(e,this.currentAncestorTile)&&(t.fallbackTile=this.currentAncestorTile,this.currentTiles.push(t))},l.prototype.isTileVisible=function(e,t){return e.globe.projectionLimits&&!t.sector.overlaps(e.globe.projectionLimits)?!1:t.extent.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)},l.prototype.tileMeetsRenderingCriteria=function(e,t){var n=this.detailControl;if(t.sector.minLatitude>=75||t.sector.maxLatitude<=-75)n*=1.2;return t.level.isLastLevel()||!t.mustSubdivide(e,n)},l.prototype.isTileTextureInMemory=function(e,t){return e.gpuResourceCache.containsResource(t.imagePath)},l.prototype.isTextureExpired=function(e){return this.expiration&&e.creationTime.getTime()<=this.expiration.getTime()},l.prototype.retrieveTileImage=function(e,t){if(this.currentRetrievals.indexOf(t.imagePath)<0){if(this.absentResourceList.isResourceAbsent(t.imagePath))return;var n=this.resourceUrlForTile(t,this.retrievalImageFormat),r=new Image,i=t.imagePath,o=e.gpuResourceCache,u=e.currentGlContext.canvas,a=this;if(!n){this.currentTilesInvalid=!0;return}r.onload=function(){s.log(s.LEVEL_INFO,"Image retrieval succeeded: "+n);var f=a.createTexture(e,t,r);a.removeFromCurrentRetrievals(i);if(f){o.putResource(i,f,f.size),a.currentTilesInvalid=!0,a.absentResourceList.unmarkResourceAbsent(i);var l=document.createEvent("Event");l.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),u.dispatchEvent(l)}},r.onerror=function(){a.removeFromCurrentRetrievals(i),a.absentResourceList.markResourceAbsent(i),s.log(s.LEVEL_WARNING,"Image retrieval failed: "+n)},this.currentRetrievals.push(i),r.crossOrigin="anonymous",r.src=n}},l.prototype.createTexture=function(e,t,n){return new u(e.currentGlContext,n)},l.prototype.removeFromCurrentRetrievals=function(e){var t=this.currentRetrievals.indexOf(e);t>-1&&this.currentRetrievals.splice(t,1)},l.prototype.resourceUrlForTile=function(e,t){return this.urlBuilder?this.urlBuilder.urlForTile(e,t):null},l}),n("layer/MercatorTiledImageLayer",["../util/Color","../geom/Sector","../layer/TiledImageLayer","../geom/Vec2","../util/WWMath"],function(e,t,n,r,i){"use strict";var s=function(e,t,i,s,o,u,a){n.call(this,e,t,i,s,o,u,a),this.detectBlankImages=!1,this.testPixels=[new r(20,20),new r(235,20),new r(20,235),new r(235,235)],this.destCanvas=document.createElement("canvas"),this.destContext=this.destCanvas.getContext("2d")};return s.prototype=Object.create(n.prototype),s.prototype.createTile=function(e,r,s,o){var u=this.mapSizeForLevel(r.levelNumber),a=i.clamp(o*this.imageSize,0,u),f=i.clamp(s*this.imageSize,0,u),l=i.clamp(a+this.imageSize,0,u),c=i.clamp(f+this.imageSize,0,u),h,p,d,v,m,g;return h=a/u-.5,p=.5-c/u,d=90-360*Math.atan(Math.exp(-p*2*Math.PI))/Math.PI,v=360*h,h=l/u-.5,p=.5-f/u,m=90-360*Math.atan(Math.exp(-p*2*Math.PI))/Math.PI,g=360*h,e=new t(d,m,v,g),n.prototype.createTile.call(this,e,r,s,o)},s.prototype.createTexture=function(e,t,r){var s=e.canvas2D,o=e.ctx2D,u,a=this.destCanvas,f=this.destContext,l=f.createImageData(r.width,r.height),c=t.sector,h=i.gudermannianInverse(c.minLatitude),p=i.gudermannianInverse(c.maxLatitude),d,v,m,g,y,b,w;s.width=r.width,s.height=r.height,a.width=r.width,a.height=r.height,o.drawImage(r,0,0,r.width,r.height),u=o.getImageData(0,0,r.width,r.height);if(this.detectBlankImages&&this.isBlankImage(r,u))return this.absentResourceList.markResourceAbsentPermanently(t.imagePath),null;for(var E=0;E<1;E++)for(var S=0;S<r.height;S++){b=1-S/(r.height-1),d=b*c.deltaLatitude()+c.minLatitude,v=i.gudermannianInverse(d),w=1-(v-h)/(p-h),w=i.clamp(w,0,1),m=Math.floor(w*(r.height-1));for(var x=0;x<r.width;x++)g=4*(x+m*r.width),y=4*(x+S*r.width),l.data[y]=u.data[g],l.data[y+1]=u.data[g+1],l.data[y+2]=u.data[g+2],l.data[y+3]=u.data[g+3]}return f.putImageData(l,0,0),n.prototype.createTexture.call(this,e,t,a)},s.prototype.isBlankImage=function(e,t){var n,r,i=null;for(var s=0,o=this.testPixels.length;s<o;s++){n=this.testPixels[s],r=4*(n[0]+n[1]*e.width);if(!i)i=[t.data[r],t.data[r+1],t.data[r+2]];else if(t.data[r]!=i[0]||t.data[r+1]!=i[1]||t.data[r+2]!=i[2])return!1}return!0},s}),n("layer/BingTiledImageLayer",["../geom/Angle","../geom/Location","../geom/Sector","../layer/MercatorTiledImageLayer"],function(e,t,n,r){"use strict";var i=function(e){this.imageSize=256,r.call(this,new n(-85.05,85.05,-180,180),new t(85.05,180),23,"image/jpeg",e,this.imageSize,this.imageSize),this.displayName=e,this.pickEnabled=!1,this.detectBlankImages=!0,this.creditImage=WorldWind.configuration.baseUrl+"images/powered-by-bing.png"};return i.prototype=Object.create(r.prototype),i.prototype.doRender=function(e){r.prototype.doRender.call(this,e),this.inCurrentFrame&&e.screenCreditController.addImageCredit(this.creditImage)},i.prototype.createTopLevelTiles=function(e){this.topLevelTiles=[],this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,1)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,1))},i.prototype.mapSizeForLevel=function(e){return 256<<e+1},i}),n("util/BingImageryUrlBuilder",["../error/ArgumentError","../util/Logger","../util/WWUtil"],function(e,t,n){"use strict";var r=function(e,t){var n="AkttWCS8p6qzxvx5RH3qUcCPgwG9nRJ7IwlpFGb14B0rBorB5DvmXr2Y_eCUNIxH";t||(this.bingMapsKey=WorldWind.BingMapsKey,t||(this.bingMapsKey=n),t===n&&(this.bingMapsKey=n,r.showBingMapsKeyWarning())),this.imagerySet=e};return r.showBingMapsKeyWarning=function(){r.keyMessagePrinted||(r.keyMessagePrinted=!0,t.log(t.LEVEL_WARNING,"WARNING: You are using a limited use, non-production Bing Maps key.\nIf you are developing an app or a web page this violates the Bing Terms of Use.\nPlease visit https://www.microsoft.com/maps/choose-your-bing-maps-API.aspx to obtain your own key for your application.\nSpecify that key to World Wind by setting the WorldWind.BingMapsKey property to your key prior to creating any Bing Maps layers.\n"))},r.prototype.requestMetadata=function(){if(!this.metadataRetrievalInProcess){this.metadataRetrievalInProcess=!0;var e="http://dev.virtualearth.net/REST/V1/Imagery/Metadata/"+this.imagerySet+"/0,0?zl=1&key="+this.bingMapsKey,t=this;n.jsonp(e,"jsonp",function(e){t.imageUrl=e.resourceSets[0].resources[0].imageUrl;var n=document.createEvent("Event");n.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(n),t.metadataRetrievalInProcess=!1})}},r.prototype.urlForTile=function(n,r){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"BingImageryUrlBuilder","urlForTile","missingTile"));if(!this.imageUrl)return this.requestMetadata(),null;var i=this.quadKeyFromLevelRowColumn(n.level.levelNumber,n.row,n.column),s;return this.imagerySet==="Aerial"?s=this.imageUrl.replace(/a3/,"a"+i):this.imagerySet==="AerialWithLabels"?s=this.imageUrl.replace(/h3/,"h"+i):this.imagerySet==="Road"&&(s=this.imageUrl.replace(/r3/,"r"+i)),s},r.prototype.quadKeyFromLevelRowColumn=function(e,t,n){var r,i,s="";for(var o=e+1;o>0;o--)r=0,i=1<<o-1,(n&i)!=0&&(r+=1),(t&i)!=0&&(r+=2),s+=r.toString();return s},r}),n("layer/BingAerialLayer",["../geom/Location","../geom/Sector","../layer/BingTiledImageLayer","../util/BingImageryUrlBuilder"],function(e,t,n,r){"use strict";var i=function(e){n.call(this,"Bing Aerial"),this.urlBuilder=new r("Aerial",e)};return i.prototype=Object.create(n.prototype),i}),n("layer/BingAerialWithLabelsLayer",["../geom/Location","../geom/Sector","../layer/BingTiledImageLayer","../util/BingImageryUrlBuilder"],function(e,t,n,r){"use strict";var i=function(e){n.call(this,"Bing Aerial with Labels"),this.urlBuilder=new r("AerialWithLabels",e)};return i.prototype=Object.create(n.prototype),i}),n("layer/BingRoadsLayer",["../geom/Location","../geom/Sector","../layer/BingTiledImageLayer","../util/BingImageryUrlBuilder"],function(e,t,n,r){"use strict";var i=function(e){n.call(this,"Bing Roads"),this.urlBuilder=new r("Road",e),this.detectBlankImages=!1};return i.prototype=Object.create(n.prototype),i}),n("util/WmsUrlBuilder",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n,r,i,s,o){if(!n||n.length===0)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","constructor","The WMS service address is missing."));if(!r||r.length===0)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","constructor","The WMS layer names are not specified."));this.serviceAddress=n,this.layerNames=r,this.styleNames=i?i:"",this.transparent=!0,this.wmsVersion=s&&s.length>0?s:"1.3.0",this.isWms130OrGreater=s>="1.3.0",this.crs="EPSG:4326",this.timeString=o};return n.prototype.urlForTile=function(r,i){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","missingTile"));if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","The image format is null or undefined."));var s=r.sector,o=n.fixGetMapString(this.serviceAddress);return o.search(/service=wms/i)<0&&(o+="service=WMS"),o+="&request=GetMap",o=o+"&version="+this.wmsVersion,o=o+"&transparent="+(this.transparent?"TRUE":"FALSE"),o=o+"&layers="+this.layerNames,o=o+"&styles="+this.styleNames,o=o+"&format="+i,o=o+"&width="+r.tileWidth,o=o+"&height="+r.tileHeight,this.timeString&&(o=o+"&time="+this.timeString),this.isWms130OrGreater?(o=o+"&crs="+this.crs,o+="&bbox=",this.crs==="CRS:84"?(o=o+s.minLongitude+","+s.minLatitude+",",o=o+s.maxLongitude+","+s.maxLatitude):(o=o+s.minLatitude+","+s.minLongitude+",",o=o+s.maxLatitude+","+s.maxLongitude)):(o=o+"&srs="+this.crs,o+="&bbox=",o=o+s.minLongitude+","+s.minLatitude+",",o=o+s.maxLongitude+","+s.maxLatitude),o=o.replace(" ","%20"),o},n.fixGetMapString=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","fixGetMapString","The specified service address is null or undefined."));var r=n.indexOf("?");return r<0?n+="?":r!==n.length-1&&(r=n.search(/&$/),r<0&&(n+="&")),n},n}),n("layer/BingWMSLayer",["../geom/Location","../geom/Sector","../layer/TiledImageLayer","../util/WmsUrlBuilder"],function(e,t,n,r){"use strict";var i=function(){n.call(this,t.FULL_SPHERE,new e(45,45),16,"image/png","BingWMS",256,256),this.displayName="Bing WMS",this.pickEnabled=!1,this.maxActiveAltitude=1e4,this.urlBuilder=new r(location.protocol+"//worldwind27.arc.nasa.gov/wms/virtualearth","ve","","1.3.0")};return i.prototype=Object.create(n.prototype),i}),n("util/LevelRowColumnUrlBuilder",["../error/ArgumentError","../util/Logger","../util/WWUtil"],function(e,t,n){"use strict";var r=function(e,t){this.serverAddress=e;if(!e||e.length===0)this.serverAddress=n.currentUrlSansFilePart();this.pathToData=t};return r.prototype.urlForTile=function(r,i){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","missingTile"));if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","The image format is null or undefined."));var s=this.serverAddress;return this.pathToData&&(s=s+"/"+this.pathToData),s=s+"/"+r.level.levelNumber.toString(),s=s+"/"+r.row.toString(),s=s+"/"+r.row.toString()+"_"+r.column.toString(),s=s+"."+n.suffixForMimeType(i),s=s.replace(" ","%20"),s},r}),n("layer/RestTiledImageLayer",["../error/ArgumentError","../geom/Location","../util/Logger","../geom/Sector","../layer/TiledImageLayer","../util/LevelRowColumnUrlBuilder","../util/WWUtil"],function(e,t,n,r,i,s,o){"use strict";var u=function(e,n,u,a){var f=o.urlPath(e+"/"+n);i.call(this,a&&a.sector||r.FULL_SPHERE,a&&a.levelZeroTileDelta||new t(45,45),a&&a.numLevels||5,a&&a.imageFormat||"image/jpeg",f,a&&a.tileWidth||256,a&&a.tileHeight||256),this.displayName=u,this.pickEnabled=!1,this.urlBuilder=new s(e,n)};return u.prototype=Object.create(i.prototype),u}),n("layer/BlueMarbleLayer",["../layer/Layer","../layer/RestTiledImageLayer"],function(e,t){"use strict";var n=function(t,r,i){e.call(this,t||"Blue Marble"),this.time=r||new Date("2004-01"),this.configuration=i,this.pickEnabled=!1,this.layers={},this.layerNames=[{month:"BlueMarble-200401",time:n.availableTimes[0]},{month:"BlueMarble-200402",time:n.availableTimes[1]},{month:"BlueMarble-200403",time:n.availableTimes[2]},{month:"BlueMarble-200404",time:n.availableTimes[3]},{month:"BlueMarble-200405",time:n.availableTimes[4]},{month:"BlueMarble-200406",time:n.availableTimes[5]},{month:"BlueMarble-200407",time:n.availableTimes[6]},{month:"BlueMarble-200408",time:n.availableTimes[7]},{month:"BlueMarble-200409",time:n.availableTimes[8]},{month:"BlueMarble-200410",time:n.availableTimes[9]},{month:"BlueMarble-200411",time:n.availableTimes[10]},{month:"BlueMarble-200412",time:n.availableTimes[11]}],this.serverAddress=null,this.pathToData="../standalonedata/Earth/BlueMarble256/"};return n.prototype=Object.create(e.prototype),n.availableTimes=[new Date("2004-01"),new Date("2004-02"),new Date("2004-03"),new Date("2004-04"),new Date("2004-05"),new Date("2004-06"),new Date("2004-07"),new Date("2004-08"),new Date("2004-09"),new Date("2004-10"),new Date("2004-11"),new Date("2004-12")],n.prototype.prePopulate=function(e){if(!e)throw new ArgumentError(Logger.logMessage(Logger.LEVEL_SEVERE,"BlueMarbleLayer","prePopulate","missingWorldWindow"));for(var t=0;t<this.layerNames.length;t++){var n=this.layerNames[t].month;this.layers[n]||this.createSubLayer(n),this.layers[n].prePopulate(e)}},n.prototype.isPrePopulated=function(e){for(var t=0;t<this.layerNames.length;t++){var n=this.layers[this.layerNames[t].month];if(!n||!n.isPrePopulated(e))return!1}return!0},n.prototype.doRender=function(e){var t=this.nearestLayer(this.time);t.opacity=this.opacity,this.detailControl&&(t.detailControl=this.detailControl),t.doRender(e),this.inCurrentFrame=t.inCurrentFrame},n.prototype.nearestLayer=function(e){var t=this.nearestLayerName(e);return this.layers[t]||this.createSubLayer(t),this.layers[t]},n.prototype.createSubLayer=function(e){var n=this.pathToData+e;this.layers[e]=new t(this.serverAddress,n,this.displayName,this.configuration)},n.prototype.nearestLayerName=function(e){var t=e.getTime();if(t<=this.layerNames[0].time.getTime())return this.layerNames[0].month;if(t>=this.layerNames[11].time.getTime())return this.layerNames[11].month;for(var n=0;n<this.layerNames.length-1;n++){var r=this.layerNames[n].time.getTime(),i=this.layerNames[n+1].time.getTime();if(t>=r&&t<=i){var s=t-r,o=i-t;return s<o?this.layerNames[n].month:this.layerNames[n+1].month}}},n}),n("layer/BMNGLandsatLayer",["../geom/Location","../geom/Sector","../layer/TiledImageLayer","../util/WmsUrlBuilder"],function(e,t,n,r){"use strict";var i=function(){n.call(this,t.FULL_SPHERE,new e(45,45),10,"image/jpeg","BMNGLandsat256",256,256),this.displayName="Blue Marble & Landsat",this.pickEnabled=!1,this.urlBuilder=new r(location.protocol+"//worldwind25.arc.nasa.gov/wms","BlueMarble-200405,esat","","1.3.0")};return i.prototype=Object.create(n.prototype),i}),n("layer/BMNGLayer",["../geom/Location","../geom/Sector","../layer/TiledImageLayer","../util/WmsUrlBuilder"],function(e,t,n,r){"use strict";var i=function(i){n.call(this,t.FULL_SPHERE,new e(45,45),5,"image/jpeg",i||"BMNG256",256,256),this.displayName="Blue Marble",this.pickEnabled=!1,this.urlBuilder=new r(location.protocol+"//worldwind25.arc.nasa.gov/wms",i||"BlueMarble-200405","","1.3.0")};return i.prototype=Object.create(n.prototype),i}),n("layer/RenderableLayer",["../error/ArgumentError","../layer/Layer","../util/Logger"],function(e,t,n){"use strict";var r=function(e){t.call(this,e),this.renderables=[]};return r.prototype=Object.create(t.prototype),r.prototype.addRenderable=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"RenderableLayer","addRenderable","missingRenderable"));this.renderables.push(t)},r.prototype.addRenderables=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"RenderableLayer","addRenderables","The renderables array is null or undefined."));for(var r=0,i=t.length;r<i;r++)this.addRenderable(t[r])},r.prototype.removeRenderable=function(e){var t=this.renderables.indexOf(e);t>=0&&this.renderables.splice(t,1)},r.prototype.removeAllRenderables=function(){this.renderables=[]},r.prototype.doRender=function(e){var t=e.orderedRenderables.length;for(var r=0,i=this.renderables.length;r<i;r++)try{this.renderables[r].render(e)}catch(s){n.logMessage(n.LEVEL_SEVERE,"RenderableLayer","doRender","Error while rendering shape "+this.renderables[r].displayName+".\n"+s.toString())}e.orderedRenderables.length>t&&(this.inCurrentFrame=!0)},r}),n("render/SurfaceTile",["../error/ArgumentError","../util/Logger","../geom/Matrix","../geom/Sector","../error/UnsupportedOperationError"],function(e,t,n,r,i){"use strict";var s=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceTile","constructor","missingSector"));this.sector=n};return s.prototype.bind=function(e){throw new i(t.logMessage(t.LEVEL_SEVERE,"SurfaceTile","bind","abstractInvocation"))},s.prototype.applyInternalTransform=function(e,n){throw new i(t.logMessage(t.LEVEL_SEVERE,"SurfaceTile","applyInternalTransform","abstractInvocation"))},s}),n("shapes/SurfaceImage",["../error/ArgumentError","../util/Logger","../pick/PickedObject","../render/SurfaceTile"],function(e,t,n,r){"use strict";var i=function(n,i){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceImage","constructor","missingSector"));if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceImage","constructor","missingImage"));r.call(this,n),this.enabled=!0,this._imageSource=i,this.opacity=1,this.displayName="Surface Image",this.imageSourceWasUpdated=!0};return i.prototype=Object.create(r.prototype),Object.defineProperties(i.prototype,{imageSource:{get:function(){return this._imageSource},set:function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceImage","imageSource","missingImage"));this._imageSource=n,this.imageSourceWasUpdated=!0}}}),i.prototype.bind=function(e){var t=e.gpuResourceCache.resourceForKey(this._imageSource);if(t&&!this.imageSourceWasUpdated)return t.bind(e);t=e.gpuResourceCache.retrieveTexture(e.currentGlContext,this._imageSource),this.imageSourceWasUpdated=!1;if(t)return t.bind(e)},i.prototype.applyInternalTransform=function(e,t){},i.prototype.render=function(e){if(!this.enabled||!this.sector.overlaps(e.terrain.sector))return;e.pickingMode&&(this.pickColor=e.uniquePickColor()),e.surfaceTileRenderer.renderTiles(e,[this],this.opacity*e.currentLayer.opacity);if(e.pickingMode){var t=new n(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);e.resolvePick(t)}e.currentLayer.inCurrentFrame=!0},i}),n("layer/BMNGOneImageLayer",["../layer/RenderableLayer","../geom/Sector","../shapes/SurfaceImage","../util/WWUtil"],function(e,t,n,r){"use strict";var i=function(){e.call(this,"Blue Marble Image");var r=new n(t.FULL_SPHERE,WorldWind.configuration.baseUrl+"images/BMNG_world.topo.bathy.200405.3.2048x1024.jpg");this.addRenderable(r),this.pickEnabled=!1,this.minActiveAltitude=3e6};return i.prototype=Object.create(e.prototype),i}),n("gesture/Touch",[],function(){"use strict";var e=function(e,t,n){this.identifier=e,this._clientX=t,this._clientY=n,this._clientStartX=t,this._clientStartY=n};return Object.defineProperties(e.prototype,{clientX:{get:function(){return this._clientX},set:function(e){this._clientX=e}},clientY:{get:function(){return this._clientY},set:function(e){this._clientY=e}},translationX:{get:function(){return this._clientX-this._clientStartX},set:function(e){this._clientStartX=this._clientX-e}},translationY:{get:function(){return this._clientY-this._clientStartY},set:function(e){this._clientStartY=this._clientY-e}}}),e}),n("gesture/GestureRecognizer",["../error/ArgumentError","../util/Logger","../gesture/Touch"],function(e,t,n){"use strict";var r=function(n,i){function o(e){s.handleEvent(e)}if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"GestureRecognizer","constructor","missingTarget"));this.target=n,this.enabled=!0,this._state=WorldWind.POSSIBLE,this._nextState=null,this._clientX=0,this._clientY=0,this._clientStartX=0,this._clientStartY=0,this._translationX=0,this._translationY=0,this._translationWeight=.4,this._mouseButtonMask=0,this._touches=[],this._touchCentroidShiftX=0,this._touchCentroidShiftY=0,this._gestureCallbacks=[],this._canRecognizeWith=[],this._requiresFailureOf=[],this._requiredToFailBy=[],i&&this._gestureCallbacks.push(i),r.allRecognizers.push(this);var s=this;window.PointerEvent?(n.addEventListener("pointerdown",o,!1),window.addEventListener("pointermove",o,!1),window.addEventListener("pointercancel",o,!1),window.addEventListener("pointerup",o,!1)):(n.addEventListener("mousedown",o,!1),window.addEventListener("mousemove",o,!1),window.addEventListener("mouseup",o,!1),n.addEventListener("touchstart",o,!1),n.addEventListener("touchmove",o,!1),n.addEventListener("touchend",o,!1),n.addEventListener("touchcancel",o,!1))};return r.allRecognizers=[],Object.defineProperties(r.prototype,{state:{get:function(){return this._state},set:function(e){this.transitionToState(e)}},clientX:{get:function(){return this._clientX},set:function(e){this._clientX=e}},clientY:{get:function(){return this._clientY},set:function(e){this._clientY=e}},translationX:{get:function(){return this._translationX},set:function(e){this._translationX=e,this._clientStartX=this._clientX,this._touchCentroidShiftX=0}},translationY:{get:function(){return this._translationY},set:function(e){this._translationY=e,this._clientStartY=this._clientY,this._touchCentroidShiftY=0}},mouseButtonMask:{get:function(){return this._mouseButtonMask}},touchCount:{get:function(){return this._touches.length}},gestureCallbacks:{get:function(){return this._gestureCallbacks}}}),r.prototype.touch=function(n){if(n<0||n>=this._touches.length)throw new e(t.logMessage(t.LEVEL_SEVERE,"GestureRecognizer","touch","indexOutOfRange"));return this._touches[n]},r.prototype.recognizeSimultaneouslyWith=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"GestureRecognizer","recognizeSimultaneouslyWith","The specified gesture recognizer is null or undefined."));var r=this._canRecognizeWith.indexOf(n);r==-1&&(this._canRecognizeWith.push(n),n._canRecognizeWith.push(this))},r.prototype.canRecognizeSimultaneouslyWith=function(e){var t=this._canRecognizeWith.indexOf(e);return t!=-1},r.prototype.requireRecognizerToFail=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"GestureRecognizer","requireRecognizerToFail","The specified gesture recognizer is null or undefined"));var r=this._requiresFailureOf.indexOf(n);r==-1&&(this._requiresFailureOf.push(n),n._requiredToFailBy.push(this))},r.prototype.requiresRecognizerToFail=function(e){var t=this._requiresFailureOf.indexOf(e);return t!=-1},r.prototype.requiredToFailByRecognizer=function(e){var t=this._requiredToFailBy.indexOf(e);return t!=-1},r.prototype.reset=function(){this._state=WorldWind.POSSIBLE,this._nextState=null,this._clientX=0,this._clientY=0,this._clientStartX=0,this._clientStartY=0,this._translationX=0,this._translationY=0,this._mouseButtonMask=0,this._touches=[],this._touchCentroidShiftX=0,this._touchCentroidShiftY=0},r.prototype.prepareToRecognize=function(){},r.prototype.mouseDown=function(e){},r.prototype.mouseMove=function(e){},r.prototype.mouseUp=function(e){},r.prototype.touchStart=function(e){},r.prototype.touchMove=function(e){},r.prototype.touchCancel=function(e){},r.prototype.touchEnd=function(e){},r.prototype.transitionToState=function(e){this._nextState=null,e==WorldWind.FAILED?(this._state=e,this.updateRecognizersWaitingForFailure(),this.resetIfEventsEnded()):e==WorldWind.RECOGNIZED?(this.tryToRecognize(e),this._state==e&&(this.prepareToRecognize(),this.callGestureCallbacks(),this.resetIfEventsEnded())):e==WorldWind.BEGAN?(this.tryToRecognize(e),this._state==e&&(this.prepareToRecognize(),this.callGestureCallbacks())):e==WorldWind.CHANGED?(this._state=e,this.callGestureCallbacks()):e==WorldWind.CANCELLED?(this._state=e,this.callGestureCallbacks(),this.resetIfEventsEnded()):e==WorldWind.ENDED&&(this._state=e,this.callGestureCallbacks(),this.resetIfEventsEnded())},r.prototype.updateRecognizersWaitingForFailure=function(){for(var e=0,t=this._requiredToFailBy.length;e<t;e++){var n=this._requiredToFailBy[e];n._nextState!=null&&n.transitionToState(n._nextState)}},r.prototype.tryToRecognize=function(e){if(r.allRecognizers.some(this.canBePreventedByRecognizer,this)){this.transitionToState(WorldWind.FAILED);return}if(r.allRecognizers.some(this.isWaitingForRecognizerToFail,this)){this._nextState=e;return}var t=r.allRecognizers.filter(this.canPreventRecognizer,this);for(var n=0,i=t.length;n<i;n++)t[n].transitionToState(WorldWind.FAILED);this._state=e},r.prototype.canPreventRecognizer=function(e){return this!=e&&this.target==e.target&&e.state==WorldWind.POSSIBLE&&(this.requiredToFailByRecognizer(e)||!this.canRecognizeSimultaneouslyWith(e))},r.prototype.canBePreventedByRecognizer=function(e){return this!=e&&this.target==e.target&&e.state==WorldWind.RECOGNIZED&&(this.requiresRecognizerToFail(e)||!this.canRecognizeSimultaneouslyWith(e))},r.prototype.isWaitingForRecognizerToFail=function(e){return this!=e&&this.target==e.target&&e.state==WorldWind.POSSIBLE&&this.requiresRecognizerToFail(e)},r.prototype.callGestureCallbacks=function(){for(var e=0,t=this._gestureCallbacks.length;e<t;e++)this._gestureCallbacks[e](this)},r.prototype.handleEvent=function(e){if(!this.enabled)return;if(e.defaultPrevented&&this.state==WorldWind.POSSIBLE)return;var n,r;try{if(e.type=="mousedown")this.handleMouseDown(e);else if(e.type=="mousemove")this.handleMouseMove(e);else if(e.type=="mouseup")this.handleMouseUp(e);else if(e.type=="touchstart")for(n=0,r=e.changedTouches.length;n<r;n++)this.handleTouchStart(e.changedTouches.item(n));else if(e.type=="touchmove")for(n=0,r=e.changedTouches.length;n<r;n++)this.handleTouchMove(e.changedTouches.item(n));else if(e.type=="touchcancel")for(n=0,r=e.changedTouches.length;n<r;n++)this.handleTouchCancel(e.changedTouches.item(n));else if(e.type=="touchend")for(n=0,r=e.changedTouches.length;n<r;n++)this.handleTouchEnd(e.changedTouches.item(n));else if(e.type=="pointerdown"&&e.pointerType=="mouse")this.handleMouseDown(e);else if(e.type=="pointermove"&&e.pointerType=="mouse")this.handleMouseMove(e);else if(e.type!="pointercancel"||e.pointerType!="mouse")e.type=="pointerup"&&e.pointerType=="mouse"?this.handleMouseUp(e):e.type=="pointerdown"&&e.pointerType=="touch"?this.handleTouchStart(e):e.type=="pointermove"&&e.pointerType=="touch"?this.handleTouchMove(e):e.type=="pointercancel"&&e.pointerType=="touch"?this.handleTouchCancel(e):e.type=="pointerup"&&e.pointerType=="touch"?this.handleTouchEnd(e):t.logMessage(t.LEVEL_INFO,"GestureRecognizer","handleEvent","Unrecognized event type: "+e.type)}catch(i){t.logMessage(t.LEVEL_SEVERE,"GestureRecognizer","handleEvent","Error handling event.\n"+i.toString())}},r.prototype.handleMouseDown=function(e){if(e.type=="mousedown"&&this._touches.length>0)return;var t=1<<e.button;if(t&this._mouseButtonMask!=0)return;this._mouseButtonMask==0&&(this._clientX=e.clientX,this._clientY=e.clientY,this._clientStartX=e.clientX,this._clientStartY=e.clientY,this._translationX=0,this._translationY=0),this._mouseButtonMask|=t,this.mouseDown(e)},r.prototype.handleMouseMove=function(e){if(this._mouseButtonMask==0)return;if(this._clientX==e.clientX&&this._clientY==e._clientY)return;var t=e.clientX-this._clientStartX,n=e.clientY-this._clientStartY,r=this._translationWeight;this._clientX=e.clientX,this._clientY=e.clientY,this._translationX=this._translationX*(1-r)+t*r,this._translationY=this._translationY*(1-r)+n*r,this.mouseMove(e)},r.prototype.handleMouseUp=function(e){var t=1<<e.button;if(t&this._mouseButtonMask==0)return;this._mouseButtonMask&=~t,this.mouseUp(e),this._mouseButtonMask==0&&this.resetIfEventsEnded()},r.prototype.handleTouchStart=function(e){var t=new n(e.identifier||e.pointerId,e.clientX,e.clientY);this._touches.push(t),this._touches.length==1?(this._clientX=e.clientX,this._clientY=e.clientY,this._clientStartX=e.clientX,this._clientStartY=e.clientY,this._translationX=0,this._translationY=0,this._touchCentroidShiftX=0,this._touchCentroidShiftY=0):this.touchesAddedOrRemoved(),this.touchStart(t)},r.prototype.handleTouchMove=function(e){var t=this.indexOfTouchWithId(e.identifier||e.pointerId);if(t==-1)return;var n=this._touches[t];if(n.clientX==e.clientX&&n.clientY==e.clientY)return;n.clientX=e.clientX,n.clientY=e.clientY;var r=this.touchCentroid(),i=r.clientX-this._clientStartX+this._touchCentroidShiftX,s=r.clientY-this._clientStartY+this._touchCentroidShiftY,o=this._translationWeight;this._clientX=r.clientX,this._clientY=r.clientY,this._translationX=this._translationX*(1-o)+i*o,this._translationY=this._translationY*(1-o)+s*o,this.touchMove(n)},r.prototype.handleTouchCancel=function(e){var t=this.indexOfTouchWithId(e.identifier||e.pointerId);if(t==-1)return;var n=this._touches[t];this._touches.splice(t,1),this.touchesAddedOrRemoved(),this.touchCancel(n),this.resetIfEventsEnded()},r.prototype.handleTouchEnd=function(e){var t=this.indexOfTouchWithId(e.identifier||e.pointerId);if(t==-1)return;var n=this._touches[t];this._touches.splice(t,1),this.touchesAddedOrRemoved(),this.touchEnd(n),this.resetIfEventsEnded()},r.prototype.resetIfEventsEnded=function(){this._state!=WorldWind.POSSIBLE&&this._mouseButtonMask==0&&this._touches.length==0&&this.reset()},r.prototype.touchesAddedOrRemoved=function(){this._touchCentroidShiftX+=this._clientX,this._touchCentroidShiftY+=this._clientY;var e=this.touchCentroid();this._clientX=e.clientX,this._clientY=e.clientY,this._touchCentroidShiftX-=this._clientX,this._touchCentroidShiftY-=this._clientY},r.prototype.touchCentroid=function(){var e=0,t=0;for(var n=0,r=this._touches.length;n<r;n++){var i=this._touches[n];e+=i.clientX/r,t+=i.clientY/r}return{clientX:e,clientY:t}},r.prototype.indexOfTouchWithId=function(e){for(var t=0,n=this._touches.length;t<n;t++)if(this._touches[t].identifier==e)return t;return-1},r}),n("gesture/ClickRecognizer",["../gesture/GestureRecognizer"],function(e){"use strict";var t=function(t,n){e.call(this,t,n),this.numberOfClicks=1,this.button=0,this.maxMouseMovement=5,this.maxClickDuration=500,this.maxClickInterval=400,this.clicks=[],this.timeout=null};return t.prototype=Object.create(e.prototype),t.prototype.reset=function(){e.prototype.reset.call(this),this.clicks=[],this.cancelFailAfterDelay()},t.prototype.mouseDown=function(e){if(this.state!=WorldWind.POSSIBLE)return;if(this.button!=e.button)this.state=WorldWind.FAILED;else{var t={clientX:this.clientX,clientY:this.clientY};this.clicks.push(t),this.failAfterDelay(this.maxClickDuration)}},t.prototype.mouseMove=function(e){if(this.state!=WorldWind.POSSIBLE)return;var t=this.translationX,n=this.translationY,r=Math.sqrt(t*t+n*n);r>this.maxMouseMovement&&(this.state=WorldWind.FAILED)},t.prototype.mouseUp=function(e){if(this.state!=WorldWind.POSSIBLE)return;if(this.mouseButtonMask!=0)return;var t=this.clicks.length;t==this.numberOfClicks?(this.clientX=this.clicks[0].clientX,this.clientY=this.clicks[0].clientY,this.state=WorldWind.RECOGNIZED):this.failAfterDelay(this.maxClickInterval)},t.prototype.touchStart=function(e){if(this.state!=WorldWind.POSSIBLE)return;this.state=WorldWind.FAILED},t.prototype.failAfterDelay=function(e){var t=this;t.timeout&&window.clearTimeout(t.timeout),t.timeout=window.setTimeout(function(){t.timeout=null,t.state==WorldWind.POSSIBLE&&(t.state=WorldWind.FAILED)},e)},t.prototype.cancelFailAfterDelay=function(){var e=this;e.timeout&&(window.clearTimeout(e.timeout),e.timeout=null)},t}),n("util/ImageSource",["../error/ArgumentError","../util/Color","../util/Logger"],function(e,t,n){"use strict";var r=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"ImageSource","constructor","missingImage"));this.image=t,this.key="ImageSource "+ ++r.keyPool};return r.keyPool=0,r}),n("shapes/ScreenImage",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/ImageSource","../util/Logger","../geom/Matrix","../util/Offset","../pick/PickedObject","../render/Renderable","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(t,r){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"ScreenImage","constructor","missingOffset"));if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"ScreenImage","constructor","missingImage"));a.call(this),this.screenOffset=t,this._imageSource=r,this.imageColor=n.WHITE,this.imageOffset=new o(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5),this.imageScale=1,this.imageRotation=0,this.imageTilt=0,this.enabled=!0,this.opacity=1,this.pickDelegate=null,this.activeTexture=null,this.imageTransform=s.fromIdentity(),this.texCoordMatrix=s.fromIdentity(),this.imageBounds=null,this.layer=null};return c.matrix=s.fromIdentity(),c.prototype=Object.create(a.prototype),Object.defineProperties(c.prototype,{imageSource:{get:function(){return this._imageSource},set:function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"ScreenImage","imageSource","missingImage"));this._imageSource=t,this.imageSourceWasUpdated=!0}}}),c.prototype.render=function(e){if(!this.enabled)return;if(!e.accumulateOrderedRenderables)return;var t=null;this.lastFrameTime!==e.timestamp&&(t=this.makeOrderedRenderable(e));if(!t)return;if(!t.isVisible(e))return;t.layer=e.currentLayer,this.lastFrameTime=e.timestamp,e.addOrderedRenderable(t)},c.prototype.renderOrdered=function(e){this.drawOrderedScreenImage(e);if(e.pickingMode){var t=new u(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);e.resolvePick(t)}},c.prototype.makeOrderedRenderable=function(e){var t,n,r,i,s,o,u;this.activeTexture=this.getActiveTexture(e);if(!this.activeTexture||this.imageSourceWasUpdated){this.activeTexture=e.gpuResourceCache.retrieveTexture(e.currentGlContext,this._imageSource);if(!this.activeTexture)return null}return this.eyeDistance=0,t=this.activeTexture.imageWidth,n=this.activeTexture.imageHeight,r=this.imageScale,o=this.imageOffset.offsetForSize(t,n),i=e.navigatorState.viewport.width,s=e.navigatorState.viewport.height,u=this.screenOffset.offsetForSize(i,s),this.imageTransform.setTranslation(u[0]-o[0]*r,u[1]-o[1]*r,0),this.imageTransform.setScale(t*r,n*r,1),this.imageBounds=l.boundingRectForUnitQuad(this.imageTransform),this},c.prototype.getActiveTexture=function(e){return e.gpuResourceCache.resourceForKey(this._imageSource)},c.prototype.isVisible=function(e){return e.pickingMode?e.pickRectangle&&this.imageBounds.intersects(e.pickRectangle):this.imageBounds.intersects(e.navigatorState.viewport)},c.prototype.drawOrderedScreenImage=function(e){this.beginDrawing(e);try{this.doDrawOrderedScreenImage(e)}finally{this.endDrawing(e)}},c.prototype.beginDrawing=function(e){var n=e.currentGlContext,r;e.findAndBindProgram(t),r=e.currentProgram,n.bindBuffer(n.ARRAY_BUFFER,e.unitQuadBuffer()),n.vertexAttribPointer(r.vertexTexCoordLocation,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.vertexPointLocation),n.enableVertexAttribArray(r.vertexTexCoordLocation),r.loadTextureUnit(n,n.TEXTURE0),r.loadModulateColor(n,e.pickingMode)},c.prototype.endDrawing=function(e){var t=e.currentGlContext,n=e.currentProgram;t.disableVertexAttribArray(n.vertexPointLocation),t.disableVertexAttribArray(n.vertexTexCoordLocation),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindTexture(t.TEXTURE_2D,null),t.enable(t.DEPTH_TEST)},c.prototype.doDrawOrderedScreenImage=function(e){var t=e.currentGlContext,n=e.currentProgram;t.bindBuffer(t.ARRAY_BUFFER,e.unitQuadBuffer3()),t.vertexAttribPointer(n.vertexPointLocation,3,t.FLOAT,!1,0,0),c.matrix.copy(e.screenProjection),c.matrix.multiplyMatrix(this.imageTransform),c.matrix.multiplyByTranslation(.5,.5,.5),c.matrix.multiplyByRotation(1,0,0,this.imageTilt),c.matrix.multiplyByRotation(0,0,1,this.imageRotation),c.matrix.multiplyByTranslation(-0.5,-0.5,0),n.loadModelviewProjection(t,c.matrix),n.loadTextureEnabled(t,!0),e.pickingMode?(this.pickColor=e.uniquePickColor(),n.loadColor(t,this.pickColor)):(n.loadColor(t,this.imageColor),n.loadOpacity(t,this.opacity*this.layer.opacity)),this.texCoordMatrix.setToIdentity(),this.texCoordMatrix.multiplyByTextureTransform(this.activeTexture),n.loadTextureMatrix(t,this.texCoordMatrix),this.activeTexture.bind(e)&&t.drawArrays(t.TRIANGLE_STRIP,0,4)},c}),n("shapes/Compass",["../error/ArgumentError","../util/Logger","../util/Offset","../shapes/ScreenImage"],function(e,t,n,r){"use strict";var i=function(e,t){var i=e?e:new n(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,1),s=t?t:WorldWind.configuration.baseUrl+"images/notched-compass.png";r.call(this,i,s),e||(this.imageOffset=new n(WorldWind.OFFSET_FRACTION,1.1,WorldWind.OFFSET_FRACTION,1.1)),this.size=.15};return i.prototype=Object.create(r.prototype),i.prototype.render=function(e){this.imageRotation=e.navigatorState.heading,this.imageTilt=e.navigatorState.tilt;var t=this.getActiveTexture(e);t&&(this.imageScale=.15*e.currentGlContext.drawingBufferWidth/t.imageWidth),r.prototype.render.call(this,e)},i}),n("layer/CompassLayer",["../shapes/Compass","../layer/RenderableLayer"],function(e,t){"use strict";var n=function(){t.call(this,"Compass"),this._compass=new e(null,null),this.addRenderable(this._compass)};return n.prototype=Object.create(t.prototype),Object.defineProperties(n.prototype,{compass:{get:function(){return this._compass},set:function(t){t&&t instanceof e&&(this.removeAllRenderables(),this.addRenderable(t),this._compass=t)}}}),n}),n("shapes/Text",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Font","../util/Logger","../geom/Matrix","../pick/PickedObject","../render/Renderable","../shapes/TextAttributes","../error/UnsupportedOperationError","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){"use strict";var p=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Text","constructor","missingText"));u.call(this),this.attributes=new a(null),this.highlightAttributes=null,this.highlighted=!1,this.enabled=!0,this.text=t,this.altitudeMode=WorldWind.ABSOLUTE,this.pickDelegate=null,this.alwaysOnTop=!1,this.targetVisibility=1,this.currentVisibility=1,this.declutterGroup=0,this.markerImageSource=WorldWind.configuration.baseUrl+"images/white-dot.png",this.markerImageScale=.1,this.activeAttributes=null,this.activeTexture=null,this.imageTransform=s.fromIdentity(),this.texCoordMatrix=s.fromIdentity(),this.imageBounds=null,this.layer=null,this.depthOffset=-0.003,this.screenPoint=new c(0,0,0)};return p.matrix=s.fromIdentity(),p.glPickPoint=new c(0,0,0),p.prototype=Object.create(u.prototype),p.prototype.copy=function(e){return this.text=e.text,this.attributes=e.attributes,this.highlightAttributes=e.highlightAttributes,this.highlighted=e.highlighted,this.enabled=e.enabled,this.altitudeMode=e.altitudeMode,this.pickDelegate=e.pickDelegate,this.alwaysOnTop=e.alwaysOnTop,this.depthOffset=e.depthOffset,this.declutterGroup=e.declutterGroup,this.targetVisibility=e.targetVisibility,this.currentVisibility=e.currentVisibility,this},Object.defineProperties(p.prototype,{screenBounds:{get:function(){return this.imageBounds}}}),p.prototype.render=function(e){if(!this.enabled||!this.text||this.text.length===0)return;if(!e.accumulateOrderedRenderables)return;var t;if(this.lastFrameTime!=e.timestamp)t=this.makeOrderedRenderable(e);else{var n=this.clone();t=n.makeOrderedRenderable(e)}if(!t)return;if(!t.isVisible(e))return;t.layer=e.currentLayer,this.lastFrameTime=e.timestamp,e.addOrderedRenderable(t)},p.prototype.renderOrdered=function(e){if(this.currentVisibility===0&&this.targetVisibility===0&&!this.markerImageSource)return;this.drawOrderedText(e);if(e.pickingMode){var t=new o(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,this.position,this.layer,!1);e.resolvePick(t)}},p.prototype.makeOrderedRenderable=function(e){var t,n,r,i;this.determineActiveAttributes(e);if(!this.activeAttributes)return null;if(!this.computeScreenPointAndEyeDistance(e))return null;var s=this.activeAttributes.font,o=this.text+s.toString();return this.activeTexture=e.gpuResourceCache.resourceForKey(o),this.activeTexture||(this.activeTexture=e.textSupport.createTexture(e,this.text,s,!0),e.gpuResourceCache.putResource(o,this.activeTexture,this.activeTexture.size)),t=this.activeTexture.imageWidth,n=this.activeTexture.imageHeight,r=this.activeAttributes.scale,i=this.activeAttributes.offset.offsetForSize(t,n),this.imageTransform.setTranslation(this.screenPoint[0]-i[0]*r,this.screenPoint[1]-i[1]*r,this.screenPoint[2]),this.imageTransform.setScale(t*r,n*r,1),this.imageBounds=h.boundingRectForUnitQuad(this.imageTransform),this},p.prototype.computeScreenPointAndEyeDistance=function(e){throw new f(i.logMessage(i.LEVEL_SEVERE,"Renderable","render","abstractInvocation"))},p.prototype.determineActiveAttributes=function(e){this.highlighted&&this.highlightAttributes?this.activeAttributes=this.highlightAttributes:this.activeAttributes=this.attributes},p.prototype.isVisible=function(e){return e.pickingMode?e.pickRectangle&&this.imageBounds.intersects(e.pickRectangle):this.imageBounds.intersects(e.navigatorState.viewport)},p.prototype.drawOrderedText=function(e){this.beginDrawing(e);try{this.doDrawOrderedText(e),!e.pickingMode}finally{this.endDrawing(e)}},p.prototype.drawBatchOrderedText=function(e){var t;while((t=e.peekOrderedRenderable())&&t instanceof p){e.popOrderedRenderable();try{t.doDrawOrderedText(e)}catch(n){i.logMessage(i.LEVEL_WARNING,"Text","drawBatchOrderedText","Error occurred while rendering text using batching: "+n.message)}}},p.prototype.beginDrawing=function(e){var n=e.currentGlContext,r;e.findAndBindProgram(t),r=e.currentProgram,n.bindBuffer(n.ARRAY_BUFFER,e.unitQuadBuffer3()),n.vertexAttribPointer(r.vertexPointLocation,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e.unitQuadBuffer()),n.vertexAttribPointer(r.vertexTexCoordLocation,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.vertexPointLocation),n.enableVertexAttribArray(r.vertexTexCoordLocation),r.loadTextureUnit(n,n.TEXTURE0),e.pickingMode&&r.loadTextureEnabled(n,!1),r.loadModulateColor(n,!1),n.depthMask(!1),p.currentTexture=null},p.prototype.endDrawing=function(e){var t=e.currentGlContext,n=e.currentProgram;t.disableVertexAttribArray(n.vertexPointLocation),t.disableVertexAttribArray(n.vertexTexCoordLocation),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindTexture(t.TEXTURE_2D,null),t.depthMask(!0),p.currentTexture=null},p.prototype.doDrawOrderedText=function(e){var t=e.currentGlContext,n=e.currentProgram,r;e.pickingMode&&(this.pickColor=e.uniquePickColor());if(!e.pickingMode&&this.currentVisibility!=this.targetVisibility){var i=(e.timestamp-e.previousRedrawTimestamp)/e.fadeTime;this.currentVisibility<this.targetVisibility?this.currentVisibility=Math.min(1,this.currentVisibility+i):this.currentVisibility=Math.max(0,this.currentVisibility-i),e.redrawRequested=!0}this.currentVisibility>0&&(p.matrix.copy(e.screenProjection),p.matrix.multiplyMatrix(this.imageTransform),n.loadModelviewProjection(t,p.matrix),e.pickingMode?(n.loadColor(t,this.pickColor),n.loadTextureEnabled(t,!1)):(n.loadColor(t,this.activeAttributes.color),n.loadOpacity(t,this.layer.opacity*this.currentVisibility),this.texCoordMatrix.setToIdentity(),this.activeTexture&&this.texCoordMatrix.multiplyByTextureTransform(this.activeTexture),n.loadTextureMatrix(t,this.texCoordMatrix),this.activeTexture&&this.activeTexture!=p.currentTexture&&(r=this.activeTexture.bind(e),n.loadTextureEnabled(t,r),p.currentTexture=this.activeTexture)),this.activeAttributes.depthTest||t.disable(t.DEPTH_TEST,!1),t.drawArrays(t.TRIANGLE_STRIP,0,4),this.activeAttributes.depthTest||t.disable(t.DEPTH_TEST,!0));if(this.currentVisibility<1&&this.markerImageSource){var o=e.gpuResourceCache.resourceForKey(this.markerImageSource);if(!o){e.gpuResourceCache.retrieveTexture(e.currentGlContext,this.markerImageSource);return}var u=this.markerImageScale,a=s.fromIdentity();a.setTranslation(this.screenPoint[0]-u*o.imageWidth/2,this.screenPoint[1]-u*o.imageWidth/2,this.screenPoint[2]),a.setScale(o.imageWidth*u,o.imageHeight*u,1),p.matrix.copy(e.screenProjection),p.matrix.multiplyMatrix(a),n.loadModelviewProjection(t,p.matrix);if(e.pickingMode)n.loadColor(t,this.pickColor),n.loadTextureEnabled(t,!1);else{n.loadColor(t,this.activeAttributes.color),n.loadOpacity(t,this.layer.opacity*(1-this.currentVisibility));var f=s.fromIdentity();f.multiplyByTextureTransform(o),n.loadTextureMatrix(t,f),o!=p.currentTexture&&(r=o.bind(e),n.loadTextureEnabled(t,r),p.currentTexture=o)}this.activeAttributes.depthTest||t.disable(t.DEPTH_TEST,!1),t.drawArrays(t.TRIANGLE_STRIP,0,4),this.activeAttributes.depthTest||t.enable(t.DEPTH_TEST,!0)}},p}),n("shapes/ScreenText",["../error/ArgumentError","../util/Logger","../util/Offset","../shapes/Text"],function(e,t,n,r){"use strict";var i=function(n,i){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"Text","constructor","missingOffset"));r.call(this,i),this.screenOffset=n,this.altitudeMode=null};return i.prototype=Object.create(r.prototype),i.prototype.render=function(e){this.lastFrameTime!=e.timestamp&&r.prototype.render.call(this,e)},i.prototype.computeScreenPointAndEyeDistance=function(e){var t=e.currentGlContext,n=this.screenOffset.offsetForSize(t.drawingBufferWidth,t.drawingBufferHeight);return this.screenPoint[0]=n[0],this.screenPoint[1]=n[1],this.screenPoint[2]=0,this.eyeDistance=0,!0},i}),n("layer/CoordinatesDisplayLayer",["../error/ArgumentError","../util/Color","../util/Font","../layer/Layer","../util/Logger","../util/Offset","../geom/Position","../shapes/ScreenImage","../shapes/ScreenText","../shapes/TextAttributes","../geom/Vec2"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(n){function h(e){c.handleUIEvent(e)}function p(e,t){c.handleRedraw(t)}if(!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"ViewControlsLayer","constructor","missingWorldWindow"));r.call(this,"Coordinates"),this.wwd=n,this.pickEnabled=!1,this.eventType=null,this.clientX=null,this.clientY=null,this.terrainPosition=null,this.latText=new a(new s(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0)," "),this.latText.attributes=new f(null),this.latText.attributes.color=t.YELLOW,this.lonText=new a(new s(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0)," "),this.lonText.attributes=new f(null),this.lonText.attributes.color=t.YELLOW,this.elevText=new a(new s(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0)," "),this.elevText.attributes=new f(null),this.elevText.attributes.color=t.YELLOW,this.eyeText=new a(new s(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0)," "),this.eyeText.attributes=new f(null),this.eyeText.attributes.color=t.YELLOW;var o=new s(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5),l=WorldWind.configuration.baseUrl+"images/crosshair.png";this.crosshairImage=new u(o,l);var c=this;window.PointerEvent?(n.addEventListener("pointerdown",h),n.addEventListener("pointermove",h),n.addEventListener("pointerleave",h)):(n.addEventListener("mousedown",h),n.addEventListener("mousemove",h),n.addEventListener("mouseleave",h),n.addEventListener("touchstart",h),n.addEventListener("touchmove",h)),this.wwd.redrawCallbacks.push(p)};return c.prototype=Object.create(r.prototype),c.prototype.doRender=function(e){var t=this.terrainPosition,n=e.eyePosition,r=e.currentGlContext.canvas.clientWidth,i,o,u,a,f;r>650?(i=r/2-50,o=5,u=WorldWind.OFFSET_PIXELS,a=0):r>400?(i=60,o=5,u=WorldWind.OFFSET_INSET_PIXELS,a=1):(i=60,o=5,u=WorldWind.OFFSET_INSET_PIXELS,a=1,f=!0),this.latText.text=t?this.formatLatitude(t.latitude):null,this.latText.screenOffset=new s(WorldWind.OFFSET_PIXELS,i,u,o),this.latText.attributes.offset=new s(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,a),this.latText.render(e),i+=70,this.lonText.text=t?this.formatLongitude(t.longitude):null,this.lonText.screenOffset=new s(WorldWind.OFFSET_PIXELS,i,u,o),this.lonText.attributes.offset=new s(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,a),this.lonText.render(e),e.globe.is2D()||(i+=70,this.elevText.text=t?this.formatAltitude(t.altitude,"m"):null,this.elevText.screenOffset=new s(WorldWind.OFFSET_PIXELS,i,u,o),this.elevText.attributes.offset=new s(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,a),this.elevText.render(e)),f||(i+=40,this.eyeText.text="Eye  "+this.formatAltitude(n.altitude,n.altitude<1e3?"m":"km"),this.eyeText.screenOffset=new s(WorldWind.OFFSET_PIXELS,i,u,o),this.eyeText.attributes.offset=new s(WorldWind.OFFSET_FRACTION,0,WorldWind.OFFSET_FRACTION,a),this.eyeText.render(e)),this.eventType=="touch"&&this.crosshairImage.render(e),this.inCurrentFrame=!0},c.prototype.handleUIEvent=function(e){e.type.indexOf("pointer")!=-1?this.eventType=e.pointerType:e.type.indexOf("mouse")!=-1?this.eventType="mouse":e.type.indexOf("touch")!=-1&&(this.eventType="touch"),e.type.indexOf("leave")!=-1?(this.clientX=null,this.clientY=null):(this.clientX=e.clientX,this.clientY=e.clientY),this.wwd.redraw()},c.prototype.handleRedraw=function(e){if(e!=WorldWind.BEFORE_REDRAW)return;var t,n;(this.eventType=="mouse"||this.eventType=="pen")&&this.clientX&&this.clientY?(t=this.wwd.canvasCoordinates(this.clientX,this.clientY),t[0]>=0&&t[0]<this.wwd.canvas.width&&t[1]>=0&&t[1]<this.wwd.canvas.height&&(n=this.wwd.pickTerrain(t).terrainObject())):this.eventType=="touch"&&(t=new l(this.wwd.canvas.width/2,this.wwd.canvas.height/2),n=this.wwd.pickTerrain(t).terrainObject()),this.terrainPosition=n?n.position:null},c.prototype.formatLatitude=function(e){var t=e<0?"°S":"°N";return Math.abs(e).toFixed(2)+t},c.prototype.formatLongitude=function(e){var t=e<0?"°W":"°E";return Math.abs(e).toFixed(2)+t},c.prototype.formatAltitude=function(e,t){return t==="km"&&(e/=1e3),e.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",")+" "+t},c}),n("layer/DigitalGlobeTiledImageLayer",["../geom/Angle","../error/ArgumentError","../util/Color","../geom/Location","../util/Logger","../geom/Sector","../layer/MercatorTiledImageLayer"],function(e,t,n,r,i,s,o){"use strict";var u=function(e,n,u){if(!n)throw new t(i.logMessage(i.LEVEL_SEVERE,"DigitalGlobeTiledImageLayer","constructor","The map ID is null or undefined."));if(!u)throw new t(i.logMessage(i.LEVEL_SEVERE,"DigitalGlobeTiledImageLayer","constructor","The access token is null or undefined."));this.imageSize=256,e=e||"Digital Globe",o.call(this,new s(-85.05,85.05,-180,180),new r(85.05,180),19,"image/jpeg",e,this.imageSize,this.imageSize),this.mapId=n,this.accessToken=u,this.displayName=e,this.pickEnabled=!1,this.destCanvas=document.createElement("canvas"),this.destContext=this.destCanvas.getContext("2d"),this.requestMetadata();var a=this;this.urlBuilder={urlForTile:function(e,t){return a.metadataRetrievalInProcess?null:a.urlTemplate.replace("{z}",e.level.levelNumber+1).replace("{x}",e.column).replace("{y}",e.row)}}};return u.prototype=Object.create(o.prototype),u.prototype.requestMetadata=function(){if(!this.metadataRetrievalInProcess){this.metadataRetrievalInProcess=!0;var e="https://api.mapbox.com/v4/"+this.mapId+".json?secure&access_token="+this.accessToken,t=new XMLHttpRequest,n=this;t.onreadystatechange=function(){if(t.readyState===4&&t.status===200){var e=JSON.parse(t.responseText);n.urlTemplate=e.tiles[0];var r=document.createEvent("Event");r.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(r),n.metadataRetrievalInProcess=!1}},t.open("GET",e,!0),t.send()}},u.prototype.doRender=function(e){o.prototype.doRender.call(this,e),this.inCurrentFrame&&e.screenCreditController.addStringCredit("© Digital Globe",n.DARK_GRAY)},u.prototype.createTopLevelTiles=function(e){this.topLevelTiles=[],this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,1)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,1))},u.prototype.mapSizeForLevel=function(e){return 256<<e+1},u}),n("gesture/DragRecognizer",["../gesture/GestureRecognizer"],function(e){"use strict";var t=function(t,n){e.call(this,t,n),this.button=0,this.interpretDistance=5};return t.prototype=Object.create(e.prototype),t.prototype.mouseMove=function(e){if(this.state==WorldWind.POSSIBLE)this.shouldInterpret()&&(this.shouldRecognize()?(this.translationX=0,this.translationY=0,this.state=WorldWind.BEGAN):this.state=WorldWind.FAILED);else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.CHANGED},t.prototype.mouseUp=function(e){if(this.mouseButtonMask==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.ENDED},t.prototype.touchStart=function(e){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},t.prototype.shouldInterpret=function(){var e=this.translationX,t=this.translationY,n=Math.sqrt(e*e+t*t);return n>this.interpretDistance},t.prototype.shouldRecognize=function(){var e=1<<this.button;return e==this.mouseButtonMask},t}),n("util/FrameStatistics",[],function(){"use strict";var e=function(){this.frameCount=0,this.frameTimeCumulative=0,this.frameTimeBase=0,this.frameTimeExtremes=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],this.frameTime=0,this.tessellationTime=0,this.layerRenderingTime=0,this.orderedRenderingTime=0,this.terrainTileCount=0,this.imageTileCount=0,this.renderedTileCount=0,this.tileUpdateCount=0,this.textureLoadCount=0,this.vboLoadCount=0,this.frameTimeAverage=0,this.frameRateAverage=0,this.frameTimeMin=0,this.frameTimeMax=0};return e.prototype.beginFrame=function(){this.frameTime=Date.now(),this.tessellationTime=0,this.layerRenderingTime=0,this.orderedRenderingTime=0,this.terrainTileCount=0,this.imageTileCount=0,this.renderedTileCount=0,this.tileUpdateCount=0,this.textureLoadCount=0,this.vboLoadCount=0,++this.frameCount},e.prototype.endFrame=function(){var e=Date.now();this.frameTime=e-this.frameTime,this.frameTimeCumulative+=this.frameTime,this.frameTimeExtremes[0]=Math.min(this.frameTimeExtremes[0],this.frameTime),this.frameTimeExtremes[1]=Math.max(this.frameTimeExtremes[1],this.frameTime),e-this.frameTimeBase>2e3&&(this.frameTimeAverage=this.frameTimeCumulative/this.frameCount,this.frameRateAverage=1e3*this.frameCount/(e-this.frameTimeBase),this.frameTimeMin=this.frameTimeExtremes[0],this.frameTimeMax=this.frameTimeExtremes[1],this.frameCount=0,this.frameTimeCumulative=0,this.frameTimeBase=e,this.frameTimeExtremes=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY])},e.prototype.incrementRenderedTileCount=function(e){this.renderedTileCount+=e},e.prototype.setTerrainTileCount=function(e){this.terrainTileCount=e},e.prototype.incrementImageTileCount=function(e){this.imageTileCount=e},e.prototype.incrementTileUpdateCount=function(e){this.tileUpdateCount+=e},e.prototype.incrementTextureLoadCount=function(e){this.textureLoadCount+=e},e.prototype.incrementVboLoadCount=function(e){this.vboLoadCount+=e},e}),n("render/FramebufferTexture",["../error/ArgumentError","../util/Logger","../util/WWMath"],function(e,t){"use strict";var n=function(n,r,i,s){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"FramebufferTexture","constructor","missingGlContext"));if(r<0||i<0)throw new e(t.logMessage(t.LEVEL_SEVERE,"FramebufferTexture","constructor","The framebuffer width or height is less than zero."));this.width=r,this.height=i,this.depth=s,this.size=r*i*4+(s?r*i*2:0),this.framebufferId=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,this.framebufferId),this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r,i,0,n.RGBA,n.UNSIGNED_BYTE,null),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.texture,0),this.depthBuffer=null,s&&(this.depthBuffer=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,this.depthBuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,r,i),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,this.depthBuffer));var o=n.checkFramebufferStatus(n.FRAMEBUFFER);o!=n.FRAMEBUFFER_COMPLETE&&(t.logMessage(t.LEVEL_WARNING,"FramebufferTexture","constructor","Error creating framebuffer: "+o),this.framebufferId=null,this.texture=null,this.depthBuffer=null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindRenderbuffer(n.RENDERBUFFER,null),n.bindTexture(n.TEXTURE_2D,null)};return n.prototype.bind=function(e){return this.texture&&e.currentGlContext.bindTexture(gl.TEXTURE_2D,this.texture),!!this.texture},n}),n("render/FramebufferTile",["../error/ArgumentError","../render/FramebufferTexture","../util/Logger","../geom/Matrix","../geom/Rectangle","../render/TextureTile"],function(e,t,n,r,i,s){"use strict";var o=function(t,i,o,u,a){if(!a||a.length<1)throw new e(n.logMessage(n.LEVEL_SEVERE,"FramebufferTile","constructor","The specified cache name is null, undefined or zero length."));s.call(this,t,i,o,u),this.gpuCacheKey=a,this.textureTransform=r.fromIdentity().setToUnitYFlip(),this.mustClear=!0};return o.prototype=Object.create(s.prototype),o.prototype.clearFramebuffer=function(e){this.mustClear=!0},o.prototype.bindFramebuffer=function(e){var t=e.gpuResourceCache.resourceForKey(this.gpuCacheKey);return t||(t=this.createFramebuffer(e)),e.bindFramebuffer(t),this.mustClear&&(this.doClearFramebuffer(e),this.mustClear=!1),!0},o.prototype.createFramebuffer=function(e){var n=new t(e.currentGlContext,this.tileWidth,this.tileHeight,!1);return e.gpuResourceCache.putResource(this.gpuCacheKey,n,n.size),n},o.prototype.doClearFramebuffer=function(e){var t=e.currentGlContext;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},o.prototype.applyInternalTransform=function(e,t){t.multiplyMatrix(this.textureTransform)},o}),n("render/FramebufferTileController",["../error/ArgumentError","../render/FramebufferTile","../util/LevelSet","../geom/Location","../util/Logger","../cache/MemoryCache","../geom/Sector","../util/Tile"],function(e,t,n,r,i,s,o,u){"use strict";var a=function(){this.tileWidth=256,this.tileHeight=256,this.detailControl=1.75,this.levels=new n(o.FULL_SPHERE,new r(45,45),16,this.tileWidth,this.tileHeight),this.topLevelTiles=[],this.currentTiles=[],this.currentTimestamp=null,this.currentGlobeStateKey=null,this.tileCache=new s(5e5,4e5),this.key="FramebufferTileController "+ ++a.keyPool};return a.keyPool=0,a.prototype.selectTiles=function(t,n){if(!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"FramebufferTileController","selectTiles","missingSector"));this.assembleTiles(t);var r=[];for(var s=0,o=this.currentTiles.length;s<o;s++){var u=this.currentTiles[s];u.sector.overlaps(n)&&(u.selected=!0,r.push(u))}return r},a.prototype.render=function(e){if(this.currentTiles.length==0)return;var t=[];for(var n=0,r=this.currentTiles.length;n<r;n++){var i=this.currentTiles[n];i.selected&&t.push(i)}e.surfaceTileRenderer.renderTiles(e,t,1);var s=e.currentGlContext,o=e.currentFramebuffer;try{s.clearColor(0,0,0,0);for(n=0,r=t.length;n<r;n++)i=t[n],i.selected=!1,i.bindFramebuffer(e),s.clear(s.COLOR_BUFFER_BIT)}finally{e.bindFramebuffer(o)}},a.prototype.assembleTiles=function(e){var t=e.timestamp,n=e.globeStateKey;if(this.currentTimestamp!=t||this.currentGlobeStateKey!=n)this.doAssembleTiles(e),this.currentTimestamp=t,this.currentGlobeStateKey=n},a.prototype.doAssembleTiles=function(e){this.currentTiles=[];if(!e.terrain)return;this.topLevelTiles.length==0&&this.createTopLevelTiles();for(var t=0,n=this.topLevelTiles.length;t<n;t++){var r=this.topLevelTiles[t];r.update(e),this.isTileVisible(e,r)&&this.addTileOrDescendants(e,r)}},a.prototype.createTile=function(e,n,r,i){var s=this.key+" "+n.levelNumber+"."+r+"."+i;return new t(e,n,r,i,s)},a.prototype.createTopLevelTiles=function(){u.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles)},a.prototype.addTileOrDescendants=function(e,t){if(this.tileMeetsRenderingCriteria(e,t)){this.addTile(t);return}var n=t.subdivideToCache(t.level.nextLevel(),this,this.tileCache);for(var r=0,i=n.length;r<i;r++){var s=n[r];s.update(e),this.isTileVisible(e,s)&&this.addTileOrDescendants(e,s)}},a.prototype.addTile=function(e){this.currentTiles.push(e)},a.prototype.isTileVisible=function(e,t){return e.globe.projectionLimits&&!t.sector.overlaps(e.globe.projectionLimits)?!1:e.pickingMode?t.extent.intersectsFrustum(e.pickFrustum):t.extent.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)},a.prototype.tileMeetsRenderingCriteria=function(e,t){var n=this.detailControl;if(t.sector.minLatitude>=75||t.sector.maxLatitude<=-75)n*=1.2;return t.level.isLastLevel()||!t.mustSubdivide(e,n)},a}),n("globe/ElevationImage",["../error/ArgumentError","../util/Logger","../util/WWMath"],function(e,t,n){"use strict";var r=function(n,r,i,s){if(!n||n.length<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationImage","constructor","The specified image path is null, undefined or zero length."));if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationImage","constructor","missingSector"));this.sector=r,this.imagePath=n,this.imageWidth=i,this.imageHeight=s,this.size=this.imageWidth*this.imageHeight};return r.prototype.pixel=function(e,t){return e<0||e>=this.imageWidth?0:t<0||t>=this.imageHeight?0:(t=this.imageHeight-t-1,this.imageData[e+t*this.imageWidth])},r.prototype.elevationAtLocation=function(e,t){var r=this.sector.maxLatitude,i=this.sector.minLongitude,s=this.sector.deltaLatitude(),o=this.sector.deltaLongitude(),u=(this.imageWidth-1)*(t-i)/o,a=(this.imageHeight-1)*(r-e)/s,f=Math.floor(n.clamp(u,0,this.imageWidth-1)),l=Math.floor(n.clamp(f+1,0,this.imageWidth-1)),c=Math.floor(n.clamp(a,0,this.imageHeight-1)),h=Math.floor(n.clamp(c+1,0,this.imageHeight-1)),p=this.imageData,d=p[f+c*this.imageWidth],v=p[l+c*this.imageWidth],m=p[f+h*this.imageWidth],g=p[l+h*this.imageWidth],y=u-f,b=a-c;return(1-y)*(1-b)*d+y*(1-b)*v+(1-y)*b*m+y*b*g},r.prototype.elevationsForGrid=function(r,i,s,o){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationImage","elevationsForSector","missingSector"));if(i<1||s<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationImage","elevationsForSector","The specified number of sample points is less than 1."));if(!o)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationImage","elevationsForSector","missingResult"));var u=this.sector.minLatitude,a=this.sector.maxLatitude,f=this.sector.minLongitude,l=this.sector.maxLongitude,c=a-u,h=l-f,p=r.minLatitude,d=r.maxLatitude,v=r.minLongitude,m=r.maxLongitude,g=(d-p)/(i>1?i-1:1),y=(m-v)/(s>1?s-1:1),b,w,E,S,x=0,T=this.imageData;for(S=0,b=p;S<i;S+=1,b+=g){S===i-1&&(b=d);if(b>=u&&b<=a){var N=(this.imageHeight-1)*(a-b)/c,C=Math.floor(n.clamp(N,0,this.imageHeight-1)),k=Math.floor(n.clamp(C+1,0,this.imageHeight-1)),L=N-C;for(E=0,w=v;E<s;E+=1,w+=y){E===s-1&&(w=m);if(w>=f&&w<=l){var A=(this.imageWidth-1)*(w-f)/h,O=Math.floor(n.clamp(A,0,this.imageWidth-1)),M=Math.floor(n.clamp(O+1,0,this.imageWidth-1)),_=A-O,D=T[O+C*this.imageWidth],P=T[M+C*this.imageWidth],H=T[O+k*this.imageWidth],B=T[M+k*this.imageWidth];o[x]=(1-_)*(1-L)*D+_*(1-L)*P+(1-_)*L*H+_*L*B}x++}}else x+=s}},r.prototype.minAndMaxElevationsForSector=function(e){var t=[];if(!e)t[0]=this.minElevation,t[1]=this.maxElevation;else if(e.contains(this.sector))t[0]>this.minElevation&&(t[0]=this.minElevation),t[1]<this.maxElevation&&(t[1]=this.maxElevation);else{var r=this.sector.maxLatitude,i=this.sector.minLongitude,s=this.sector.deltaLatitude(),o=this.sector.deltaLongitude(),u=e.minLatitude,a=e.maxLatitude,f=e.minLongitude,l=e.maxLongitude,c=Math.floor((this.imageHeight-1)*(r-a)/s),h=Math.ceil((this.imageHeight-1)*(r-u)/s),p=Math.floor((this.imageWidth-1)*(f-i)/o),d=Math.ceil((this.imageWidth-1)*(l-i)/o);c=n.clamp(c,0,this.imageHeight-1),h=n.clamp(h,0,this.imageHeight-1),p=n.clamp(p,0,this.imageWidth-1),d=n.clamp(d,0,this.imageWidth-1);var v=this.imageData,m=Number.MAX_VALUE,g=-m;for(var y=c;y<=h;y++)for(var b=p;b<=d;b++){var w=v[Math.floor(b+y*this.imageWidth)];m>w&&(m=w),g<w&&(g=w)}t[0]>m&&(t[0]=m),t[1]<g&&(t[1]=g)}return t},r.prototype.findMinAndMaxElevation=function(){if(this.imageData&&this.imageData.length>0){this.minElevation=Number.MAX_VALUE,this.maxElevation=-this.minElevation;var e=this.imageData,t=this.imageWidth*this.imageHeight;for(var n=0;n<t;n++){var r=e[n];this.minElevation>r&&(this.minElevation=r),this.maxElevation<r&&(this.maxElevation=r)}}else this.minElevation=0,this.maxElevation=0},r}),n("globe/ElevationTile",["../error/ArgumentError","../util/Logger","../util/Tile"],function(e,t,n){"use strict";var r=function(r,i,s,o,u,a){if(!u||u.length<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationTile","constructor","The specified image path is null, undefined or zero length."));if(!a)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationTile","constructor","The specified cache is null or undefined."));n.call(this,r,i,s,o),this.imagePath=u,this.memoryCache=a};return r.prototype=Object.create(n.prototype),r.prototype.size=function(){return n.prototype.size.call(this)+this.imagePath.length+8},r.prototype.image=function(){return this.memoryCache.entryForKey(this.imagePath)},r}),n("globe/ElevationModel",["../util/AbsentResourceList","../geom/Angle","../error/ArgumentError","../globe/ElevationImage","../globe/ElevationTile","../util/LevelSet","../util/Logger","../cache/MemoryCache","../geom/Sector","../util/Tile","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(t,r,i,f,l,h,p){if(!t)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","missingSector"));if(!r)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","The specified level-zero delta is null or undefined."));if(!f)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","The specified image format is null or undefined."));if(!l)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","The specified cache path is null or undefined."));if(!i||i<1)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","The specified number of levels is not greater than zero."));if(!h||!p||h<1||p<1)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","The specified tile width or height is not greater than zero."));this.coverageSector=t,this.retrievalImageFormat=f,this.cachePath=l,this.displayName="Elevations",this.timestamp=Date.now(),this.minElevation=0,this.maxElevation=0,this.pixelIsPoint=!0,this.levels=new s(this.coverageSector,r,i,h,p),this.currentTiles=[],this.currentSector=new a(0,0,0,0),this.tileCache=new u(1e6,8e5),this.imageCache=new u(1e7,8e6),this.currentRetrievals=[],this.absentResourceList=new e(3,5e3),this.id=++c.idPool,this.stateKey="elevationModel "+this.id.toString()+" "};return c.idPool=0,c.prototype.minAndMaxElevationsForSector=function(e){if(!e)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","minAndMaxElevationsForSector","missingSector"));var r=this.levels.levelForTexelSize(e.deltaLatitude()*t.DEGREES_TO_RADIANS/64);this.assembleTiles(r,e,!1);if(this.currentTiles.length==0)return null;var i=Number.MAX_VALUE,s=-i,u,a,f,l=[];for(var c=0,h=this.currentTiles.length;c<h;c++){u=this.currentTiles[c].image();if(!u)return l[0]=this.minElevation,l[1]=this.maxElevation,l;a=u.minElevation,i>a&&(i=a),f=u.maxElevation,s<f&&(s=f)}return l[0]=i,l[1]=s,l},c.prototype.elevationAtLocation=function(e,t){return this.coverageSector.containsLocation(e,t)?this.pointElevationForLocation(e,t):0},c.prototype.elevationsForGrid=function(e,t,r,i,s){if(!e)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","elevationsForSector","missingSector"));if(!s)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","elevationsForSector","missingResult"));if(!t||!r||t<1||r<1)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","The specified number of latitudinal or longitudinal positions is less than one."));var u=this.levels.levelForTexelSize(i);return this.pixelIsPoint?this.pointElevationsForGrid(e,t,r,u,s):this.areaElevationsForGrid(e,t,r,u,s)},c.prototype.pointElevationForLocation=function(e,t){var n=this.levels.lastLevel(),r=n.tileDelta.latitude,i=n.tileDelta.longitude,s=f.computeRow(r,e),o=f.computeColumn(i,t),u,a=null;for(var l=n.levelNumber;l>=0;l--){u=this.tileCache.entryForKey(l+"."+s+"."+o);if(u){a=u.image();if(a)return a.elevationAtLocation(e,t)}s=Math.floor(s/2),o=Math.floor(o/2)}return 0},c.prototype.pointElevationsForGrid=function(e,t,n,r,i){var s=0,o;this.assembleTiles(r,e,!0);if(this.currentTiles.length===0)return 0;this.currentTiles.sort(function(e,t){return e.level.levelNumber-t.level.levelNumber});for(var u=0,a=this.currentTiles.length;u<a;u++){var f=this.currentTiles[u],l=f.image();l?(l.elevationsForGrid(e,t,n,i),o=f.level.texelSize,s<o&&(s=o)):s=Number.MAX_VALUE}return s},c.prototype.areaElevationsForGrid=function(e,t,n,r,i){var s=e.minLatitude,o=e.maxLatitude,u=e.minLongitude,a=e.maxLongitude,f=e.deltaLatitude()/(t>1?t-1:1),l=e.deltaLongitude()/(n>1?n-1:1),c,h,p,d,v,m,g=0;for(v=0,c=s;v<t;v+=1,c+=f){v===t-1&&(c=o);for(m=0,h=u;m<n;m+=1,h+=l)m===n-1&&(h=a),this.coverageSector.containsLocation(c,h)&&(p=(h+180)/360,d=(c+90)/180,this.areaElevationForCoord(p,d,r.levelNumber,i,g)),g++}return r.texelSize},c.prototype.areaElevationForCoord=function(e,t,n,r,i){var s,o,u,a,f,c,h,p,d,v,m,g,y,b,w=new Float64Array(4);for(var E=n;E>=0;E--){s=this.levels.level(E),o=Math.round(s.tileWidth*360/s.tileDelta.longitude),u=Math.round(s.tileHeight*180/s.tileDelta.latitude),a=1/(2*u),f=1-a,c=o*l.fract(e),h=u*l.clamp(t,a,f),p=l.mod(Math.floor(c-.5),o),d=l.mod(p+1,o),v=Math.floor(h-.5),m=v+1,g=l.fract(c-.5),y=l.fract(h-.5),b=E==n||E==0;if(this.lookupPixels(p,d,v,m,s,b,w)){r[i]=(1-g)*(1-y)*w[0]+g*(1-y)*w[1]+(1-g)*y*w[2]+g*y*w[3];return}}},c.prototype.lookupPixels=function(e,t,n,r,i,s,o){var u=i.levelNumber,a=i.tileWidth,f=i.tileHeight,l=Math.floor(n/f),c=Math.floor(r/f),h=Math.floor(e/a),p=Math.floor(t/a),d,v,m,g;return l==c&&l==this.cachedRow&&h==p&&h==this.cachedCol?d=v=m=g=this.cachedImage:l==c&&h==p?(d=this.lookupImage(u,l,h,s),v=m=g=d,this.cachedRow=l,this.cachedCol=h,this.cachedImage=d):(d=this.lookupImage(u,l,h,s),v=this.lookupImage(u,l,p,s),m=this.lookupImage(u,c,h,s),g=this.lookupImage(u,c,p,s)),d&&v&&m&&g?(o[0]=d.pixel(e%a,n%f),o[1]=v.pixel(t%a,n%f),o[2]=m.pixel(e%a,r%f),o[3]=g.pixel(t%a,r%f),!0):!1},c.prototype.lookupImage=function(e,t,n,r){var i=this.tileForLevel(e,t,n),s=i.image();return s==null&&r&&this.retrieveTileImage(i),s},c.prototype.createTile=function(e,t,n,r){var s=this.cachePath+"/"+t.levelNumber+"/"+n+"/"+n+"_"+r+".bil";return new i(e,t,n,r,s,this.imageCache)},c.prototype.assembleTiles=function(e,t,n){this.currentTiles=[],this.currentSector.copy(t),this.currentSector.intersection(this.coverageSector);if(this.currentSector.isEmpty())return;var r=e.tileDelta.latitude,i=e.tileDelta.longitude,s=f.computeRow(r,this.currentSector.minLatitude),o=f.computeLastRow(r,this.currentSector.maxLatitude),u=f.computeColumn(i,this.currentSector.minLongitude),a=f.computeLastColumn(i,this.currentSector.maxLongitude);for(var l=s;l<=o;l++)for(var c=u;c<=a;c++)this.addTileOrAncestor(e,l,c,n)},c.prototype.addTileOrAncestor=function(e,t,n,r){var i=this.tileForLevel(e.levelNumber,t,n);this.isTileImageInMemory(i)?this.addToCurrentTiles(i):(r&&this.retrieveTileImage(i),e.isFirstLevel()?this.currentTiles.push(i):this.addAncestor(e,t,n,r))},c.prototype.addAncestor=function(e,t,n,r){var i=null,s=Math.floor(t/2),o=Math.floor(n/2);for(var u=e.levelNumber-1;u>=0;u--){i=this.tileForLevel(u,s,o);if(this.isTileImageInMemory(i)){this.addToCurrentTiles(i);return}s=Math.floor(s/2),o=Math.floor(o/2)}this.addToCurrentTiles(i),r&&this.retrieveTileImage(i)},c.prototype.addToCurrentTiles=function(e){this.currentTiles.push(e)},c.prototype.tileForLevel=function(e,t,n){var r=e+"."+t+"."+n,i=this.tileCache.entryForKey(r);if(i)return i;var s=this.levels.level(e),o=f.computeSector(s,t,n);return i=this.createTile(o,s,t,n),this.tileCache.putEntry(r,i,i.size()),i},c.prototype.isTileImageInMemory=function(e){return this.imageCache.containsKey(e.imagePath)},c.prototype.resourceUrlForTile=function(e){return this.urlBuilder.urlForTile(e,this.retrievalImageFormat)},c.prototype.retrieveTileImage=function(e){if(this.currentRetrievals.indexOf(e.imagePath)<0){var t=this.resourceUrlForTile(e,this.retrievalImageFormat),n=new XMLHttpRequest,r=this;if(!t)return;n.open("GET",t,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){if(n.readyState===4){r.removeFromCurrentRetrievals(e.imagePath);var i=n.getResponseHeader("content-type");if(n.status===200)if(i===r.retrievalImageFormat||i==="text/plain"||i==="application/octet-stream"){o.log(o.LEVEL_INFO,"Elevations retrieval succeeded: "+t),r.loadElevationImage(e,n),r.absentResourceList.unmarkResourceAbsent(e.imagePath);var s=document.createEvent("Event");s.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(s)}else i==="text/xml"?(r.absentResourceList.markResourceAbsent(e.imagePath),o.log(o.LEVEL_WARNING,"Elevations retrieval failed ("+n.statusText+"): "+t+".\n "+String.fromCharCode.apply(null,new Uint8Array(n.response)))):(r.absentResourceList.markResourceAbsent(e.imagePath),o.log(o.LEVEL_WARNING,"Elevations retrieval failed: "+t+". "+"Unexpected content type "+i));else r.absentResourceList.markResourceAbsent(e.imagePath),o.log(o.LEVEL_WARNING,"Elevations retrieval failed ("+n.statusText+"): "+t)}},n.onerror=function(){r.removeFromCurrentRetrievals(e.imagePath),r.absentResourceList.markResourceAbsent(e.imagePath),o.log(o.LEVEL_WARNING,"Elevations retrieval failed: "+t)},n.ontimeout=function(){r.removeFromCurrentRetrievals(e.imagePath),r.absentResourceList.markResourceAbsent(e.imagePath),o.log(o.LEVEL_WARNING,"Elevations retrieval timed out: "+t)},n.send(null),this.currentRetrievals.push(e.imagePath)}},c.prototype.removeFromCurrentRetrievals=function(e){var t=this.currentRetrievals.indexOf(e);t>-1&&this.currentRetrievals.splice(t,1)},c.prototype.loadElevationImage=function(e,t){var n=new r(e.imagePath,e.sector,e.tileWidth,e.tileHeight);this.retrievalImageFormat=="application/bil16"?(n.imageData=new Int16Array(t.response),n.size=n.imageData.length*2):this.retrievalImageFormat=="application/bil32"&&(n.imageData=new Float32Array(t.response),n.size=n.imageData.length*4),n.imageData&&(n.findMinAndMaxElevation(),this.imageCache.putEntry(e.imagePath,n,n.size),this.timestamp=Date.now())},c}),n("projections/GeographicProjection",["../error/ArgumentError","../util/Logger","../geom/Sector","../error/UnsupportedOperationError"],function(e,t,n,r){"use strict";var i=function(e,t,n){this.displayName=e||"Geographic Projection",this.continuous=t,this.projectionLimits=n,this.is2D=!0};return i.prototype.geographicToCartesian=function(e,n,i,s,o,u){throw new r(t.logMessage(t.LEVEL_SEVERE,"GeographicProjection","geographicToCartesian","abstractInvocation"))},i.prototype.geographicToCartesianGrid=function(e,n,i,s,o,u,a,f){throw new r(t.logMessage(t.LEVEL_SEVERE,"GeographicProjection","geographicToCartesianGrid","abstractInvocation"))},i.prototype.cartesianToGeographic=function(e,n,i,s,o,u){throw new r(t.logMessage(t.LEVEL_SEVERE,"GeographicProjection","cartesianToGeographic","abstractInvocation"))},i.prototype.northTangentAtLocation=function(n,r,i,s){if(!s)throw new e(t.logMessage(t.LEVEL_SEVERE,"ProjectionEquirectangular","northTangentAtLocation","missingResult"));return s[0]=0,s[1]=1,s[2]=0,s},i.prototype.northTangentAtPoint=function(n,r,i,s,o,u){if(!u)throw new e(t.logMessage(t.LEVEL_SEVERE,"ProjectionEquirectangular","northTangentAtPoint","missingResult"));return u[0]=0,u[1]=1,u[2]=0,u},i.prototype.surfaceNormalAtPoint=function(n,r,i,s,o){if(!o)throw new e(t.logMessage(t.LEVEL_SEVERE,"GeographicProjection","surfaceNormalAtPoint","missingResult"));return o[0]=0,o[1]=0,o[2]=1,o},i}),n("projections/ProjectionWgs84",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger","../geom/Position","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o){"use strict";var u=function(){n.call(this,"WGS84",!1,null),this.is2D=!1,this.scratchPosition=new i(0,0,0)};return u.prototype=Object.create(n.prototype),Object.defineProperties(u.prototype,{stateKey:{get:function(){return"projection wgs84 "}}}),u.prototype.geographicToCartesian=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionWgs84","geographicToCartesian","missingGlobe"));var f=Math.cos(i*e.DEGREES_TO_RADIANS),l=Math.sin(i*e.DEGREES_TO_RADIANS),c=Math.cos(s*e.DEGREES_TO_RADIANS),h=Math.sin(s*e.DEGREES_TO_RADIANS),p=n.equatorialRadius/Math.sqrt(1-n.eccentricitySquared*l*l);return a[0]=(p+o)*f*h,a[1]=(p*(1-n.eccentricitySquared)+o)*l,a[2]=(p+o)*f*c,a},u.prototype.geographicToCartesianGrid=function(n,i,o,u,a,f,l,c){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionWgs84","geographicToCartesianGrid","missingGlobe"));var h=i.minLatitude*e.DEGREES_TO_RADIANS,p=i.maxLatitude*e.DEGREES_TO_RADIANS,d=i.minLongitude*e.DEGREES_TO_RADIANS,v=i.maxLongitude*e.DEGREES_TO_RADIANS,m=(p-h)/(o>1?o-1:1),g=(v-d)/(u>1?u-1:1),y=f?f:new s(0,0,0),b,w,E=0,S=0,x,T,N,C,k,L,A=new Float64Array(u),O=new Float64Array(u);for(w=0,T=d;w<u;w++,T+=g)w===u-1&&(T=v),A[w]=Math.cos(T),O[w]=Math.sin(T);for(b=0,x=h;b<o;b++,x+=m){b===o-1&&(x=p),k=Math.cos(x),L=Math.sin(x),N=n.equatorialRadius/Math.sqrt(1-n.eccentricitySquared*L*L);for(w=0;w<u;w++)C=a[E++],c[S++]=(N+C)*k*O[w]-y[0],c[S++]=(N*(1-n.eccentricitySquared)+C)*L-y[1],c[S++]=(N+C)*k*A[w]-y[2]}return c},u.prototype.cartesianToGeographic=function(n,i,s,u,a,f){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionWgs84","cartesianToGeographic","missingGlobe"));var l=u,c=i,h=s,p=l*l+c*c,d=Math.sqrt(p),v=n.equatorialRadius,m=1/(v*v),g=n.eccentricitySquared,y=g*g,b=p*m,w=h*h*(1-g)*m,E=(b+w-y)/6,S,x,T,N=8*E*E*E+y*b*w,C,k,L,A,O,M,_,D,P,H,B,j;return N>0||w!=0?(N>0?(C=Math.sqrt(N),k=Math.sqrt(y*b*w),N>10*g?(L=o.cbrt((C+k)*(C+k)),T=E+.5*L+2*E*E/L):T=E+.5*o.cbrt((C+k)*(C+k))+.5*o.cbrt((C-k)*(C-k))):(C=Math.sqrt(-N),k=Math.sqrt(-8*E*E*E),L=Math.sqrt(y*b*w),A=2*Math.atan2(L,C+k)/3,T=-4*E*Math.sin(A)*Math.cos(Math.PI/6+A)),O=Math.sqrt(T*T+y*w),M=g*(T+O-w)/(2*O),_=(T+O)/(Math.sqrt(M*M+T+O)+M),D=_*d/(_+g),P=Math.sqrt(D*D+h*h),S=(_+g-1)*P/_,x=2*Math.atan2(h,P+D)):(C=Math.sqrt(1-g),k=Math.sqrt(g-b),H=Math.sqrt(g),S=-v*C*k/H,x=k/(H*k+C*Math.sqrt(b))),j=Math.sqrt(2),(j-1)*c<d+l?B=2*Math.atan2(c,d+l):d+c<(j+1)*l?B=-Math.PI*.5+2*Math.atan2(l,d-c):B=Math.PI*.5-2*Math.atan2(l,d+c),f.latitude=e.RADIANS_TO_DEGREES*x,f.longitude=e.RADIANS_TO_DEGREES*B,f.altitude=S,f},u.prototype.northTangentAtLocation=function(t,n,r,i){var s=Math.cos(n*e.DEGREES_TO_RADIANS),o=Math.cos(r*e.DEGREES_TO_RADIANS),u=Math.sin(n*e.DEGREES_TO_RADIANS),a=Math.sin(r*e.DEGREES_TO_RADIANS);return i[0]=-u*a,i[1]=s,i[2]=-u*o,i},u.prototype.northTangentAtPoint=function(e,t,n,r,i,o){return this.cartesianToGeographic(e,t,n,r,s.ZERO,this.scratchPosition),this.northTangentAtLocation(e,this.scratchPosition.latitude,this.scratchPosition.longitude,o)},u.prototype.surfaceNormalAtPoint=function(e,n,i,s,o){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionWgs84","surfaceNormalAtPoint","missingGlobe"));var u=e.equatorialRadius*e.equatorialRadius,a=e.polarRadius*e.polarRadius;return o[0]=n/u,o[1]=i/a,o[2]=s/u,o.normalize()},u}),n("navigate/NavigatorState",["../error/ArgumentError","../geom/Frustum","../geom/Line","../util/Logger","../geom/Matrix","../geom/Rectangle","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a){"use strict";var f=function(e,n,r,s,o){this.modelview=e,this.projection=n,this.modelviewProjection=i.fromIdentity(),this.modelviewProjection.setToMultiply(n,e),this.viewport=r,this.heading=s,this.tilt=o,this.eyePoint=this.modelview.extractEyePoint(new u(0,0,0)),this.frustumInModelCoordinates=null;var f=i.fromIdentity();f.setToTransposeOfMatrix(this.modelview),this.frustumInModelCoordinates=t.fromProjectionMatrix(this.projection),this.frustumInModelCoordinates.transformByMatrix(f),this.frustumInModelCoordinates.normalize(),this.modelviewInv=i.fromIdentity(),this.modelviewInv.invertOrthonormalMatrix(this.modelview),this.projectionInv=i.fromIdentity(),this.projectionInv.invertMatrix(this.projection),this.modelviewProjectionInv=i.fromIdentity(),this.modelviewProjectionInv.invertMatrix(this.modelviewProjection),this.modelviewNormalTransform=i.fromIdentity().setToTransposeOfMatrix(this.modelviewInv.upper3By3());var l=new u(-1,-1,-1),c=new u(1,1,-1),h=new u(-1,-1,1),p=new u(1,1,1);l.multiplyByMatrix(this.projectionInv),c.multiplyByMatrix(this.projectionInv),h.multiplyByMatrix(this.projectionInv),p.multiplyByMatrix(this.projectionInv);var d=a.fabs(c[0]-l[0]),v=a.fabs(p[0]-h[0]),m=-l[2],g=-h[2],y=(v-d)/(g-m),b=d-y*m;this.pixelSizeScale=y/r.width,this.pixelSizeOffset=b/r.height};return f.prototype.project=function(t,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","project","missingPoint"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","project","missingResult"));var i=t[0],s=t[1],o=t[2],u=this.modelviewProjection,a=u[0]*i+u[1]*s+u[2]*o+u[3],f=u[4]*i+u[5]*s+u[6]*o+u[7],l=u[8]*i+u[9]*s+u[10]*o+u[11],c=u[12]*i+u[13]*s+u[14]*o+u[15],h=this.viewport;return c==0?!1:(a/=c,f/=c,l/=c,l<-1||l>1?!1:(a=a*.5+.5,f=f*.5+.5,l=l*.5+.5,a=a*h.width+h.x,f=f*h.height+h.y,n[0]=a,n[1]=f,n[2]=l,!0))},f.prototype.projectWithDepth=function(t,n,i){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","projectWithDepth","missingPoint"));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","projectWithDepth","missingResult"));var s=t[0],o=t[1],u=t[2],f=this.modelview,l=f[0]*s+f[1]*o+f[2]*u+f[3],c=f[4]*s+f[5]*o+f[6]*u+f[7],h=f[8]*s+f[9]*o+f[10]*u+f[11],p=f[12]*s+f[13]*o+f[14]*u+f[15],d=this.projection,v=d[0]*l+d[1]*c+d[2]*h+d[3]*p,m=d[4]*l+d[5]*c+d[6]*h+d[7]*p,g=d[8]*l+d[9]*c+d[10]*h+d[11]*p,y=d[12]*l+d[13]*c+d[14]*h+d[15]*p,b=this.viewport;return y===0?!1:(v/=y,m/=y,g/=y,g<-1||g>1?!1:(g=d[8]*l+d[9]*c+d[10]*h*(1+n)+d[11]*p,g/=y,g=a.clamp(g,-1,1),v=v*.5+.5,m=m*.5+.5,g=g*.5+.5,v=v*b.width+b.x,m=m*b.height+b.y,i[0]=v,i[1]=m,i[2]=g,!0))},f.prototype.unProject=function(t,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","unProject","missingPoint"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","unProject","missingResult"));var i=t[0],s=t[1],o=t[2],u=this.viewport;i=(i-u.x)/u.width,s=(s-u.y)/u.height,i=i*2-1,s=s*2-1,o=o*2-1;if(o<-1||o>1)return!1;var a=this.modelviewProjectionInv,f=a[0]*i+a[1]*s+a[2]*o+a[3],l=a[4]*i+a[5]*s+a[6]*o+a[7],c=a[8]*i+a[9]*s+a[10]*o+a[11],h=a[12]*i+a[13]*s+a[14]*o+a[15];return h===0?!1:(n[0]=f/h,n[1]=l/h,n[2]=c/h,!0)},f.prototype.convertPointToWindow=function(t,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToWindow","missingPoint"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToWindow","missingResult"));return n[0]=t[0],n[1]=this.viewport.height-t[1],n},f.prototype.convertPointToViewport=function(t,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToViewport","missingPoint"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToViewport","missingResult"));return n[0]=t[0],n[1]=this.viewport.height-t[1],n},f.prototype.rayFromScreenPoint=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","rayFromScreenPoint","missingPoint"));var i=this.convertPointToViewport(t,new u(0,0,0)),s=new u(0,0,0),o=new u(0,0,0);if(!this.unProject(i,s))return null;i[2]=1;if(!this.unProject(i,o))return null;var a=new u(this.eyePoint[0],this.eyePoint[1],this.eyePoint[2]),f=new u(o[0],o[1],o[2]);return f.subtract(s),f.normalize(),new n(a,f)},f.prototype.pixelSizeAtDistance=function(e){return this.pixelSizeScale*e+this.pixelSizeOffset},f}),n("globe/Terrain",["../error/ArgumentError","../util/Logger","../geom/Vec3"],function(e,t,n){"use strict";var r=function(e,t,n,r){this.globe=e,this.verticalExaggeration=r,this.sector=n.sector,this.tessellator=t,this.surfaceGeometry=n.tileArray,this.stateKey=e.stateKey+" ve "+r.toString()};return r.scratchPoint=new n(0,0,0),r.prototype.surfacePoint=function(n,i,s,o){if(!o)throw new e(t.logMessage(t.LEVEL_SEVERE,"Terrain","surfacePoint","missingResult"));for(var u=0,a=this.surfaceGeometry.length;u<a;u++)if(this.surfaceGeometry[u].sector.containsLocation(n,i)){this.surfaceGeometry[u].surfacePoint(n,i,o);if(s){var f=this.globe.surfaceNormalAtPoint(o[0],o[1],o[2],r.scratchPoint);o[0]+=f[0]*s,o[1]+=f[1]*s,o[2]+=f[2]*s}return o}var l=s+this.globe.elevationAtLocation(n,i)*this.verticalExaggeration;return this.globe.computePointFromPosition(n,i,l,o),o},r.prototype.surfacePointForMode=function(n,r,i,s,o){if(!o)throw new e(t.logMessage(t.LEVEL_SEVERE,"Terrain","surfacePointForMode","missingResult"));s||(s=WorldWind.ABSOLUTE);if(s===WorldWind.CLAMP_TO_GROUND)return this.surfacePoint(n,r,0,o);if(s===WorldWind.RELATIVE_TO_GROUND)return this.surfacePoint(n,r,i,o);var u=i*this.verticalExaggeration;return this.globe.computePointFromPosition(n,r,u,o),o},r.prototype.beginRendering=function(e){this.globe&&this.globe.tessellator&&this.globe.tessellator.beginRendering(e)},r.prototype.endRendering=function(e){this.globe&&this.globe.tessellator&&this.globe.tessellator.endRendering(e)},r.prototype.beginRenderingTile=function(n,r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Terrain","beginRenderingTile","missingTile"));this.globe&&this.globe.tessellator&&this.globe.tessellator.beginRenderingTile(n,r)},r.prototype.endRenderingTile=function(e,t){},r.prototype.renderTile=function(n,r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Terrain","renderTile","missingTile"));this.globe&&this.globe.tessellator&&this.globe.tessellator.renderTile(n,r)},r.prototype.pick=function(e){this.globe&&this.globe.tessellator&&this.globe.tessellator.pick(e,this.surfaceGeometry,this)},r}),n("globe/TerrainTile",["../error/ArgumentError","../util/Logger","../geom/Matrix","../util/Tile"],function(e,t,n,r){"use strict";var i=function(e,t,i,s){r.call(this,e,t,i,s),this.transformationMatrix=n.fromIdentity(),this.points=null,this.pointsStateKey=null,this.pointsVboStateKey=null,this.neighborMap={},this.neighborMap[WorldWind.NORTH]=null,this.neighborMap[WorldWind.SOUTH]=null,this.neighborMap[WorldWind.EAST]=null,this.neighborMap[WorldWind.WEST]=null,this._stateKey=null,this._elevationTimestamp=null,this.scratchArray=[]};return i.prototype=Object.create(r.prototype),Object.defineProperties(i.prototype,{stateKey:{get:function(){return this._stateKey||(this._stateKey=this.computeStateKey()),this._stateKey}}}),i.prototype.neighborLevel=function(e){return this.neighborMap[e]},i.prototype.setNeighborLevel=function(e,t){this.neighborMap[e]=t,this._stateKey=null},i.prototype.surfacePoint=function(n,r,i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"TerrainTile","surfacePoint","missingResult"));var s=this.sector,o=s.minLatitude,u=s.maxLatitude,a=s.minLongitude,f=s.maxLongitude,l=this.tileWidth,c=this.tileHeight,h,p,d,v,m,g,y,b,w,E,S,x,T;h=(r-a)/(f-a)*l,p=(n-o)/(u-o)*c,d=h<l?Math.floor(h):l-1,v=p<c?Math.floor(p):c-1,m=l+1,g=this.points,y=this.scratchArray,b=3*(d+v*m);for(var N=0;N<6;N++)y[N]=g[b+N];b=3*(d+(v+1)*m);for(var C=6;C<12;C++)y[C]=g[b+(C-6)];return w=h<l?h-Math.floor(h):1,E=p<c?p-Math.floor(p):1,w>E?(i[0]=y[0]+w*(y[3]-y[0])+E*(y[6]-y[0]),i[1]=y[1]+w*(y[4]-y[1])+E*(y[7]-y[1]),i[2]=y[2]+w*(y[5]-y[2])+E*(y[8]-y[2])):(i[0]=y[9]+(1-w)*(y[6]-y[9])+(1-E)*(y[3]-y[9]),i[1]=y[10]+(1-w)*(y[7]-y[10])+(1-E)*(y[4]-y[10]),i[2]=y[11]+(1-w)*(y[8]-y[11])+(1-E)*(y[5]-y[11])),i[0]+=this.referencePoint[0],i[1]+=this.referencePoint[1],i[2]+=this.referencePoint[2],i},i.prototype.update=function(e){r.prototype.update.call(this,e);var t=e.globe.elevationTimestamp();this._elevationTimestamp!=t&&(this._elevationTimestamp=t,this._stateKey=null)},i.prototype.computeStateKey=function(){var e=[];return e.push(this._elevationTimestamp),e.push(this.neighborMap[WorldWind.NORTH]?this.neighborMap[WorldWind.NORTH].compare(this.level):0),e.push(this.neighborMap[WorldWind.SOUTH]?this.neighborMap[WorldWind.SOUTH].compare(this.level):0),e.push(this.neighborMap[WorldWind.EAST]?this.neighborMap[WorldWind.EAST].compare(this.level):0),e.push(this.neighborMap[WorldWind.WEST]?this.neighborMap[WorldWind.WEST].compare(this.level):0),e.join(".")},i}),n("globe/TerrainTileList",["../error/ArgumentError","../util/Logger","../geom/Sector"],function(e,t,n){"use strict";var r=function(r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"TerrainTileList","TerrainTileList","missingTessellator"));this.tessellator=r,this.sector=null,this.tileArray=[]};return Object.defineProperties(r.prototype,{length:{get:function(){return this.tileArray.length}}}),r.prototype.addTile=function(r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"TerrainTileList","addTile","missingTile"));this.tileArray.indexOf(r)==-1&&(this.tileArray.push(r),this.sector?this.sector.union(r.sector):(this.sector=new n(0,0,0,0),this.sector.copy(r.sector)))},r.prototype.removeAllTiles=function(){this.tileArray=[],this.sector=null},r}),n("globe/Tessellator",["../error/ArgumentError","../shaders/BasicProgram","../globe/Globe","../shaders/GpuProgram","../util/Level","../util/LevelSet","../geom/Location","../util/Logger","../geom/Matrix","../cache/MemoryCache","../navigate/NavigatorState","../error/NotYetImplementedError","../pick/PickedObject","../geom/Position","../geom/Rectangle","../geom/Sector","../globe/Terrain","../globe/TerrainTile","../globe/TerrainTileList","../util/Tile","../util/WWMath","../util/WWUtil"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){"use strict";var S=function(){this.numRowsTilesInTopLevel=4,this.numColumnsTilesInTopLevel=8,this.maximumSubdivisionDepth=15,this.tileWidth=32,this.tileHeight=32,this.detailControl=40,this.levels=new s(v.FULL_SPHERE,new o(180/this.numRowsTilesInTopLevel,360/this.numColumnsTilesInTopLevel),this.maximumSubdivisionDepth,this.tileWidth,this.tileHeight),this.topLevelTiles={},this.currentTiles=new y(this),this.tileCache=new f(5e6,4e6),this.elevationTimestamp=undefined,this.lastModelViewProjection=undefined,this.vertexPointLocation=-1,this.vertexTexCoordLocation=-1,this.texCoords=null,this.texCoordVboCacheKey="global_tex_coords",this.indices=null,this.numIndices=null,this.indicesVboCacheKey="global_indices",this.indicesNorth=null,this.numIndicesNorth=null,this.indicesNorthVboCacheKey="global_north_indices",this.indicesSouth=null,this.numIndicesSouth=null,this.indicesSouthVboCacheKey="global_south_indices",this.indicesWest=null,this.numIndicesWest=null,this.indicesWestVboCacheKey="global_west_indices",this.indicesEast=null,this.numIndicesEast=null,this.indicesEastVboCacheKey="global_east_indices",this.indicesLoresNorth=null,this.numIndicesLoresNorth=null,this.indicesLoresNorthVboCacheKey="global_lores_north_indices",this.indicesLoresSouth=null,this.numIndicesLoresSouth=null,this.indicesLoresSouthVboCacheKey="global_lores_south_indices",this.indicesLoresWest=null,this.numIndicesLoresWest=null,this.indicesLoresWestVboCacheKey="global_lores_west_indices",this.indicesLoresEast=null,this.numIndicesLoresEast=null,this.indicesLoresEastVboCacheKey="global_lores_east_indices",this.outlineIndices=null,this.outlineIndicesVboCacheKey="global_outline_indices",this.wireframeIndices=null,this.wireframeIndicesVboCacheKey="global_wireframe_indices",this.scratchMatrix=a.fromIdentity(),this.scratchElevations=null,this.scratchPrevElevations=null,this.corners={},this.tiles=[]};return S.prototype.tessellate=function(t){if(!t)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","tessellate","missingDC"));var n=t.globe.elevationTimestamp();if(this.lastGlobeStateKey===t.globeStateKey&&this.lastVerticalExaggeration===t.verticalExaggeration&&this.elevationTimestamp===n&&this.lastModelViewProjection&&t.navigatorState.modelviewProjection.equals(this.lastModelViewProjection))return this.lastTerrain;var r=t.navigatorState;this.lastModelViewProjection=r.modelviewProjection,this.lastGlobeStateKey=t.globeStateKey,this.elevationTimestamp=n,this.lastVerticalExaggeration=t.verticalExaggeration,this.currentTiles.removeAllTiles(),(!this.topLevelTiles[t.globeStateKey]||this.topLevelTiles[t.globeStateKey].length==0)&&this.createTopLevelTiles(t),this.corners={},this.tiles=[];for(var i=0,s=this.topLevelTiles[t.globeStateKey].length;i<s;i+=1){var o=this.topLevelTiles[t.globeStateKey][i];o.update(t),this.isTileVisible(t,o)&&this.addTileOrDescendants(t,o)}return this.refineNeighbors(t),this.finishTessellating(t),this.lastTerrain=this.currentTiles.length===0?null:new m(t.globe,this,this.currentTiles,t.verticalExaggeration),this.lastTerrain},S.prototype.createTile=function(t,n,r,i){if(!t)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tile","constructor","missingSector"));if(!n)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tile","constructor","The specified level is null or undefined."));if(r<0||i<0)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tile","constructor","The specified row or column is less than zero."));return new g(t,n,r,i)},S.prototype.beginRendering=function(e){var t=e.currentProgram;if(!t){u.logMessage(u.LEVEL_INFO,"Tessellator","beginRendering","Current Program is empty");return}this.buildSharedGeometry(),this.cacheSharedGeometryVBOs(e);var n=e.currentGlContext,r=e.gpuResourceCache;this.vertexPointLocation=t.attributeLocation(n,"vertexPoint"),this.vertexTexCoordLocation=t.attributeLocation(n,"vertexTexCoord"),n.enableVertexAttribArray(this.vertexPointLocation);if(this.vertexTexCoordLocation>=0){var i=r.resourceForKey(this.texCoordVboCacheKey);n.bindBuffer(n.ARRAY_BUFFER,i),n.vertexAttribPointer(this.vertexTexCoordLocation,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(this.vertexTexCoordLocation)}},S.prototype.endRendering=function(e){var t=e.currentGlContext;t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.vertexPointLocation>=0&&t.disableVertexAttribArray(this.vertexPointLocation),this.vertexTexCoordLocation>=0&&t.disableVertexAttribArray(this.vertexTexCoordLocation)},S.prototype.beginRenderingTile=function(t,n){if(!n)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","beginRenderingTile","missingTile"));var r=t.currentGlContext,i=t.gpuResourceCache;this.scratchMatrix.setToMultiply(t.navigatorState.modelviewProjection,n.transformationMatrix),t.currentProgram.loadModelviewProjection(r,this.scratchMatrix);var s=t.globeStateKey+n.tileKey,o=i.resourceForKey(s);o?n.pointsVboStateKey!=n.pointsStateKey?(r.bindBuffer(r.ARRAY_BUFFER,o),r.bufferSubData(r.ARRAY_BUFFER,0,n.points),n.pointsVboStateKey=n.pointsStateKey):t.currentGlContext.bindBuffer(r.ARRAY_BUFFER,o):(o=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,o),r.bufferData(r.ARRAY_BUFFER,n.points,r.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),i.putResource(s,o,n.points.length*4),n.pointsVboStateKey=n.pointsStateKey),r.vertexAttribPointer(this.vertexPointLocation,3,r.FLOAT,!1,0,0)},S.prototype.endRenderingTile=function(e,t){},S.prototype.renderTile=function(t,n){if(!n)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","renderTile","missingTile"));var r=t.currentGlContext,i=t.gpuResourceCache,s=r.TRIANGLE_STRIP,o=i.resourceForKey(this.indicesVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o),r.drawElements(s,this.numIndices,r.UNSIGNED_SHORT,0);var a=n.level,f;f=n.neighborLevel(WorldWind.NORTH);if(f&&f.compare(a)<0){var l=i.resourceForKey(this.indicesLoresNorthVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,l),r.drawElements(s,this.numIndicesLoresNorth,r.UNSIGNED_SHORT,0)}else{var c=i.resourceForKey(this.indicesNorthVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,c),r.drawElements(s,this.numIndicesNorth,r.UNSIGNED_SHORT,0)}f=n.neighborLevel(WorldWind.SOUTH);if(f&&f.compare(a)<0){var h=i.resourceForKey(this.indicesLoresSouthVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,h),r.drawElements(s,this.numIndicesLoresSouth,r.UNSIGNED_SHORT,0)}else{var p=i.resourceForKey(this.indicesSouthVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,p),r.drawElements(s,this.numIndicesSouth,r.UNSIGNED_SHORT,0)}f=n.neighborLevel(WorldWind.WEST);if(f&&f.compare(a)<0){var d=i.resourceForKey(this.indicesLoresWestVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,d),r.drawElements(s,this.numIndicesLoresWest,r.UNSIGNED_SHORT,0)}else{var v=i.resourceForKey(this.indicesWestVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,v),r.drawElements(s,this.numIndicesWest,r.UNSIGNED_SHORT,0)}f=n.neighborLevel(WorldWind.EAST);if(f&&f.compare(a)<0){var m=i.resourceForKey(this.indicesLoresEastVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,m),r.drawElements(s,this.numIndicesLoresEast,r.UNSIGNED_SHORT,0)}else{var g=i.resourceForKey(this.indicesEastVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,g),r.drawElements(s,this.numIndicesEast,r.UNSIGNED_SHORT,0)}},S.prototype.renderWireframeTile=function(t,n){if(!n)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","renderWireframeTile","missingTile"));var r=t.currentGlContext,i=t.gpuResourceCache;this.vertexTexCoordLocation>=0&&r.disableVertexAttribArray(this.vertexTexCoordLocation);var s=i.resourceForKey(this.wireframeIndicesVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s),r.drawElements(r.LINES,this.wireframeIndices.length,r.UNSIGNED_SHORT,0)},S.prototype.renderTileOutline=function(t,n){if(!n)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","renderTileOutline","missingTile"));var r=t.currentGlContext,i=t.gpuResourceCache;this.vertexTexCoordLocation>=0&&r.disableVertexAttribArray(this.vertexTexCoordLocation);var s=i.resourceForKey(this.outlineIndicesVboCacheKey);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s),r.drawElements(r.LINE_LOOP,this.outlineIndices.length,r.UNSIGNED_SHORT,0)},S.prototype.pick=function(t,n,r){if(!t)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","pick","missingDc"));if(!n)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","pick","missingList"));var i=null,s=r||this,o=new p(0,0,0),a=[];for(var f=0,l=n.length;f<l;f++){var c=n[f];c.extent.intersectsFrustum(t.pickFrustum)&&a.push(c)}t.pickTerrainOnly||(i=t.uniquePickColor(),this.drawPickTiles(t,a,i));if(!t.regionPicking){var d=t.navigatorState.rayFromScreenPoint(t.pickPoint),v=this.computeNearestIntersection(d,a);v&&(t.globe.computePositionFromPoint(v[0],v[1],v[2],o),o.altitude=t.globe.elevationAtLocation(o.latitude,o.longitude),t.addPickedObject(new h(i,s,o,null,!0)))}},S.prototype.drawPickTiles=function(e,n,r){var i=e.currentGlContext;try{e.findAndBindProgram(t),e.currentProgram.loadColor(i,r),this.beginRendering(e);for(var s=0,o=n.length;s<o;s++){var u=n[s];this.beginRenderingTile(e,u),this.renderTile(e,u),this.endRenderingTile(e,u)}}finally{this.endRendering(e)}},S.prototype.computeNearestIntersection=function(e,t){var n=[];for(var r=0,i=t.length;r<i;r++)this.computeIntersections(e,t[r],n);if(n.length==0)return null;var s=Number.POSITIVE_INFINITY,o;for(r=0,i=n.length;r<i;r++){var u=e.origin.distanceToSquared(n[r]);s>u&&(s=u,o=r)}return n[o]},S.prototype.computeIntersections=function(e,t,n){var r=t.level,i,s=t.points,o,u=n.length;e.origin.subtract(t.referencePoint),this.buildSharedGeometry(t),o=this.indices,w.computeTriStripIntersections(e,s,o,n),i=t.neighborLevel(WorldWind.SOUTH),o=i&&i.compare(r)<0?this.indicesLoresSouth:this.indicesSouth,w.computeTriStripIntersections(e,s,o,n),i=t.neighborLevel(WorldWind.WEST),o=i&&i.compare(r)<0?this.indicesLoresWest:this.indicesWest,w.computeTriStripIntersections(e,s,o,n),i=t.neighborLevel(WorldWind.EAST),o=i&&i.compare(r)<0?this.indicesLoresEast:this.indicesEast,w.computeTriStripIntersections(e,s,o,n),i=t.neighborLevel(WorldWind.NORTH),o=i&&i.compare(r)<0?this.indicesLoresNorth:this.indicesNorth,w.computeTriStripIntersections(e,s,o,n),e.origin.add(t.referencePoint);for(var a=u,f=n.length;a<f;a++)n[a].add(t.referencePoint)},S.prototype.createTopLevelTiles=function(e){this.topLevelTiles[e.globeStateKey]=[],b.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles[e.globeStateKey])},S.prototype.addTileOrDescendants=function(e,t){if(this.tileMeetsRenderCriteria(e,t)){this.addTile(e,t);return}this.addTileDescendants(e,t)},S.prototype.addTileDescendants=function(e,t){var n=t.level.nextLevel(),r=t.subdivideToCache(n,this,this.tileCache);for(var i=0;i<r.length;i+=1){var s=r[i];s.update(e),this.levels.sector.intersects(s.sector)&&this.isTileVisible(e,s)&&this.addTileOrDescendants(e,s)}},S.prototype.addTile=function(e,t){var n=this.tiles.length;this.tiles.push(t);var r=t.sector,i=[r.maxLatitude,r.maxLongitude].toString(),s=[r.minLatitude,r.maxLongitude].toString(),o=[r.maxLatitude,r.minLongitude].toString(),u=[r.minLatitude,r.minLongitude].toString(),a;a=this.corners[u],a?a.sw=n:this.corners[u]={sw:n},a=this.corners[o],a?a.nw=n:this.corners[o]={nw:n},a=this.corners[s],a?a.se=n:this.corners[s]={se:n},a=this.corners[i],a?a.ne=n:this.corners[i]={ne:n}},S.prototype.refineNeighbors=function(e){var t={};for(var n=0,r=this.tiles.length;n<r;n+=1){var i=this.tiles[n],s=i.level.levelNumber,o=i.sector,u,a,n,r,f=[o.maxLatitude,o.maxLongitude].toString(),l=[o.minLatitude,o.maxLongitude].toString(),c=[o.maxLatitude,o.minLongitude].toString(),h=[o.minLatitude,o.minLongitude].toString();u=this.corners[f],u.hasOwnProperty("se")&&(a=u.se,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u.hasOwnProperty("nw")&&(a=u.nw,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u=this.corners[l],u.hasOwnProperty("ne")&&(a=u.ne,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u.hasOwnProperty("sw")&&(a=u.sw,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u=this.corners[c],u.hasOwnProperty("ne")&&(a=u.ne,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u.hasOwnProperty("sw")&&(a=u.sw,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u=this.corners[h],u.hasOwnProperty("se")&&(a=u.se,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u.hasOwnProperty("nw")&&(a=u.nw,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0)))}var p=[],d=[];for(n=0,r=this.tiles.length;n<r;n+=1)i=this.tiles[n],t[n]?p.push(i):d.push(i);if(p.length>0){this.tiles=[],this.corners={};for(n=0,r=d.length;n<r;n+=1)i=d[n],this.addTile(e,i);for(n=0,r=p.length;n<r;n+=1){var i=p[n];this.addTileDescendants(e,i)}this.refineNeighbors(e)}},S.prototype.finishTessellating=function(e){for(var t=0,n=this.tiles.length;t<n;t+=1){var r=this.tiles[t];this.setNeighbors(r),this.regenerateTileGeometryIfNeeded(e,r),this.currentTiles.addTile(r)}},S.prototype.setNeighbors=function(e){var t=e.sector,n=[t.maxLatitude,t.maxLongitude].toString(),r=[t.minLatitude,t.maxLongitude].toString(),i=[t.maxLatitude,t.minLongitude].toString(),s=[t.minLatitude,t.minLongitude].toString(),o=this.corners[n],u=this.corners[r],a=this.corners[i],f=this.corners[s],l=-1,c=-1,h=-1,p=-1;o.hasOwnProperty("se")?l=o.se:a.hasOwnProperty("sw")&&(l=a.sw),u.hasOwnProperty("ne")?c=u.ne:f.hasOwnProperty("nw")&&(c=f.nw),o.hasOwnProperty("nw")?h=o.nw:u.hasOwnProperty("sw")&&(h=u.sw),a.hasOwnProperty("ne")?p=a.ne:f.hasOwnProperty("se")&&(p=f.se),e.setNeighborLevel(WorldWind.NORTH,l>=0?this.tiles[l].level:null),e.setNeighborLevel(WorldWind.SOUTH,c>=0?this.tiles[c].level:null),e.setNeighborLevel(WorldWind.EAST,h>=0?this.tiles[h].level:null),e.setNeighborLevel(WorldWind.WEST,p>=0?this.tiles[p].level:null)},S.prototype.isTileVisible=function(e,t){return e.globe.projectionLimits&&!t.sector.overlaps(e.globe.projectionLimits)?!1:t.extent.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)},S.prototype.tileMeetsRenderCriteria=function(e,t){var n=this.detailControl;if(t.sector.minLatitude>=75||t.sector.maxLatitude<=-75)n*=2;return t.level.isLastLevel()||!t.mustSubdivide(e,n)},S.prototype.regenerateTileGeometryIfNeeded=function(e,t){var n=e.globeStateKey+t.stateKey+e.verticalExaggeration;if(!t.points||t.pointsStateKey!=n)this.regenerateTileGeometry(e,t),t.pointsStateKey=n},S.prototype.regenerateTileGeometry=function(e,t){var n=t.tileHeight+1,r=t.tileWidth+1,i=t.referencePoint,s=this.scratchElevations;s||(s=new Float64Array(n*r),this.scratchElevations=s),t.points||(t.points=new Float32Array(n*r*3)),E.fillArray(s,0),e.globe.elevationsForGrid(t.sector,n,r,t.texelSize,s),this.mustAlignNeighborElevations(e,t)&&this.alignNeighborElevations(e,t,s),E.multiplyArray(s,e.verticalExaggeration),e.globe.computePointsForGrid(t.sector,n,r,s,i,t.points),t.transformationMatrix.setTranslation(i[0],i[1],i[2])},S.prototype.mustAlignNeighborElevations=function(e,t){var n=t.level,r=t.neighborLevel(WorldWind.NORTH),i=t.neighborLevel(WorldWind.SOUTH),s=t.neighborLevel(WorldWind.EAST),o=t.neighborLevel(WorldWind.WEST);return r&&r.compare(n)<0||i&&i.compare(n)<0||s&&s.compare(n)<0||o&&o.compare(n)<0},S.prototype.alignNeighborElevations=function(e,t,n){var r=t.tileHeight+1,i=t.tileWidth+1,s=t.level,o=Math.floor(r/2)+1,u=Math.floor(i/2)+1,a=s.previousLevel(),f=this.scratchPrevElevations,l,c,h,p;f||(f=new Float64Array(o*u),this.scratchPrevElevations=f),E.fillArray(f,0),e.globe.elevationsForGrid(t.sector,o,u,a.texelSize,f),l=t.neighborLevel(WorldWind.NORTH);if(l&&l.compare(s)<0){h=(r-1)*i,p=(o-1)*u;for(c=0;c<u;c++,h+=2,p+=1)n[h]=f[p],c<u-1&&(n[h+1]=.5*(f[p]+f[p+1]))}l=t.neighborLevel(WorldWind.SOUTH);if(l&&l.compare(s)<0){h=0,p=0;for(c=0;c<u;c++,h+=2,p+=1)n[h]=f[p],c<u-1&&(n[h+1]=.5*(f[p]+f[p+1]))}l=t.neighborLevel(WorldWind.EAST);if(l&&l.compare(s)<0){h=i-1,p=u-1;for(c=0;c<o;c++,h+=2*i,p+=u)n[h]=f[p],c<o-1&&(n[h+i]=.5*(f[p]+f[p+u]))}l=t.neighborLevel(WorldWind.WEST);if(l&&l.compare(s)<0){h=0,p=0;for(c=0;c<o;c++,h+=2*i,p+=u)n[h]=f[p],c<o-1&&(n[h+i]=.5*(f[p]+f[p+u]))}},S.prototype.buildSharedGeometry=function(){var e=this.levels.tileWidth,t=this.levels.tileHeight;this.texCoords||this.buildTexCoords(e,t),this.indices||this.buildIndices(e,t),this.wireframeIndices||this.buildWireframeIndices(e,t),this.outlineIndices||this.buildOutlineIndices(e,t)},S.prototype.buildTexCoords=function(e,t){var n=e+1,r=t+1,i=1/e,s=1/t,o=new Float32Array(n*r*2),u=0;for(var a=0,f=0;a<r;a++,f+=s){a==r-1&&(f=1);for(var l=0,c=0;l<n;l++,c+=i)l==n-1&&(c=1),o[u++]=c,o[u++]=f}this.texCoords=o},S.prototype.buildIndices=function(e,t){var n,r=t+1,i=e+1,s=t/2,o=e/2,u=2*(r-3)*(i-2)+2*(r-3),a=new Int16Array(u),f=0;for(var l=1;l<i-2;l+=1){for(var c=1;c<r-1;c+=1)n=l+c*i,a[f++]=n,a[f++]=n+1;a[f++]=n+1,n=l+1+1*i,a[f++]=n}this.indices=a,this.numIndices=u,u=2*i-2,a=new Int16Array(u),f=0,c=r-1,l=i-1,n=l+c*i,a[f++]=n;for(l=i-2;l>0;l-=1)n=l+c*i,a[f++]=n,a[f++]=n-i;l=0,n=l+c*i,a[f++]=n,this.indicesNorth=a,this.numIndicesNorth=u,u=2*i-2,a=new Int16Array(u),f=0,c=0,l=0,n=l+c*i,a[f++]=n;for(l=1;l<i-1;l+=1)n=l+c*i,a[f++]=n,a[f++]=n+i;l=i-1,n=l+c*i,a[f++]=n,this.indicesSouth=a,this.numIndicesSouth=u,u=2*r-2,a=new Int16Array(u),f=0,l=0,c=r-1,n=l+c*i,a[f++]=n;for(c=r-2;c>0;c-=1)n=l+c*i,a[f++]=n,a[f++]=n+1;c=0,n=l+c*i,a[f++]=n,this.indicesWest=a,this.numIndicesWest=u,u=2*r-2,a=new Int16Array(u),f=0,l=i-1,c=0,n=l+c*i,a[f++]=n;for(c=1;c<r-1;c+=1)n=l+c*i,a[f++]=n,a[f++]=n-1;c=r-1,n=l+c*i,a[f++]=n,this.indicesEast=a,this.numIndicesEast=u,u=2*i-2,a=new Int16Array(u),f=0,c=r-1,l=i-1,n=l+c*i,a[f++]=n;for(l=i-2;l>0;l-=1)n=(l+1&-2)+c*i,a[f++]=n,n=l+(c-1)*i,a[f++]=n;l=0,n=l+c*i,a[f++]=n,this.indicesLoresNorth=a,this.numIndicesLoresNorth=u,u=2*i-2,a=new Int16Array(u),f=0,c=0,l=0,n=l+c*i,a[f++]=n;for(l=1;l<i-1;l+=1)n=(l&-2)+c*i,a[f++]=n,n=l+(c+1)*i,a[f++]=n;l=i-1,n=l+c*i,a[f++]=n,this.indicesLoresSouth=a,this.numIndicesLoresSouth=u,u=2*r-2,a=new Int16Array(u),f=0,l=0,c=r-1,n=l+c*i,a[f++]=n;for(c=r-2;c>0;c-=1)n=l+(c+1&-2)*i,a[f++]=n,n=l+1+c*i,a[f++]=n;c=0,n=l+c*i,a[f++]=n,this.indicesLoresWest=a,this.numIndicesLoresWest=u,u=2*r-2,a=new Int16Array(u),f=0,l=i-1,c=0,n=l+c*i,a[f++]=n;for(c=1;c<r-1;c+=1)n=l+(c&-2)*i,a[f++]=n,n=l-1+c*i,a[f++]=n;c=r-1,n=l+c*i,a[f++]=n,this.indicesLoresEast=a,this.numIndicesLoresEast=u},S.prototype.buildWireframeIndices=function(e,t){var n=t+1,r=e+1,i=2*e*n+2*t*r,s=new Int16Array(i),o=r,u=0,a,f,l;for(f=0;f<n;f+=1)for(a=0;a<e;a+=1)l=a+f*o,s[u]=l,s[u+1]=l+1,u+=2;for(a=0;a<r;a+=1)for(f=0;f<t;f+=1)l=a+f*o,s[u]=l,s[u+1]=l+o,u+=2;this.wireframeIndices=s},S.prototype.buildOutlineIndices=function(e,t){var n=t+1,r=e+1,i=2*(n-2)+2*r+1,s=new Int16Array(i),o=n,u=0,a,f,l;f=0;for(a=0;a<r;a+=1)l=a+f*r,s[u]=l,u+=1;a=r-1;for(f=1;f<n;f+=1)l=a+f*r,s[u]=l,u+=1;f=n-1;for(a=r-1;a>=0;a-=1)l=a+f*r,s[u]=l,u+=1;a=0;for(f=n-1;f>=0;f-=1)l=a+f*r,s[u]=l,u+=1;this.outlineIndices=s},S.prototype.cacheSharedGeometryVBOs=function(e){var t=e.currentGlContext,n=e.gpuResourceCache,r=n.resourceForKey(this.texCoordVboCacheKey);r||(r=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,this.texCoords,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.texCoordVboCacheKey,r,this.texCoords.length*4/2));var i=n.resourceForKey(this.indicesVboCacheKey);i||(i=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesVboCacheKey,i,this.indices.length*2));var s=n.resourceForKey(this.indicesNorthVboCacheKey);s||(s=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indicesNorth,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesNorthVboCacheKey,s,this.indicesNorth.length*2));var o=n.resourceForKey(this.indicesSouthVboCacheKey);o||(o=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indicesSouth,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesSouthVboCacheKey,o,this.indicesSouth.length*2));var u=n.resourceForKey(this.indicesWestVboCacheKey);u||(u=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indicesWest,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesWestVboCacheKey,u,this.indicesWest.length*2));var a=n.resourceForKey(this.indicesEastVboCacheKey);a||(a=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indicesEast,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesEastVboCacheKey,a,this.indicesEast.length*2));var f=n.resourceForKey(this.indicesLoresNorthVboCacheKey);f||(f=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,f),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indicesLoresNorth,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesLoresNorthVboCacheKey,f,this.indicesLoresNorth.length*2));var l=n.resourceForKey(this.indicesLoresSouthVboCacheKey);l||(l=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,l),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indicesLoresSouth,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesLoresSouthVboCacheKey,l,this.indicesLoresSouth.length*2));var c=n.resourceForKey(this.indicesLoresWestVboCacheKey);c||(c=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,c),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indicesLoresWest,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesLoresWestVboCacheKey,c,this.indicesLoresWest.length*2));var h=n.resourceForKey(this.indicesLoresEastVboCacheKey);h||(h=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indicesLoresEast,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesLoresEastVboCacheKey,h,this.indicesLoresEast.length*2));var p=n.resourceForKey(this.outlineIndicesVboCacheKey);p||(p=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,p),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.outlineIndices,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.outlineIndicesVboCacheKey,p,this.outlineIndices.length*2));var d=n.resourceForKey(this.wireframeIndicesVboCacheKey);d||(d=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,d),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.wireframeIndices,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.wireframeIndicesVboCacheKey,d,this.wireframeIndices.length*2))},S}),n("globe/Globe",["../geom/Angle","../error/ArgumentError","../geom/BoundingBox","../globe/ElevationModel","../geom/Line","../geom/Location","../util/Logger","../geom/Position","../projections/ProjectionWgs84","../geom/Sector","../globe/Tessellator","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){"use strict";var p=function(e,n){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","constructor","Elevation model is null or undefined."));this.elevationModel=e,this.equatorialRadius=6378137,this.polarRadius=6356752.3,this.eccentricitySquared=.00669437999013,this.tessellator=new l,this._projection=n||new a,this._offset=0,this.offsetVector=new c(0,0,0),this.id=++p.idPool,this._stateKey="globe "+this.id.toString()+" "};return p.idPool=0,Object.defineProperties(p.prototype,{stateKey:{get:function(){return this._stateKey+this.elevationModel.stateKey+"offset "+this.offset.toString()+" "+this.projection.stateKey}},continuous:{get:function(){return this.projection.continuous}},projection:{get:function(){return this._projection},set:function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","projection","missingProjection"));this.projection!=e&&(this.tessellator=new l),this._projection=e}},projectionLimits:{get:function(){return this._projection.projectionLimits}},offset:{get:function(){return this._offset},set:function(e){this._offset=e,this.offsetVector[0]=e*2*Math.PI*this.equatorialRadius}}}),p.prototype.is2D=function(){return this.projection.is2D},p.prototype.computePointFromPosition=function(e,n,r,i){if(!i)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","computePointFromPosition","missingResult"));return this.projection.geographicToCartesian(this,e,n,r,this.offsetVector,i)},p.prototype.computePointFromLocation=function(e,n,r){if(!r)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","computePointFromLocation","missingResult"));return this.computePointFromPosition(e,n,0,r)},p.prototype.computePointsForGrid=function(e,n,r,i,s,u){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","computePointsFromPositions","missingSector"));if(n<1||r<1)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","computePointsFromPositions","Number of latitude or longitude locations is less than one."));var a=n*r;if(!i||i.length<a)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","computePointsFromPositions","Elevations array is null, undefined or insufficient length."));if(!u||u.length<a)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","computePointsFromPositions","Result array is null, undefined or insufficient length."));return this.projection.geographicToCartesianGrid(this,e,n,r,i,s,this.offsetVector,u)},p.prototype.computePositionFromPoint=function(e,n,r,i){if(!i)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","computePositionFromPoint","missingResult"));return this.projection.cartesianToGeographic(this,e,n,r,this.offsetVector,i),this.continuous&&(i.longitude<-180?i.longitude+=360:i.longitude>180&&(i.longitude-=360)),i},p.prototype.radiusAt=function(t,n){var r=Math.sin(t*e.DEGREES_TO_RADIANS),i=this.equatorialRadius/Math.sqrt(1-this.eccentricitySquared*r*r);return i*Math.sqrt(1+(this.eccentricitySquared*this.eccentricitySquared-2*this.eccentricitySquared)*r*r)},p.prototype.surfaceNormalAtLocation=function(n,r,i){if(!i)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","surfaceNormalAtLocation","missingResult"));if(this.is2D())return i[0]=0,i[1]=0,i[2]=1,i;var s=Math.cos(n*e.DEGREES_TO_RADIANS),u=Math.cos(r*e.DEGREES_TO_RADIANS),a=Math.sin(n*e.DEGREES_TO_RADIANS),f=Math.sin(r*e.DEGREES_TO_RADIANS),l=this.equatorialRadius*this.equatorialRadius,c=this.polarRadius*this.polarRadius;return i[0]=s*f/l,i[1]=(1-this.eccentricitySquared)*a/c,i[2]=s*u/l,i.normalize()},p.prototype.surfaceNormalAtPoint=function(e,n,r,i){if(!i)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","surfaceNormalAtPoint","missingResult"));if(this.projection.surfaceNormalAtPoint)return this.projection.surfaceNormalAtPoint(this,e,n,r,i);if(this.is2D())return i[0]=0,i[1]=0,i[2]=1,i;var s=this.equatorialRadius*this.equatorialRadius,u=this.polarRadius*this.polarRadius;return i[0]=e/s,i[1]=n/u,i[2]=r/s,i.normalize()},p.prototype.northTangentAtLocation=function(e,n,r){if(!r)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","northTangentAtLocation","missingResult"));return this.projection.northTangentAtLocation(this,e,n,r)},p.prototype.northTangentAtPoint=function(e,n,r,i){if(!i)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","northTangentAtPoint","missingResult"));return this.projection.northTangentAtPoint(this,e,n,r,this.offsetVector,i)},p.prototype.intersectsFrustum=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","intersectsFrustum","missingFrustum"));if(this.is2D()){var r=new n;return r.setToSector(f.FULL_SPHERE,this,this.elevationModel.minElevation,this.elevationModel.maxElevation),r.intersectsFrustum(e)}return e.far.distance<=this.equatorialRadius?!1:e.left.distance<=this.equatorialRadius?!1:e.right.distance<=this.equatorialRadius?!1:e.top.distance<=this.equatorialRadius?!1:e.bottom.distance<=this.equatorialRadius?!1:e.near.distance<=this.equatorialRadius?!1:!0},p.prototype.intersectsLine=function(e,n){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","intersectWithRay","missingLine"));if(!n)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","intersectsLine","missingResult"));if(this.is2D()){var r=e.direction[0],i=e.direction[1],s=e.direction[2],u=e.origin[0],a=e.origin[1],f=e.origin[2],l;return s==0&&f!=0?!1:(l=-f/s,l<0?!1:(n[0]=u+r*l,n[1]=a+i*l,n[2]=f+s*l,!0))}return h.computeEllipsoidalGlobeIntersection(e,this.equatorialRadius,this.polarRadius,n)},p.prototype.elevationTimestamp=function(){return this.elevationModel.timestamp},p.prototype.minElevation=function(){return this.elevationModel.minElevation},p.prototype.maxElevation=function(){return this.elevationModel.maxElevation},p.prototype.minAndMaxElevationsForSector=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","minAndMaxElevationsForSector","missingSector"));return this.elevationModel.minAndMaxElevationsForSector(e)},p.prototype.elevationAtLocation=function(e,t){return this.elevationModel.elevationAtLocation(e,t)},p.prototype.elevationsForGrid=function(e,n,r,i,s){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","elevationsForSector","missingSector"));if(n<=0||r<=0)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","elevationsForSector","numLat or numLon is less than 1"));if(!s||s.length<n*r)throw new t(o.logMessage(o.LEVEL_SEVERE,"Globe","elevationsForSector","missingArray"));return this.elevationModel.elevationsForGrid(e,n,r,i,s)},p}),n("cache/GpuResourceCache",["../util/AbsentResourceList","../error/ArgumentError","../util/ImageSource","../util/Logger","../cache/MemoryCache","../render/Texture"],function(e,t,n,r,i,s){"use strict";var o=function(n,s){if(!n||n<1)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","constructor","Specified cache capacity is undefined, 0 or negative."));if(!s||s<0||s>=n)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","constructor","Specified cache low-water value is undefined, negative or not less than the capacity."));this.entries=new i(n,s),this.cacheKeyPool=0,this.currentRetrievals={},this.absentResourceList=new e(3,6e4)};return Object.defineProperties(o.prototype,{capacity:{get:function(){return this.entries.capacity}},lowWater:{get:function(){return this.entries.lowWater}},usedCapacity:{get:function(){return this.entries.usedCapacity}},freeCapacity:{get:function(){return this.entries.freeCapacity}}}),o.prototype.generateCacheKey=function(){return"GpuResourceCache "+ ++this.cacheKeyPool},o.prototype.putResource=function(e,i,s){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","putResource","missingKey."));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","putResource","missingResource."));if(!s||s<1)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","putResource","The specified resource size is undefined or less than 1."));var o={resource:i};this.entries.putEntry(e instanceof n?e.key:e,o,s)},o.prototype.resourceForKey=function(e){var t=e instanceof n?this.entries.entryForKey(e.key):this.entries.entryForKey(e);return t?t.resource:null},o.prototype.containsResource=function(e){return this.entries.containsKey(e instanceof n?e.key:e)},o.prototype.removeResource=function(e){this.entries.removeEntry(e instanceof n?e.key:e)},o.prototype.clear=function(){this.entries.clear(!1)},o.prototype.retrieveTexture=function(e,t){if(!t)return null;if(t instanceof n){var i=new s(e,t.image);return this.putResource(t.key,i,i.size),i}if(this.currentRetrievals[t]||this.absentResourceList.isResourceAbsent(t))return null;var o=this,u=new Image;return u.onload=function(){r.log(r.LEVEL_INFO,"Image retrieval succeeded: "+t);var n=new s(e,u);o.putResource(t,n,n.size),delete o.currentRetrievals[t],o.absentResourceList.unmarkResourceAbsent(t);var i=document.createEvent("Event");i.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(i)},u.onerror=function(){delete o.currentRetrievals[t],o.absentResourceList.markResourceAbsent(t),r.log(r.LEVEL_WARNING,"Image retrieval failed: "+t)},this.currentRetrievals[t]=t,u.crossOrigin="anonymous",u.src=t,null},o}),n("pick/PickedObjectList",[],function(){"use strict";var e=function(){this.objects=[]};return e.prototype.hasNonTerrainObjects=function(){return this.objects.length>1||this.objects.length===1&&this.terrainObject()==null},e.prototype.terrainObject=function(){for(var e=0,t=this.objects.length;e<t;e++)if(this.objects[e].isTerrain)return this.objects[e];return null},e.prototype.add=function(e){if(e)if(e.isTerrain){var t=this.objects.length;for(var n=0,r=this.objects.length;n<r;n++)if(this.objects[n].isTerrain){t=n;break}this.objects[t]=e}else this.objects.push(e)},e.prototype.clear=function(){this.objects=[]},e.prototype.topPickedObject=function(){var e=this.objects.length;if(e>1)for(var t=0;t<e;t++)if(this.objects[[t].isOnTop])return this.objects[t];return e>0?this.objects[0]:null},e}),n("render/ScreenCreditController",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Font","../util/Logger","../geom/Matrix","../util/Offset","../pick/PickedObject","../render/Renderable","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(){this.imageUrls=[],this.stringCredits=[],this.imageCreditSize=64,this.margin=5,this.opacity=.5,this.creditFont=new r(14)};return c.scratchMatrix=s.fromIdentity(),c.imageTransform=s.fromIdentity(),c.texCoordMatrix=s.fromIdentity(),c.prototype.clear=function(){this.imageUrls=[],this.stringCredits=[]},c.prototype.addImageCredit=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"ScreenCreditController","addImageCredit","missingUrl"));this.imageUrls.indexOf(t)===-1&&this.imageUrls.push(t)},c.prototype.addStringCredit=function(t,r){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"ScreenCreditController","addStringCredit","missingText"));if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"ScreenCreditController","addStringCredit","missingColor"));this.stringCredits.indexOf(t)===-1&&this.stringCredits.push({text:t,color:r||n.WHITE})},c.prototype.drawCredits=function(e){if(this.imageUrls.length===0&&this.stringCredits.length===0)return;if(e.pickingMode)return;if(e.timestamp==this.lastFrameTimestamp)return;this.lastFrameTimestamp=e.timestamp,this.beginDrawingCredits(e);var t=e.navigatorState.viewport.width-(this.margin+this.imageCreditSize),n,r=0;for(var i=0;i<this.imageUrls.length;i++)n=this.drawImageCredit(e,this.imageUrls[i],t,this.margin),n>0&&(t-=this.margin+this.imageCreditSize,r=l.max(n,r));var s=r+this.margin;for(var o=0;o<this.stringCredits.length;o++)this.drawStringCredit(e,this.stringCredits[o],s),s+=this.margin+15;this.endDrawingCredits(e)},c.prototype.beginDrawingCredits=function(e){var n=e.currentGlContext,r;e.findAndBindProgram(t),r=e.currentProgram,n.bindBuffer(n.ARRAY_BUFFER,e.unitQuadBuffer3()),n.vertexAttribPointer(r.vertexPointLocation,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e.unitQuadBuffer()),n.vertexAttribPointer(r.vertexTexCoordLocation,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.vertexPointLocation),n.enableVertexAttribArray(r.vertexTexCoordLocation),r.loadTextureUnit(n,n.TEXTURE0),r.loadModulateColor(n,!1)},c.prototype.endDrawingCredits=function(e){var t=e.currentGlContext,n=e.currentProgram;t.disableVertexAttribArray(n.vertexPointLocation),t.disableVertexAttribArray(n.vertexTexCoordLocation),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindTexture(t.TEXTURE_2D,null),t.enable(t.DEPTH_TEST)},c.prototype.drawImageCredit=function(e,t,r,i){var s,o,u,a,f,l;return a=e.gpuResourceCache.resourceForKey(t),a?(s=a.imageWidth,o=a.imageHeight,s<=this.imageCreditSize&&this.imageHeight<=this.imageCreditSize?u=1:s>=o?u=this.imageCreditSize/s:u=this.imageCreditSize/o,c.imageTransform.setTranslation(r,i,0),c.imageTransform.setScale(u*s,u*o,1),f=e.currentGlContext,l=e.currentProgram,c.scratchMatrix.copy(e.screenProjection),c.scratchMatrix.multiplyMatrix(c.imageTransform),l.loadModelviewProjection(f,c.scratchMatrix),l.loadTextureEnabled(f,!0),l.loadColor(f,n.WHITE),l.loadOpacity(f,this.opacity),c.texCoordMatrix.setToIdentity(),c.texCoordMatrix.multiplyByTextureTransform(a),l.loadTextureMatrix(f,c.texCoordMatrix),a.bind(e)&&f.drawArrays(f.TRIANGLE_STRIP,0,4),o):(e.gpuResourceCache.retrieveTexture(e.currentGlContext,t),0)},c.prototype.drawStringCredit=function(e,t,n){var r,i,s,o,u,a,f;return o=t.text+this.creditFont.toString(),s=e.gpuResourceCache.resourceForKey(o),s||(s=e.textSupport.createTexture(e,t.text,this.creditFont,!1),e.gpuResourceCache.putResource(o,s,s.size)),r=s.imageWidth,i=s.imageHeight,f=e.navigatorState.viewport.width-(r+this.margin),c.imageTransform.setTranslation(f,n,0),c.imageTransform.setScale(r,i,1),u=e.currentGlContext,a=e.currentProgram,c.scratchMatrix.copy(e.screenProjection),c.scratchMatrix.multiplyMatrix(c.imageTransform),a.loadModelviewProjection(u,c.scratchMatrix),a.loadTextureEnabled(u,!0),a.loadColor(u,t.color),a.loadOpacity(u,this.opacity),c.texCoordMatrix.setToIdentity(),c.texCoordMatrix.multiplyByTextureTransform(s),a.loadTextureMatrix(u,c.texCoordMatrix),s.bind(e)&&u.drawArrays(u.TRIANGLE_STRIP,0,4),!0},c}),n("shapes/ShapeAttributes",["../util/Color","../util/ImageSource"],function(e,t){"use strict";var n=function(t){this._drawInterior=t?t._drawInterior:!0,this._drawOutline=t?t._drawOutline:!0,this._enableLighting=t?t._enableLighting:!1,this._interiorColor=t?t._interiorColor:e.WHITE,this._outlineColor=t?t._outlineColor:e.RED,this._outlineWidth=t?t._outlineWidth:1,this._outlineStippleFactor=t?t._outlineStippleFactor:0,this._outlineStipplePattern=t?t._outlineStipplePattern:61680,this._imageSource=t?t._imageSource:null,this._depthTest=t?t._depthTest:!0,this._drawVerticals=t?t._drawVerticals:!1,this._applyLighting=t?t._applyLighting:!1,this.stateKeyInvalid=!0};return n.prototype.computeStateKey=function(){return"di "+this._drawInterior+" do "+this._drawOutline+" el "+this._enableLighting+" ic "+this._interiorColor.toHexString(!0)+" oc "+this._outlineColor.toHexString(!0)+" ow "+this._outlineWidth+" osf "+this._outlineStippleFactor+" osp "+this._outlineStipplePattern+" is "+(this._imageSource?this.imageSource instanceof t?this.imageSource.key:this.imageSource:"null")+" dt "+this._depthTest+" dv "+this._drawVerticals+" li "+this._applyLighting},Object.defineProperties(n.prototype,{stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}},drawInterior:{get:function(){return this._drawInterior},set:function(e){this._drawInterior=e,this.stateKeyInvalid=!0}},drawOutline:{get:function(){return this._drawOutline},set:function(e){this._drawOutline=e,this.stateKeyInvalid=!0}},enableLighting:{get:function(){return this._enableLighting},set:function(e){this._enableLighting=e,this.stateKeyInvalid=!0}},interiorColor:{get:function(){return this._interiorColor},set:function(e){this._interiorColor=e,this.stateKeyInvalid=!0}},outlineColor:{get:function(){return this._outlineColor},set:function(e){this._outlineColor=e,this.stateKeyInvalid=!0}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth=e,this.stateKeyInvalid=!0}},outlineStipplePattern:{get:function(){return this._outlineStipplePattern},set:function(e){this._outlineStipplePattern=e,this.stateKeyInvalid=!0}},outlineStippleFactor:{get:function(){return this._outlineStippleFactor},set:function(e){this._outlineStippleFactor=e,this.stateKeyInvalid=!0}},imageSource:{get:function(){return this._imageSource},set:function(e){this._imageSource=e,this.stateKeyInvalid=!0}},depthTest:{get:function(){return this._depthTest},set:function(e){this._depthTest=e,this.stateKeyInvalid=!0}},drawVerticals:{get:function(){return this._drawVerticals},set:function(e){this._drawVerticals=e,this.stateKeyInvalid=!0}},applyLighting:{get:function(){return this._applyLighting},set:function(e){this._applyLighting=e,this.stateKeyInvalid=!0}}}),n}),n("shapes/SurfaceShape",["../error/AbstractError","../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../error/NotYetImplementedError","../pick/PickedObject","../render/Renderable","../geom/Sector","../shapes/ShapeAttributes","../error/UnsupportedOperationError","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c){"use strict";var h=function(e){u.call(this),this._displayName="Surface Shape",this._attributes=e?e:new f(null),this._highlightAttributes=null,this._highlighted=!1,this._enabled=!0,this._pathType=WorldWind.GREAT_CIRCLE,this._maximumNumEdgeIntervals=h.DEFAULT_NUM_EDGE_INTERVALS,this._polarThrottle=h.DEFAULT_POLAR_THROTTLE,this._sector=null,this.pickDelegate=null,this._sectors=[],this._locations=null,this._boundaries=null,this._interiorGeometry=null,this._outlineGeometry=null,this._isInteriorInhibited=!1,this.stateKeyInvalid=!0,this._attributesStateKey=null,this.isPrepared=!1,this.layer=null,this.pickColor=null};return h.prototype=Object.create(u.prototype),Object.defineProperties(h.prototype,{stateKey:{get:function(){if(!this._attributesStateKey)this._highlighted?!this._highlightAttributes||(this._attributesStateKey=this._highlightAttributes.stateKey):!this._attributes||(this._attributesStateKey=this._attributes.stateKey),!this._attributesStateKey||(this.stateKeyInvalid=!0);else{var e=null;this._highlighted?!this._highlightAttributes||(e=this._highlightAttributes.stateKey):!this._attributes||(e=this._attributes.stateKey),e!=this._attributesStateKey&&(this._attributesStateKey=e,this.stateKeyInvalid=!0)}return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey()),this._stateKey}},displayName:{get:function(){return this._displayName},set:function(e){this.stateKeyInvalid=!0,this._displayName=e}},attributes:{get:function(){return this._attributes},set:function(e){this.stateKeyInvalid=!0,this._attributes=e,this._attributesStateKey=e.stateKey}},highlightAttributes:{get:function(){return this._highlightAttributes},set:function(e){this.stateKeyInvalid=!0,this._highlightAttributes=e}},highlighted:{get:function(){return this._highlighted},set:function(e){this.stateKeyInvalid=!0,this._highlighted=e}},enabled:{get:function(){return this._enabled},set:function(e){this.stateKeyInvalid=!0,this._enabled=e}},pathType:{get:function(){return this._pathType},set:function(e){this.stateKeyInvalid=!0,this._pathType=e}},maximumNumEdgeIntervals:{get:function(){return this._maximumNumEdgeIntervals},set:function(e){this.stateKeyInvalid=!0,this._maximumNumEdgeIntervals=e}},polarThrottle:{get:function(){return this._polarThrottle},set:function(e){this.stateKeyInvalid=!0,this._polarThrottle=e}},sector:{get:function(){return this._sector}}}),h.staticStateKey=function(e){return e.stateKeyInvalid=!1,e.highlighted?e._highlightAttributes?e._attributesStateKey=e._highlightAttributes.stateKey:e._attributes?e._attributesStateKey=e._attributes.stateKey:e._attributesStateKey=null:e._attributes?e._attributesStateKey=e._attributes.stateKey:e._attributesStateKey=null,"dn "+e.displayName+" at "+(e._attributesStateKey?e._attributesStateKey:"null")+" hi "+e.highlighted+" en "+e.enabled+" pt "+e.pathType+" ne "+e.maximumNumEdgeIntervals+" po "+e.polarThrottle+" se "+"["+e.sector.minLatitude+","+e.sector.maxLatitude+","+e.sector.minLongitude+","+e.sector.maxLongitude+"]"},h.prototype.computeStateKey=function(){return h.staticStateKey(this)},h.prototype.area=function(e,t){throw new s(i.logMessage(i.LEVEL_SEVERE,"SurfaceShape","area","notYetImplemented"))},h.prototype.computeBoundaries=function(t){throw new e(i.logMessage(i.LEVEL_SEVERE,"SurfaceShape","computeBoundaries","abstractInvocation"))},h.prototype.render=function(e){this.layer=e.currentLayer,this.prepareBoundaries(e),e.surfaceShapeTileBuilder.insertSurfaceShape(this)},h.prototype.interpolateLocations=function(e){var t=e[0],n=t,r,i=!0,s=!0,o=0,u=!0,a,f;this._locations=[t];for(a=1,f=e.length;a<f;a+=1){r=n,s=i,n=e[a],i=n.latitude==t.latitude&&n.longitude==t.longitude,u=!0;if(i||s)o+=1,o>2&&(u=!1);u&&this.interpolateEdge(r,n,this._locations),this._locations.push(n),r=n}!this._isInteriorInhibited&&(r.latitude!=t.latitude||r.longitude!=t.longitude)&&(this.interpolateEdge(r,t,this._locations),this._locations.push(t))},h.prototype.interpolateEdge=function(e,t,n){var i=r.greatCircleDistance(e,t),s=Math.round(this._maximumNumEdgeIntervals*i/Math.PI),o,u;if(s>0){o=1/s,u=e;for(var a=this.throttledStep(o,u);a<1;a+=this.throttledStep(o,u))u=new r(0,0),r.interpolateAlongPath(this._pathType,a,e,t,u),n.push(u)}},h.prototype.throttledStep=function(e,n){var r=Math.cos(n.latitude*t.DEGREES_TO_RADIANS);r*=r;var i=this._polarThrottle/(1+this._polarThrottle);return e*(1-i+i*r)},h.prototype.prepareBoundaries=function(e){if(this.isPrepared)return;this._boundaries||this.computeBoundaries(e),this._locations||this.interpolateLocations(this._boundaries),this.prepareGeometry(e),this.prepareSectors(),this.isPrepared=!0},h.prototype.computeSectors=function(e){return this._sectors&&this._sectors.length>0?this._sectors:(this.prepareBoundaries(e),this._sectors)},h.prototype.prepareSectors=function(){var e=this._boundaries;if(!e)return;this._sector=new a(-90,90,-180,180),this._sector.setToBoundingSector(e);var t=this.containsPole(e);t!=r.poles.NONE?(t==r.poles.NORTH?this._sector=new a(this._sector.minLatitude,90,-180,180):this._sector=new a(-90,this._sector.maxLatitude,-180,180),this._sectors=[this._sector]):r.locationsCrossDateLine(e)?this._sectors=a.splitBoundingSectors(e):this._sector.isEmpty()||(this._sectors=[this._sector]);if(!this._sectors)return;if(this._pathType===WorldWind.GREAT_CIRCLE)for(var n=0,i=this._sectors.length;n<i;n+=1){var s=this._sectors[n],o=r.greatCircleArcExtremeLocations(e),u=Math.min(s.minLatitude,o[0].latitude),f=Math.max(s.maxLatitude,o[1].latitude);this._sectors[n]=new a(u,f,s.minLongitude,s.maxLongitude)}},h.prototype.prepareGeometry=function(e){var t;this._interiorGeometry=[],this._outlineGeometry=[];var n=this._locations,i=this.containsPole(n);if(i!=r.poles.NONE){var s=this.cutAlongDateLine(n,i,e.globe);this._interiorGeometry.push(s),t=this.repeatAroundDateline(n),this._outlineGeometry.push(t[0]),t.length>1&&this._outlineGeometry.push(t[1])}else r.locationsCrossDateLine(n)?(t=this.repeatAroundDateline(n),this._interiorGeometry.push(t[0]),this._interiorGeometry.push(t[1]),this._outlineGeometry.push(t[0]),this._outlineGeometry.push(t[1])):(this._interiorGeometry.push(n),this._outlineGeometry.push(n))},h.prototype.containsPole=function(e){var t=!1,n=90,i=-90,s=e[0];for(var o=1,u=e.length;o<u;o+=1){var a=e[o];r.locationsCrossDateLine([s,a])&&(t=!t),n=Math.min(n,a.latitude),i=Math.max(i,a.latitude),s=a}var f=e[0];return r.locationsCrossDateLine([f,s])&&(t=!t),t?n>0?r.poles.NORTH:i<0?r.poles.SOUTH:Math.abs(i)>=Math.abs(n)?r.poles.NORTH:r.poles.SOUTH:r.poles.NONE},h.prototype.cutAlongDateLine=function(e,t,n){if(t==r.poles.NONE)return e;var i=[],s=t==r.poles.NORTH?90:-90,o=e[e.length-1];for(var u=0,a=e.length;u<a;u+=1){var f=e[u];i.push(o);if(r.locationsCrossDateLine([o,f])){var l=r.intersectionWithMeridian(o,f,180,n),h=c.signum(o.longitude),p=l,d=180*h,v=-d;i.push(new r(p,d)),i.push(new r(s,d)),i.push(new r(s,v)),i.push(new r(p,v))}o=f}return i.push(o),i},h.prototype.repeatAroundDateline=function(e){var t=0,n=!1,i=[],s=e[0];i.push(s);for(var o=1,u=e.length;o<u;o+=1){var a=e[o];r.locationsCrossDateLine([s,a])&&(t==0&&(t=s.longitude<0?-360:360),n=!n),n?i.push(new r(a.latitude,a.longitude+t)):i.push(a),s=a}var f=[i];if(t!=0){var l=i;i=[];for(o=0,u=l.length;o<u;o+=1){var c=l[o];i.push(new r(c.latitude,c.longitude-t))}f.push(i)}return f},h.prototype.resetPickColor=function(){this.pickColor=null},h.prototype.renderToTexture=function(e,t,n,r,i,s){var u,a,f=[],l,c,h=e.pickingMode,p=this._highlighted?this._highlightAttributes||this._attributes:this._attributes;h&&!this.pickColor&&(this.pickColor=e.uniquePickColor());if(!this._isInteriorInhibited&&p.drawInterior){t.fillStyle=h?this.pickColor.toHexString(!1):p.interiorColor.toHexString(!1);for(u=0,a=this._interiorGeometry.length;u<a;u+=1){l=0,c=this._outlineGeometry[u].length*2,f.splice(0,f.length);if(this.transformPath(this._interiorGeometry[u],n,r,i,s,f)){t.beginPath(),t.moveTo(f[l++],f[l++]);while(l<c)t.lineTo(f[l++],f[l++]);t.closePath(),t.fill()}}}if(p.drawOutline&&p.outlineWidth>0){t.lineWidth=4*p.outlineWidth,t.strokeStyle=h?this.pickColor.toHexString(!1):p.outlineColor.toHexString(!1);var d=this._attributes.outlineStipplePattern,v=this._attributes.outlineStippleFactor;for(u=0,a=this._outlineGeometry.length;u<a;u+=1){f.splice(0,f.length);if(this.transformPath(this._outlineGeometry[u],n,r,i,s,f)){var m=f[0],g=f[1],y=m,b=g,w=m,E=g,S=!0,x=!0,T=0;for(l=2,c=f.length;l<c;){y=w,b=E,S=x,w=f[l++],E=f[l++],x=w==m&&E==g;if(S||x){T+=1;if(T>2)continue}t.beginPath(),t.moveTo(y,b),t.lineTo(w,E),t.stroke()}}}}if(h){var N=new o(this.pickColor.clone(),this._pickDelegate?this._pickDelegate:this,null,this.layer,!1);e.resolvePick(N)}},h.prototype.transformPath=function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E=4,S,x,T,N,C;T=0,x=e[0],l=x.longitude*t+r,c=x.latitude*n+i,S=!0,d=m=o=a=l,v=g=u=f=c,s[T++]=a,s[T++]=f;for(N=1,C=e.length;N<C;N+=1){x=e[N],h=a,p=f,a=x.longitude*t+r,f=x.latitude*n+i,S=a==l&&f==c,y=a-o,b=f-u,w=y*y+b*b;if(S||w>=E){d=Math.min(d,a),m=Math.max(m,a),v=Math.min(v,f),g=Math.max(g,f);if(s[T-2]!=h||s[T-1]!=p)s[T++]=h,s[T++]=p;s[T++]=a,s[T++]=f,o=a,u=f}}return m-d>=2||g-v>=2},h.DEFAULT_NUM_EDGE_INTERVALS=128,h.DEFAULT_POLAR_THROTTLE=10,h}),n("shapes/SurfaceShapeTile",["../geom/Angle","../error/ArgumentError","../util/Level","../util/Logger","../geom/Sector","../render/Texture","../render/TextureTile"],function(e,t,n,r,i,s,o){"use strict";var u=function(e,t,n,r){o.call(this,e,t,n,r),this.surfaceShapes=[],this.sector=e,this.cacheKey=null,this.pickSequence=0,this.surfaceShapeStateKeys=[],this.prevSurfaceShapes=[],this.createCtx2D()};return u.prototype=Object.create(o.prototype),u.prototype.clearShapes=function(){var e=this.prevSurfaceShapes;this.prevSurfaceShapes=this.surfaceShapes,this.surfaceShapes=e,this.surfaceShapes.splice(0,this.surfaceShapes.length)},u.prototype.hasShapes=function(){return this.surfaceShapes.length>0},u.prototype.getShapes=function(){return this.surfaceShapes},u.prototype.setShapes=function(e){this.surfaceShapes=e},u.prototype.getSector=function(){return this.sector},u.prototype.addSurfaceShape=function(e){this.surfaceShapes.push(e),this.surfaceShapeStateKeys.push(e.stateKey)},u.prototype.addAllSurfaceShapes=function(e){for(var t=0,n=e.length;t<n;t+=1){var r=e[t];this.addAllSurfaceShapes(r)}},u.prototype.needsUpdate=function(e){var t,n,r,i;if(this.prevSurfaceShapes.length!=this.surfaceShapes.length)return!0;for(t=0,n=this.prevSurfaceShapes;t<n;t+=1){r=this.prevSurfaceShapes[t];if(this.surfaceShapes.indexOf(r)<0)return!0}for(t=0,n=this.surfaceShapes;t<n;t+=1){r=this.surfaceShapes[t];if(this.prevSurfaceShapes.indexOf(r)<0)return!0}for(t=0,n=this.surfaceShapes.length;t<n;t+=1){r=this.surfaceShapes[t],i=this.surfaceShapeStateKeys[t];if(i!=r.stateKey)return!0}return this.hasTexture(e)?!1:!0},u.prototype.hasTexture=function(e){if(e.pickingMode)return!1;var t=e.gpuResourceCache;this.gpuCacheKey||(this.gpuCacheKey=this.getCacheKey());var n=t.resourceForKey(this.gpuCacheKey);return!!n},u.prototype.updateTexture=function(e){var t=e.currentGlContext,n=u.canvas;n.width=this.tileWidth,n.height=this.tileHeight;var r=u.ctx2D,i=this.tileWidth/this.sector.deltaLongitude(),o=-this.tileHeight/this.sector.deltaLatitude(),a=-this.sector.minLongitude*i,f=-this.sector.maxLatitude*o;for(var l=0,c=this.surfaceShapes.length;l<c;l+=1){var h=this.surfaceShapes[l];this.surfaceShapeStateKeys[l]=h.stateKey,h.renderToTexture(e,r,i,o,a,f)}var p=new s(t,n),d=e.gpuResourceCache;return this.gpuCacheKey=this.getCacheKey(),d.putResource(this.gpuCacheKey,p,p.size),p},u.prototype.getCacheKey=function(){return this.cacheKey||(this.cacheKey="SurfaceShapeTile:"+this.tileKey+","+this.pickSequence.toString()),this.cacheKey},u.prototype.createCtx2D=function(){u.ctx2D||(u.canvas=document.createElement("canvas"),u.ctx2D=u.canvas.getContext("2d"))},u.canvas=null,u.ctx2D=null,u}),n("shapes/SurfaceShapeTileBuilder",["../error/ArgumentError","../render/DrawContext","../globe/Globe","../shaders/GpuProgram","../util/Level","../util/LevelSet","../geom/Location","../util/Logger","../geom/Matrix","../cache/MemoryCache","../navigate/NavigatorState","../error/NotYetImplementedError","../pick/PickedObject","../geom/Rectangle","../geom/Sector","../shapes/SurfaceShape","../shapes/SurfaceShapeTile","../globe/Terrain","../globe/TerrainTile","../globe/TerrainTileList","../render/TextureTile","../util/Tile"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){"use strict";var S=function(){this.numRowsTilesInTopLevel=4,this.numColumnsTilesInTopLevel=8,this.maximumSubdivisionDepth=15,this.tileWidth=256,this.tileHeight=256,this.levels=new s(d.FULL_SPHERE,new o(180/this.numRowsTilesInTopLevel,360/this.numColumnsTilesInTopLevel),this.maximumSubdivisionDepth,this.tileWidth,this.tileHeight),this.surfaceShapes=[],this.surfaceShapeTiles=[],this.topLevelTiles=[],this.sector=new d(-90,90,-180,180),this.detailControl=1.25,this.tileCache=new f(5e5,4e5)};return S.prototype.clear=function(){this.surfaceShapeTiles.splice(0,this.surfaceShapeTiles.length),this.surfaceShapes.splice(0,this.surfaceShapes.length)},S.prototype.insertSurfaceShape=function(e){this.surfaceShapes.push(e)},S.prototype.doRender=function(e){if(e.pickingMode){for(var t=0,n=this.surfaceShapes.length;t<n;t+=1)this.surfaceShapes[t].resetPickColor();S.pickSequence+=1;var r=this.surfaceShapeTiles,i=this.topLevelTiles;this.surfaceShapeTiles=[],this.topLevelTiles=[],this.buildTiles(e),e.deepPicking?this.doDeepPickingRender(e):e.surfaceTileRenderer.renderTiles(e,this.surfaceShapeTiles,1),this.surfaceShapeTiles=r,this.topLevelTiles=i}else this.buildTiles(e),e.surfaceTileRenderer.renderTiles(e,this.surfaceShapeTiles,1)},S.prototype.doDeepPickingRender=function(e){var t,n,r,i,s,o,u,a,f,l=[];for(s=0,o=e.objectsAtPickPoint.objects.length;s<o;s+=1)u=e.objectsAtPickPoint.objects[s],u.userObject instanceof v&&(a=u.userObject,l.indexOf(a)<0&&(l.push(a),e.objectsAtPickPoint.objects.splice(s,1),s-=1,o-=1));if(l.length<=0)return;var c=[];for(r=0,i=l.length;r<i;r+=1){a=l[r];for(t=0,n=this.surfaceShapeTiles.length;t<n;t+=1)f=this.surfaceShapeTiles[t],f.setShapes([a]),f.updateTexture(e);e.surfaceTileRenderer.renderTiles(e,this.surfaceShapeTiles,1);var p=e.readPickColor(e.pickPoint);!!p&&a.pickColor.equals(p)&&(u=new h(a.pickColor.clone(),a._pickDelegate?a._pickDelegate:a,null,a.layer,!1),c.push(u))}for(s=0,o=e.objectsAtPickPoint.objects.length;s<o;s+=1)u=e.objectsAtPickPoint.objects[s],u.userObject instanceof v&&(e.objectsAtPickPoint.objects.splice(s,1),s-=1,o-=1);for(s=0,o=c.length;s<o;s+=1)u=c[s],e.objectsAtPickPoint.objects.push(u)},S.prototype.buildTiles=function(t){if(!t)throw new e(u.logMessage(u.LEVEL_SEVERE,"SurfaceShapeTileBuilder","buildTiles","missingDc"));if(!this.surfaceShapes||this.surfaceShapes.length<1)return;this.assembleTiles(t),this.surfaceShapes.splice(0,this.surfaceShapes.length);for(var n=0,r=this.surfaceShapeTiles.length;n<r;n+=1){var i=this.surfaceShapeTiles[n];i.clearShapes()}},S.prototype.assembleTiles=function(e){var t,n,r,i,s,o,u;this.topLevelTiles.length<1&&this.createTopLevelTiles();var a={};for(n=0,r=this.surfaceShapes.length;n<r;n+=1){var f=this.surfaceShapes[n],l=f.computeSectors(e);if(!l)continue;for(o=0,u=l.length;o<u;o+=1){var c=l[o];for(i=0,s=this.topLevelTiles.length;i<s;i+=1){t=this.topLevelTiles[i];if(t.sector.intersects(c)){var h=t.tileKey;a[h]=t,t.addSurfaceShape(f)}}}}for(var p in a)a.hasOwnProperty(p)&&(t=a[p],this.addTileOrDescendants(e,this.levels,null,t))},S.prototype.addTileOrDescendants=function(e,t,n,r){if(!this.intersectsFrustum(e,r)){r.clearShapes();return}n!=null&&this.addIntersectingShapes(e,n,r);if(!r.hasShapes())return;if(this.meetsRenderCriteria(e,t,r)){this.addTile(e,r);return}var i=t.level(r.level.levelNumber+1),s=e.pickingMode?r.subdivide(i,this):r.subdivideToCache(i,this,this.tileCache);for(var o=0,u=s.length;o<u;o+=1){var a=s[o];this.addTileOrDescendants(e,t,r,a)}r.clearShapes()},S.prototype.addIntersectingShapes=function(e,t,n){if(!t.hasShapes())return;if(!n.sector.intersects(t.sector))return;if(n.getSector().contains(t.sector))n.addAllSurfaceShapes(t.getShapes());else{var r=t.getShapes();for(var i=0,s=r.length;i<s;i+=1){var o=r[i],u=o.computeSectors(e);if(!u)continue;for(var a=0,f=u.length;a<f;a+=1){var l=u[a];if(n.getSector().intersects(l)){n.addSurfaceShape(o);break}}}}},S.prototype.addTile=function(e,t){e.pickingMode&&(t.pickSequence=S.pickSequence),t.needsUpdate(e)&&t.updateTexture(e),this.surfaceShapeTiles.push(t)},S.prototype.createTile=function(e,t,n,r){return new m(e,t,n,r)},S.prototype.createTopLevelTiles=function(){E.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles)},S.prototype.intersectsFrustum=function(e,t){return e.globe.projectionLimits&&!t.sector.overlaps(e.globe.projectionLimits)?!1:(t.update(e),t.extent.intersectsFrustum(e.pickingMode?e.pickFrustum:e.navigatorState.frustumInModelCoordinates))},S.prototype.meetsRenderCriteria=function(e,t,n){return n.level.levelNumber==t.lastLevel().levelNumber||!n.mustSubdivide(e,this.detailControl)},S.pickSequence=0,S}),n("shaders/SurfaceTileRendererProgram",["../error/ArgumentError","../util/Color","../shaders/GpuProgram","../util/Logger"],function(e,t,n,r){"use strict";var i=function(e){var t="attribute vec4 vertexPoint;\nattribute vec4 vertexTexCoord;\nuniform mat4 mvpMatrix;\nuniform mat4 texSamplerMatrix;\nuniform mat4 texMaskMatrix;\nvarying vec2 texSamplerCoord;\nvarying vec2 texMaskCoord;\nvoid main() {\ngl_Position = mvpMatrix * vertexPoint;\ntexSamplerCoord = (texSamplerMatrix * vertexTexCoord).st;\ntexMaskCoord = (texMaskMatrix * vertexTexCoord).st;\n}",r="precision mediump float;\nuniform sampler2D texSampler;\nuniform float opacity;\nuniform vec4 color;\nuniform bool modulateColor;\nvarying vec2 texSamplerCoord;\nvarying vec2 texMaskCoord;\nbool isInsideTextureImage(const vec2 coord) {\n    return coord.x >= 0.0 && coord.x <= 1.0 && coord.y >= 0.0 && coord.y <= 1.0;\n}\nvoid main(void) {\nfloat mask = float(isInsideTextureImage(texMaskCoord));if (modulateColor) {\n    gl_FragColor = color * mask * floor(texture2D(texSampler, texSamplerCoord).a + 0.5);\n} else {\n    gl_FragColor = texture2D(texSampler, texSamplerCoord) * mask * opacity;\n}\n}";n.call(this,e,t,r),this.vertexPointLocation=this.attributeLocation(e,"vertexPoint"),this.vertexTexCoordLocation=this.attributeLocation(e,"vertexTexCoord"),this.mvpMatrixLocation=this.uniformLocation(e,"mvpMatrix"),this.colorLocation=this.uniformLocation(e,"color"),this.modulateColorLocation=this.uniformLocation(e,"modulateColor"),this.texSamplerMatrixLocation=this.uniformLocation(e,"texSamplerMatrix"),this.texMaskMatrixLocation=this.uniformLocation(e,"texMaskMatrix"),this.texSamplerLocation=this.uniformLocation(e,"texSampler"),this.opacityLocation=this.uniformLocation(e,"opacity"),this.vertexPointLocation=-1};return i.key="WorldWindGpuSurfaceTileRenderingProgram",i.prototype=Object.create(n.prototype),i.prototype.loadModelviewProjection=function(t,n){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadModelviewProjection","missingMatrix"));this.loadUniformMatrix(t,n,this.mvpMatrixLocation)},i.prototype.loadTexSamplerMatrix=function(t,n){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadTexSamplerMatrix","missingMatrix"));this.loadUniformMatrix(t,n,this.texSamplerMatrixLocation)},i.prototype.loadTexMaskMatrix=function(t,n){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadTexMaskMatrix","missingMatrix"));this.loadUniformMatrix(t,n,this.texMaskMatrixLocation)},i.prototype.loadTexSampler=function(e,t){e.uniform1i(this.texSamplerLocation,t-WebGLRenderingContext.TEXTURE0)},i.prototype.loadOpacity=function(e,t){e.uniform1f(this.opacityLocation,t)},i.prototype.loadColor=function(t,n){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadColor","missingColor"));this.loadUniformColor(t,n,this.colorLocation)},i.prototype.loadModulateColor=function(e,t){e.uniform1i(this.modulateColorLocation,t?1:0)},i}),n("render/SurfaceTileRenderer",["../error/ArgumentError","../util/Logger","../geom/Matrix","../shapes/SurfaceShapeTile","../shaders/SurfaceTileRendererProgram"],function(e,t,n,r,i){"use strict";var s=function(){this.texMaskMatrix=n.fromIdentity(),this.texSamplerMatrix=n.fromIdentity(),this.isSurfaceShapeTileRendering=!1};return s.prototype.renderTiles=function(n,i,s,o){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceTileRenderer","renderTiles","Specified surface tiles array is null or undefined."));if(i.length<1)return;var u=n.terrain,a=n.currentGlContext,f=0,l,c,h,p,d=1;if(!u)return;this.isSurfaceShapeTileRendering=i[0]instanceof r,s*=n.surfaceOpacity,l=this.beginRendering(n,s),u.beginRendering(n);try{for(var v=0,m=u.surfaceGeometry.length;v<m;v++){c=u.surfaceGeometry[v],h=c.sector,u.beginRenderingTile(n,c);try{for(var g=0,y=i.length;g<y;g++)p=i[g],p.sector.overlaps(h)&&p.bind(n)&&(n.pickingMode?p.pickColor&&l.loadColor(a,p.pickColor):o&&p.opacity!=d&&(l.loadOpacity(a,s*p.opacity),d=p.opacity),this.applyTileState(n,c,p),u.renderTile(n,c),++f)}catch(b){console.log(b)}finally{u.endRenderingTile(n,c)}}}catch(b){console.log(b)}finally{u.endRendering(n),this.endRendering(n),n.frameStatistics.incrementRenderedTileCount(f)}},s.prototype.beginRendering=function(e,t){var n=e.currentGlContext,r=e.findAndBindProgram(i);return r.loadTexSampler(n,n.TEXTURE0),e.pickingMode&&!this.isSurfaceShapeTileRendering?r.loadModulateColor(n,!0):(r.loadModulateColor(n,!1),r.loadOpacity(n,t)),r},s.prototype.endRendering=function(e){var t=e.currentGlContext;t.bindTexture(t.TEXTURE_2D,null)},s.prototype.applyTileState=function(e,t,n){var r=e.currentGlContext,i=e.currentProgram,s=t.sector,o=s.deltaLatitude(),u=s.deltaLongitude(),a=n.sector,f=a.deltaLatitude(),l=a.deltaLongitude(),c=f>0?f:1,h=l>0?l:1,p=u/h,d=o/c,v=-(a.minLongitude-s.minLongitude)/h,m=-(a.minLatitude-s.minLatitude)/c;this.texMaskMatrix.set(p,0,0,v,0,d,0,m,0,0,1,0,0,0,0,1),this.texSamplerMatrix.setToUnitYFlip(),n.applyInternalTransform(e,this.texSamplerMatrix),this.texSamplerMatrix.multiplyMatrix(this.texMaskMatrix),i.loadTexSamplerMatrix(r,this.texSamplerMatrix),i.loadTexMaskMatrix(r,this.texMaskMatrix)},s}),n("render/TextSupport",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Logger","../geom/Matrix","../render/Texture","../geom/Vec2"],function(e,t,n,r,i,s,o){"use strict";var u=function(){this.canvas2D=document.createElement("canvas"),this.ctx2D=this.canvas2D.getContext("2d"),this.lineSpacing=.15,this.strokeStyle="rgba(0, 0, 0, 0.5)",this.strokeWidth=4};return u.prototype.textSize=function(e,t,n){if(e.length===0)return new o(0,0);this.ctx2D.font=t.fontString;var r=e.split("\n"),i=r.length*t.size*(1+this.lineSpacing),s=0;for(var u=0;u<r.length;u++)s=Math.max(s,this.ctx2D.measureText(r[u]).width);return n&&(s+=this.strokeWidth,i+=this.strokeWidth),new o(s,i)},u.prototype.createTexture=function(e,t,r,i){var o=e.currentGlContext,u=this.ctx2D,a=this.canvas2D,f=this.textSize(t,r,i),l=t.split("\n"),c=i?this.strokeWidth/2:0,h=e.pixelScale,p,d;a.width=Math.ceil(f[0])*h,a.height=Math.ceil(f[1])*h,u.scale(h,h),u.font=r.fontString,u.textBaseline="top",u.textAlign=r.horizontalAlignment,u.fillStyle=n.WHITE.toHexString(!1),u.strokeStyle=this.strokeStyle,u.lineWidth=this.strokeWidth,u.lineCap="round",u.lineJoin="round",r.horizontalAlignment==="left"?u.translate(c,0):r.horizontalAlignment==="right"?u.translate(f[0]-c,0):u.translate(f[0]/2,0);for(var v=0;v<l.length;v++)i&&u.strokeText(l[v],0,0),u.fillText(l[v],0,0),u.translate(0,r.size*(1+this.lineSpacing)+c);return new s(o,a)},u.prototype.getMaxLineHeight=function(e){return this.textSize("_É",e,0)[1]},u.prototype.wrap=function(t,n,i,s){if(!t)throw new e(r.logMessage(r.WARNING,"TextSupport","wrap","missing text"));var o,u=t.split("\n"),a="";for(o=0;o<u.length;o++)u[o]=this.wrapLine(u[o],n,s);var f=0,l=!1,c=this.getMaxLineHeight(s);for(o=0;o<u.length&&!l;o++){var h=u[o].split("\n");for(var p=0;p<h.length&&!l;p++)i<=0||f+c<=i?(a+=h[p],f+=c+this.lineSpacing,p<h.length-1&&(a+="\n")):l=!0;o<u.length-1&&!l&&(a+="\n")}return l&&(a.length>0&&(a=a.substring(0,a.length-1)),a+="..."),a},u.prototype.wrapLine=function(e,t,n){var r="",i=e.trim(),s=this.textSize(i,n,0);if(s[0]>t){var o="",u=0,a=i.indexOf(" ",u+1);while(u<i.length){a==-1&&(a=i.length);var f=i.substring(u,a),l=o+f;this.textSize(l,n,0)[0]<=t?o+=f:o.length!=0?(r+=o,r+="\n",o="",o+=f.trim()):o+=f.trim(),u=a,u<i.length-1&&(a=i.indexOf(" ",u+1))}r+=o}else r+=i;return r},u}),n("render/DrawContext",["../error/ArgumentError","../util/Color","../util/FrameStatistics","../render/FramebufferTexture","../render/FramebufferTileController","../geom/Frustum","../globe/Globe","../shaders/GpuProgram","../cache/GpuResourceCache","../layer/Layer","../util/Logger","../geom/Matrix","../navigate/NavigatorState","../pick/PickedObjectList","../geom/Plane","../geom/Position","../geom/Rectangle","../render/ScreenCreditController","../geom/Sector","../shapes/SurfaceShape","../shapes/SurfaceShapeTileBuilder","../render/SurfaceTileRenderer","../render/TextSupport","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N){"use strict";var C=function(n){if(!n)throw new e(l.logMessage(l.LEVEL_SEVERE,"Texture","constructor","missingGlContext"));this.currentGlContext=n,this.canvas2D=document.createElement("canvas"),this.ctx2D=this.canvas2D.getContext("2d"),this.clearColor=t.TRANSPARENT,this.gpuResourceCache=new a(WorldWind.configuration.gpuCacheSize,.8*WorldWind.configuration.gpuCacheSize),this.surfaceTileRenderer=new E,this.surfaceShapeTileBuilder=new w,this.surfaceShapeTileController=new i,this.screenCreditController=new g,this.textSupport=new S,this.currentFramebuffer=null,this.currentProgram=null,this.surfaceRenderables=[],this.orderedRenderingMode=!1,this.orderedRenderables=[],this.screeRenderables=[],this.orderedRenderablesCounter=0,this.timestamp=Date.now(),this.previousRedrawTimestamp=this.timestamp,this.redrawRequested=!1,this.globe=null,this.globeStateKey=null,this.layers=null,this.currentLayer=null,this.navigatorState=null,this.eyePosition=new v(0,0,0),this.screenProjection=c.fromIdentity(),this.terrain=null,this.verticalExaggeration=1,this.fadeTime=500,this.surfaceOpacity=1,this.frameStatistics=null,this.pickingMode=!1,this.pickTerrainOnly=!1,this.deepPicking=!1,this.regionPicking=!1,this.pickPoint=null,this.pickRectangle=null,this.pickFramebuffer=null,this.pickFrustum=null,this.pickColor=new t(0,0,0,1),this.objectsAtPickPoint=new p,this.pixelScale=1};return C.unitCubeKey="DrawContextUnitCubeKey",C.unitCubeElementsKey="DrawContextUnitCubeElementsKey",C.unitQuadKey="DrawContextUnitQuadKey",C.unitQuadKey3="DrawContextUnitQuadKey3",C.prototype.reset=function(){this.screenCreditController.clear(),this.surfaceRenderables=[],this.orderedRenderingMode=!1,this.orderedRenderables=[],this.screenRenderables=[],this.orderedRenderablesCounter=0;var e=this.timestamp;this.timestamp=Date.now(),this.timestamp===e&&++this.timestamp,this.redrawRequested=!1,this.globe=null,this.globeStateKey=null,this.layers=null,this.currentLayer=null,this.navigatorState=null,this.terrain=null,this.verticalExaggeration=1,this.frameStatistics=null,this.accumulateOrderedRenderables=!0,this.pickingMode=!1,this.pickTerrainOnly=!1,this.deepPicking=!1,this.regionPicking=!1,this.pickPoint=null,this.pickRectangle=null,this.pickFrustum=null,this.pickColor=new t(0,0,0,1),this.objectsAtPickPoint.clear()},C.prototype.update=function(){var e=this.currentGlContext,t=this.navigatorState.eyePoint;this.globeStateKey=this.globe.stateKey,this.globe.computePositionFromPoint(t[0],t[1],t[2],this.eyePosition),this.screenProjection.setToScreenProjection(e.drawingBufferWidth,e.drawingBufferHeight)},C.prototype.contextLost=function(){this.gpuResourceCache.clear(),this.pickFramebuffer=null,this.currentFramebuffer=null,this.currentProgram=null},C.prototype.contextRestored=function(){this.gpuResourceCache.clear()},C.prototype.bindFramebuffer=function(e){this.currentFramebuffer!=e&&(this.currentGlContext.bindFramebuffer(this.currentGlContext.FRAMEBUFFER,e?e.framebufferId:null),this.currentFramebuffer=e)},C.prototype.bindProgram=function(e){this.currentProgram!=e&&(this.currentGlContext.useProgram(e?e.programId:null),this.currentProgram=e)},C.prototype.findAndBindProgram=function(t){if(!t)throw new e(l.logMessage(l.LEVEL_SEVERE,"DrawContext","findAndBindProgram","The specified program constructor is null or undefined."));var n=this.gpuResourceCache.resourceForKey(t.key);if(n)this.bindProgram(n);else try{n=new t(this.currentGlContext),this.bindProgram(n),this.gpuResourceCache.putResource(t.key,n,n.size)}catch(r){l.log(l.LEVEL_SEVERE,"Error attempting to create GPU program.")}return n},C.prototype.addSurfaceRenderable=function(e){e&&this.surfaceRenderables.push(e)},C.prototype.peekSurfaceRenderable=function(){return this.surfaceRenderables.length>0?this.surfaceRenderables[this.surfaceRenderables.length-1]:null},C.prototype.popSurfaceRenderable=function(){return this.surfaceRenderables.length>0?this.surfaceRenderables.pop():null},C.prototype.reverseSurfaceRenderables=function(){this.surfaceRenderables.reverse()},C.prototype.addOrderedRenderable=function(e,t){if(e){var n={orderedRenderable:e,insertionOrder:this.orderedRenderablesCounter++,eyeDistance:t||e.eyeDistance,globeStateKey:this.globeStateKey};this.globe.continuous&&(n.globeOffset=this.globe.offset),n.eyeDistance===0?this.screenRenderables.push(n):this.orderedRenderables.push(n)}},C.prototype.addOrderedRenderableToBack=function(e){if(e){var t={orderedRenderable:e,insertionOrder:this.orderedRenderablesCounter++,eyeDistance:Number.MAX_VALUE,globeStateKey:this.globeStateKey};this.globe.continuous&&(t.globeOffset=this.globe.offset),this.orderedRenderables.push(t)}},C.prototype.peekOrderedRenderable=function(){return this.orderedRenderables.length>0?this.orderedRenderables[this.orderedRenderables.length-1].orderedRenderable:null},C.prototype.popOrderedRenderable=function(){if(this.orderedRenderables.length>0){var e=this.orderedRenderables.pop();return this.globeStateKey=e.globeStateKey,this.globe.continuous&&(this.globe.offset=e.globeOffset),e.orderedRenderable}return null},C.prototype.nextScreenRenderable=function(){if(this.screenRenderables.length>0){var e=this.screenRenderables.shift();return this.globeStateKey=e.globeStateKey,this.globe.continuous&&(this.globe.offset=e.globeOffset),e.orderedRenderable}return null},C.prototype.sortOrderedRenderables=function(){this.orderedRenderables.sort(function(e,t){var n=e.eyeDistance,r=t.eyeDistance;if(n<r)return-1;if(n>r)return 1;var i=e.insertionOrder,s=t.insertionOrder;return i>s?-1:i<s?1:0})},C.prototype.readPickColor=function(e){var n=this.navigatorState.convertPointToViewport(e,new x(0,0)),r=new Uint8Array(4);return this.currentGlContext.readPixels(n[0],n[1],1,1,this.currentGlContext.RGBA,this.currentGlContext.UNSIGNED_BYTE,r),this.clearColor.equalsBytes(r)?null:t.colorFromByteArray(r)},C.prototype.readPickColors=function(e){var n=this.currentGlContext,r=new Uint8Array(e.width*e.height*4),i={},s,o=new t(0,0,0,0),u=n.getParameter(n.PACK_ALIGNMENT);n.pixelStorei(n.PACK_ALIGNMENT,1),this.currentGlContext.readPixels(e.x,e.y,e.width,e.height,n.RGBA,n.UNSIGNED_BYTE,r),n.pixelStorei(n.PACK_ALIGNMENT,u);for(var a=0,f=e.width*e.height;a<f;a++){var l=a*4;s=t.colorFromBytes(r[l],r[l+1],r[l+2],r[l+3]);if(s.equals(this.clearColor)||s.equals(o))continue;i[s.toByteString()]=s}return i},C.prototype.resolvePick=function(e){if(e.userObject instanceof b||!this.deepPicking||!!this.regionPicking)this.addPickedObject(e);else{var t=this.readPickColor(this.pickPoint);if(!t)return null;e.color.equals(t)&&this.addPickedObject(e)}},C.prototype.addPickedObject=function(e){e&&this.objectsAtPickPoint.add(e)},C.prototype.uniquePickColor=function(){var e=this.pickColor.nextColor().clone();return e.equals(this.clearColor)?e.nextColor():e},C.prototype.makePickFramebuffer=function(){var e=this.currentGlContext,t=e.drawingBufferWidth,n=e.drawingBufferHeight;if(!this.pickFramebuffer||this.pickFramebuffer.width!=t||this.pickFramebuffer.height!=n)this.pickFramebuffer=new r(e,t,n,!0);return this.pickFramebuffer},C.prototype.makePickFrustum=function(){if(!this.pickPoint&&!this.pickRectangle)return!1;var e,t,n,r,i,o,u,a,f,l,c,h,p,v,g,y,b,w,E,S,C,k=new T(0,0,0),L=2,A=new T(0,0,0),O,M=this.pickRectangle,_=this.navigatorState.viewport;M||(O=this.navigatorState.convertPointToViewport(this.pickPoint,new x(0,0)),M=new m(O[0]-L,O[1]-L,2*L,2*L));var D=M.x,P=M.x+M.width,H=M.y,B=M.y+M.height;return P<0||B<0||D>_.x+_.width||H>_.y+_.height?!1:(M.x=N.clamp(D,_.x,_.x+_.width),M.y=N.clamp(H,_.y,_.y+_.height),M.width=N.clamp(P,_.x,_.x+_.width)-M.x,M.height=N.clamp(B,_.y,_.y+_.height)-M.y,this.pickRectangle=M,A[0]=M.x,A[1]=M.y,A[2]=0,this.navigatorState.unProject(A,e=new T(0,0,0)),A[0]=M.x,A[1]=M.y,A[2]=1,this.navigatorState.unProject(A,t=new T(0,0,0)),A[0]=M.x+M.width,A[1]=M.y,A[2]=0,this.navigatorState.unProject(A,n=new T(0,0,0)),A[0]=M.x+M.width,A[1]=M.y,A[2]=1,this.navigatorState.unProject(A,r=new T(0,0,0)),A[0]=M.x,A[1]=M.y+M.height,A[2]=0,this.navigatorState.unProject(A,i=new T(0,0,0)),A[0]=M.x,A[1]=M.y+M.height,A[2]=1,this.navigatorState.unProject(A,o=new T(0,0,0)),A[0]=M.x+M.width,A[1]=M.y+M.height,A[2]=0,this.navigatorState.unProject(A,u=new T(0,0,0)),A[0]=M.x+M.width,A[1]=M.y+M.height,A[2]=1,this.navigatorState.unProject(A,a=new T(0,0,0)),C=new T(o[0]-e[0],o[1]-e[1],o[2]-e[2]),k.set(i[0]-t[0],i[1]-t[1],i[2]-t[2]),f=C.cross(k),g=new d(f[0],f[1],f[2],-f.dot(e)),g.normalize(),C=new T(u[0]-r[0],u[1]-r[1],u[2]-r[2]),k.set(a[0]-n[0],a[1]-n[1],a[2]-n[2]),l=C.cross(k),y=new d(l[0],l[1],l[2],-l.dot(n)),y.normalize(),C=new T(o[0]-u[0],o[1]-u[1],o[2]-u[2]),k.set(a[0]-i[0],a[1]-i[1],a[2]-i[2]),c=C.cross(k),b=new d(c[0],c[1],c[2],-c.dot(i)),b.normalize(),C=new T(r[0]-e[0],r[1]-e[1],r[2]-e[2]),k.set(t[0]-n[0],t[1]-n[1],t[2]-n[2]),h=C.cross(k),w=new d(h[0],h[1],h[2],-h.dot(n)),w.normalize(),C=new T(i[0]-n[0],i[1]-n[1],i[2]-n[2]),k.set(u[0]-e[0],u[1]-e[1],u[2]-e[2]),p=C.cross(k),E=new d(p[0],p[1],p[2],-p.dot(e)),E.normalize(),C=new T(a[0]-t[0],a[1]-t[1],a[2]-t[2]),k.set(o[0]-r[0],o[1]-r[1],o[2]-r[2]),v=C.cross(k),S=new d(v[0],v[1],v[2],-v.dot(t)),S.normalize(),this.pickFrustum=new s(g,y,w,b,E,S),!0)},C.prototype.isSmall=function(e,t){if(!e)return!1;var n=this.navigatorState.eyePoint.distanceTo(e.center),r=this.navigatorState.pixelSizeAtDistance(n);return 2*e.radius<t*r},C.prototype.unitCubeBuffer=function(){var e=this.gpuResourceCache.resourceForKey(C.unitCubeKey);if(!e){var t=this.currentGlContext,n=new Float32Array(24),r=0;n[r++]=0,n[r++]=1,n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=1,n[r++]=1,n[r++]=0,n[r++]=1,n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=1,n[r++]=1,n[r++]=0,n[r++]=0,n[r++]=1,n[r++]=1,n[r++]=1,n[r++]=1,n[r++]=1,n[r++]=0,n[r]=1,e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(C.unitCubeKey,e,n.length*4)}return e},C.prototype.unitCubeElements=function(){var e=this.gpuResourceCache.resourceForKey(C.unitCubeElementsKey);if(!e){var t=this.currentGlContext,n=new Int16Array(60),r=0;n[r++]=1,n[r++]=0,n[r++]=3,n[r++]=3,n[r++]=0,n[r++]=2,n[r++]=4,n[r++]=5,n[r++]=6,n[r++]=6,n[r++]=5,n[r++]=7,n[r++]=5,n[r++]=1,n[r++]=7,n[r++]=7,n[r++]=1,n[r++]=3,n[r++]=6,n[r++]=2,n[r++]=4,n[r++]=4,n[r++]=2,n[r++]=0,n[r++]=4,n[r++]=0,n[r++]=5,n[r++]=5,n[r++]=0,n[r++]=1,n[r++]=7,n[r++]=3,n[r++]=6,n[r++]=6,n[r++]=3,n[r++]=2,n[r++]=0,n[r++]=1,n[r++]=1,n[r++]=3,n[r++]=3,n[r++]=2,n[r++]=2,n[r++]=0,n[r++]=4,n[r++]=5,n[r++]=5,n[r++]=7,n[r++]=7,n[r++]=6,n[r++]=6,n[r++]=4,n[r++]=0,n[r++]=4,n[r++]=5,n[r++]=1,n[r++]=2,n[r++]=6,n[r++]=7,n[r]=3,e=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(C.unitCubeElementsKey,e,n.length*2)}return e},C.prototype.unitQuadBuffer=function(){var e=this.gpuResourceCache.resourceForKey(C.unitQuadKey);if(!e){var t=this.currentGlContext,n=new Float32Array(8);n[0]=0,n[1]=1,n[2]=0,n[3]=0,n[4]=1,n[5]=1,n[6]=1,n[7]=0,e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(C.unitQuadKey,e,n.length*4)}return e},C.prototype.unitQuadBuffer3=function(){var e=this.gpuResourceCache.resourceForKey(C.unitQuadKey3);if(!e){var t=this.currentGlContext,n=new Float32Array(12);n[0]=0,n[1]=1,n[2]=0,n[3]=0,n[4]=0,n[5]=0,n[6]=1,n[7]=1,n[8]=0,n[9]=1,n[10]=0,n[11]=0,e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(C.unitQuadKey3,e,n.length*4)}return e},C.prototype.surfacePointForMode=function(t,n,r,i,s){if(!s)throw new e(l.logMessage(l.LEVEL_SEVERE,"DrawContext","surfacePointForMode","missingResult"));if(this.terrain)this.terrain.surfacePointForMode(t,n,r,i,s);else{var o=r+this.globe.elevationAtLocation(t,n)*this.verticalExaggeration;this.globe.computePointFromPosition(t,n,o,s)}return s},C}),n("globe/EarthElevationModel",["../geom/Location","../geom/Sector","../globe/ElevationModel","../util/WmsUrlBuilder"],function(e,t,n,r){"use strict";var i=function(){n.call(this,t.FULL_SPHERE,new e(45,45),12,"application/bil16","EarthElevations256",256,256),this.displayName="Earth Elevation Model",this.minElevation=-11e3,this.maxElevation=8850,this.pixelIsPoint=!1,this.urlBuilder=new r("http://worldwind26.arc.nasa.gov/elev","GEBCO,aster_v2,USGS-NED","","1.3.0")};return i.prototype=Object.create(n.prototype),i}),n("globe/EarthRestElevationModel",["../geom/Location","../geom/Sector","../globe/ElevationModel","../util/LevelRowColumnUrlBuilder"],function(e,t,n,r){"use strict";var i=function(i,s,o){n.call(this,t.FULL_SPHERE,new e(60,60),5,"application/bil16","EarthElevations",512,512),this.displayName=o,this.minElevation=-11e3,this.maxElevation=8850,this.urlBuilder=new r(i,s)};return i.prototype=Object.create(n.prototype),i}),n("layer/FrameStatisticsLayer",["../error/ArgumentError","../util/Color","../util/Font","../layer/Layer","../util/Logger","../util/Offset","../shapes/ScreenText","../shapes/TextAttributes"],function(e,t,n,r,i,s,o,u){"use strict";var a=function(a){function c(e,t){l.handleRedraw(e,t)}if(!a)throw new e(i.logMessage(i.LEVEL_SEVERE,"FrameStatisticsLayer","constructor","missingWorldWindow"));r.call(this,"Frame Statistics"),this.pickEnabled=!1;var f=new u(null);f.color=t.GREEN,f.font=new n(12),f.offset=new s(WorldWind.OFFSET_FRACTION,0,WorldWind.OFFSET_FRACTION,1),this.frameTime=new o(new s(WorldWind.OFFSET_PIXELS,5,WorldWind.OFFSET_INSET_PIXELS,5)," "),this.frameTime.attributes=f,this.frameRate=new o(new s(WorldWind.OFFSET_PIXELS,5,WorldWind.OFFSET_INSET_PIXELS,25)," "),this.frameRate.attributes=f;var l=this;a.redrawCallbacks.push(c)};return a.prototype=Object.create(r.prototype),a.prototype.doRender=function(e){this.frameRate.render(e),this.frameTime.render(e),this.inCurrentFrame=!0},a.prototype.handleRedraw=function(e,t){if(t!=WorldWind.BEFORE_REDRAW)return;var n=e.frameStatistics;this.frameTime.text="Frame time  "+n.frameTimeAverage.toFixed(0)+" ms  ("+n.frameTimeMin.toFixed(0)+" - "+n.frameTimeMax.toFixed(0)+")",this.frameRate.text="Frame rate  "+n.frameRateAverage.toFixed(0)+" fps"},a}),n("shapes/AbstractShape",["../error/ArgumentError","../util/Logger","../geom/Matrix","../cache/MemoryCache","../render/Renderable","../shapes/ShapeAttributes","../error/UnsupportedOperationError","../geom/Vec3"],function(e,t,n,r,i,s,o,u){"use strict";var a=function(e){i.call(this),this._attributes=e?e:new s(null),this._highlightAttributes=null,this.highlighted=!1,this._altitudeMode=WorldWind.ABSOLUTE,this.referencePosition=null,this.shapeDataCache=new r(3,2),this.currentData=null,this.activeAttributes=null,this.expirationInterval=2e3,this.useSurfaceShapeFor2D=!1,this.scratchMatrix=n.fromIdentity()};return a.prototype=Object.create(i.prototype),Object.defineProperties(a.prototype,{attributes:{get:function(){return this._attributes},set:function(e){this._attributes=e,this.surfaceShape&&(this.surfaceShape.attributes=this._attributes)}},highlightAttributes:{get:function(){return this._highlightAttributes},set:function(e){this._highlightAttributes=e,this.surfaceShape&&(this.surfaceShape.highlightAttributes=this._highlightAttributes)}},altitudeMode:{get:function(){return this._altitudeMode},set:function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"AbstractShape","altitudeMode","missingAltitudeMode"));this._altitudeMode=n,this.reset()}}}),a.prototype.reset=function(){this.shapeDataCache.clear(!1),this.surfaceShape=null},a.prototype.updateSurfaceShape=function(){this.surfaceShape.displayName=this.displayName,this.surfaceShape.highlighted=this.highlighted,this.surfaceShape.enabled=this.enabled,this.surfaceShape.pathType=this.pathType,this.surfaceShape.pickDelegate=this.pickDelegate?this.pickDelegate:this},a.prototype.createSurfaceShape=function(){return null},a.prototype.render=function(e){if(!this.enabled)return;if(!e.accumulateOrderedRenderables)return;if(e.globe.is2D()&&this.useSurfaceShapeFor2D){this.surfaceShape||(this.surfaceShape=this.createSurfaceShape(),this.surfaceShape&&(this.surfaceShape.attributes=this._attributes,this.surfaceShape.highlightAttributes=this._highlightAttributes));if(this.surfaceShape){this.updateSurfaceShape(),this.surfaceShape.render(e);return}}if(!e.terrain&&this.altitudeMode!=WorldWind.ABSOLUTE)return;this.establishCurrentData(e);if(e.globe.projectionLimits&&!this.isWithinProjectionLimits(e))return;if(this.currentData.extent&&!this.intersectsFrustum(e))return;this.determineActiveAttributes(e);if(!this.activeAttributes)return;var t=this.makeOrderedRenderable(e);if(t){if(!this.intersectsFrustum(e))return;if(e.isSmall(this.currentData.extent,1))return;t.layer=e.currentLayer,e.addOrderedRenderable(t,this.currentData.eyeDistance)}},a.prototype.renderOrdered=function(e){this.currentData=this.shapeDataCache.entryForKey(e.globeStateKey),this.beginDrawing(e);try{this.doRenderOrdered(e)}finally{this.endDrawing(e)}},a.prototype.makeOrderedRenderable=function(e){var t=this.doMakeOrderedRenderable(e);return this.currentData.verticalExaggeration=e.verticalExaggeration,t},a.prototype.doMakeOrderedRenderable=function(e){throw new o(t.logMessage(t.LEVEL_SEVERE,"AbstractShape","makeOrderedRenderable","abstractInvocation"))},a.prototype.doRenderOrdered=function(e){throw new o(t.logMessage(t.LEVEL_SEVERE,"AbstractShape","doRenderOrdered","abstractInvocation"))},a.prototype.beginDrawing=function(e){},a.prototype.endDrawing=function(e){},a.prototype.intersectsFrustum=function(e){return this.currentData&&this.currentData.extent?e.pickingMode?this.currentData.extent.intersectsFrustum(e.pickFrustum):this.currentData.extent.intersectsFrustum(e.navigatorState.frustumInModelCoordinates):!0},a.prototype.establishCurrentData=function(e){this.currentData=this.shapeDataCache.entryForKey(e.globeStateKey),this.currentData||(this.currentData=this.createShapeDataObject(),this.resetExpiration(this.currentData),this.shapeDataCache.putEntry(e.globeStateKey,this.currentData,1)),this.currentData.isExpired=!this.isShapeDataCurrent(e,this.currentData)},a.prototype.createShapeDataObject=function(){return{transformationMatrix:n.fromIdentity(),referencePoint:new u(0,0,0)}},a.prototype.resetExpiration=function(e){e.expiryTime=Date.now()+this.expirationInterval+1e3*Math.random()},a.prototype.isShapeDataCurrent=function(e,t){return t.verticalExaggeration===e.verticalExaggeration&&t.expiryTime>Date.now()},a.prototype.determineActiveAttributes=function(e){this.highlighted&&this._highlightAttributes?this.activeAttributes=this.highlightAttributes:this.activeAttributes=this._attributes},a.prototype.isWithinProjectionLimits=function(e){return!0},a.prototype.applyMvpMatrix=function(e){this.scratchMatrix.copy(e.navigatorState.modelviewProjection),this.scratchMatrix.multiplyMatrix(this.currentData.transformationMatrix),e.currentProgram.loadModelviewProjection(e.currentGlContext,this.scratchMatrix)},a.prototype.applyMvpMatrixForOutline=function(e){this.scratchMatrix.copy(e.navigatorState.projection),this.scratchMatrix.offsetProjectionDepth(-0.001),this.scratchMatrix.multiplyMatrix(e.navigatorState.modelview),this.scratchMatrix.multiplyMatrix(this.currentData.transformationMatrix),e.currentProgram.loadModelviewProjection(e.currentGlContext,this.scratchMatrix)},a}),n("shapes/AbstractMesh",["../shapes/AbstractShape","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../util/ImageSource","../geom/Line","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){"use strict";var m=function(t){e.call(this,t),this.pickTransparentImagePixels=!0,this._altitudeScale=1};return m.prototype=Object.create(e.prototype),Object.defineProperties(m.prototype,{altitudeScale:{get:function(){return this._altitudeScale},set:function(e){this._altitudeScale=e,this.reset()}}}),m.prototype.mustGenerateGeometry=function(e){return this.currentData.meshPoints?this.currentData.drawInterior!==this.activeAttributes.drawInterior?!0:this.activeAttributes.applyLighting&&!this.currentData.normals?!0:this.altitudeMode===WorldWind.ABSOLUTE?!1:this.currentData.isExpired:!0},m.prototype.doMakeOrderedRenderable=function(e){if(!this.activeAttributes.drawInterior&&!this.activeAttributes.drawOutline)return null;if(!this.mustGenerateGeometry(e))return this;var t=this.currentData,n=t.referencePoint;return e.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude*this._altitudeScale,this._altitudeMode,n),t.transformationMatrix.setToTranslation(n[0],n[1],n[2]),t.meshPoints=this.computeMeshPoints(e,t),t.refreshVertexBuffer=!0,this.activeAttributes.imageSource&&!this.texCoords&&(this.texCoords=this.computeTexCoords(),this.texCoords&&(t.refreshTexCoordBuffer=!0)),this.meshIndices||(this.meshIndices=this.computeMeshIndices(),t.refreshMeshIndices=!0),this.meshOutlineIndices||(this.meshOutlineIndices=this.computeOutlineIndices(),this.meshOutlineIndices&&(t.refreshOutlineIndices=!0)),this.activeAttributes.applyLighting&&this.computeNormals(t),t.drawInterior=this.activeAttributes.drawInterior,this.resetExpiration(t),t.extent||(t.extent=new r),t.extent.setToPoints(t.meshPoints),t.extent.translate(t.referencePoint),this},m.prototype.computeMeshPoints=function(e,t){throw new UnsupportedOperationError(a.logMessage(a.LEVEL_SEVERE,"AbstractMesh","computeMeshPoints","abstractInvocation"))},m.prototype.computeTexCoords=function(){return null},m.prototype.computeMeshIndices=function(e){throw new UnsupportedOperationError(a.logMessage(a.LEVEL_SEVERE,"AbstractMesh","computeMeshIndices","abstractInvocation"))},m.prototype.computeOutlineIndices=function(e){},m.prototype.computeNormals=function(e){var t=new Float32Array(e.meshPoints.length),n=this.meshIndices,r=e.meshPoints,i=[],s=[new d(0,0,0),new d(0,0,0),new d(0,0,0)],o;for(var u=0;u<n.length;u+=3){for(var a=0;a<3;a++)o=n[u+a],s[a].set(r[3*o],r[3*o+1],r[3*o+2]);var f=d.computeTriangleNormal(s[0],s[1],s[2]);for(a=0;a<3;a++)o=n[u+a],i[o]||(i[o]=[]),i[o].push(f)}f=new d(0,0,0);for(u=0;u<i.length;u++)i[u]?(d.average(i[u],f),f.normalize(),t[u*3]=f[0],t[u*3+1]=f[1],t[u*3+2]=f[2]):(t[u*3]=0,t[u*3+1]=0,t[u*3+2]=0);e.normals=t,e.refreshNormalsBuffer=!0},m.prototype.doRenderOrdered=function(e){var t=e.currentGlContext,n=e.currentProgram,r=this.currentData,i=this.texCoords&&!!this.activeAttributes.imageSource,s,o,u,a,f;e.pickingMode&&(a=e.uniquePickColor()),r.pointsVboCacheKey||(r.pointsVboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.pointsVboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(r.pointsVboCacheKey,s,r.meshPoints.length*4),r.refreshVertexBuffer=!0),t.bindBuffer(t.ARRAY_BUFFER,s),r.refreshVertexBuffer&&(t.bufferData(t.ARRAY_BUFFER,r.meshPoints,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),r.refreshVertexBuffer=!1),t.vertexAttribPointer(n.vertexPointLocation,3,t.FLOAT,!1,0,0),n.loadTextureEnabled(t,!1);if(this.activeAttributes.drawInterior){var c=!e.pickingMode&&r.normals&&this.activeAttributes.applyLighting;this.applyMvpMatrix(e),r.meshIndicesVboCacheKey||(r.meshIndicesVboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.meshIndicesVboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(r.meshIndicesVboCacheKey,s,this.meshIndices.length*2),r.refreshMeshIndices=!0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),r.refreshMeshIndices&&(t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.meshIndices,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),r.refreshMeshIndices=!1),u=this.activeAttributes.interiorColor,o=u.alpha*e.currentLayer.opacity,t.depthMask(o>=1||e.pickingMode),n.loadColor(t,e.pickingMode?a:u),n.loadOpacity(t,e.pickingMode?o>0?1:0:o),i&&(!e.pickingMode||!this.pickTransparentImagePixels)&&(this.activeTexture=e.gpuResourceCache.resourceForKey(this.activeAttributes.imageSource),this.activeTexture||(this.activeTexture=e.gpuResourceCache.retrieveTexture(e.currentGlContext,this.activeAttributes.imageSource)),f=this.activeTexture&&this.activeTexture.bind(e),f&&(r.texCoordsVboCacheKey||(r.texCoordsVboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.texCoordsVboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(r.texCoordsVboCacheKey,s,this.texCoords.length*4),r.refreshTexCoordBuffer=!0),t.bindBuffer(t.ARRAY_BUFFER,s),r.refreshTexCoordBuffer&&(t.bufferData(t.ARRAY_BUFFER,this.texCoords,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),r.refreshTexCoordBuffer=!1),n.loadTextureEnabled(t,!0),t.enableVertexAttribArray(n.vertexTexCoordLocation),t.vertexAttribPointer(n.vertexTexCoordLocation,2,t.FLOAT,!1,0,0),n.loadTextureUnit(t,t.TEXTURE0),n.loadModulateColor(t,e.pickingMode))),c&&(n.loadApplyLighting(t,!0),r.normalsVboCacheKey||(r.normalsVboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.normalsVboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(r.normalsVboCacheKey,s,r.normals.length*4),r.refreshNormalsBuffer=!0),t.bindBuffer(t.ARRAY_BUFFER,s),r.refreshNormalsBuffer&&(t.bufferData(t.ARRAY_BUFFER,r.normals,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),r.refreshNormalsBuffer=!1),t.enableVertexAttribArray(n.normalVectorLocation),t.vertexAttribPointer(n.normalVectorLocation,3,t.FLOAT,!1,0,0)),t.drawElements(t.TRIANGLES,this.meshIndices.length,t.UNSIGNED_SHORT,0),i&&t.disableVertexAttribArray(n.vertexTexCoordLocation),c&&(n.loadApplyLighting(t,!1),t.disableVertexAttribArray(n.normalVectorLocation))}this.activeAttributes.drawOutline&&this.meshOutlineIndices&&(n.loadTextureEnabled(t,!1),t.disableVertexAttribArray(n.vertexTexCoordLocation),this.applyMvpMatrixForOutline(e),u=this.activeAttributes.outlineColor,o=u.alpha*e.currentLayer.opacity,t.depthMask(o>=1||e.pickingMode),n.loadColor(t,e.pickingMode?a:u),n.loadOpacity(t,e.pickingMode?1:o),t.lineWidth(this.activeAttributes.outlineWidth),r.outlineIndicesVboCacheKey||(r.outlineIndicesVboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.outlineIndicesVboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(r.outlineIndicesVboCacheKey,s,this.meshOutlineIndices.length*2),r.refreshOutlineIndices=!0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),r.refreshOutlineIndices&&(t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.meshOutlineIndices,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),r.refreshOutlineIndices=!1),t.drawElements(t.LINE_STRIP,this.meshOutlineIndices.length,t.UNSIGNED_SHORT,0));if(e.pickingMode){var h=this.computePickPosition(e),p=new l(a,this.pickDelegate?this.pickDelegate:this,h,e.currentLayer,!1);e.resolvePick(p)}},m.prototype.computePickPosition=function(e){var t=this.currentData,n=e.navigatorState.rayFromScreenPoint(e.pickPoint),r=(new d(n.origin[0],n.origin[1],n.origin[2])).subtract(t.referencePoint),i=new o(r,n.direction),s=[];if(v.computeIndexedTrianglesIntersection(i,t.meshPoints,this.meshIndices,s)){var u=s[0];if(s.length>1){var a=u.distanceToSquared(e.navigatorState.eyePoint);for(var f=1;f<s.length;f++){var l=s[f].distanceToSquared(e.navigatorState.eyePoint);l<a&&(a=l,u=s[f])}}var h=new c(0,0,0);return e.globe.computePositionFromPoint(u[0]+t.referencePoint[0],u[1]+t.referencePoint[1],u[2]+t.referencePoint[2],h),h.altitude/=this._altitudeScale,h}return null},m.prototype.beginDrawing=function(e){var t=e.currentGlContext;if(this.activeAttributes.drawInterior){t.disable(t.CULL_FACE),e.findAndBindProgram(n);var r=!e.pickMode&&this.currentData.normals&&this.activeAttributes.applyLighting;r&&e.currentProgram.loadModelviewInverse(t,e.navigatorState.modelviewNormalTransform)}t.enableVertexAttribArray(e.currentProgram.vertexPointLocation)},m.prototype.endDrawing=function(e){var t=e.currentGlContext;t.disableVertexAttribArray(e.currentProgram.vertexPointLocation),t.depthMask(!0),t.lineWidth(1),t.enable(t.CULL_FACE)},m}),n("shapes/SurfacePolygon",["../error/ArgumentError","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape"],function(e,t,n,r){"use strict";var i=function(n,i){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfacePolygon","constructor","The specified boundary array is null or undefined."));r.call(this,i);var s=null;if(n.length>0&&n[0].latitude)s=n.slice(0),s.push(n[0]),this._boundariesSpecifiedSimply=!0;else if(n.length>1){var o=null;s=[];for(var u=0;u<n.length;u++){var a=n[u][0];for(var f=0;f<n[u].length;f++)s.push(n[u][f]);s.push(a),o?s.push(o):o=s[s.length-1]}}else n.length===1&&(s=n[0].slice(0),s.push(n[0][0]));this._boundaries=s};return i.prototype=Object.create(r.prototype),Object.defineProperties(i.prototype,{}),i.staticStateKey=function(e){var t=r.staticStateKey(e);return t},i.prototype.computeStateKey=function(){return i.staticStateKey(this)},i}),n("shapes/GeographicMesh",["../shapes/AbstractMesh","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../util/ImageSource","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../shapes/SurfacePolygon","../geom/Vec2","../geom/Vec3"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){"use strict";var v=function(n,r){if(!n)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","constructor","missingPositions"));if(n.length<2||n[0].length<2)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","constructor","Number of positions is insufficient."));if(n.length*n[0].length>65536)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","constructor","Too many positions. Must be fewer than 65536. Try using multiple meshes."));var i=n[0].length;for(var s=1;s<n.length;s++)if(n[s].length!==i)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","constructor","Array lengths are inconsistent."));var o=n.length,a=n[0].length;e.call(this,r),this.pickTransparentImagePixels=!0,this._positions=n,this._altitudeScale=1,this.numRows=o,this.numColumns=a,this._textureCoordinates=null,this.referencePosition=this.determineReferencePosition(this._positions)};return v.prototype=Object.create(e.prototype),Object.defineProperties(v.prototype,{positions:{get:function(){return this._positions},set:function(e){if(!e)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","positions","missingPositions"));if(e.length<2||e[0].length<2)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","positions","Number of positions is insufficient."));var n=e[0].length;for(var r=1;r<e.length;r++)if(e[r].length!==n)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","positions","Array lengths are inconsistent."));this.numRows=e.length,this.numColumns=e[0].length,this._positions=e,this.referencePosition=this.determineReferencePosition(this._positions),this.reset(),this.meshIndices=null,this.outlineIndices=null}},textureCoordinates:{get:function(){return this._textureCoordinates},set:function(e){if(e&&e.length!=this.numRows)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","textureCoordinates","Number of texture coordinate rows is inconsistent with the currently specified positions."));for(var n=0;n<this.numRows;n++)if(e[n].length!==this.numColumns)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","textureCoordinates","Texture coordinate row lengths are inconsistent with the currently specified positions."));this._textureCoordinates=e,this.reset(),this.texCoords=null}}}),v.makeGridIndices=function(e,t){var n=[],r=0;for(var i=0;i<e-1;i++)for(var s=0;s<t-1;s++){var o=i*t+s;n[r++]=o,n[r++]=o+1,n[r++]=o+t,n[r++]=o+1,n[r++]=o+1+t,n[r++]=o+t}return n},v.prototype.determineReferencePosition=function(e){return e[0][0]},v.prototype.createSurfaceShape=function(){var e=[];for(var t=0;t<this.numColumns;t++)e.push(this._positions[0][t]);for(var n=1;n<this.numRows;n++)e.push(this._positions[n][this.numColumns-1]);for(t=this.numColumns-2;t>=0;t--)e.push(this._positions[this.numRows-1][t]);for(n=this.numRows-2;n>0;n--)e.push(this._positions[n][0]);return new h(e,null)},v.prototype.computeMeshPoints=function(e,t){var n=Number.MAX_VALUE,r=e.navigatorState.eyePoint,i=new Float32Array(this.numRows*this.numColumns*3),s=new d(0,0,0),o=0,u,a;for(var f=0;f<this._positions.length;f++)for(var l=0,c=this._positions[f].length;l<c;l++)u=this._positions[f][l],e.surfacePointForMode(u.latitude,u.longitude,u.altitude*this._altitudeScale,this.altitudeMode,s),a=s.distanceToSquared(r),a<n&&(n=a),s.subtract(this.currentData.referencePoint),i[o++]=s[0],i[o++]=s[1],i[o++]=s[2];return t.eyeDistance=Math.sqrt(n),i},v.prototype.computeTexCoords=function(){return this._textureCoordinates?this.computeExplicitTexCoords():this.computeImplicitTexCoords()},v.prototype.computeExplicitTexCoords=function(){var e=new Float32Array(2*this.numRows*this.numColumns),t=0;for(var n=0;n<this._textureCoordinates.length;n++)for(var r=0,i=this._textureCoordinates[n].length;r<i;r++){var s=this._textureCoordinates[n][r];e[t++]=s[0],e[t++]=s[1]}return e},v.prototype.computeImplicitTexCoords=function(){var e=new Float32Array(2*this.numRows*this.numColumns),t=1/(this.numRows-1),n=1/(this.numColumns-1),r=0;for(var i=0;i<this._positions.length;i++){var s=i===this.numRows-1?1:i*t;for(var o=0,u=this._positions[i].length;o<u;o++)e[r++]=o===this.numColumns-1?1:o*n,e[r++]=s}return e},v.prototype.computeMeshIndices=function(){var e=new Uint16Array((this.numRows-1)*(this.numColumns-1)*6),t=0;for(var n=0;n<this.numRows-1;n++)for(var r=0;r<this.numColumns-1;r++){var i=n*this.numColumns+r;e[t++]=i,e[t++]=i+1,e[t++]=i+this.numColumns,e[t++]=i+1,e[t++]=i+1+this.numColumns,e[t++]=i+this.numColumns}return e},v.prototype.computeOutlineIndices=function(){var e=new Uint16Array(2*this.numRows+2*this.numColumns),t=0;for(var n=0;n<this.numColumns;n++)e[t++]=n;for(var r=1;r<this.numRows;r++)e[t++]=(r+1)*this.numColumns-1;for(n=this.numRows*this.numColumns-2;n>=(this.numRows-1)*this.numColumns;n--)e[t++]=n;for(r=this.numRows-2;r>=0;r--)e[t++]=r*this.numColumns;return e},v}),n("shapes/GeographicText",["../error/ArgumentError","../util/Logger","../shapes/Text","../geom/Vec3"],function(e,t,n,r){"use strict";var i=function(r,i){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Text","constructor","missingPosition"));n.call(this,i),this.position=r,this.declutterGroup=1};return i.placePoint=new r(0,0,0),i.prototype=Object.create(n.prototype),i.prototype.clone=function(){var e=new i(this.position,this.text);return e.copy(this),e.pickDelegate=this.pickDelegate?this.pickDelegate:this,e},i.prototype.render=function(e){if(e.globe.projectionLimits&&!e.globe.projectionLimits.containsLocation(this.position.latitude,this.position.longitude))return;n.prototype.render.call(this,e)},i.prototype.computeScreenPointAndEyeDistance=function(e){return e.surfacePointForMode(this.position.latitude,this.position.longitude,this.position.altitude,this.altitudeMode,i.placePoint),e.navigatorState.frustumInModelCoordinates.containsPoint(i.placePoint)?(this.eyeDistance=this.alwaysOnTop?0:e.navigatorState.eyePoint.distanceTo(i.placePoint),e.navigatorState.projectWithDepth(i.placePoint,this.depthOffset,this.screenPoint)?!0:!1):!1},i}),n("formats/geojson/GeoJSONConstants",[],function(){"use strict";var e=function(){};return e.FIELD_TYPE="type",e.FIELD_CRS="crs",e.FIELD_NAME="name",e.FIELD_BBOX="bbox",e.FIELD_COORDINATES="coordinates",e.FIELD_GEOMETRIES="geometries",e.FIELD_GEOMETRY="geometry",e.FIELD_PROPERTIES="properties",e.FIELD_FEATURES="features",e.FIELD_ID="id",e.TYPE_POINT="Point",e.TYPE_MULTI_POINT="MultiPoint",e.TYPE_LINE_STRING="LineString",e.TYPE_MULTI_LINE_STRING="MultiLineString",e.TYPE_POLYGON="Polygon",e.TYPE_MULTI_POLYGON="MultiPolygon",e.TYPE_GEOMETRY_COLLECTION="GeometryCollection",e.TYPE_FEATURE="Feature",e.TYPE_FEATURE_COLLECTION="FeatureCollection",e.FIELD_CRS_NAME="name",e.FIELD_CRS_LINK="link",e.WGS84_CRS="urn:ogc:def:crs:OGC:1.3:CRS84",e.EPSG4326_CRS="EPSG:4326",e}),!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof n&&n.amd)n("util/proj4-src",e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.proj4=e()}}(function(){var e,n,r;return function i(e,n,r){function s(u,a){if(!n[u]){if(!e[u]){var f=typeof t=="function"&&t;if(!a&&f)return f(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}var l=n[u]={exports:{}};e[u][0].call(l.exports,function(t){var n=e[u][1][t];return s(n?n:t)},l,l.exports,i,e,n,r)}return n[u].exports}var o=typeof t=="function"&&t;for(var u=0;u<r.length;u++)s(r[u]);return s}({1:[function(e,t,n){function i(e,t,n){if(!(this instanceof i))return new i(e,t,n);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if(typeof e=="object")this.x=e.x,this.y=e.y,this.z=e.z||0;else if(typeof e=="string"&&typeof t=="undefined"){var r=e.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=e,this.y=t,this.z=n||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var r=e("mgrs");i.fromMGRS=function(e){return new i(r.toPoint(e))},i.prototype.toMGRS=function(e){return r.forward([this.x,this.y],e)},t.exports=i},{mgrs:66}],2:[function(e,t,n){function u(e,t){if(!(this instanceof u))return new u(e);t=t||function(e){if(e)throw e};var n=r(e);if(typeof n!="object"){t(e);return}var s=o(n),a=u.projections.get(s.projName);a?(i(this,s),i(this,a),this.init(),t(null,this)):t(e)}var r=e("./parseCode"),i=e("./extend"),s=e("./projections"),o=e("./deriveConstants");u.projections=s,u.projections.start(),t.exports=u},{"./deriveConstants":32,"./extend":33,"./parseCode":36,"./projections":38}],3:[function(e,t,n){t.exports=function(e,t,n){var r=n.x,i=n.y,s=n.z||0,o,u,a;for(a=0;a<3;a++){if(t&&a===2&&n.z===undefined)continue;a===0?(o=r,u="x"):a===1?(o=i,u="y"):(o=s,u="z");switch(e.axis[a]){case"e":n[u]=o;break;case"w":n[u]=-o;break;case"n":n[u]=o;break;case"s":n[u]=-o;break;case"u":n[u]!==undefined&&(n.z=o);break;case"d":n[u]!==undefined&&(n.z=-o);break;default:return null}}return n}},{}],4:[function(e,t,n){var r=Math.PI/2,i=e("./sign");t.exports=function(e){return Math.abs(e)<r?e:e-i(e)*Math.PI}},{"./sign":21}],5:[function(e,t,n){var r=Math.PI*2,i=3.14159265359,s=e("./sign");t.exports=function(e){return Math.abs(e)<=i?e:e-s(e)*r}},{"./sign":21}],6:[function(e,t,n){t.exports=function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}},{}],7:[function(e,t,n){t.exports=function(e){return 1-.25*e*(1+e/16*(3+1.25*e))}},{}],8:[function(e,t,n){t.exports=function(e){return.375*e*(1+.25*e*(1+.46875*e))}},{}],9:[function(e,t,n){t.exports=function(e){return.05859375*e*e*(1+.75*e)}},{}],10:[function(e,t,n){t.exports=function(e){return e*e*e*(35/3072)}},{}],11:[function(e,t,n){t.exports=function(e,t,n){var r=t*n;return e/Math.sqrt(1-r*r)}},{}],12:[function(e,t,n){t.exports=function(e,t,n,r,i){var s,o;s=e/t;for(var u=0;u<15;u++){o=(e-(t*s-n*Math.sin(2*s)+r*Math.sin(4*s)-i*Math.sin(6*s)))/(t-2*n*Math.cos(2*s)+4*r*Math.cos(4*s)-6*i*Math.cos(6*s)),s+=o;if(Math.abs(o)<=1e-10)return s}return NaN}},{}],13:[function(e,t,n){var r=Math.PI/2;t.exports=function(e,t){var n=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-n)<1e-6)return t<0?-1*r:r;var i=Math.asin(.5*t),s,o,u,a;for(var f=0;f<30;f++){o=Math.sin(i),u=Math.cos(i),a=e*o,s=Math.pow(1-a*a,2)/(2*u)*(t/(1-e*e)-o/(1-a*a)+.5/e*Math.log((1-a)/(1+a))),i+=s;if(Math.abs(s)<=1e-10)return i}return NaN}},{}],14:[function(e,t,n){t.exports=function(e,t,n,r,i){return e*i-t*Math.sin(2*i)+n*Math.sin(4*i)-r*Math.sin(6*i)}},{}],15:[function(e,t,n){t.exports=function(e,t,n){var r=e*t;return n/Math.sqrt(1-r*r)}},{}],16:[function(e,t,n){var r=Math.PI/2;t.exports=function(e,t){var n=.5*e,i,s,o=r-2*Math.atan(t);for(var u=0;u<=15;u++){i=e*Math.sin(o),s=r-2*Math.atan(t*Math.pow((1-i)/(1+i),n))-o,o+=s;if(Math.abs(s)<=1e-10)return o}return-9999}},{}],17:[function(e,t,n){var r=1,i=.25,s=.046875,o=.01953125,u=.01068115234375,a=.75,f=.46875,l=.013020833333333334,c=.007120768229166667,h=.3645833333333333,p=.005696614583333333,d=.3076171875;t.exports=function(e){var t=[];t[0]=r-e*(i+e*(s+e*(o+e*u))),t[1]=e*(a-e*(s+e*(o+e*u)));var n=e*e;return t[2]=n*(f-e*(l+e*c)),n*=e,t[3]=n*(h-e*p),t[4]=n*e*d,t}},{}],18:[function(e,t,n){var r=e("./pj_mlfn"),i=1e-10,s=20;t.exports=function(e,t,n){var o=1/(1-t),u=e;for(var a=s;a;--a){var f=Math.sin(u),l=1-t*f*f;l=(r(u,f,Math.cos(u),n)-e)*l*Math.sqrt(l)*o,u-=l;if(Math.abs(l)<i)return u}return u}},{"./pj_mlfn":19}],19:[function(e,t,n){t.exports=function(e,t,n,r){return n*=t,t*=t,r[0]*e-n*(r[1]+t*(r[2]+t*(r[3]+t*r[4])))}},{}],20:[function(e,t,n){t.exports=function(e,t){var n;return e>1e-7?(n=e*t,(1-e*e)*(t/(1-n*n)-.5/e*Math.log((1-n)/(1+n)))):2*t}},{}],21:[function(e,t,n){t.exports=function(e){return e<0?-1:1}},{}],22:[function(e,t,n){t.exports=function(e,t){return Math.pow((1-e)/(1+e),t)}},{}],23:[function(e,t,n){t.exports=function(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}},{}],24:[function(e,t,n){var r=Math.PI/2;t.exports=function(e,t,n){var i=e*n,s=.5*e;return i=Math.pow((1-i)/(1+i),s),Math.tan(.5*(r-t))/i}},{}],25:[function(e,t,n){n.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},n.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},n.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},n.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},n.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},n.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},n.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},n.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},n.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},n.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},n.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},n.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},n.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},n.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},n.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},n.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},{}],26:[function(e,t,n){n.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},n.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},n.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},n.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},n.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},n.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},n.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},n.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},n.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},n.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},n.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},n.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},n.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},n.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},n.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},n.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},n.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},n.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},n.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},n.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},n.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},n.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},n.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},n.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},n.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},n.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},n.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},n.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},n.hough={a:6378270,rf:297,ellipseName:"Hough"},n.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},n.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},n.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},n.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},n.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},n.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},n.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},n.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},n.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},n.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},n.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},n.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"},n.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"},n.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},{}],27:[function(e,t,n){n.greenwich=0,n.lisbon=-9.131906111111,n.paris=2.337229166667,n.bogota=-74.080916666667,n.madrid=-3.687938888889,n.rome=12.452333333333,n.bern=7.439583333333,n.jakarta=106.807719444444,n.ferro=-17.666666666667,n.brussels=4.367975,n.stockholm=18.058277777778,n.athens=23.7163375,n.oslo=10.722916666667},{}],28:[function(e,t,n){function o(e,t,n){var r;return Array.isArray(n)?(r=i(e,t,n),n.length===3?[r.x,r.y,r.z]:[r.x,r.y]):i(e,t,n)}function u(e){return e instanceof r?e:e.oProj?e.oProj:r(e)}function a(e,t,n){e=u(e);var r=!1,i;if(typeof t=="undefined")t=e,e=s,r=!0;else if(typeof t.x!="undefined"||Array.isArray(t))n=t,t=e,e=s,r=!0;return t=u(t),n?o(e,t,n):(i={forward:function(n){return o(e,t,n)},inverse:function(n){return o(t,e,n)}},r&&(i.oProj=t),i)}var r=e("./Proj"),i=e("./transform"),s=r("WGS84");t.exports=a},{"./Proj":2,"./transform":64}],29:[function(e,t,n){var r=Math.PI/2,i=1,s=2,o=3,u=4,a=5,f=484813681109536e-20,l=1.0026,c=.3826834323650898,h=function(e){if(!(this instanceof h))return new h(e);this.datum_type=u;if(!e)return;e.datumCode&&e.datumCode==="none"&&(this.datum_type=a);if(e.datum_params){for(var t=0;t<e.datum_params.length;t++)e.datum_params[t]=parseFloat(e.datum_params[t]);if(e.datum_params[0]!==0||e.datum_params[1]!==0||e.datum_params[2]!==0)this.datum_type=i;e.datum_params.length>3&&(e.datum_params[3]!==0||e.datum_params[4]!==0||e.datum_params[5]!==0||e.datum_params[6]!==0)&&(this.datum_type=s,e.datum_params[3]*=f,e.datum_params[4]*=f,e.datum_params[5]*=f,e.datum_params[6]=e.datum_params[6]/1e6+1)}this.datum_type=e.grids?o:this.datum_type,this.a=e.a,this.b=e.b,this.es=e.es,this.ep2=e.ep2,this.datum_params=e.datum_params,this.datum_type===o&&(this.grids=e.grids)};h.prototype={compare_datums:function(e){return this.datum_type!==e.datum_type?!1:this.a!==e.a||Math.abs(this.es-e.es)>5e-11?!1:this.datum_type===i?this.datum_params[0]===e.datum_params[0]&&this.datum_params[1]===e.datum_params[1]&&this.datum_params[2]===e.datum_params[2]:this.datum_type===s?this.datum_params[0]===e.datum_params[0]&&this.datum_params[1]===e.datum_params[1]&&this.datum_params[2]===e.datum_params[2]&&this.datum_params[3]===e.datum_params[3]&&this.datum_params[4]===e.datum_params[4]&&this.datum_params[5]===e.datum_params[5]&&this.datum_params[6]===e.datum_params[6]:this.datum_type===o||e.datum_type===o?this.nadgrids===e.nadgrids:!0},geodetic_to_geocentric:function(e){var t=e.x,n=e.y,i=e.z?e.z:0,s,o,u,a=0,f,l,c,h;if(n<-r&&n>-1.001*r)n=-r;else if(n>r&&n<1.001*r)n=r;else if(n<-r||n>r)return null;return t>Math.PI&&(t-=2*Math.PI),l=Math.sin(n),h=Math.cos(n),c=l*l,f=this.a/Math.sqrt(1-this.es*c),s=(f+i)*h*Math.cos(t),o=(f+i)*h*Math.sin(t),u=(f*(1-this.es)+i)*l,e.x=s,e.y=o,e.z=u,a},geocentric_to_geodetic:function(e){var t=1e-12,n=t*t,i=30,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=e.x,w=e.y,E=e.z?e.z:0,S,x,T;g=!1,s=Math.sqrt(b*b+w*w),o=Math.sqrt(b*b+w*w+E*E);if(s/this.a<t){g=!0,S=0;if(o/this.a<t){x=r,T=-this.b;return}}else S=Math.atan2(w,b);u=E/o,a=s/o,f=1/Math.sqrt(1-this.es*(2-this.es)*a*a),h=a*(1-this.es)*f,p=u*f,y=0;do y++,c=this.a/Math.sqrt(1-this.es*p*p),T=s*h+E*p-c*(1-this.es*p*p),l=this.es*c/(c+T),f=1/Math.sqrt(1-l*(2-l)*a*a),d=a*(1-l)*f,v=u*f,m=v*h-d*p,h=d,p=v;while(m*m>n&&y<i);return x=Math.atan(v/Math.abs(d)),e.x=S,e.y=x,e.z=T,e},geocentric_to_geodetic_noniter:function(e){var t=e.x,n=e.y,i=e.z?e.z:0,s,o,u,a,f,h,p,d,v,m,g,y,b,w,E,S,x;t=parseFloat(t),n=parseFloat(n),i=parseFloat(i),x=!1;if(t!==0)s=Math.atan2(n,t);else if(n>0)s=r;else if(n<0)s=-r;else{x=!0,s=0;if(i>0)o=r;else{if(!(i<0)){o=r,u=-this.b;return}o=-r}}return f=t*t+n*n,a=Math.sqrt(f),h=i*l,d=Math.sqrt(h*h+f),m=h/d,y=a/d,g=m*m*m,p=i+this.b*this.ep2*g,S=a-this.a*this.es*y*y*y,v=Math.sqrt(p*p+S*S),b=p/v,w=S/v,E=this.a/Math.sqrt(1-this.es*b*b),w>=c?u=a/w-E:w<=-c?u=a/-w-E:u=i/b+E*(this.es-1),x===!1&&(o=Math.atan(b/w)),e.x=s,e.y=o,e.z=u,e},geocentric_to_wgs84:function(e){if(this.datum_type===i)e.x+=this.datum_params[0],e.y+=this.datum_params[1],e.z+=this.datum_params[2];else if(this.datum_type===s){var t=this.datum_params[0],n=this.datum_params[1],r=this.datum_params[2],o=this.datum_params[3],u=this.datum_params[4],a=this.datum_params[5],f=this.datum_params[6],l=f*(e.x-a*e.y+u*e.z)+t,c=f*(a*e.x+e.y-o*e.z)+n,h=f*(-u*e.x+o*e.y+e.z)+r;e.x=l,e.y=c,e.z=h}},geocentric_from_wgs84:function(e){if(this.datum_type===i)e.x-=this.datum_params[0],e.y-=this.datum_params[1],e.z-=this.datum_params[2];else if(this.datum_type===s){var t=this.datum_params[0],n=this.datum_params[1],r=this.datum_params[2],o=this.datum_params[3],u=this.datum_params[4],a=this.datum_params[5],f=this.datum_params[6],l=(e.x-t)/f,c=(e.y-n)/f,h=(e.z-r)/f;e.x=l+a*c-u*h,e.y=-a*l+c+o*h,e.z=u*l-o*c+h}}},t.exports=h},{}],30:[function(e,t,n){var r=1,i=2,s=3,o=5,u=6378137,a=.006694379990141316;t.exports=function(e,t,n){function h(e){return e===r||e===i}var f,l,c;if(e.compare_datums(t))return n;if(e.datum_type===o||t.datum_type===o)return n;var p=e.a,d=e.es,v=t.a,m=t.es,g=e.datum_type;if(g===s)if(this.apply_gridshift(e,0,n)===0)e.a=u,e.es=a;else{if(!e.datum_params)return e.a=p,e.es=e.es,n;f=1;for(l=0,c=e.datum_params.length;l<c;l++)f*=e.datum_params[l];if(f===0)return e.a=p,e.es=e.es,n;e.datum_params.length>3?g=i:g=r}t.datum_type===s&&(t.a=u,t.es=a);if(e.es!==t.es||e.a!==t.a||h(g)||h(t.datum_type))e.geodetic_to_geocentric(n),h(e.datum_type)&&e.geocentric_to_wgs84(n),h(t.datum_type)&&t.geocentric_from_wgs84(n),t.geocentric_to_geodetic(n);return t.datum_type===s&&this.apply_gridshift(t,1,n),e.a=p,e.es=d,t.a=v,t.es=m,n}},{}],31:[function(e,t,n){function o(e){var t=this;if(arguments.length===2){var n=arguments[1];typeof n=="string"?n.charAt(0)==="+"?o[e]=i(arguments[1]):o[e]=s(arguments[1]):o[e]=n}else if(arguments.length===1){if(Array.isArray(e))return e.map(function(e){Array.isArray(e)?o.apply(t,e):o(e)});if(typeof e=="string"){if(e in o)return o[e]}else"EPSG"in e?o["EPSG:"+e.EPSG]=e:"ESRI"in e?o["ESRI:"+e.ESRI]=e:"IAU2000"in e?o["IAU2000:"+e.IAU2000]=e:console.log(e);return}}var r=e("./global"),i=e("./projString"),s=e("./wkt");r(o),t.exports=o},{"./global":34,"./projString":37,"./wkt":65}],32:[function(e,t,n){var r=e("./constants/Datum"),i=e("./constants/Ellipsoid"),s=e("./extend"),o=e("./datum"),u=1e-10,a=.16666666666666666,f=.04722222222222222,l=.022156084656084655;t.exports=function(e){if(e.datumCode&&e.datumCode!=="none"){var t=r[e.datumCode];t&&(e.datum_params=t.towgs84?t.towgs84.split(","):null,e.ellps=t.ellipse,e.datumName=t.datumName?t.datumName:e.datumCode)}if(!e.a){var n=i[e.ellps]?i[e.ellps]:i.WGS84;s(e,n)}e.rf&&!e.b&&(e.b=(1-1/e.rf)*e.a);if(e.rf===0||Math.abs(e.a-e.b)<u)e.sphere=!0,e.b=e.a;return e.a2=e.a*e.a,e.b2=e.b*e.b,e.es=(e.a2-e.b2)/e.a2,e.e=Math.sqrt(e.es),e.R_A&&(e.a*=1-e.es*(a+e.es*(f+e.es*l)),e.a2=e.a*e.a,e.b2=e.b*e.b,e.es=0),e.ep2=(e.a2-e.b2)/e.b2,e.k0||(e.k0=1),e.axis||(e.axis="enu"),e.datum||(e.datum=o(e)),e}},{"./constants/Datum":25,"./constants/Ellipsoid":26,"./datum":29,"./extend":33}],33:[function(e,t,n){t.exports=function(e,t){e=e||{};var n,r;if(!t)return e;for(r in t)n=t[r],n!==undefined&&(e[r]=n);return e}},{}],34:[function(e,t,n){t.exports=function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}},{}],35:[function(e,t,n){var r=e("./core");r.defaultDatum="WGS84",r.Proj=e("./Proj"),r.WGS84=new r.Proj("WGS84"),r.Point=e("./Point"),r.toPoint=e("./common/toPoint"),r.defs=e("./defs"),r.transform=e("./transform"),r.mgrs=e("mgrs"),r.version=e("../package.json").version,e("./includedProjections")(r),t.exports=r},{"../package.json":67,"./Point":1,"./Proj":2,"./common/toPoint":23,"./core":28,"./defs":31,"./includedProjections":"gWUPNW","./transform":64,mgrs:66}],36:[function(e,t,n){function o(e){return typeof e=="string"}function u(e){return e in r}function a(e){var t=["GEOGCS","GEOCCS","PROJCS","LOCAL_CS"];return t.reduce(function(t,n){return t+1+e.indexOf(n)},0)}function f(e){return e[0]==="+"}function l(e){if(!o(e))return e;if(u(e))return r[e];if(a(e))return i(e);if(f(e))return s(e)}var r=e("./defs"),i=e("./wkt"),s=e("./projString");t.exports=l},{"./defs":31,"./projString":37,"./wkt":65}],37:[function(e,t,n){var r=.017453292519943295,i=e("./constants/PrimeMeridian");t.exports=function(e){var t={},n={};e.split("+").map(function(e){return e.trim()}).filter(function(e){return e}).forEach(function(e){var t=e.split("=");t.push(!0),n[t[0].toLowerCase()]=t[1]});var s,o,u,a={proj:"projName",datum:"datumCode",rf:function(e){t.rf=parseFloat(e)},lat_0:function(e){t.lat0=e*r},lat_1:function(e){t.lat1=e*r},lat_2:function(e){t.lat2=e*r},lat_ts:function(e){t.lat_ts=e*r},lon_0:function(e){t.long0=e*r},lon_1:function(e){t.long1=e*r},lon_2:function(e){t.long2=e*r},alpha:function(e){t.alpha=parseFloat(e)*r},lonc:function(e){t.longc=e*r},x_0:function(e){t.x0=parseFloat(e)},y_0:function(e){t.y0=parseFloat(e)},k_0:function(e){t.k0=parseFloat(e)},k:function(e){t.k0=parseFloat(e)},a:function(e){t.a=parseFloat(e)},b:function(e){t.b=parseFloat(e)},r_a:function(){t.R_A=!0},zone:function(e){t.zone=parseInt(e,10)},south:function(){t.utmSouth=!0},towgs84:function(e){t.datum_params=e.split(",").map(function(e){return parseFloat(e)})},to_meter:function(e){t.to_meter=parseFloat(e)},from_greenwich:function(e){t.from_greenwich=e*r},pm:function(e){t.from_greenwich=(i[e]?i[e]:parseFloat(e))*r},nadgrids:function(e){e==="@null"?t.datumCode="none":t.nadgrids=e},axis:function(e){var n="ewnsud";e.length===3&&n.indexOf(e.substr(0,1))!==-1&&n.indexOf(e.substr(1,1))!==-1&&n.indexOf(e.substr(2,1))!==-1&&(t.axis=e)}};for(s in n)o=n[s],s in a?(u=a[s],typeof u=="function"?u(o):t[u]=o):t[s]=o;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}},{"./constants/PrimeMeridian":27}],38:[function(e,t,n){function o(e,t){var n=s.length;return e.names?(s[n]=e,e.names.forEach(function(e){i[e.toLowerCase()]=n}),this):(console.log(t),!0)}var r=[e("./projections/merc"),e("./projections/longlat")],i={},s=[];n.add=o,n.get=function(e){if(!e)return!1;var t=e.toLowerCase();if(typeof i[t]!="undefined"&&s[i[t]])return s[i[t]]},n.start=function(){r.forEach(o)}},{"./projections/longlat":50,"./projections/merc":51}],39:[function(e,t,n){var r=1e-10,i=e("../common/msfnz"),s=e("../common/qsfnz"),o=e("../common/adjust_lon"),u=e("../common/asinz");n.init=function(){if(Math.abs(this.lat1+this.lat2)<r)return;this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=i(this.e3,this.sin_po,this.cos_po),this.qs1=s(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=i(this.e3,this.sin_po,this.cos_po),this.qs2=s(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=s(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>r?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0},n.forward=function(e){var t=e.x,n=e.y;this.sin_phi=Math.sin(n),this.cos_phi=Math.cos(n);var r=s(this.e3,this.sin_phi,this.cos_phi),i=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,u=this.ns0*o(t-this.long0),a=i*Math.sin(u)+this.x0,f=this.rh-i*Math.cos(u)+this.y0;return e.x=a,e.y=f,e},n.inverse=function(e){var t,n,r,i,s,u;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),r=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),r=-1),i=0,t!==0&&(i=Math.atan2(r*e.x,r*e.y)),r=t*this.ns0/this.a,this.sphere?u=Math.asin((this.c-r*r)/(2*this.ns0)):(n=(this.c-r*r)/this.ns0,u=this.phi1z(this.e3,n)),s=o(i/this.ns0+this.long0),e.x=s,e.y=u,e},n.phi1z=function(e,t){var n,i,s,o,a,f=u(.5*t);if(e<r)return f;var l=e*e;for(var c=1;c<=25;c++){n=Math.sin(f),i=Math.cos(f),s=e*n,o=1-s*s,a=.5*o*o/i*(t/(1-l)-n/o+.5/e*Math.log((1-s)/(1+s))),f+=a;if(Math.abs(a)<=1e-7)return f}return null},n.names=["Albers_Conic_Equal_Area","Albers","aea"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/msfnz":15,"../common/qsfnz":20}],40:[function(e,t,n){var r=e("../common/adjust_lon"),i=Math.PI/2,s=1e-10,o=e("../common/mlfn"),u=e("../common/e0fn"),a=e("../common/e1fn"),f=e("../common/e2fn"),l=e("../common/e3fn"),c=e("../common/gN"),h=e("../common/asinz"),p=e("../common/imlfn");n.init=function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},n.forward=function(e){var t=e.x,n=e.y,h=Math.sin(e.y),p=Math.cos(e.y),d=r(t-this.long0),v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j;return this.sphere?Math.abs(this.sin_p12-1)<=s?(e.x=this.x0+this.a*(i-n)*Math.sin(d),e.y=this.y0-this.a*(i-n)*Math.cos(d),e):Math.abs(this.sin_p12+1)<=s?(e.x=this.x0+this.a*(i+n)*Math.sin(d),e.y=this.y0+this.a*(i+n)*Math.cos(d),e):(_=this.sin_p12*h+this.cos_p12*p*Math.cos(d),O=Math.acos(_),M=O/Math.sin(O),e.x=this.x0+this.a*M*p*Math.sin(d),e.y=this.y0+this.a*M*(this.cos_p12*h-this.sin_p12*p*Math.cos(d)),e):(v=u(this.es),m=a(this.es),g=f(this.es),y=l(this.es),Math.abs(this.sin_p12-1)<=s?(b=this.a*o(v,m,g,y,i),w=this.a*o(v,m,g,y,n),e.x=this.x0+(b-w)*Math.sin(d),e.y=this.y0-(b-w)*Math.cos(d),e):Math.abs(this.sin_p12+1)<=s?(b=this.a*o(v,m,g,y,i),w=this.a*o(v,m,g,y,n),e.x=this.x0+(b+w)*Math.sin(d),e.y=this.y0+(b+w)*Math.cos(d),e):(E=h/p,S=c(this.a,this.e,this.sin_p12),x=c(this.a,this.e,h),T=Math.atan((1-this.es)*E+this.es*S*this.sin_p12/(x*p)),N=Math.atan2(Math.sin(d),this.cos_p12*Math.tan(T)-this.sin_p12*Math.cos(d)),N===0?D=Math.asin(this.cos_p12*Math.sin(T)-this.sin_p12*Math.cos(T)):Math.abs(Math.abs(N)-Math.PI)<=s?D=-Math.asin(this.cos_p12*Math.sin(T)-this.sin_p12*Math.cos(T)):D=Math.asin(Math.sin(d)*Math.cos(T)/Math.sin(N)),C=this.e*this.sin_p12/Math.sqrt(1-this.es),k=this.e*this.cos_p12*Math.cos(N)/Math.sqrt(1-this.es),L=C*k,A=k*k,P=D*D,H=P*D,B=H*D,j=B*D,O=S*D*(1-P*A*(1-A)/6+H/8*L*(1-2*A)+B/120*(A*(4-7*A)-3*C*C*(1-7*A))-j/48*L),e.x=this.x0+O*Math.sin(N),e.y=this.y0+O*Math.cos(N),e))},n.inverse=function(e){e.x-=this.x0,e.y-=this.y0;var t,n,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P;if(this.sphere){t=Math.sqrt(e.x*e.x+e.y*e.y);if(t>2*i*this.a)return;return n=t/this.a,d=Math.sin(n),v=Math.cos(n),m=this.long0,Math.abs(t)<=s?g=this.lat0:(g=h(v*this.sin_p12+e.y*d*this.cos_p12/t),y=Math.abs(this.lat0)-i,Math.abs(y)<=s?this.lat0>=0?m=r(this.long0+Math.atan2(e.x,-e.y)):m=r(this.long0-Math.atan2(-e.x,e.y)):m=r(this.long0+Math.atan2(e.x*d,t*this.cos_p12*v-e.y*this.sin_p12*d))),e.x=m,e.y=g,e}return b=u(this.es),w=a(this.es),E=f(this.es),S=l(this.es),Math.abs(this.sin_p12-1)<=s?(x=this.a*o(b,w,E,S,i),t=Math.sqrt(e.x*e.x+e.y*e.y),T=x-t,g=p(T/this.a,b,w,E,S),m=r(this.long0+Math.atan2(e.x,-1*e.y)),e.x=m,e.y=g,e):Math.abs(this.sin_p12+1)<=s?(x=this.a*o(b,w,E,S,i),t=Math.sqrt(e.x*e.x+e.y*e.y),T=t-x,g=p(T/this.a,b,w,E,S),m=r(this.long0+Math.atan2(e.x,e.y)),e.x=m,e.y=g,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),k=Math.atan2(e.x,e.y),N=c(this.a,this.e,this.sin_p12),L=Math.cos(k),A=this.e*this.cos_p12*L,O=-A*A/(1-this.es),M=3*this.es*(1-O)*this.sin_p12*this.cos_p12*L/(1-this.es),_=t/N,D=_-O*(1+O)*Math.pow(_,3)/6-M*(1+3*O)*Math.pow(_,4)/24,P=1-O*D*D/2-_*D*D*D/6,C=Math.asin(this.sin_p12*Math.cos(D)+this.cos_p12*Math.sin(D)*L),m=r(this.long0+Math.asin(Math.sin(k)*Math.sin(D)/Math.cos(C))),g=Math.atan((1-this.es*P*this.sin_p12/Math.sin(C))*Math.tan(C)/(1-this.es)),e.x=m,e.y=g,e)},n.names=["Azimuthal_Equidistant","aeqd"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],41:[function(e,t,n){var r=e("../common/mlfn"),i=e("../common/e0fn"),s=e("../common/e1fn"),o=e("../common/e2fn"),u=e("../common/e3fn"),a=e("../common/gN"),f=e("../common/adjust_lon"),l=e("../common/adjust_lat"),c=e("../common/imlfn"),h=Math.PI/2,p=1e-10;n.init=function(){this.sphere||(this.e0=i(this.es),this.e1=s(this.es),this.e2=o(this.es),this.e3=u(this.es),this.ml0=this.a*r(this.e0,this.e1,this.e2,this.e3,this.lat0))},n.forward=function(e){var t,n,i=e.x,s=e.y;i=f(i-this.long0);if(this.sphere)t=this.a*Math.asin(Math.cos(s)*Math.sin(i)),n=this.a*(Math.atan2(Math.tan(s),Math.cos(i))-this.lat0);else{var o=Math.sin(s),u=Math.cos(s),l=a(this.a,this.e,o),c=Math.tan(s)*Math.tan(s),h=i*Math.cos(s),p=h*h,d=this.es*u*u/(1-this.es),v=this.a*r(this.e0,this.e1,this.e2,this.e3,s);t=l*h*(1-p*c*(1/6-(8-c+8*d)*p/120)),n=v-this.ml0+l*o/u*p*(.5+(5-c+6*d)*p/24)}return e.x=t+this.x0,e.y=n+this.y0,e},n.inverse=function(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,n=e.y/this.a,r,i;if(this.sphere){var s=n+this.lat0;r=Math.asin(Math.sin(s)*Math.cos(t)),i=Math.atan2(Math.tan(t),Math.cos(s))}else{var o=this.ml0/this.a+n,u=c(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(u)-h)<=p)return e.x=this.long0,e.y=h,n<0&&(e.y*=-1),e;var d=a(this.a,this.e,Math.sin(u)),v=d*d*d/this.a/this.a*(1-this.es),m=Math.pow(Math.tan(u),2),g=t*this.a/d,y=g*g;r=u-d*Math.tan(u)/v*g*g*(.5-(1+3*m)*g*g/24),i=g*(1-y*(m/3+(1+3*m)*m*y/15))/Math.cos(u)}return e.x=f(i+this.long0),e.y=l(r),e},n.names=["Cassini","Cassini_Soldner","cass"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],42:[function(e,t,n){var r=e("../common/adjust_lon"),i=e("../common/qsfnz"),s=e("../common/msfnz"),o=e("../common/iqsfnz");n.init=function(){this.sphere||(this.k0=s(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},n.forward=function(e){var t=e.x,n=e.y,s,o,u=r(t-this.long0);if(this.sphere)s=this.x0+this.a*u*Math.cos(this.lat_ts),o=this.y0+this.a*Math.sin(n)/Math.cos(this.lat_ts);else{var a=i(this.e,Math.sin(n));s=this.x0+this.a*this.k0*u,o=this.y0+this.a*a*.5/this.k0}return e.x=s,e.y=o,e},n.inverse=function(e){e.x-=this.x0,e.y-=this.y0;var t,n;return this.sphere?(t=r(this.long0+e.x/this.a/Math.cos(this.lat_ts)),n=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(n=o(this.e,2*e.y*this.k0/this.a),t=r(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=n,e},n.names=["cea"]},{"../common/adjust_lon":5,"../common/iqsfnz":13,"../common/msfnz":15,"../common/qsfnz":20}],43:[function(e,t,n){var r=e("../common/adjust_lon"),i=e("../common/adjust_lat");n.init=function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},n.forward=function(e){var t=e.x,n=e.y,s=r(t-this.long0),o=i(n-this.lat0);return e.x=this.x0+this.a*s*this.rc,e.y=this.y0+this.a*o,e},n.inverse=function(e){var t=e.x,n=e.y;return e.x=r(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=i(this.lat0+(n-this.y0)/this.a),e},n.names=["Equirectangular","Equidistant_Cylindrical","eqc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5}],44:[function(e,t,n){var r=e("../common/e0fn"),i=e("../common/e1fn"),s=e("../common/e2fn"),o=e("../common/e3fn"),u=e("../common/msfnz"),a=e("../common/mlfn"),f=e("../common/adjust_lon"),l=e("../common/adjust_lat"),c=e("../common/imlfn"),h=1e-10;n.init=function(){if(Math.abs(this.lat1+this.lat2)<h)return;this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=r(this.es),this.e1=i(this.es),this.e2=s(this.es),this.e3=o(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=u(this.e,this.sinphi,this.cosphi),this.ml1=a(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<h?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=u(this.e,this.sinphi,this.cosphi),this.ml2=a(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=a(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0)},n.forward=function(e){var t=e.x,n=e.y,r;if(this.sphere)r=this.a*(this.g-n);else{var i=a(this.e0,this.e1,this.e2,this.e3,n);r=this.a*(this.g-i)}var s=this.ns*f(t-this.long0),o=this.x0+r*Math.sin(s),u=this.y0+this.rh-r*Math.cos(s);return e.x=o,e.y=u,e},n.inverse=function(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,n,r,i;this.ns>=0?(n=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(n=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var s=0;n!==0&&(s=Math.atan2(t*e.x,t*e.y));if(this.sphere)return i=f(this.long0+s/this.ns),r=l(this.g-n/this.a),e.x=i,e.y=r,e;var o=this.g-n/this.a;return r=c(o,this.e0,this.e1,this.e2,this.e3),i=f(this.long0+s/this.ns),e.x=i,e.y=r,e},n.names=["Equidistant_Conic","eqdc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/imlfn":12,"../common/mlfn":14,"../common/msfnz":15}],45:[function(e,t,n){var r=Math.PI/4,i=e("../common/srat"),s=Math.PI/2,o=20;n.init=function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+r)/(Math.pow(Math.tan(.5*this.lat0+r),this.C)*i(this.e*e,this.ratexp))},n.forward=function(e){var t=e.x,n=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*n+r),this.C)*i(this.e*Math.sin(n),this.ratexp))-s,e.x=this.C*t,e},n.inverse=function(e){var t=1e-14,n=e.x/this.C,u=e.y,a=Math.pow(Math.tan(.5*u+r)/this.K,1/this.C);for(var f=o;f>0;--f){u=2*Math.atan(a*i(this.e*Math.sin(e.y),-0.5*this.e))-s;if(Math.abs(u-e.y)<t)break;e.y=u}return f?(e.x=n,e.y=u,e):null},n.names=["gauss"]},{"../common/srat":22}],46:[function(e,t,n){var r=e("../common/adjust_lon"),i=1e-10,s=e("../common/asinz");n.init=function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},n.forward=function(e){var t,n,s,o,u,a,f,l,c=e.x,h=e.y;return s=r(c-this.long0),t=Math.sin(h),n=Math.cos(h),o=Math.cos(s),a=this.sin_p14*t+this.cos_p14*n*o,u=1,a>0||Math.abs(a)<=i?(f=this.x0+this.a*u*n*Math.sin(s)/a,l=this.y0+this.a*u*(this.cos_p14*t-this.sin_p14*n*o)/a):(f=this.x0+this.infinity_dist*n*Math.sin(s),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*n*o)),e.x=f,e.y=l,e},n.inverse=function(e){var t,n,i,o,u,a;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(o=Math.atan2(t,this.rc),n=Math.sin(o),i=Math.cos(o),a=s(i*this.sin_p14+e.y*n*this.cos_p14/t),u=Math.atan2(e.x*n,t*this.cos_p14*i-e.y*this.sin_p14*n),u=r(this.long0+u)):(a=this.phic0,u=0),e.x=u,e.y=a,e},n.names=["gnom"]},{"../common/adjust_lon":5,"../common/asinz":6}],47:[function(e,t,n){var r=e("../common/adjust_lon");n.init=function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},n.forward=function(e){var t,n,i,s,o,u,a,f=e.x,l=e.y,c=r(f-this.long0);return t=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),n=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/t)-this.s45),i=-c*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(n)+Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),o=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(s)),u=this.n*o,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),e.y=a*Math.cos(u)/1,e.x=a*Math.sin(u)/1,this.czech||(e.y*=-1,e.x*=-1),e},n.inverse=function(e){var t,n,r,i,s,o,u,a,f=e.x;e.x=e.y,e.y=f,this.czech||(e.y*=-1,e.x*=-1),o=Math.sqrt(e.x*e.x+e.y*e.y),s=Math.atan2(e.y,e.x),i=s/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(i)),n=Math.asin(Math.cos(r)*Math.sin(i)/Math.cos(t)),e.x=this.long0-n/this.alfa,u=t,a=0;var l=0;do e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.e/2))-this.s45),Math.abs(u-e.y)<1e-10&&(a=1),u=e.y,l+=1;while(a===0&&l<15);return l>=15?null:e},n.names=["Krovak","krovak"]},{"../common/adjust_lon":5}],48:[function(e,t,n){var r=Math.PI/2,i=Math.PI/4,s=1e-10,o=e("../common/qsfnz"),u=e("../common/adjust_lon");n.S_POLE=1,n.N_POLE=2,n.EQUIT=3,n.OBLIQ=4,n.init=function(){var e=Math.abs(this.lat0);Math.abs(e-r)<s?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<s?this.mode=this.EQUIT:this.mode=this.OBLIQ;if(this.es>0){var t;this.qp=o(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es);switch(this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=o(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},n.forward=function(e){var t,n,a,f,l,c,h,p,d,v,m=e.x,g=e.y;m=u(m-this.long0);if(this.sphere){l=Math.sin(g),v=Math.cos(g),a=Math.cos(m);if(this.mode===this.OBLIQ||this.mode===this.EQUIT){n=this.mode===this.EQUIT?1+v*a:1+this.sinph0*l+this.cosph0*v*a;if(n<=s)return null;n=Math.sqrt(2/n),t=n*v*Math.sin(m),n*=this.mode===this.EQUIT?l:this.cosph0*l-this.sinph0*v*a}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){this.mode===this.N_POLE&&(a=-a);if(Math.abs(g+this.phi0)<s)return null;n=i-g*.5,n=2*(this.mode===this.S_POLE?Math.cos(n):Math.sin(n)),t=n*Math.sin(m),n*=a}}else{h=0,p=0,d=0,a=Math.cos(m),f=Math.sin(m),l=Math.sin(g),c=o(this.e,l);if(this.mode===this.OBLIQ||this.mode===this.EQUIT)h=c/this.qp,p=Math.sqrt(1-h*h);switch(this.mode){case this.OBLIQ:d=1+this.sinb1*h+this.cosb1*p*a;break;case this.EQUIT:d=1+p*a;break;case this.N_POLE:d=r+g,c=this.qp-c;break;case this.S_POLE:d=g-r,c=this.qp+c}if(Math.abs(d)<s)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:d=Math.sqrt(2/d),this.mode===this.OBLIQ?n=this.ymf*d*(this.cosb1*h-this.sinb1*p*a):n=(d=Math.sqrt(2/(1+p*a)))*h*this.ymf,t=this.xmf*d*p*f;break;case this.N_POLE:case this.S_POLE:c>=0?(t=(d=Math.sqrt(c))*f,n=a*(this.mode===this.S_POLE?d:-d)):t=n=0}}return e.x=this.a*t+this.x0,e.y=this.a*n+this.y0,e},n.inverse=function(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,n=e.y/this.a,i,o,a,f,l,c,h;if(this.sphere){var p=0,d,v=0;d=Math.sqrt(t*t+n*n),o=d*.5;if(o>1)return null;o=2*Math.asin(o);if(this.mode===this.OBLIQ||this.mode===this.EQUIT)v=Math.sin(o),p=Math.cos(o);switch(this.mode){case this.EQUIT:o=Math.abs(d)<=s?0:Math.asin(n*v/d),t*=v,n=p*d;break;case this.OBLIQ:o=Math.abs(d)<=s?this.phi0:Math.asin(p*this.sinph0+n*v*this.cosph0/d),t*=v*this.cosph0,n=(p-Math.sin(o)*this.sinph0)*d;break;case this.N_POLE:n=-n,o=r-o;break;case this.S_POLE:o-=r}i=n!==0||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(t,n):0}else{h=0;if(this.mode===this.OBLIQ||this.mode===this.EQUIT){t/=this.dd,n*=this.dd,c=Math.sqrt(t*t+n*n);if(c<s)return e.x=0,e.y=this.phi0,e;f=2*Math.asin(.5*c/this.rq),a=Math.cos(f),t*=f=Math.sin(f),this.mode===this.OBLIQ?(h=a*this.sinb1+n*f*this.cosb1/c,l=this.qp*h,n=c*this.cosb1*a-n*this.sinb1*f):(h=n*f/c,l=this.qp*h,n=c*a)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){this.mode===this.N_POLE&&(n=-n),l=t*t+n*n;if(!l)return e.x=0,e.y=this.phi0,e;h=1-l/this.qp,this.mode===this.S_POLE&&(h=-h)}i=Math.atan2(t,n),o=this.authlat(Math.asin(h),this.apa)}return e.x=u(this.long0+i),e.y=o,e},n.P00=.3333333333333333,n.P01=.17222222222222222,n.P02=.10257936507936508,n.P10=.06388888888888888,n.P11=.0664021164021164,n.P20=.016415012942191543,n.authset=function(e){var t,n=[];return n[0]=e*this.P00,t=e*e,n[0]+=t*this.P01,n[1]=t*this.P10,t*=e,n[0]+=t*this.P02,n[1]+=t*this.P11,n[2]=t*this.P20,n},n.authlat=function(e,t){var n=e+e;return e+t[0]*Math.sin(n)+t[1]*Math.sin(n+n)+t[2]*Math.sin(n+n+n)},n.names=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"]},{"../common/adjust_lon":5,"../common/qsfnz":20}],49:[function(e,t,n){var r=1e-10,i=e("../common/msfnz"),s=e("../common/tsfnz"),o=Math.PI/2,u=e("../common/sign"),a=e("../common/adjust_lon"),f=e("../common/phi2z");n.init=function(){this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0;if(Math.abs(this.lat1+this.lat2)<r)return;var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),n=Math.cos(this.lat1),o=i(this.e,t,n),u=s(this.e,this.lat1,t),a=Math.sin(this.lat2),f=Math.cos(this.lat2),l=i(this.e,a,f),c=s(this.e,this.lat2,a),h=s(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>r?this.ns=Math.log(o/l)/Math.log(u/c):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=o/(this.ns*Math.pow(u,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")},n.forward=function(e){var t=e.x,n=e.y;Math.abs(2*Math.abs(n)-Math.PI)<=r&&(n=u(n)*(o-2*r));var i=Math.abs(Math.abs(n)-o),f,l;if(i>r)f=s(this.e,n,Math.sin(n)),l=this.a*this.f0*Math.pow(f,this.ns);else{i=n*this.ns;if(i<=0)return null;l=0}var c=this.ns*a(t-this.long0);return e.x=this.k0*l*Math.sin(c)+this.x0,e.y=this.k0*(this.rh-l*Math.cos(c))+this.y0,e},n.inverse=function(e){var t,n,r,i,s,u=(e.x-this.x0)/this.k0,l=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(u*u+l*l),n=1):(t=-Math.sqrt(u*u+l*l),n=-1);var c=0;t!==0&&(c=Math.atan2(n*u,n*l));if(t!==0||this.ns>0){n=1/this.ns,r=Math.pow(t/(this.a*this.f0),n),i=f(this.e,r);if(i===-9999)return null}else i=-o;return s=a(c/this.ns+this.long0),e.x=s,e.y=i,e},n.names=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],50:[function(e,t,n){function r(e){return e}n.init=function(){},n.forward=r,n.inverse=r,n.names=["longlat","identity"]},{}],51:[function(e,t,n){var r=e("../common/msfnz"),i=Math.PI/2,s=1e-10,o=57.29577951308232,u=e("../common/adjust_lon"),a=Math.PI/4,f=e("../common/tsfnz"),l=e("../common/phi2z");n.init=function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=r(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},n.forward=function(e){var t=e.x,n=e.y;if(n*o>90&&n*o<-90&&t*o>180&&t*o<-180)return null;var r,l;if(Math.abs(Math.abs(n)-i)<=s)return null;if(this.sphere)r=this.x0+this.a*this.k0*u(t-this.long0),l=this.y0+this.a*this.k0*Math.log(Math.tan(a+.5*n));else{var c=Math.sin(n),h=f(this.e,n,c);r=this.x0+this.a*this.k0*u(t-this.long0),l=this.y0-this.a*this.k0*Math.log(h)}return e.x=r,e.y=l,e},n.inverse=function(e){var t=e.x-this.x0,n=e.y-this.y0,r,s;if(this.sphere)s=i-2*Math.atan(Math.exp(-n/(this.a*this.k0)));else{var o=Math.exp(-n/(this.a*this.k0));s=l(this.e,o);if(s===-9999)return null}return r=u(this.long0+t/(this.a*this.k0)),e.x=r,e.y=s,e},n.names=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/tsfnz":24}],52:[function(e,t,n){var r=e("../common/adjust_lon");n.init=function(){},n.forward=function(e){var t=e.x,n=e.y,i=r(t-this.long0),s=this.x0+this.a*i,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+n/2.5))*1.25;return e.x=s,e.y=o,e},n.inverse=function(e){e.x-=this.x0,e.y-=this.y0;var t=r(this.long0+e.x/this.a),n=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=n,e},n.names=["Miller_Cylindrical","mill"]},{"../common/adjust_lon":5}],53:[function(e,t,n){var r=e("../common/adjust_lon"),i=1e-10;n.init=function(){},n.forward=function(e){var t=e.x,n=e.y,s=r(t-this.long0),o=n,u=Math.PI*Math.sin(n);for(var a=0;!0;a++){var f=-(o+Math.sin(o)-u)/(1+Math.cos(o));o+=f;if(Math.abs(f)<i)break}o/=2,Math.PI/2-Math.abs(n)<i&&(s=0);var l=.900316316158*this.a*s*Math.cos(o)+this.x0,c=1.4142135623731*this.a*Math.sin(o)+this.y0;return e.x=l,e.y=c,e},n.inverse=function(e){var t,n;e.x-=this.x0,e.y-=this.y0,n=e.y/(1.4142135623731*this.a),Math.abs(n)>.999999999999&&(n=.999999999999),t=Math.asin(n);var i=r(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),n=(2*t+Math.sin(2*t))/Math.PI,Math.abs(n)>1&&(n=1);var s=Math.asin(n);return e.x=i,e.y=s,e},n.names=["Mollweide","moll"]},{"../common/adjust_lon":5}],54:[function(e,t,n){var r=484813681109536e-20;n.iterations=1,n.init=function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-0.1358797613,this.A[3]=.063294409,this.A[4]=-0.02526853,this.A[5]=.0117879,this.A[6]=-0.0055161,this.A[7]=.0026906,this.A[8]=-0.001333,this.A[9]=67e-5,this.A[10]=-0.00034,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-0.001541739,this.B_im[3]=.04105856,this.B_re[4]=-0.10162907,this.B_im[4]=.01727609,this.B_re[5]=-0.26623489,this.B_im[5]=-0.36249218,this.B_re[6]=-0.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-0.577245789,this.C_im[2]=-0.007809598,this.C_re[3]=.508307513,this.C_im[3]=-0.112208952,this.C_re[4]=-0.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-0.03333098,this.D[4]=-0.1052906,this.D[5]=-0.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-0.0013},n.forward=function(e){var t,n=e.x,i=e.y,s=i-this.lat0,o=n-this.long0,u=s/r*1e-5,a=o,f=1,l=0;for(t=1;t<=10;t++)f*=u,l+=this.A[t]*f;var c=l,h=a,p=1,d=0,v,m,g=0,y=0;for(t=1;t<=6;t++)v=p*c-d*h,m=d*c+p*h,p=v,d=m,g=g+this.B_re[t]*p-this.B_im[t]*d,y=y+this.B_im[t]*p+this.B_re[t]*d;return e.x=y*this.a+this.x0,e.y=g*this.a+this.y0,e},n.inverse=function(e){var t,n=e.x,i=e.y,s=n-this.x0,o=i-this.y0,u=o/this.a,a=s/this.a,f=1,l=0,c,h,p=0,d=0;for(t=1;t<=6;t++)c=f*u-l*a,h=l*u+f*a,f=c,l=h,p=p+this.C_re[t]*f-this.C_im[t]*l,d=d+this.C_im[t]*f+this.C_re[t]*l;for(var v=0;v<this.iterations;v++){var m=p,g=d,y,b,w=u,E=a;for(t=2;t<=6;t++)y=m*p-g*d,b=g*p+m*d,m=y,g=b,w+=(t-1)*(this.B_re[t]*m-this.B_im[t]*g),E+=(t-1)*(this.B_im[t]*m+this.B_re[t]*g);m=1,g=0;var S=this.B_re[1],x=this.B_im[1];for(t=2;t<=6;t++)y=m*p-g*d,b=g*p+m*d,m=y,g=b,S+=t*(this.B_re[t]*m-this.B_im[t]*g),x+=t*(this.B_im[t]*m+this.B_re[t]*g);var T=S*S+x*x;p=(w*S+E*x)/T,d=(E*S-w*x)/T}var N=p,C=d,k=1,L=0;for(t=1;t<=9;t++)k*=N,L+=this.D[t]*k;var A=this.lat0+L*r*1e5,O=this.long0+C;return e.x=O,e.y=A,e},n.names=["New_Zealand_Map_Grid","nzmg"]},{}],55:[function(e,t,n){var r=e("../common/tsfnz"),i=e("../common/adjust_lon"),s=e("../common/phi2z"),o=Math.PI/2,u=Math.PI/4,a=1e-10;n.init=function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var e=Math.sin(this.lat0),t=Math.cos(this.lat0),n=this.e*e;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(t,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-n*n);var s=r(this.e,this.lat0,e),o=this.bl/t*Math.sqrt((1-this.es)/(1-n*n));o*o<1&&(o=1);var u,a;if(!isNaN(this.longc))this.lat0>=0?u=o+Math.sqrt(o*o-1):u=o-Math.sqrt(o*o-1),this.el=u*Math.pow(s,this.bl),a=.5*(u-1/u),this.gamma0=Math.asin(Math.sin(this.alpha)/o),this.long0=this.longc-Math.asin(a*Math.tan(this.gamma0))/this.bl;else{var f=r(this.e,this.lat1,Math.sin(this.lat1)),l=r(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(o+Math.sqrt(o*o-1))*Math.pow(s,this.bl):this.el=(o-Math.sqrt(o*o-1))*Math.pow(s,this.bl);var c=Math.pow(f,this.bl),h=Math.pow(l,this.bl);u=this.el/c,a=.5*(u-1/u);var p=(this.el*this.el-h*c)/(this.el*this.el+h*c),d=(h-c)/(h+c),v=i(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(p*Math.tan(.5*this.bl*v)/d)/this.bl,this.long0=i(this.long0);var m=i(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*m)/a),this.alpha=Math.asin(o*Math.sin(this.gamma0))}this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(o*o-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(o*o-1),Math.cos(this.alpha))},n.forward=function(e){var t=e.x,n=e.y,s=i(t-this.long0),f,l,c;if(Math.abs(Math.abs(n)-o)<=a)n>0?c=-1:c=1,l=this.al/this.bl*Math.log(Math.tan(u+c*this.gamma0*.5)),f=-1*c*o*this.al/this.bl;else{var h=r(this.e,n,Math.sin(n)),p=this.el/Math.pow(h,this.bl),d=.5*(p-1/p),v=.5*(p+1/p),m=Math.sin(this.bl*s),g=(d*Math.sin(this.gamma0)-m*Math.cos(this.gamma0))/v;Math.abs(Math.abs(g)-1)<=a?l=Number.POSITIVE_INFINITY:l=.5*this.al*Math.log((1-g)/(1+g))/this.bl,Math.abs(Math.cos(this.bl*s))<=a?f=this.al*this.bl*s:f=this.al*Math.atan2(d*Math.cos(this.gamma0)+m*Math.sin(this.gamma0),Math.cos(this.bl*s))/this.bl}return this.no_rot?(e.x=this.x0+f,e.y=this.y0+l):(f-=this.uc,e.x=this.x0+l*Math.cos(this.alpha)+f*Math.sin(this.alpha),e.y=this.y0+f*Math.cos(this.alpha)-l*Math.sin(this.alpha)),e},n.inverse=function(e){var t,n;this.no_rot?(n=e.y-this.y0,t=e.x-this.x0):(n=(e.x-this.x0)*Math.cos(this.alpha)-(e.y-this.y0)*Math.sin(this.alpha),t=(e.y-this.y0)*Math.cos(this.alpha)+(e.x-this.x0)*Math.sin(this.alpha),t+=this.uc);var r=Math.exp(-1*this.bl*n/this.al),u=.5*(r-1/r),f=.5*(r+1/r),l=Math.sin(this.bl*t/this.al),c=(l*Math.cos(this.gamma0)+u*Math.sin(this.gamma0))/f,h=Math.pow(this.el/Math.sqrt((1+c)/(1-c)),1/this.bl);return Math.abs(c-1)<a?(e.x=this.long0,e.y=o):Math.abs(c+1)<a?(e.x=this.long0,e.y=-1*o):(e.y=s(this.e,h),e.x=i(this.long0-Math.atan2(u*Math.cos(this.gamma0)-l*Math.sin(this.gamma0),Math.cos(this.bl*t/this.al))/this.bl)),e},n.names=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},{"../common/adjust_lon":5,"../common/phi2z":16,"../common/tsfnz":24}],56:[function(e,t,n){var r=e("../common/e0fn"),i=e("../common/e1fn"),s=e("../common/e2fn"),o=e("../common/e3fn"),u=e("../common/adjust_lon"),a=e("../common/adjust_lat"),f=e("../common/mlfn"),l=1e-10,c=e("../common/gN"),h=20;n.init=function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=r(this.es),this.e1=i(this.es),this.e2=s(this.es),this.e3=o(this.es),this.ml0=this.a*f(this.e0,this.e1,this.e2,this.e3,this.lat0)},n.forward=function(e){var t=e.x,n=e.y,r,i,s,o=u(t-this.long0);s=o*Math.sin(n);if(this.sphere)Math.abs(n)<=l?(r=this.a*o,i=-1*this.a*this.lat0):(r=this.a*Math.sin(s)/Math.tan(n),i=this.a*(a(n-this.lat0)+(1-Math.cos(s))/Math.tan(n)));else if(Math.abs(n)<=l)r=this.a*o,i=-1*this.ml0;else{var h=c(this.a,this.e,Math.sin(n))/Math.tan(n);r=h*Math.sin(s),i=this.a*f(this.e0,this.e1,this.e2,this.e3,n)-this.ml0+h*(1-Math.cos(s))}return e.x=r+this.x0,e.y=i+this.y0,e},n.inverse=function(e){var t,n,r,i,s,o,a,c,p;r=e.x-this.x0,i=e.y-this.y0;if(this.sphere)if(Math.abs(i+this.a*this.lat0)<=l)t=u(r/this.a+this.long0),n=0;else{o=this.lat0+i/this.a,a=r*r/this.a/this.a+o*o,c=o;var d;for(s=h;s;--s){d=Math.tan(c),p=-1*(o*(c*d+1)-c-.5*(c*c+a)*d)/((c-o)/d-1),c+=p;if(Math.abs(p)<=l){n=c;break}}t=u(this.long0+Math.asin(r*Math.tan(c)/this.a)/Math.sin(n))}else if(Math.abs(i+this.ml0)<=l)n=0,t=u(this.long0+r/this.a);else{o=(this.ml0+i)/this.a,a=r*r/this.a/this.a+o*o,c=o;var v,m,g,y,b;for(s=h;s;--s){b=this.e*Math.sin(c),v=Math.sqrt(1-b*b)*Math.tan(c),m=this.a*f(this.e0,this.e1,this.e2,this.e3,c),g=this.e0-2*this.e1*Math.cos(2*c)+4*this.e2*Math.cos(4*c)-6*this.e3*Math.cos(6*c),y=m/this.a,p=(o*(v*y+1)-y-.5*v*(y*y+a))/(this.es*Math.sin(2*c)*(y*y+a-2*o*y)/(4*v)+(o-y)*(v*g-2/Math.sin(2*c))-g),c-=p;if(Math.abs(p)<=l){n=c;break}}v=Math.sqrt(1-this.es*Math.pow(Math.sin(n),2))*Math.tan(n),t=u(this.long0+Math.asin(r*v/this.a)/Math.sin(n))}return e.x=t,e.y=n,e},n.names=["Polyconic","poly"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/mlfn":14}],57:[function(e,t,n){var r=e("../common/adjust_lon"),i=e("../common/adjust_lat"),s=e("../common/pj_enfn"),o=20,u=e("../common/pj_mlfn"),a=e("../common/pj_inv_mlfn"),f=Math.PI/2,l=1e-10,c=e("../common/asinz");n.init=function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=s(this.es)},n.forward=function(e){var t,n,i=e.x,s=e.y;i=r(i-this.long0);if(this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else{var a=this.n*Math.sin(s);for(var f=o;f;--f){var c=(this.m*s+Math.sin(s)-a)/(this.m+Math.cos(s));s-=c;if(Math.abs(c)<l)break}}t=this.a*this.C_x*i*(this.m+Math.cos(s)),n=this.a*this.C_y*s}else{var h=Math.sin(s),p=Math.cos(s);n=this.a*u(s,h,p,this.en),t=this.a*i*p/Math.sqrt(1-this.es*h*h)}return e.x=t,e.y=n,e},n.inverse=function(e){var t,n,s,o;return e.x-=this.x0,s=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,s/=this.C_x*(this.m+Math.cos(t)),this.m?t=c((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=c(Math.sin(t)/this.n)),s=r(s+this.long0),t=i(t)):(t=a(e.y/this.a,this.es,this.en),o=Math.abs(t),o<f?(o=Math.sin(t),n=this.long0+e.x*Math.sqrt(1-this.es*o*o)/(this.a*Math.cos(t)),s=r(n)):o-l<f&&(s=this.long0)),e.x=s,e.y=t,e},n.names=["Sinusoidal","sinu"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/asinz":6,"../common/pj_enfn":17,"../common/pj_inv_mlfn":18,"../common/pj_mlfn":19}],58:[function(e,t,n){n.init=function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),n=this.a,r=this.rf,i=1/r,s=2*i-Math.pow(i,2),o=this.e=Math.sqrt(s);this.R=this.k0*n*Math.sqrt(1-s)/(1-s*Math.pow(t,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var u=Math.log(Math.tan(Math.PI/4+this.b0/2)),a=Math.log(Math.tan(Math.PI/4+e/2)),f=Math.log((1+o*t)/(1-o*t));this.K=u-this.alpha*a+this.alpha*o/2*f},n.forward=function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),n=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),r=-this.alpha*(t+n)+this.K,i=2*(Math.atan(Math.exp(r))-Math.PI/4),s=this.alpha*(e.x-this.lambda0),o=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(s))),u=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(s));return e.y=this.R/2*Math.log((1+Math.sin(u))/(1-Math.sin(u)))+this.y0,e.x=this.R*o+this.x0,e},n.inverse=function(e){var t=e.x-this.x0,n=e.y-this.y0,r=t/this.R,i=2*(Math.atan(Math.exp(n/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(r)),o=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(i))),u=this.lambda0+o/this.alpha,a=0,f=s,l=-1e3,c=0;while(Math.abs(f-l)>1e-7){if(++c>20)return;a=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(f))/2)),l=f,f=2*Math.atan(Math.exp(a))-Math.PI/2}return e.x=u,e.y=f,e},n.names=["somerc"]},{}],59:[function(e,t,n){var r=Math.PI/2,i=1e-10,s=e("../common/sign"),o=e("../common/msfnz"),u=e("../common/tsfnz"),a=e("../common/phi2z"),f=e("../common/adjust_lon");n.ssfn_=function(e,t,n){return t*=n,Math.tan(.5*(r+e))*Math.pow((1-t)/(1+t),.5*n)},n.init=function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=i&&(this.k0=.5*(1+s(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=i&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=i&&(this.k0=.5*this.cons*o(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/u(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=o(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-r,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},n.forward=function(e){var t=e.x,n=e.y,s=Math.sin(n),o=Math.cos(n),a,l,c,h,p,d,v=f(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=i&&Math.abs(n+this.lat0)<=i?(e.x=NaN,e.y=NaN,e):this.sphere?(a=2*this.k0/(1+this.sinlat0*s+this.coslat0*o*Math.cos(v)),e.x=this.a*a*o*Math.sin(v)+this.x0,e.y=this.a*a*(this.coslat0*s-this.sinlat0*o*Math.cos(v))+this.y0,e):(l=2*Math.atan(this.ssfn_(n,s,this.e))-r,h=Math.cos(l),c=Math.sin(l),Math.abs(this.coslat0)<=i?(p=u(this.e,n*this.con,this.con*s),d=2*this.a*this.k0*p/this.cons,e.x=this.x0+d*Math.sin(t-this.long0),e.y=this.y0-this.con*d*Math.cos(t-this.long0),e):(Math.abs(this.sinlat0)<i?(a=2*this.a*this.k0/(1+h*Math.cos(v)),e.y=a*c):(a=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*c+this.cosX0*h*Math.cos(v))),e.y=a*(this.cosX0*c-this.sinX0*h*Math.cos(v))+this.y0),e.x=a*h*Math.sin(v)+this.x0,e))},n.inverse=function(e){e.x-=this.x0,e.y-=this.y0;var t,n,s,o,u,l=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var c=2*Math.atan(l/(.5*this.a*this.k0));return t=this.long0,n=this.lat0,l<=i?(e.x=t,e.y=n,e):(n=Math.asin(Math.cos(c)*this.sinlat0+e.y*Math.sin(c)*this.coslat0/l),Math.abs(this.coslat0)<i?this.lat0>0?t=f(this.long0+Math.atan2(e.x,-1*e.y)):t=f(this.long0+Math.atan2(e.x,e.y)):t=f(this.long0+Math.atan2(e.x*Math.sin(c),l*this.coslat0*Math.cos(c)-e.y*this.sinlat0*Math.sin(c))),e.x=t,e.y=n,e)}if(Math.abs(this.coslat0)<=i){if(l<=i)return n=this.lat0,t=this.long0,e.x=t,e.y=n,e;e.x*=this.con,e.y*=this.con,s=l*this.cons/(2*this.a*this.k0),n=this.con*a(this.e,s),t=this.con*f(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else o=2*Math.atan(l*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,l<=i?u=this.X0:(u=Math.asin(Math.cos(o)*this.sinX0+e.y*Math.sin(o)*this.cosX0/l),t=f(this.long0+Math.atan2(e.x*Math.sin(o),l*this.cosX0*Math.cos(o)-e.y*this.sinX0*Math.sin(o)))),n=-1*a(this.e,Math.tan(.5*(r+u)));return e.x=t,e.y=n,e},n.names=["stere"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],60:[function(e,t,n){var r=e("./gauss"),i=e("../common/adjust_lon");n.init=function(){r.init.apply(this);if(!this.rc)return;this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative")},n.forward=function(e){var t,n,s,o;return e.x=i(e.x-this.long0),r.forward.apply(this,[e]),t=Math.sin(e.y),n=Math.cos(e.y),s=Math.cos(e.x),o=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*n*s),e.x=o*n*Math.sin(e.x),e.y=o*(this.cosc0*t-this.sinc0*n*s),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},n.inverse=function(e){var t,n,s,o,u;e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0;if(u=Math.sqrt(e.x*e.x+e.y*e.y)){var a=2*Math.atan2(u,this.R2);t=Math.sin(a),n=Math.cos(a),o=Math.asin(n*this.sinc0+e.y*t*this.cosc0/u),s=Math.atan2(e.x*t,u*this.cosc0*n-e.y*this.sinc0*t)}else o=this.phic0,s=0;return e.x=s,e.y=o,r.inverse.apply(this,[e]),e.x=i(e.x+this.long0),e},n.names=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]},{"../common/adjust_lon":5,"./gauss":45}],61:[function(e,t,n){var r=e("../common/e0fn"),i=e("../common/e1fn"),s=e("../common/e2fn"),o=e("../common/e3fn"),u=e("../common/mlfn"),a=e("../common/adjust_lon"),f=Math.PI/2,l=1e-10,c=e("../common/sign"),h=e("../common/asinz");n.init=function(){this.e0=r(this.es),this.e1=i(this.es),this.e2=s(this.es),this.e3=o(this.es),this.ml0=this.a*u(this.e0,this.e1,this.e2,this.e3,this.lat0)},n.forward=function(e){var t=e.x,n=e.y,r=a(t-this.long0),i,s,o,f=Math.sin(n),l=Math.cos(n);if(this.sphere){var c=l*Math.sin(r);if(Math.abs(Math.abs(c)-1)<1e-10)return 93;s=.5*this.a*this.k0*Math.log((1+c)/(1-c)),i=Math.acos(l*Math.cos(r)/Math.sqrt(1-c*c)),n<0&&(i=-i),o=this.a*this.k0*(i-this.lat0)}else{var h=l*r,p=Math.pow(h,2),d=this.ep2*Math.pow(l,2),v=Math.tan(n),m=Math.pow(v,2);i=1-this.es*Math.pow(f,2);var g=this.a/Math.sqrt(i),y=this.a*u(this.e0,this.e1,this.e2,this.e3,n);s=this.k0*g*h*(1+p/6*(1-m+d+p/20*(5-18*m+Math.pow(m,2)+72*d-58*this.ep2)))+this.x0,o=this.k0*(y-this.ml0+g*v*p*(.5+p/24*(5-m+9*d+4*Math.pow(d,2)+p/30*(61-58*m+Math.pow(m,2)+600*d-330*this.ep2))))+this.y0}return e.x=s,e.y=o,e},n.inverse=function(e){var t,n,r,i,s=6,o,u;if(this.sphere){var p=Math.exp(e.x/(this.a*this.k0)),d=.5*(p-1/p),v=this.lat0+e.y/(this.a*this.k0),m=Math.cos(v);t=Math.sqrt((1-m*m)/(1+d*d)),o=h(t),v<0&&(o=-o),d===0&&m===0?u=this.long0:u=a(Math.atan2(d,m)+this.long0)}else{var g=e.x-this.x0,y=e.y-this.y0;t=(this.ml0+y/this.k0)/this.a,n=t;for(i=0;!0;i++){r=(t+this.e1*Math.sin(2*n)-this.e2*Math.sin(4*n)+this.e3*Math.sin(6*n))/this.e0-n,n+=r;if(Math.abs(r)<=l)break;if(i>=s)return 95}if(Math.abs(n)<f){var b=Math.sin(n),w=Math.cos(n),E=Math.tan(n),S=this.ep2*Math.pow(w,2),x=Math.pow(S,2),T=Math.pow(E,2),N=Math.pow(T,2);t=1-this.es*Math.pow(b,2);var C=this.a/Math.sqrt(t),k=C*(1-this.es)/t,L=g/(C*this.k0),A=Math.pow(L,2);o=n-C*E*A/k*(.5-A/24*(5+3*T+10*S-4*x-9*this.ep2-A/30*(61+90*T+298*S+45*N-252*this.ep2-3*x))),u=a(this.long0+L*(1-A/6*(1+2*T+S-A/20*(5-2*S+28*T-3*x+8*this.ep2+24*N)))/w)}else o=f*c(y),u=this.long0}return e.x=u,e.y=o,e},n.names=["Transverse_Mercator","Transverse Mercator","tmerc"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/mlfn":14,"../common/sign":21}],62:[function(e,t,n){var r=.017453292519943295,i=e("./tmerc");n.dependsOn="tmerc",n.init=function(){if(!this.zone)return;this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*r,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,i.init.apply(this),this.forward=i.forward,this.inverse=i.inverse},n.names=["Universal Transverse Mercator System","utm"]},{"./tmerc":61}],63:[function(e,t,n){var r=e("../common/adjust_lon"),i=Math.PI/2,s=1e-10,o=e("../common/asinz");n.init=function(){this.R=this.a},n.forward=function(e){var t=e.x,n=e.y,u=r(t-this.long0),a,f;Math.abs(n)<=s&&(a=this.x0+this.R*u,f=this.y0);var l=o(2*Math.abs(n/Math.PI));if(Math.abs(u)<=s||Math.abs(Math.abs(n)-i)<=s)a=this.x0,n>=0?f=this.y0+Math.PI*this.R*Math.tan(.5*l):f=this.y0+Math.PI*this.R*-Math.tan(.5*l);var c=.5*Math.abs(Math.PI/u-u/Math.PI),h=c*c,p=Math.sin(l),d=Math.cos(l),v=d/(p+d-1),m=v*v,g=v*(2/p-1),y=g*g,b=Math.PI*this.R*(c*(v-y)+Math.sqrt(h*(v-y)*(v-y)-(y+h)*(m-y)))/(y+h);u<0&&(b=-b),a=this.x0+b;var w=h+v;return b=Math.PI*this.R*(g*w-c*Math.sqrt((y+h)*(h+1)-w*w))/(y+h),n>=0?f=this.y0+b:f=this.y0-b,e.x=a,e.y=f,e},n.inverse=function(e){var t,n,i,o,u,a,f,l,c,h,p,d,v;return e.x-=this.x0,e.y-=this.y0,p=Math.PI*this.R,i=e.x/p,o=e.y/p,u=i*i+o*o,a=-Math.abs(o)*(1+u),f=a-2*o*o+i*i,l=-2*a+1+2*o*o+u*u,v=o*o/l+(2*f*f*f/l/l/l-9*a*f/l/l)/27,c=(a-f*f/3/l)/l,h=2*Math.sqrt(-c/3),p=3*v/c/h,Math.abs(p)>1&&(p>=0?p=1:p=-1),d=Math.acos(p)/3,e.y>=0?n=(-h*Math.cos(d+Math.PI/3)-f/3/l)*Math.PI:n=-(-h*Math.cos(d+Math.PI/3)-f/3/l)*Math.PI,Math.abs(i)<s?t=this.long0:t=r(this.long0+Math.PI*(u-1+Math.sqrt(1+2*(i*i-o*o)+u*u))/2/i),e.x=t,e.y=n,e},n.names=["Van_der_Grinten_I","VanDerGrinten","vandg"]},{"../common/adjust_lon":5,"../common/asinz":6}],64:[function(e,t,n){var r=.017453292519943295,i=57.29577951308232,s=1,o=2,u=e("./datum_transform"),a=e("./adjust_axis"),f=e("./Proj"),l=e("./common/toPoint");t.exports=function c(e,t,n){function p(e,t){return(e.datum.datum_type===s||e.datum.datum_type===o)&&t.datumCode!=="WGS84"}var h;return Array.isArray(n)&&(n=l(n)),e.datum&&t.datum&&(p(e,t)||p(t,e))&&(h=new f("WGS84"),c(e,h,n),e=h),e.axis!=="enu"&&a(e,!1,n),e.projName==="longlat"?(n.x*=r,n.y*=r):(e.to_meter&&(n.x*=e.to_meter,n.y*=e.to_meter),e.inverse(n)),e.from_greenwich&&(n.x+=e.from_greenwich),n=u(e.datum,t.datum,n),t.from_greenwich&&(n.x-=t.from_greenwich),t.projName==="longlat"?(n.x*=i,n.y*=i):(t.forward(n),t.to_meter&&(n.x/=t.to_meter,n.y/=t.to_meter)),t.axis!=="enu"&&a(t,!0,n),n}},{"./Proj":2,"./adjust_axis":3,"./common/toPoint":23,"./datum_transform":30}],65:[function(e,t,n){function s(e,t,n){e[t]=n.map(function(e){var t={};return o(e,t),t}).reduce(function(e,t){return i(e,t)},{})}function o(e,t){var n;if(!Array.isArray(e)){t[e]=!0;return}n=e.shift(),n==="PARAMETER"&&(n=e.shift()),e.length===1?Array.isArray(e[0])?(t[n]={},o(e[0],t[n])):t[n]=e[0]:e.length?n==="TOWGS84"?t[n]=e:(t[n]={},["UNIT","PRIMEM","VERT_DATUM"].indexOf(n)>-1?(t[n]={name:e[0].toLowerCase(),convert:e[1]},e.length===3&&(t[n].auth=e[2])):n==="SPHEROID"?(t[n]={name:e[0],a:e[1],rf:e[2]},e.length===4&&(t[n].auth=e[3])):["GEOGCS","GEOCCS","DATUM","VERT_CS","COMPD_CS","LOCAL_CS","FITTED_CS","LOCAL_DATUM"].indexOf(n)>-1?(e[0]=["name",e[0]],s(t,n,e)):e.every(function(e){return Array.isArray(e)})?s(t,n,e):o(e,t[n])):t[n]=!0}function u(e,t){var n=t[0],r=t[1];!(n in e)&&r in e&&(e[n]=e[r],t.length===3&&(e[n]=t[2](e[n])))}function a(e){return e*r}function f(e){function t(t){var n=e.to_meter||1;return parseFloat(t,10)*n}e.type==="GEOGCS"?e.projName="longlat":e.type==="LOCAL_CS"?(e.projName="identity",e.local=!0):typeof e.PROJECTION=="object"?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.UNIT.convert&&(e.to_meter=parseFloat(e.UNIT.convert,10)));if(e.GEOGCS){e.GEOGCS.DATUM?e.datumCode=e.GEOGCS.DATUM.name.toLowerCase():e.datumCode=e.GEOGCS.name.toLowerCase(),e.datumCode.slice(0,2)==="d_"&&(e.datumCode=e.datumCode.slice(2));if(e.datumCode==="new_zealand_geodetic_datum_1949"||e.datumCode==="new_zealand_1949")e.datumCode="nzgd49";e.datumCode==="wgs_1984"&&(e.PROJECTION==="Mercator_Auxiliary_Sphere"&&(e.sphere=!0),e.datumCode="wgs84"),e.datumCode.slice(-6)==="_ferro"&&(e.datumCode=e.datumCode.slice(0,-6)),e.datumCode.slice(-8)==="_jakarta"&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),e.GEOGCS.DATUM&&e.GEOGCS.DATUM.SPHEROID&&(e.ellps=e.GEOGCS.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),e.ellps.toLowerCase().slice(0,13)==="international"&&(e.ellps="intl"),e.a=e.GEOGCS.DATUM.SPHEROID.a,e.rf=parseFloat(e.GEOGCS.DATUM.SPHEROID.rf,10)),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36")}e.b&&!isFinite(e.b)&&(e.b=e.a);var n=function(t){return u(e,t)},r=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",a],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",a],["x0","false_easting",t],["y0","false_northing",t],["long0","central_meridian",a],["lat0","latitude_of_origin",a],["lat0","standard_parallel_1",a],["lat1","standard_parallel_1",a],["lat2","standard_parallel_2",a],["alpha","azimuth",a],["srsCode","name"]];r.forEach(n),!e.long0&&e.longc&&(e.PROJECTION==="Albers_Conic_Equal_Area"||e.PROJECTION==="Lambert_Azimuthal_Equal_Area")&&(e.long0=e.longc)}var r=.017453292519943295,i=e("./extend");t.exports=function(e,t){var n=JSON.parse((","+e).replace(/\s*\,\s*([A-Z_0-9]+?)(\[)/g,',["$1",').slice(1).replace(/\s*\,\s*([A-Z_0-9]+?)\]/g,',"$1"]').replace(/,\["VERTCS".+/,"")),r=n.shift(),s=n.shift();n.unshift(["name",s]),n.unshift(["type",r]),n.unshift("output");var u={};return o(n,u),f(u.output),i(t,u.output)}},{"./extend":33}],66:[function(e,t,n){function c(e){return e*(Math.PI/180)}function h(e){return 180*(e/Math.PI)}function p(e){var t=e.lat,n=e.lon,r=6378137,i=.00669438,s=.9996,o,u,a,f,l,h,p,d=c(t),m=c(n),g,y;y=Math.floor((n+180)/6)+1,n===180&&(y=60),t>=56&&t<64&&n>=3&&n<12&&(y=32),t>=72&&t<84&&(n>=0&&n<9?y=31:n>=9&&n<21?y=33:n>=21&&n<33?y=35:n>=33&&n<42&&(y=37)),o=(y-1)*6-180+3,g=c(o),u=i/(1-i),a=r/Math.sqrt(1-i*Math.sin(d)*Math.sin(d)),f=Math.tan(d)*Math.tan(d),l=u*Math.cos(d)*Math.cos(d),h=Math.cos(d)*(m-g),p=r*((1-i/4-3*i*i/64-5*i*i*i/256)*d-(3*i/8+3*i*i/32+45*i*i*i/1024)*Math.sin(2*d)+(15*i*i/256+45*i*i*i/1024)*Math.sin(4*d)-35*i*i*i/3072*Math.sin(6*d));var b=s*a*(h+(1-f+l)*h*h*h/6+(5-18*f+f*f+72*l-58*u)*h*h*h*h*h/120)+5e5,w=s*(p+a*Math.tan(d)*(h*h/2+(5-f+9*l+4*l*l)*h*h*h*h/24+(61-58*f+f*f+600*l-330*u)*h*h*h*h*h*h/720));return t<0&&(w+=1e7),{northing:Math.round(w),easting:Math.round(b),zoneNumber:y,zoneLetter:v(t)}}function d(e){var t=e.northing,n=e.easting,r=e.zoneLetter,i=e.zoneNumber;if(i<0||i>60)return null;var s=.9996,o=6378137,u=.00669438,a,f=(1-Math.sqrt(1-u))/(1+Math.sqrt(1-u)),l,c,p,v,m,g,y,b,w,E=n-5e5,S=t;r<"N"&&(S-=1e7),y=(i-1)*6-180+3,a=u/(1-u),g=S/s,b=g/(o*(1-u/4-3*u*u/64-5*u*u*u/256)),w=b+(3*f/2-27*f*f*f/32)*Math.sin(2*b)+(21*f*f/16-55*f*f*f*f/32)*Math.sin(4*b)+151*f*f*f/96*Math.sin(6*b),l=o/Math.sqrt(1-u*Math.sin(w)*Math.sin(w)),c=Math.tan(w)*Math.tan(w),p=a*Math.cos(w)*Math.cos(w),v=o*(1-u)/Math.pow(1-u*Math.sin(w)*Math.sin(w),1.5),m=E/(l*s);var x=w-l*Math.tan(w)/v*(m*m/2-(5+3*c+10*p-4*p*p-9*a)*m*m*m*m/24+(61+90*c+298*p+45*c*c-252*a-3*p*p)*m*m*m*m*m*m/720);x=h(x);var T=(m-(1+2*c+p)*m*m*m/6+(5-2*p+28*c-3*p*p+8*a+24*c*c)*m*m*m*m*m/120)/Math.cos(w);T=y+h(T);var N;if(e.accuracy){var C=d({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});N={top:C.lat,right:C.lon,bottom:x,left:T}}else N={lat:x,lon:T};return N}function v(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function m(e,t){var n=""+e.easting,r=""+e.northing;return e.zoneNumber+e.zoneLetter+g(e.easting,e.northing,e.zoneNumber)+n.substr(n.length-5,t)+r.substr(r.length-5,t)}function g(e,t,n){var r=y(n),i=Math.floor(e/1e5),s=Math.floor(t/1e5)%20;return b(i,s,r)}function y(e){var t=e%r;return t===0&&(t=r),t}function b(e,t,n){var r=n-1,c=i.charCodeAt(r),h=s.charCodeAt(r),p=c+e-1,d=h+t,v=!1;p>l&&(p=p-l+o-1,v=!0),(p===u||c<u&&p>u||(p>u||c<u)&&v)&&p++;if(p===a||c<a&&p>a||(p>a||c<a)&&v)p++,p===u&&p++;p>l&&(p=p-l+o-1),d>f?(d=d-f+o-1,v=!0):v=!1,(d===u||h<u&&d>u||(d>u||h<u)&&v)&&d++;if(d===a||h<a&&d>a||(d>a||h<a)&&v)d++,d===u&&d++;d>f&&(d=d-f+o-1);var m=String.fromCharCode(p)+String.fromCharCode(d);return m}function w(e){if(e&&e.length===0)throw"MGRSPoint coverting from nothing";var t=e.length,n=null,r="",i,s=0;while(!/[A-Z]/.test(i=e.charAt(s))){if(s>=2)throw"MGRSPoint bad conversion from: "+e;r+=i,s++}var o=parseInt(r,10);if(s===0||s+3>t)throw"MGRSPoint bad conversion from: "+e;var u=e.charAt(s++);if(u<="A"||u==="B"||u==="Y"||u>="Z"||u==="I"||u==="O")throw"MGRSPoint zone letter "+u+" not handled: "+e;n=e.substring(s,s+=2);var a=y(o),f=E(n.charAt(0),a),l=S(n.charAt(1),a);while(l<x(u))l+=2e6;var c=t-s;if(c%2!==0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var h=c/2,p=0,d=0,v,m,g,b,w;return h>0&&(v=1e5/Math.pow(10,h),m=e.substring(s,s+h),p=parseFloat(m)*v,g=e.substring(s+h),d=parseFloat(g)*v),b=p+f,w=d+l,{easting:b,northing:w,zoneLetter:u,zoneNumber:o,accuracy:v}}function E(e,t){var n=i.charCodeAt(t-1),r=1e5,s=!1;while(n!==e.charCodeAt(0)){n++,n===u&&n++,n===a&&n++;if(n>l){if(s)throw"Bad character: "+e;n=o,s=!0}r+=1e5}return r}function S(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;var n=s.charCodeAt(t-1),r=0,i=!1;while(n!==e.charCodeAt(0)){n++,n===u&&n++,n===a&&n++;if(n>f){if(i)throw"Bad character: "+e;n=o,i=!0}r+=1e5}return r}function x(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}var r=6,i="AJSAJS",s="AFAFAF",o=65,u=73,a=79,f=86,l=90;n.forward=function(e,t){return t=t||5,m(p({lat:e[1],lon:e[0]}),t)},n.inverse=function(e){var t=d(w(e.toUpperCase()));return[t.left,t.bottom,t.right,t.top]},n.toPoint=function(e){var t=n.inverse(e);return[(t[2]+t[0])/2,(t[3]+t[1])/2]}},{}],67:[function(e,t,n){t.exports={name:"proj4",version:"2.3.3",description:"Proj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.",main:"lib/index.js",directories:{test:"test",doc:"docs"},scripts:{test:"./node_modules/istanbul/lib/cli.js test ./node_modules/mocha/bin/_mocha test/test.js"},repository:{type:"git",url:"git://github.com/proj4js/proj4js.git"},author:"",license:"MIT",jam:{main:"dist/proj4.js",include:["dist/proj4.js","README.md","AUTHORS","LICENSE.md"]},devDependencies:{"grunt-cli":"~0.1.13",grunt:"~0.4.2","grunt-contrib-connect":"~0.6.0","grunt-contrib-jshint":"~0.8.0",chai:"~1.8.1",mocha:"~1.17.1","grunt-mocha-phantomjs":"~0.4.0",browserify:"~3.24.5","grunt-browserify":"~1.3.0","grunt-contrib-uglify":"~0.3.2",curl:"git://github.com/cujojs/curl.git",istanbul:"~0.2.4",tin:"~0.4.0"},dependencies:{mgrs:"0.0.0"}}},{}],"./includedProjections":[function(e,t,n){t.exports=e("gWUPNW")},{}],gWUPNW:[function(e,t,n){var r=[e("./lib/projections/tmerc"),e("./lib/projections/utm"),e("./lib/projections/sterea"),e("./lib/projections/stere"),e("./lib/projections/somerc"),e("./lib/projections/omerc"),e("./lib/projections/lcc"),e("./lib/projections/krovak"),e("./lib/projections/cass"),e("./lib/projections/laea"),e("./lib/projections/aea"),e("./lib/projections/gnom"),e("./lib/projections/cea"),e("./lib/projections/eqc"),e("./lib/projections/poly"),e("./lib/projections/nzmg"),e("./lib/projections/mill"),e("./lib/projections/sinu"),e("./lib/projections/moll"),e("./lib/projections/eqdc"),e("./lib/projections/vandg"),e("./lib/projections/aeqd")];t.exports=function(e){r.forEach(function(t){e.Proj.projections.add(t)})}},{"./lib/projections/aea":39,"./lib/projections/aeqd":40,"./lib/projections/cass":41,"./lib/projections/cea":42,"./lib/projections/eqc":43,"./lib/projections/eqdc":44,"./lib/projections/gnom":46,"./lib/projections/krovak":47,"./lib/projections/laea":48,"./lib/projections/lcc":49,"./lib/projections/mill":52,"./lib/projections/moll":53,"./lib/projections/nzmg":54,"./lib/projections/omerc":55,"./lib/projections/poly":56,"./lib/projections/sinu":57,"./lib/projections/somerc":58,"./lib/projections/stere":59,"./lib/projections/sterea":60,"./lib/projections/tmerc":61,"./lib/projections/utm":62,"./lib/projections/vandg":63}]},{},[35])(35)}),n("formats/geojson/GeoJSONCRS",["../../error/ArgumentError","./GeoJSONConstants","../../util/Logger","../../util/proj4-src"],function(e,t,n,r){"use strict";var i=function(t,r){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONCRS","constructor","missingType"));if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONCRS","constructor","missingProperties"));this._type=t,this._properties=r,this._projectionString=null};return Object.defineProperties(i.prototype,{type:{get:function(){return this._type}},properties:{get:function(){return this._properties}},projectionString:{get:function(){return this._projectionString}}}),i.prototype.isDefault=function(){if(this.isNamed())if(this._projectionString===t.EPSG4326_CRS||this._projectionString===t.WGS84_CRS)return!0;return!1},i.prototype.isNamed=function(){return this._type===t.FIELD_CRS_NAME},i.prototype.isLinked=function(){return this._type===t.FIELD_CRS_LINK},i.prototype.isCRSSupported=function(){try{r(this._projectionString,t.EPSG4326_CRS)}catch(e){return n.log(n.LEVEL_WARNING,"Unknown GeoJSON coordinate reference system ("+e+"): "+this._properties.name),!1}return!0},i.prototype.getLinkedCRSString=function(e,t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="text",r.onreadystatechange=function(){r.readyState===4&&(r.status===200?(this._projectionString=r.response,t()):n.log(n.LEVEL_WARNING,"GeoJSON Linked CRS retrieval failed ("+r.statusText+"): "+e))}.bind(this),r.onerror=function(){n.log(n.LEVEL_WARNING,"GeoJSON Linked CRS retrieval failed: "+e)},r.ontimeout=function(){n.log(n.LEVEL_WARNING,"GeoJSON Linked CRS retrieval timed out: "+e)},r.send(null)},i.prototype.setCRSString=function(e){this.isNamed()?(this._projectionString=this._properties.name,e()):this.isLinked()&&this.getLinkedCRSString(this._properties.href,e)},i}),n("formats/geojson/GeoJSONFeature",["../../error/ArgumentError","./GeoJSONConstants","../../util/Logger"],function(e,t,n){"use strict";var r=function(r,i,s,o){if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONFeature","constructor","missingGeometry"));if(!r[t.FIELD_TYPE])throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONFeature","constructor","missingFeatureGeometryType"));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONFeature","constructor","missingProperties"));this._geometry=r,this._properties=i,this._id=s,this._bbox=o};return Object.defineProperties(r.prototype,{geometry:{get:function(){return this._geometry}},properties:{get:function(){return this._properties}},id:{get:function(){return this._id}},bbox:{get:function(){return this._bbox}}}),r}),n("formats/geojson/GeoJSONFeatureCollection",["../../error/ArgumentError","./GeoJSONConstants","../../util/Logger"],function(e,t,n){"use strict";var r=function(t,r){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONFeatureCollection","constructor","missingFeatures"));if(Object.prototype.toString.call(t)!=="[object Array]")throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONFeatureCollection","constructor","invalidFeatures"));this._features=t,this._bbox=r};return Object.defineProperties(r.prototype,{features:{get:function(){return this._features}},bbox:{get:function(){return this._bbox}}}),r}),n("formats/geojson/GeoJSONGeometry",["./GeoJSONConstants"],function(e){"use strict";var t=function(e,t,n){if(!e)throw new ArgumentError(Logger.logMessage(Logger.LEVEL_SEVERE,"GeoJSONGeometry","constructor","missingCoordinates"));if(!t)throw new ArgumentError(Logger.logMessage(Logger.LEVEL_SEVERE,"GeoJSONGeometry","constructor","missingType"));this._coordinates=e,this._type=t,this._bbox=n?n:null};return Object.defineProperties(t.prototype,{coordinates:{get:function(){return this._coordinates}},type:{get:function(){return this._type}},bbox:{get:function(){return this._bbox}}}),t.prototype.isPointType=function(){return this.type===e.TYPE_POINT},t.prototype.isMultiPointType=function(){return this.type===e.TYPE_MULTI_POINT},t.prototype.isLineStringType=function(){return this.type===e.TYPE_LINE_STRING},t.prototype.isMultiLineStringType=function(){return this.type===e.TYPE_MULTI_LINE_STRING},t.prototype.isPolygonType=function(){return this.type===e.TYPE_POLYGON},t.prototype.isMultiPolygonType=function(){return this.type===e.TYPE_MULTI_POLYGON},t}),n("formats/geojson/GeoJSONGeometryCollection",["../../error/ArgumentError","./GeoJSONConstants","../../util/Logger"],function(e,t,n){"use strict";var r=function(t,r){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryCollection","constructor","missingGeometries"));if(Object.prototype.toString.call(t)!=="[object Array]")throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryCollection","constructor","invalidGeometries"));this._geometries=t,this._bbox=r};return Object.defineProperties(r.prototype,{geometries:{get:function(){return this._geometries}},bbox:{get:function(){return this._bbox}}}),r}),n("formats/geojson/GeoJSONGeometryLineString",["../../error/ArgumentError","./GeoJSONGeometry","../../util/Logger"],function(e,t,n){"use strict";var r=function(r,i,s){if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryLineString","constructor","missingCoordinates"));if(r.length<2||r[0].length<2)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryLineString","constructor","invalidNumberOfCoordinates"));if(Object.prototype.toString.call(r[0])!=="[object Array]"||Object.prototype.toString.call(r[0][0])!=="[object Number]")throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryLineString","constructor","invalidCoordinatesType"));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryLineString","constructor","missingType"));t.call(this,r,i,s)};return r.prototype=Object.create(t.prototype),r}),n("formats/geojson/GeoJSONGeometryMultiLineString",["../../error/ArgumentError","./GeoJSONGeometry","../../util/Logger"],function(e,t,n){"use strict";var r=function(r,i,s){if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryMultiLineString","constructor","missingCoordinates"));if(r[0].length<2||r[0][0].length<2)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryMultiLineString","constructor","invalidNumberOfCoordinates"));if(Object.prototype.toString.call(r[0])!=="[object Array]"||Object.prototype.toString.call(r[0][0])!=="[object Array]"||Object.prototype.toString.call(r[0][0][0])!=="[object Number]")throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryMultiLineString","constructor","invalidCoordinatesType"));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryLineString","constructor","missingType"));t.call(this,r,i,s)};return r.prototype=Object.create(t.prototype),r}),n("formats/geojson/GeoJSONGeometryMultiPoint",["../../error/ArgumentError","./GeoJSONGeometry","../../util/Logger"],function(e,t,n){"use strict";var r=function(r,i,s){if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryMultiPoint","constructor","missingCoordinates"));if(r[0].length<2)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryMultiPoint","constructor","invalidNumberOfCoordinates"));if(Object.prototype.toString.call(r[0])!=="[object Array]"||Object.prototype.toString.call(r[0][0])!=="[object Number]")throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryMultiPoint","constructor","invalidCoordinatesType"));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryPoint","constructor","missingType"));t.call(this,r,i,s)};return r.prototype=Object.create(t.prototype),r}),n("formats/geojson/GeoJSONGeometryMultiPolygon",["../../error/ArgumentError","./GeoJSONGeometry","../../util/Logger"],function(e,t,n){"use strict";var r=function(r,i,s){if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryMultiPolygon","constructor","missingCoordinates"));if(Object.prototype.toString.call(r[0])!=="[object Array]"||Object.prototype.toString.call(r[0][0])!=="[object Array]"||Object.prototype.toString.call(r[0][0][0])!=="[object Array]"||Object.prototype.toString.call(r[0][0][0][0])!=="[object Number]")throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","invalidCoordinatesType"));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","missingType"));t.call(this,r,i,s)};return r.prototype=Object.create(t.prototype),r}),n("formats/geojson/GeoJSONGeometryPoint",["../../error/ArgumentError","./GeoJSONGeometry","../../util/Logger"],function(e,t,n){"use strict";var r=function(r,i,s){if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryPoint","constructor","missingCoordinates"));if(r.length<2)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryPoint","constructor","invalidNumberOfCoordinates"));if(Object.prototype.toString.call(r)!=="[object Array]"||Object.prototype.toString.call(r[0])!=="[object Number]")throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryPoint","constructor","invalidCoordinatesType"));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryPoint","constructor","missingType"));t.call(this,r,i,s)};return r.prototype=Object.create(t.prototype),r}),n("formats/geojson/GeoJSONGeometryPolygon",["../../error/ArgumentError","./GeoJSONGeometry","../../util/Logger"],function(e,t,n){"use strict";var r=function(r,i,s){if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","missingCoordinates"));if(r[0].length<2||r[0][0].length<2)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","invalidNumberOfCoordinates"));if(Object.prototype.toString.call(r[0])!=="[object Array]"||Object.prototype.toString.call(r[0][0])!=="[object Array]"||Object.prototype.toString.call(r[0][0][0])!=="[object Number]")throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","invalidCoordinatesType"));if(r[0][0]!==r[0][r.length-1])throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","invalidLinearRing"));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"GeoJSONGeometryPolygon","constructor","missingType"));t.call(this,r,i,s)};return r.prototype=Object.create(t.prototype),r}),n("shapes/PlacemarkAttributes",["../util/Color","../util/Font","../util/Offset","../shapes/ShapeAttributes","../shapes/TextAttributes"],function(e,t,n,r,i){"use strict";var s=function(t){this._imageColor=t?t._imageColor:new e(1,1,1,1),this._imageOffset=t?t._imageOffset:new n(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5),this._imageScale=t?t._imageScale:1,this._imageSource=t?t._imageSource:null,this._depthTest=t?t._depthTest:!0,this._labelAttributes=t?t._labelAttributes:new i(null),this._drawLeaderLine=t?t._drawLeaderLine:!1,this._leaderLineAttributes=t?t._leaderLineAttributes:new r(null),this.stateKeyInvalid=!0};return s.prototype.computeStateKey=function(){return"ic "+this._imageColor.toHexString(!0)+" io "+this._imageOffset.toString()+" is "+this._imageScale+" ip "+this._imageSource+" dt "+this._depthTest+" la "+this._labelAttributes.stateKey+" dll "+this._drawLeaderLine+" lla "+this._leaderLineAttributes.stateKey},Object.defineProperties(s.prototype,{stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}},imageColor:{get:function(){return this._imageColor},set:function(e){this._imageColor=e,this.stateKeyInvalid=!0}},imageOffset:{get:function(){return this._imageOffset},set:function(e){this._imageOffset=e,this.stateKeyInvalid=!0}},imageScale:{get:function(){return this._imageScale},set:function(e){this._imageScale=e,this.stateKeyInvalid=!0}},imageSource:{get:function(){return this._imageSource},set:function(e){this._imageSource=e,this.stateKeyInvalid=!0}},depthTest:{get:function(){return this._depthTest},set:function(e){this._depthTest=e,this.stateKeyInvalid=!0}},labelAttributes:{get:function(){return this._labelAttributes},set:function(e){this._labelAttributes=e,this.stateKeyInvalid=!0}},drawLeaderLine:{get:function(){return this._drawLeaderLine},set:function(e){this._drawLeaderLine=e,this.stateKeyInvalid=!0}},leaderLineAttributes:{get:function(){return this._leaderLineAttributes},set:function(e){this._leaderLineAttributes=e,this.stateKeyInvalid=!0}}}),s}),n("shapes/Placemark",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Font","../util/Logger","../geom/Matrix","../pick/PickedObject","../shapes/PlacemarkAttributes","../render/Renderable","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c){"use strict";var h=function(t,n,r){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Placemark","constructor","missingPosition"));a.call(this),this.attributes=r?r:new u(null),this.highlightAttributes=null,this.highlighted=!1,this.position=t,this.eyeDistanceScaling=n,this.eyeDistanceScalingThreshold=1e6,this.eyeDistanceScalingLabelThreshold=1.5*this.eyeDistanceScalingThreshold,this.label=null,this.altitudeMode=WorldWind.ABSOLUTE,this.alwaysOnTop=!1,this.enableLeaderLinePicking=!1,this.updateImage=!0,this.declutterGroup=2,this.targetVisibility=1,this.currentVisibility=1,this.imageRotation=0,this.imageTilt=0,this.imageRotationReference=WorldWind.RELATIVE_TO_SCREEN,this.imageTiltReference=WorldWind.RELATIVE_TO_SCREEN,this.activeAttributes=null,this.activeTexture=null,this.labelTexture=null,this.placePoint=new l(0,0,0),this.groundPoint=new l(0,0,0),this.imageTransform=s.fromIdentity(),this.labelTransform=s.fromIdentity(),this.texCoordMatrix=s.fromIdentity(),this.imageBounds=null,this.layer=null,this.depthOffset=-0.003};return h.screenPoint=new l(0,0,0),h.matrix=s.fromIdentity(),h.scratchPoint=new l(0,0,0),h.prototype=Object.create(a.prototype),Object.defineProperties(h.prototype,{screenBounds:{get:function(){return this.labelBounds}}}),h.prototype.copy=function(e){return this.position=e.position,this.attributes=e.attributes,this.highlightAttributes=e.highlightAttributes,this.highlighted=e.highlighted,this.enabled=e.enabled,this.label=e.label,this.altitudeMode=e.altitudeMode,this.pickDelegate=e.pickDelegate,this.alwaysOnTop=e.alwaysOnTop,this.depthOffset=e.depthOffset,this.targetVisibility=e.targetVisibility,this.currentVisibility=e.currentVisibility,this.imageRotation=e.imageRotation,this.imageTilt=e.imageTilt,this.imageRotationReference=e.imageRotationReference,this.imageTiltReference=e.imageTiltReference,this},h.prototype.clone=function(){var e=new h(this.position);return e.copy(this),e.pickDelegate=this.pickDelegate?this.pickDelegate:this,e},h.prototype.render=function(e){if(!this.enabled)return;if(!e.accumulateOrderedRenderables)return;if(e.globe.projectionLimits&&!e.globe.projectionLimits.containsLocation(this.position.latitude,this.position.longitude))return;var t;if(this.lastFrameTime!==e.timestamp)t=this.makeOrderedRenderable(e);else{var n=this.clone();t=n.makeOrderedRenderable(e)}if(!t)return;if(!t.isVisible(e))return;t.layer=e.currentLayer,this.lastFrameTime=e.timestamp,e.addOrderedRenderable(t)},h.prototype.renderOrdered=function(e){this.drawOrderedPlacemark(e);if(e.pickingMode){var t=new o(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,this.position,this.layer,!1);e.pickPoint&&this.mustDrawLabel()&&this.labelBounds.containsPoint(e.navigatorState.convertPointToViewport(e.pickPoint,h.scratchPoint))&&(t.labelPicked=!0),e.resolvePick(t)}},h.prototype.makeOrderedRenderable=function(e){var t,n,r,i;this.determineActiveAttributes(e);if(!this.activeAttributes)return null;e.surfacePointForMode(this.position.latitude,this.position.longitude,this.position.altitude,this.altitudeMode,this.placePoint),this.eyeDistance=this.alwaysOnTop?0:e.navigatorState.eyePoint.distanceTo(this.placePoint),this.mustDrawLeaderLine(e)&&e.surfacePointForMode(this.position.latitude,this.position.longitude,0,this.altitudeMode,this.groundPoint);if(!e.navigatorState.projectWithDepth(this.placePoint,this.depthOffset,h.screenPoint))return null;var s=this.eyeDistanceScaling?Math.max(0,Math.min(1,this.eyeDistanceScalingThreshold/this.eyeDistance)):1;this.activeTexture?(t=this.activeTexture.originalImageWidth,n=this.activeTexture.originalImageHeight,r=this.activeAttributes.imageScale*s,i=this.activeAttributes.imageOffset.offsetForSize(t,n),this.imageTransform.setTranslation(h.screenPoint[0]-i[0]*r,h.screenPoint[1]-i[1]*r,h.screenPoint[2]),this.imageTransform.setScale(t*r,n*r,1)):(r=this.activeAttributes.imageScale*s,i=this.activeAttributes.imageOffset.offsetForSize(r,r),this.imageTransform.setTranslation(h.screenPoint[0]-i[0],h.screenPoint[1]-i[1],h.screenPoint[2]),this.imageTransform.setScale(r,r,1)),this.imageBounds=c.boundingRectForUnitQuad(this.imageTransform);if(this.mustDrawLabel()){var o=this.activeAttributes.labelAttributes.font,u=this.label+o.toString();this.labelTexture=e.gpuResourceCache.resourceForKey(u),this.labelTexture||(this.labelTexture=e.textSupport.createTexture(e,this.label,o,!0),e.gpuResourceCache.putResource(u,this.labelTexture,this.labelTexture.size)),t=this.labelTexture.imageWidth,n=this.labelTexture.imageHeight,r=this.activeAttributes.labelAttributes.scale*s,i=this.activeAttributes.labelAttributes.offset.offsetForSize(t,n),this.labelTransform.setTranslation(h.screenPoint[0]-i[0]*r,h.screenPoint[1]-i[1]*r,h.screenPoint[2]),this.labelTransform.setScale(t*r,n*r,1),this.labelBounds=c.boundingRectForUnitQuad(this.labelTransform)}return this},h.prototype.determineActiveAttributes=function(e){this.highlighted&&this.highlightAttributes?this.activeAttributes=this.highlightAttributes:this.activeAttributes=this.attributes;if(this.activeAttributes&&this.activeAttributes.imageSource){this.activeTexture=e.gpuResourceCache.resourceForKey(this.activeAttributes.imageSource);if(!this.activeTexture||this.updateImage)this.activeTexture=e.gpuResourceCache.retrieveTexture(e.currentGlContext,this.activeAttributes.imageSource),this.updateImage=!1}},h.prototype.isVisible=function(e){return e.pickingMode?e.pickRectangle&&(this.imageBounds.intersects(e.pickRectangle)||this.mustDrawLabel()&&this.labelBounds.intersects(e.pickRectangle)||this.mustDrawLeaderLine(e)&&e.pickFrustum.intersectsSegment(this.groundPoint,this.placePoint)):this.imageBounds.intersects(e.navigatorState.viewport)||this.mustDrawLabel()&&this.labelBounds.intersects(e.navigatorState.viewport)||this.mustDrawLeaderLine(e)&&e.navigatorState.frustumInModelCoordinates.intersectsSegment(this.groundPoint,this.placePoint)},h.prototype.drawOrderedPlacemark=function(e){this.beginDrawing(e);try{this.doDrawOrderedPlacemark(e),e.pickingMode||this.drawBatchOrderedPlacemarks(e)}finally{this.endDrawing(e)}},h.prototype.drawBatchOrderedPlacemarks=function(e){var t;while((t=e.peekOrderedRenderable())&&t.doDrawOrderedPlacemark){e.popOrderedRenderable();try{t.doDrawOrderedPlacemark(e)}catch(n){i.logMessage(i.LEVEL_WARNING,"Placemark","drawBatchOrderedPlacemarks","Error occurred while rendering placemark using batching: "+n.message)}}},h.prototype.beginDrawing=function(e){var n=e.currentGlContext,r;e.findAndBindProgram(t),r=e.currentProgram,n.bindBuffer(n.ARRAY_BUFFER,e.unitQuadBuffer()),n.vertexAttribPointer(r.vertexTexCoordLocation,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.vertexPointLocation),n.enableVertexAttribArray(r.vertexTexCoordLocation),r.loadTextureUnit(n,n.TEXTURE0),r.loadModulateColor(n,e.pickingMode)},h.prototype.endDrawing=function(e){var t=e.currentGlContext,n=e.currentProgram;t.disableVertexAttribArray(n.vertexPointLocation),t.disableVertexAttribArray(n.vertexTexCoordLocation),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindTexture(t.TEXTURE_2D,null)},h.prototype.doDrawOrderedPlacemark=function(e){var t=e.currentGlContext,n=e.currentProgram,r=!0,i;e.pickingMode&&(this.pickColor=e.uniquePickColor()),this.eyeDistanceScaling&&this.eyeDistance>this.eyeDistanceScalingLabelThreshold&&(this.targetVisibility=0);if(!e.pickingMode&&this.mustDrawLabel()&&this.currentVisibility!=this.targetVisibility){var s=(e.timestamp-e.previousRedrawTimestamp)/e.fadeTime;this.currentVisibility<this.targetVisibility?this.currentVisibility=Math.min(1,this.currentVisibility+s):this.currentVisibility=Math.max(0,this.currentVisibility-s),e.redrawRequested=!0}n.loadOpacity(t,e.pickingMode?1:this.layer.opacity);if(this.mustDrawLeaderLine(e)){this.leaderLinePoints||(this.leaderLinePoints=new Float32Array(6)),this.leaderLinePoints[0]=this.groundPoint[0],this.leaderLinePoints[1]=this.groundPoint[1],this.leaderLinePoints[2]=this.groundPoint[2],this.leaderLinePoints[3]=this.placePoint[0],this.leaderLinePoints[4]=this.placePoint[1],this.leaderLinePoints[5]=this.placePoint[2],this.leaderLineCacheKey||(this.leaderLineCacheKey=e.gpuResourceCache.generateCacheKey());var o=e.gpuResourceCache.resourceForKey(this.leaderLineCacheKey);o||(o=t.createBuffer(),e.gpuResourceCache.putResource(this.leaderLineCacheKey,o,this.leaderLinePoints.length*4)),n.loadTextureEnabled(t,!1),n.loadColor(t,e.pickingMode?this.pickColor:this.activeAttributes.leaderLineAttributes.outlineColor),h.matrix.copy(e.navigatorState.modelviewProjection),n.loadModelviewProjection(t,h.matrix),this.activeAttributes.leaderLineAttributes.depthTest||t.disable(t.DEPTH_TEST),t.lineWidth(this.activeAttributes.leaderLineAttributes.outlineWidth),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,this.leaderLinePoints,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),t.vertexAttribPointer(n.vertexPointLocation,3,t.FLOAT,!1,0,0),t.drawArrays(t.LINES,0,2)}this.activeAttributes.depthTest||(r=!1,t.disable(t.DEPTH_TEST)),t.bindBuffer(t.ARRAY_BUFFER,e.unitQuadBuffer3()),t.vertexAttribPointer(n.vertexPointLocation,3,t.FLOAT,!1,0,0),h.matrix.copy(e.screenProjection),h.matrix.multiplyMatrix(this.imageTransform);var u=this.imageRotationReference===WorldWind.RELATIVE_TO_GLOBE?e.navigatorState.heading-this.imageRotation:-this.imageRotation;h.matrix.multiplyByTranslation(.5,.5,0),h.matrix.multiplyByRotation(0,0,1,u),h.matrix.multiplyByTranslation(-0.5,-0.5,0);var a=this.imageTiltReference===WorldWind.RELATIVE_TO_GLOBE?e.navigatorState.tilt+this.imageTilt:this.imageTilt;h.matrix.multiplyByRotation(-1,0,0,a),n.loadModelviewProjection(t,h.matrix),n.loadTextureEnabled(t,!0),e.pickingMode?n.loadColor(t,this.pickColor):n.loadColor(t,this.activeAttributes.imageColor),this.texCoordMatrix.setToIdentity(),this.activeTexture&&this.texCoordMatrix.multiplyByTextureTransform(this.activeTexture),n.loadTextureMatrix(t,this.texCoordMatrix),this.activeTexture?(i=this.activeTexture.bind(e),n.loadTextureEnabled(t,i)):n.loadTextureEnabled(t,!1),t.drawArrays(t.TRIANGLE_STRIP,0,4),this.mustDrawLabel()&&this.currentVisibility>0&&(n.loadOpacity(t,e.pickingMode?1:this.layer.opacity*this.currentVisibility),h.matrix.copy(e.screenProjection),h.matrix.multiplyMatrix(this.labelTransform),n.loadModelviewProjection(t,h.matrix),!e.pickingMode&&this.labelTexture?(this.texCoordMatrix.setToIdentity(),this.texCoordMatrix.multiplyByTextureTransform(this.labelTexture),n.loadTextureMatrix(t,this.texCoordMatrix),n.loadColor(t,this.activeAttributes.labelAttributes.color),i=this.labelTexture.bind(e),n.loadTextureEnabled(t,i)):(n.loadTextureEnabled(t,!1),n.loadColor(t,this.pickColor)),this.activeAttributes.labelAttributes.depthTest?r||(r=!0,t.enable(t.DEPTH_TEST)):(r=!1,t.disable(t.DEPTH_TEST)),t.drawArrays(t.TRIANGLE_STRIP,0,4)),r||t.enable(t.DEPTH_TEST)},h.prototype.mustDrawLabel=function(){return this.label&&this.label.length>0&&this.activeAttributes.labelAttributes},h.prototype.mustDrawLeaderLine=function(e){return this.activeAttributes.drawLeaderLine&&this.activeAttributes.leaderLineAttributes&&(!e.pickingMode||this.enableLeaderLinePicking)},h});var r={};return r.DEBUG=!1,r.assert=function(e,t){if(r.DEBUG&&!e)throw new Error("Assertion failed"+(t?": "+t:""))},r.GLU_TESS_MAX_COORD=1e150,r.TRUE_PROJECT=!1,r.TESS_MAX_CACHE=100,r.GLU_TESS_DEFAULT_TOLERANCE=0,r.windingRule={GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},r.primitiveType={GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},r.errorType={GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},r.gluEnum={GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},r.PQHandle,r.PQKey,r.geom={},r.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},r.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},r.geom.edgeEval=function(e,t,n){var r=t.s-e.s,i=n.s-t.s;return r+i>0?r<i?t.t-e.t+(e.t-n.t)*(r/(r+i)):t.t-n.t+(n.t-e.t)*(i/(r+i)):0},r.geom.edgeSign=function(e,t,n){var r=t.s-e.s,i=n.s-t.s;return r+i>0?(t.t-n.t)*r+(t.t-e.t)*i:0},r.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},r.geom.transEval=function(e,t,n){var r=t.t-e.t,i=n.t-t.t;return r+i>0?r<i?t.s-e.s+(e.s-n.s)*(r/(r+i)):t.s-n.s+(n.s-e.s)*(i/(r+i)):0},r.geom.transSign=function(e,t,n){var r=t.t-e.t,i=n.t-t.t;return r+i>0?(t.s-n.s)*r+(t.s-e.s)*i:0},r.geom.edgeGoesLeft=function(e){return r.geom.vertLeq(e.dst(),e.org)},r.geom.edgeGoesRight=function(e){return r.geom.vertLeq(e.org,e.dst())},r.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},r.geom.vertCCW=function(e,t,n){return e.s*(t.t-n.t)+t.s*(n.t-e.t)+n.s*(e.t-t.t)>=0},r.geom.interpolate_=function(e,t,n,r){return e=e<0?0:e,n=n<0?0:n,e<=n?n===0?(t+r)/2:t+(r-t)*(e/(e+n)):r+(t-r)*(n/(e+n))},r.geom.edgeIntersect=function(e,t,n,i,s){var o,u,a;r.geom.vertLeq(e,t)||(a=e,e=t,t=a),r.geom.vertLeq(n,i)||(a=n,n=i,i=a),r.geom.vertLeq(e,n)||(a=e,e=n,n=a,a=t,t=i,i=a),r.geom.vertLeq(n,t)?r.geom.vertLeq(t,i)?(o=r.geom.edgeEval(e,n,t),u=r.geom.edgeEval(n,t,i),o+u<0&&(o=-o,u=-u),s.s=r.geom.interpolate_(o,n.s,u,t.s)):(o=r.geom.edgeSign(e,n,t),u=-r.geom.edgeSign(e,i,t),o+u<0&&(o=-o,u=-u),s.s=r.geom.interpolate_(o,n.s,u,i.s)):s.s=(n.s+t.s)/2,r.geom.transLeq(e,t)||(a=e,e=t,t=a),r.geom.transLeq(n,i)||(a=n,n=i,i=a),r.geom.transLeq(e,n)||(a=e,e=n,n=a,a=t,t=i,i=a),r.geom.transLeq(n,t)?r.geom.transLeq(t,i)?(o=r.geom.transEval(e,n,t),u=r.geom.transEval(n,t,i),o+u<0&&(o=-o,u=-u),s.t=r.geom.interpolate_(o,n.t,u,t.t)):(o=r.geom.transSign(e,n,t),u=-r.geom.transSign(e,i,t),o+u<0&&(o=-o,u=-u),s.t=r.geom.interpolate_(o,n.t,u,i.t)):s.t=(n.t+t.t)/2},r.mesh={},r.mesh.makeEdge=function(e){var t=r.mesh.makeEdgePair_(e.eHead);return r.mesh.makeVertex_(t,e.vHead),r.mesh.makeVertex_(t.sym,e.vHead),r.mesh.makeFace_(t,e.fHead),t},r.mesh.meshSplice=function(e,t){var n=!1,i=!1;if(e===t)return;t.org!==e.org&&(i=!0,r.mesh.killVertex_(t.org,e.org)),t.lFace!==e.lFace&&(n=!0,r.mesh.killFace_(t.lFace,e.lFace)),r.mesh.splice_(t,e),i||(r.mesh.makeVertex_(t,e.org),e.org.anEdge=e),n||(r.mesh.makeFace_(t,e.lFace),e.lFace.anEdge=e)},r.mesh.deleteEdge=function(e){var t=e.sym,n=!1;e.lFace!==e.rFace()&&(n=!0,r.mesh.killFace_(e.lFace,e.rFace())),e.oNext===e?r.mesh.killVertex_(e.org,null):(e.rFace().anEdge=e.oPrev(),e.org.anEdge=e.oNext,r.mesh.splice_(e,e.oPrev()),n||r.mesh.makeFace_(e,e.lFace)),t.oNext===t?(r.mesh.killVertex_(t.org,null),r.mesh.killFace_(t.lFace,null)):(e.lFace.anEdge=t.oPrev(),t.org.anEdge=t.oNext,r.mesh.splice_(t,t.oPrev())),r.mesh.killEdge_(e)},r.mesh.addEdgeVertex=function(e){var t=r.mesh.makeEdgePair_(e),n=t.sym;return r.mesh.splice_(t,e.lNext),t.org=e.dst(),r.mesh.makeVertex_(n,t.org),t.lFace=n.lFace=e.lFace,t},r.mesh.splitEdge=function(e){var t=r.mesh.addEdgeVertex(e),n=t.sym;return r.mesh.splice_(e.sym,e.sym.oPrev()),r.mesh.splice_(e.sym,n),e.sym.org=n.org,n.dst().anEdge=n.sym,n.sym.lFace=e.rFace(),n.winding=e.winding,n.sym.winding=e.sym.winding,n},r.mesh.connect=function(e,t){var n=!1,i=r.mesh.makeEdgePair_(e),s=i.sym;return t.lFace!==e.lFace&&(n=!0,r.mesh.killFace_(t.lFace,e.lFace)),r.mesh.splice_(i,e.lNext),r.mesh.splice_(s,t),i.org=e.dst(),s.org=t.org,i.lFace=s.lFace=e.lFace,e.lFace.anEdge=s,n||r.mesh.makeFace_(i,e.lFace),i},r.mesh.zapFace=function(e){var t=e.anEdge,n=t.lNext,i;do{i=n,n=i.lNext,i.lFace=null;if(i.rFace()===null){i.oNext===i?r.mesh.killVertex_(i.org,null):(i.org.anEdge=i.oNext,r.mesh.splice_(i,i.oPrev()));var s=i.sym;s.oNext===s?r.mesh.killVertex_(s.org,null):(s.org.anEdge=s.oNext,r.mesh.splice_(s,s.oPrev())),r.mesh.killEdge_(i)}}while(i!==t);var o=e.prev,u=e.next;u.prev=o,o.next=u},r.mesh.meshUnion=function(e,t){var n=e.fHead,r=e.vHead,i=e.eHead,s=t.fHead,o=t.vHead,u=t.eHead;return s.next!==s&&(n.prev.next=s.next,s.next.prev=n.prev,s.prev.next=n,n.prev=s.prev),o.next!==o&&(r.prev.next=o.next,o.next.prev=r.prev,o.prev.next=r,r.prev=o.prev),u.next!==u&&(i.sym.next.sym.next=u.next,u.next.sym.next=i.sym.next,u.sym.next.sym.next=i,i.sym.next=u.sym.next),e},r.mesh.deleteMesh=function(e){},r.mesh.makeEdgePair_=function(e){var t=new r.GluHalfEdge,n=new r.GluHalfEdge,i=e.sym.next;return n.next=i,i.sym.next=t,t.next=e,e.sym.next=n,t.sym=n,t.oNext=t,t.lNext=n,n.sym=t,n.oNext=n,n.lNext=t,t},r.mesh.splice_=function(e,t){var n=e.oNext,r=t.oNext;n.sym.lNext=t,r.sym.lNext=e,e.oNext=r,t.oNext=n},r.mesh.makeVertex_=function(e,t){var n=t.prev,i=new r.GluVertex(t,n);n.next=i,t.prev=i,i.anEdge=e;var s=e;do s.org=i,s=s.oNext;while(s!==e)},r.mesh.makeFace_=function(e,t){var n=t.prev,i=new r.GluFace(t,n);n.next=i,t.prev=i,i.anEdge=e,i.inside=t.inside;var s=e;do s.lFace=i,s=s.lNext;while(s!==e)},r.mesh.killEdge_=function(e){var t=e.next,n=e.sym.next;t.sym.next=n,n.sym.next=t},r.mesh.killVertex_=function(e,t){var n=e.anEdge,r=n;do r.org=t,r=r.oNext;while(r!==n);var i=e.prev,s=e.next;s.prev=i,i.next=s},r.mesh.killFace_=function(e,t){var n=e.anEdge,r=n;do r.lFace=t,r=r.lNext;while(r!==n);var i=e.prev,s=e.next;s.prev=i,i.next=s},r.normal={},r.normal.S_UNIT_X_=1,r.normal.S_UNIT_Y_=0,r.normal.projectPolygon=function(e){var t=!1,n=[e.normal[0],e.normal[1],e.normal[2]];n[0]===0&&n[1]===0&&n[2]===0&&(r.normal.computeNormal_(e,n),t=!0);var i=e.sUnit,s=e.tUnit,o=r.normal.longAxis_(n);if(r.TRUE_PROJECT){r.normal.normalize_(n),i[o]=0,i[(o+1)%3]=r.normal.S_UNIT_X_,i[(o+2)%3]=r.normal.S_UNIT_Y_;var u=r.normal.dot_(i,n);i[0]-=u*n[0],i[1]-=u*n[1],i[2]-=u*n[2],r.normal.normalize_(i),s[0]=n[1]*i[2]-n[2]*i[1],s[1]=n[2]*i[0]-n[0]*i[2],s[2]=n[0]*i[1]-n[1]*i[0],r.normal.normalize_(s)}else i[o]=0,i[(o+1)%3]=r.normal.S_UNIT_X_,i[(o+2)%3]=r.normal.S_UNIT_Y_,s[o]=0,s[(o+1)%3]=n[o]>0?-r.normal.S_UNIT_Y_:r.normal.S_UNIT_Y_,s[(o+2)%3]=n[o]>0?r.normal.S_UNIT_X_:-r.normal.S_UNIT_X_;var a=e.mesh.vHead;for(var f=a.next;f!==a;f=f.next)f.s=r.normal.dot_(f.coords,i),f.t=r.normal.dot_(f.coords,s);t&&r.normal.checkOrientation_(e)},r.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},r.normal.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},r.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},r.normal.computeNormal_=function(e,t){var n=[-2*r.GLU_TESS_MAX_COORD,-2*r.GLU_TESS_MAX_COORD,-2*r.GLU_TESS_MAX_COORD],i=[2*r.GLU_TESS_MAX_COORD,2*r.GLU_TESS_MAX_COORD,2*r.GLU_TESS_MAX_COORD],s=[],o=[],u,a=e.mesh.vHead;for(u=a.next;u!==a;u=u.next)for(var f=0;f<3;++f){var l=u.coords[f];l<i[f]&&(i[f]=l,o[f]=u),l>n[f]&&(n[f]=l,s[f]=u)}var c=0;n[1]-i[1]>n[0]-i[0]&&(c=1),n[2]-i[2]>n[c]-i[c]&&(c=2);if(i[c]>=n[c]){t[0]=0,t[1]=0,t[2]=1;return}var h=0,p=o[c],d=s[c],v=[0,0,0],m=[p.coords[0]-d.coords[0],p.coords[1]-d.coords[1],p.coords[2]-d.coords[2]],g=[0,0,0];for(u=a.next;u!==a;u=u.next){g[0]=u.coords[0]-d.coords[0],g[1]=u.coords[1]-d.coords[1],g[2]=u.coords[2]-d.coords[2],v[0]=m[1]*g[2]-m[2]*g[1],v[1]=m[2]*g[0]-m[0]*g[2],v[2]=m[0]*g[1]-m[1]*g[0];var y=v[0]*v[0]+v[1]*v[1]+v[2]*v[2];y>h&&(h=y,t[0]=v[0],t[1]=v[1],t[2]=v[2])}h<=0&&(t[0]=t[1]=t[2]=0,t[r.normal.longAxis_(m)]=1)},r.normal.checkOrientation_=function(e){var t=0,n=e.mesh.fHead;for(var r=n.next;r!==n;r=r.next){var i=r.anEdge;if(i.winding<=0)continue;do t+=(i.org.s-i.dst().s)*(i.org.t+i.dst().t),i=i.lNext;while(i!==r.anEdge)}if(t<0){var s=e.mesh.vHead;for(var o=s.next;o!==s;o=o.next)o.t=-o.t;e.tUnit[0]=-e.tUnit[0],e.tUnit[1]=-e.tUnit[1],e.tUnit[2]=-e.tUnit[2]}},r.render={},r.render.renderMesh=function(e,t,n){var i=!1,s=-1;for(var o=t.fHead.prev;o!==t.fHead;o=o.prev)if(o.inside){i||(e.callBeginOrBeginData(r.primitiveType.GL_TRIANGLES),i=!0);var u=o.anEdge;do{if(n){var a=u.rFace().inside?0:1;s!==a&&(s=a,e.callEdgeFlagOrEdgeFlagData(!!s))}e.callVertexOrVertexData(u.org.data),u=u.lNext}while(u!==o.anEdge)}i&&e.callEndOrEndData()},r.render.renderBoundary=function(e,t){for(var n=t.fHead.next;n!==t.fHead;n=n.next)if(n.inside){e.callBeginOrBeginData(r.primitiveType.GL_LINE_LOOP);var i=n.anEdge;do e.callVertexOrVertexData(i.org.data),i=i.lNext;while(i!==n.anEdge);e.callEndOrEndData()}},r.sweep={},r.sweep.SENTINEL_COORD_=4*r.GLU_TESS_MAX_COORD,r.sweep.TOLERANCE_NONZERO_=!1,r.sweep.computeInterior=function(e){e.fatalError=!1,r.sweep.removeDegenerateEdges_(e),r.sweep.initPriorityQ_(e),r.sweep.initEdgeDict_(e);var t;while((t=e.pq.extractMin())!==null){for(;;){var n=e.pq.minimum();if(n===null||!r.geom.vertEq(n,t))break;n=e.pq.extractMin(),r.sweep.spliceMergeVertices_(e,t.anEdge,n.anEdge)}r.sweep.sweepEvent_(e,t)}var i=e.dict.getMin().getKey();e.event=i.eUp.org,r.sweep.doneEdgeDict_(e),r.sweep.donePriorityQ_(e),r.sweep.removeDegenerateFaces_(e.mesh),e.mesh.checkMesh()},r.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},r.sweep.edgeLeq_=function(e,t,n){var i=e.event,s=t.eUp,o=n.eUp;if(s.dst()===i)return o.dst()===i?r.geom.vertLeq(s.org,o.org)?r.geom.edgeSign(o.dst(),s.org,o.org)<=0:r.geom.edgeSign(s.dst(),o.org,s.org)>=0:r.geom.edgeSign(o.dst(),i,o.org)<=0;if(o.dst()===i)return r.geom.edgeSign(s.dst(),i,s.org)>=0;var u=r.geom.edgeEval(s.dst(),i,s.org),a=r.geom.edgeEval(o.dst(),i,o.org);return u>=a},r.sweep.deleteRegion_=function(e,t){t.fixUpperEdge,t.eUp.activeRegion=null,e.dict.deleteNode(t.nodeUp),t.nodeUp=null},r.sweep.fixUpperEdge_=function(e,t){r.mesh.deleteEdge(e.eUp),e.fixUpperEdge=!1,e.eUp=t,t.activeRegion=e},r.sweep.topLeftRegion_=function(e){var t=e.eUp.org;do e=e.regionAbove();while(e.eUp.org===t);if(e.fixUpperEdge){var n=r.mesh.connect(e.regionBelow().eUp.sym,e.eUp.lNext);r.sweep.fixUpperEdge_(e,n),e=e.regionAbove()}return e},r.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do e=e.regionAbove();while(e.eUp.dst()===t);return e},r.sweep.addRegionBelow_=function(e,t,n){var i=new r.ActiveRegion;return i.eUp=n,i.nodeUp=e.dict.insertBefore(t.nodeUp,i),n.activeRegion=i,i},r.sweep.isWindingInside_=function(e,t){switch(e.windingRule){case r.windingRule.GLU_TESS_WINDING_ODD:return(t&1)!==0;case r.windingRule.GLU_TESS_WINDING_NONZERO:return t!==0;case r.windingRule.GLU_TESS_WINDING_POSITIVE:return t>0;case r.windingRule.GLU_TESS_WINDING_NEGATIVE:return t<0;case r.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return t>=2||t<=-2}return!1},r.sweep.computeWinding_=function(e,t){t.windingNumber=t.regionAbove().windingNumber+t.eUp.winding,t.inside=r.sweep.isWindingInside_(e,t.windingNumber)},r.sweep.finishRegion_=function(e,t){var n=t.eUp,i=n.lFace;i.inside=t.inside,i.anEdge=n,r.sweep.deleteRegion_(e,t)},r.sweep.finishLeftRegions_=function(e,t,n){var i=t,s=t.eUp;while(i!==n){i.fixUpperEdge=!1;var o=i.regionBelow(),u=o.eUp;if(u.org!==s.org){if(!o.fixUpperEdge){r.sweep.finishRegion_(e,i);break}u=r.mesh.connect(s.lPrev(),u.sym),r.sweep.fixUpperEdge_(o,u)}s.oNext!==u&&(r.mesh.meshSplice(u.oPrev(),u),r.mesh.meshSplice(s,u)),r.sweep.finishRegion_(e,i),s=o.eUp,i=o}return s},r.sweep.addRightEdges_=function(e,t,n,i,s,o){var u=!0,a=n;do r.sweep.addRegionBelow_(e,t,a.sym),a=a.oNext;while(a!==i);s===null&&(s=t.regionBelow().eUp.rPrev());var f=t,l=s,c;for(;;){c=f.regionBelow(),a=c.eUp.sym;if(a.org!==l.org)break;a.oNext!==l&&(r.mesh.meshSplice(a.oPrev(),a),r.mesh.meshSplice(l.oPrev(),a)),c.windingNumber=f.windingNumber-a.winding,c.inside=r.sweep.isWindingInside_(e,c.windingNumber),f.dirty=!0,!u&&r.sweep.checkForRightSplice_(e,f)&&(r.sweep.addWinding_(a,l),r.sweep.deleteRegion_(e,f),r.mesh.deleteEdge(l)),u=!1,f=c,l=a}f.dirty=!0,o&&r.sweep.walkDirtyRegions_(e,f)},r.sweep.callCombine_=function(e,t,n,i,s){var o=[t.coords[0],t.coords[1],t.coords[2]];t.data=null,t.data=e.callCombineOrCombineData(o,n,i),t.data===null&&(s?e.fatalError||(e.callErrorOrErrorData(r.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),e.fatalError=!0):t.data=n[0])},r.sweep.spliceMergeVertices_=function(e,t,n){var i=[null,null,null,null],s=[.5,.5,0,0];i[0]=t.org.data,i[1]=n.org.data,r.sweep.callCombine_(e,t.org,i,s,!1),r.mesh.meshSplice(t,n)},r.sweep.vertexWeights_=function(e,t,n,i,s){var o=r.geom.vertL1dist(t,e),u=r.geom.vertL1dist(n,e),a=s,f=s+1;i[a]=.5*u/(o+u),i[f]=.5*o/(o+u),e.coords[0]+=i[a]*t.coords[0]+i[f]*n.coords[0],e.coords[1]+=i[a]*t.coords[1]+i[f]*n.coords[1],e.coords[2]+=i[a]*t.coords[2]+i[f]*n.coords[2]},r.sweep.getIntersectData_=function(e,t,n,i,s,o){var u=[0,0,0,0],a=[n.data,i.data,s.data,o.data];t.coords[0]=t.coords[1]=t.coords[2]=0,r.sweep.vertexWeights_(t,n,i,u,0),r.sweep.vertexWeights_(t,s,o,u,2),r.sweep.callCombine_(e,t,a,u,!0)},r.sweep.checkForRightSplice_=function(e,t){var n=t.regionBelow(),i=t.eUp,s=n.eUp;if(r.geom.vertLeq(i.org,s.org)){if(r.geom.edgeSign(s.dst(),i.org,s.org)>0)return!1;r.geom.vertEq(i.org,s.org)?i.org!==s.org&&(e.pq.remove(i.org.pqHandle),r.sweep.spliceMergeVertices_(e,s.oPrev(),i)):(r.mesh.splitEdge(s.sym),r.mesh.meshSplice(i,s.oPrev()),t.dirty=n.dirty=!0)}else{if(r.geom.edgeSign(i.dst(),s.org,i.org)<0)return!1;t.regionAbove().dirty=t.dirty=!0,r.mesh.splitEdge(i.sym),r.mesh.meshSplice(s.oPrev(),i)}return!0},r.sweep.checkForLeftSplice_=function(e,t){var n=t.regionBelow(),i=t.eUp,s=n.eUp,o;if(r.geom.vertLeq(i.dst(),s.dst())){if(r.geom.edgeSign(i.dst(),s.dst(),i.org)<0)return!1;t.regionAbove().dirty=t.dirty=!0,o=r.mesh.splitEdge(i),r.mesh.meshSplice(s.sym,o),o.lFace.inside=t.inside}else{if(r.geom.edgeSign(s.dst(),i.dst(),s.org)>0)return!1;t.dirty=n.dirty=!0,o=r.mesh.splitEdge(s),r.mesh.meshSplice(i.lNext,s.sym),o.rFace().inside=t.inside}return!0},r.sweep.checkForIntersect_=function(e,t){var n=t.regionBelow(),i=t.eUp,s=n.eUp,o=i.org,u=s.org,a=i.dst(),f=s.dst(),l=new r.GluVertex;if(o===u)return!1;var c=Math.min(o.t,a.t),h=Math.max(u.t,f.t);if(c>h)return!1;if(r.geom.vertLeq(o,u)){if(r.geom.edgeSign(f,o,u)>0)return!1}else if(r.geom.edgeSign(a,u,o)<0)return!1;r.geom.edgeIntersect(a,o,f,u,l),r.geom.vertLeq(l,e.event)&&(l.s=e.event.s,l.t=e.event.t);var p=r.geom.vertLeq(o,u)?o:u;r.geom.vertLeq(p,l)&&(l.s=p.s,l.t=p.t);if(r.geom.vertEq(l,o)||r.geom.vertEq(l,u))return r.sweep.checkForRightSplice_(e,t),!1;if(!r.geom.vertEq(a,e.event)&&r.geom.edgeSign(a,e.event,l)>=0||!r.geom.vertEq(f,e.event)&&r.geom.edgeSign(f,e.event,l)<=0){if(f===e.event)return r.mesh.splitEdge(i.sym),r.mesh.meshSplice(s.sym,i),t=r.sweep.topLeftRegion_(t),i=t.regionBelow().eUp,r.sweep.finishLeftRegions_(e,t.regionBelow(),n),r.sweep.addRightEdges_(e,t,i.oPrev(),i,i,!0),!0;if(a===e.event){r.mesh.splitEdge(s.sym),r.mesh.meshSplice(i.lNext,s.oPrev()),n=t,t=r.sweep.topRightRegion_(t);var d=t.regionBelow().eUp.rPrev();return n.eUp=s.oPrev(),s=r.sweep.finishLeftRegions_(e,n,null),r.sweep.addRightEdges_(e,t,s.oNext,i.rPrev(),d,!0),!0}return r.geom.edgeSign(a,e.event,l)>=0&&(t.regionAbove().dirty=t.dirty=!0,r.mesh.splitEdge(i.sym),i.org.s=e.event.s,i.org.t=e.event.t),r.geom.edgeSign(f,e.event,l)<=0&&(t.dirty=n.dirty=!0,r.mesh.splitEdge(s.sym),s.org.s=e.event.s,s.org.t=e.event.t),!1}return r.mesh.splitEdge(i.sym),r.mesh.splitEdge(s.sym),r.mesh.meshSplice(s.oPrev(),i),i.org.s=l.s,i.org.t=l.t,i.org.pqHandle=e.pq.insert(i.org),r.sweep.getIntersectData_(e,i.org,o,a,u,f),t.regionAbove().dirty=t.dirty=n.dirty=!0,!1},r.sweep.walkDirtyRegions_=function(e,t){var n=t.regionBelow();for(;;){while(n.dirty)t=n,n=n.regionBelow();if(!t.dirty){n=t,t=t.regionAbove();if(t===null||!t.dirty)return}t.dirty=!1;var i=t.eUp,s=n.eUp;i.dst()!==s.dst()&&r.sweep.checkForLeftSplice_(e,t)&&(n.fixUpperEdge?(r.sweep.deleteRegion_(e,n),r.mesh.deleteEdge(s),n=t.regionBelow(),s=n.eUp):t.fixUpperEdge&&(r.sweep.deleteRegion_(e,t),r.mesh.deleteEdge(i),t=n.regionAbove(),i=t.eUp));if(i.org!==s.org)if(i.dst()!==s.dst()&&!t.fixUpperEdge&&!n.fixUpperEdge&&(i.dst()===e.event||s.dst()===e.event)){if(r.sweep.checkForIntersect_(e,t))return}else r.sweep.checkForRightSplice_(e,t);i.org===s.org&&i.dst()===s.dst()&&(r.sweep.addWinding_(s,i),r.sweep.deleteRegion_(e,t),r.mesh.deleteEdge(i),t=n.regionAbove())}},r.sweep.connectRightVertex_=function(e,t,n){var i=n.oNext,s=t.regionBelow(),o=t.eUp,u=s.eUp,a=!1;o.dst()!==u.dst()&&r.sweep.checkForIntersect_(e,t),r.geom.vertEq(o.org,e.event)&&(r.mesh.meshSplice(i.oPrev(),o),t=r.sweep.topLeftRegion_(t),i=t.regionBelow().eUp,r.sweep.finishLeftRegions_(e,t.regionBelow(),s),a=!0),r.geom.vertEq(u.org,e.event)&&(r.mesh.meshSplice(n,u.oPrev()),n=r.sweep.finishLeftRegions_(e,s,null),a=!0);if(a){r.sweep.addRightEdges_(e,t,n.oNext,i,i,!0);return}var f;r.geom.vertLeq(u.org,o.org)?f=u.oPrev():f=o,f=r.mesh.connect(n.lPrev(),f),r.sweep.addRightEdges_(e,t,f,f.oNext,f.oNext,!1),f.sym.activeRegion.fixUpperEdge=!0,r.sweep.walkDirtyRegions_(e,t)},r.sweep.connectLeftDegenerate_=function(e,t,n){var i=t.eUp;if(r.geom.vertEq(i.org,n)){r.sweep.TOLERANCE_NONZERO_&&r.sweep.spliceMergeVertices_(e,i,n.anEdge);return}if(!r.geom.vertEq(i.dst(),n)){r.mesh.splitEdge(i.sym),t.fixUpperEdge&&(r.mesh.deleteEdge(i.oNext),t.fixUpperEdge=!1),r.mesh.meshSplice(n.anEdge,i),r.sweep.sweepEvent_(e,n);return}if(r.sweep.TOLERANCE_NONZERO_){t=r.sweep.topRightRegion_(t);var s=t.regionBelow(),o=s.eUp.sym,u=o.oNext,a=u;s.fixUpperEdge&&(r.sweep.deleteRegion_(e,s),r.mesh.deleteEdge(o),o=u.oPrev()),r.mesh.meshSplice(n.anEdge,o),r.geom.edgeGoesLeft(u)||(u=null),r.sweep.addRightEdges_(e,t,o.oNext,a,u,!0)}},r.sweep.connectLeftVertex_=function(e,t){var n=new r.ActiveRegion;n.eUp=t.anEdge.sym;var i=e.dict.search(n).getKey(),s=i.regionBelow(),o=i.eUp,u=s.eUp;if(r.geom.edgeSign(o.dst(),t,o.org)===0){r.sweep.connectLeftDegenerate_(e,i,t);return}var a=r.geom.vertLeq(u.dst(),o.dst())?i:s,f;if(i.inside||a.fixUpperEdge){if(a===i)f=r.mesh.connect(t.anEdge.sym,o.lNext);else{var l=r.mesh.connect(u.dNext(),t.anEdge);f=l.sym}a.fixUpperEdge?r.sweep.fixUpperEdge_(a,f):r.sweep.computeWinding_(e,r.sweep.addRegionBelow_(e,i,f)),r.sweep.sweepEvent_(e,t)}else r.sweep.addRightEdges_(e,i,t.anEdge,t.anEdge,null,!0)},r.sweep.sweepEvent_=function(e,t){e.event=t;var n=t.anEdge;while(n.activeRegion===null){n=n.oNext;if(n===t.anEdge){r.sweep.connectLeftVertex_(e,t);return}}var i=r.sweep.topLeftRegion_(n.activeRegion),s=i.regionBelow(),o=s.eUp,u=r.sweep.finishLeftRegions_(e,s,null);u.oNext===o?r.sweep.connectRightVertex_(e,i,u):r.sweep.addRightEdges_(e,i,u.oNext,o,o,!0)},r.sweep.addSentinel_=function(e,t){var n=new r.ActiveRegion,i=r.mesh.makeEdge(e.mesh);i.org.s=r.sweep.SENTINEL_COORD_,i.org.t=t,i.dst().s=-r.sweep.SENTINEL_COORD_,i.dst().t=t,e.event=i.dst(),n.eUp=i,n.windingNumber=0,n.inside=!1,n.fixUpperEdge=!1,n.sentinel=!0,n.dirty=!1,n.nodeUp=e.dict.insert(n)},r.sweep.initEdgeDict_=function(e){e.dict=new r.Dict(e,r.sweep.edgeLeq_),r.sweep.addSentinel_(e,-r.sweep.SENTINEL_COORD_),r.sweep.addSentinel_(e,r.sweep.SENTINEL_COORD_)},r.sweep.doneEdgeDict_=function(e){var t=0,n;while((n=e.dict.getMin().getKey())!==null)!n.sentinel,r.sweep.deleteRegion_(e,n);e.dict=null},r.sweep.removeDegenerateEdges_=function(e){var t=e.mesh.eHead,n;for(var i=t.next;i!==t;i=n){n=i.next;var s=i.lNext;r.geom.vertEq(i.org,i.dst())&&i.lNext.lNext!==i&&(r.sweep.spliceMergeVertices_(e,s,i),r.mesh.deleteEdge(i),i=s,s=i.lNext);if(s.lNext===i){if(s!==i){if(s===n||s===n.sym)n=n.next;r.mesh.deleteEdge(s)}if(i===n||i===n.sym)n=n.next;r.mesh.deleteEdge(i)}}},r.sweep.initPriorityQ_=function(e){var t=new r.PriorityQ(r.geom.vertLeq);e.pq=t;var n=e.mesh.vHead,i;for(i=n.next;i!==n;i=i.next)i.pqHandle=t.insert(i);t.init()},r.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},r.sweep.removeDegenerateFaces_=function(e){var t;for(var n=e.fHead.next;n!==e.fHead;n=t){t=n.next;var i=n.anEdge;i.lNext.lNext===i&&(r.sweep.addWinding_(i.oNext,i),r.mesh.deleteEdge(i))}},r.tessmono={},r.tessmono.tessellateMonoRegion_=function(e){var t=e.anEdge;for(;r.geom.vertLeq(t.dst(),t.org);t=t.lPrev());for(;r.geom.vertLeq(t.org,t.dst());t=t.lNext);var n=t.lPrev(),i;while(t.lNext!==n)if(r.geom.vertLeq(t.dst(),n.org)){while(n.lNext!==t&&(r.geom.edgeGoesLeft(n.lNext)||r.geom.edgeSign(n.org,n.dst(),n.lNext.dst())<=0))i=r.mesh.connect(n.lNext,n),n=i.sym;n=n.lPrev()}else{while(n.lNext!==t&&(r.geom.edgeGoesRight(t.lPrev())||r.geom.edgeSign(t.dst(),t.org,t.lPrev().org)>=0))i=r.mesh.connect(t,t.lPrev()),t=i.sym;t=t.lNext}while(n.lNext.lNext!==t)i=r.mesh.connect(n.lNext,n),n=i.sym},r.tessmono.tessellateInterior=function(e){var t;for(var n=e.fHead.next;n!==e.fHead;n=t)t=n.next,n.inside&&r.tessmono.tessellateMonoRegion_(n)},r.tessmono.discardExterior=function(e){var t;for(var n=e.fHead.next;n!==e.fHead;n=t)t=n.next,n.inside||r.mesh.zapFace(n)},r.tessmono.setWindingNumber=function(e,t,n){var i;for(var s=e.eHead.next;s!==e.eHead;s=i)i=s.next,s.rFace().inside!==s.lFace.inside?s.winding=s.lFace.inside?t:-t:n?r.mesh.deleteEdge(s):s.winding=0},r.Dict=function(e,t){this.head_=new r.DictNode,this.frame_=e,this.leq_=t},r.Dict.prototype.deleteDict_=function(){},r.Dict.prototype.insertBefore=function(e,t){do e=e.prev;while(e.key!==null&&!this.leq_(this.frame_,e.key,t));var n=new r.DictNode(t,e.next,e);return e.next.prev=n,e.next=n,n},r.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},r.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},r.Dict.prototype.search=function(e){var t=this.head_;do t=t.next;while(t.key!==null&&!this.leq_(this.frame_,e,t.key));return t},r.Dict.prototype.getMin=function(){return this.head_.next},r.Dict.prototype.getMax=function(){return this.head_.prev},r.DictNode=function(e,t,n){this.key=e||null,this.next=t||this,this.prev=n||this},r.DictNode.prototype.getKey=function(){return this.key},r.DictNode.prototype.getSuccessor=function(){return this.next},r.DictNode.prototype.getPredecessor=function(){return this.prev},r.CachedVertex=function(){this.coords=[0,0,0],this.data=null},r.GluTesselator=function(){this.state=r.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.callError_=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.relTolerance=r.GLU_TESS_DEFAULT_TOLERANCE,this.windingRule=r.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.callCombine_=null,this.boundaryOnly=!1,this.callBegin_=null,this.callEdgeFlag_=null,this.callVertex_=null,this.callEnd_=null,this.callMesh_=null,this.callBeginData_=null,this.callEdgeFlagData_=null,this.callVertexData_=null,this.callEndData_=null,this.callErrorData_=null,this.callCombineData_=null,this.polygonData_=null,this.emptyCache=!1,this.cacheCount=0,this.cache=new Array(r.TESS_MAX_CACHE);for(var e=0;e<r.TESS_MAX_CACHE;e++)this.cache[e]=new r.CachedVertex},r.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},r.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(r.GluTesselator.tessState_.T_DORMANT)},r.GluTesselator.prototype.gluTessProperty=function(e,t){switch(e){case r.gluEnum.GLU_TESS_TOLERANCE:if(t<0||t>1)break;this.relTolerance=t;return;case r.gluEnum.GLU_TESS_WINDING_RULE:var n=t;switch(n){case r.windingRule.GLU_TESS_WINDING_ODD:case r.windingRule.GLU_TESS_WINDING_NONZERO:case r.windingRule.GLU_TESS_WINDING_POSITIVE:case r.windingRule.GLU_TESS_WINDING_NEGATIVE:case r.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:this.windingRule=n;return;default:}break;case r.gluEnum.GLU_TESS_BOUNDARY_ONLY:this.boundaryOnly=!!t;return;default:this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_ENUM);return}this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_VALUE)},r.GluTesselator.prototype.gluGetTessProperty=function(e){switch(e){case r.gluEnum.GLU_TESS_TOLERANCE:return this.relTolerance;case r.gluEnum.GLU_TESS_WINDING_RULE:var t=this.windingRule;return t;case r.gluEnum.GLU_TESS_BOUNDARY_ONLY:return this.boundaryOnly;default:this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_ENUM)}return!1},r.GluTesselator.prototype.gluTessNormal=function(e,t,n){this.normal[0]=e,this.normal[1]=t,this.normal[2]=n},r.GluTesselator.prototype.gluTessCallback=function(e,t){var n=t?t:null;switch(e){case r.gluEnum.GLU_TESS_BEGIN:this.callBegin_=n;return;case r.gluEnum.GLU_TESS_BEGIN_DATA:this.callBeginData_=n;return;case r.gluEnum.GLU_TESS_EDGE_FLAG:this.callEdgeFlag_=n;return;case r.gluEnum.GLU_TESS_EDGE_FLAG_DATA:this.callEdgeFlagData_=n;return;case r.gluEnum.GLU_TESS_VERTEX:this.callVertex_=n;return;case r.gluEnum.GLU_TESS_VERTEX_DATA:this.callVertexData_=n;return;case r.gluEnum.GLU_TESS_END:this.callEnd_=n;return;case r.gluEnum.GLU_TESS_END_DATA:this.callEndData_=n;return;case r.gluEnum.GLU_TESS_ERROR:this.callError_=n;return;case r.gluEnum.GLU_TESS_ERROR_DATA:this.callErrorData_=n;return;case r.gluEnum.GLU_TESS_COMBINE:this.callCombine_=n;return;case r.gluEnum.GLU_TESS_COMBINE_DATA:this.callCombineData_=n;return;case r.gluEnum.GLU_TESS_MESH:this.callMesh_=n;return;default:this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_ENUM);return}},r.GluTesselator.prototype.gluTessVertex=function(e,t){var n=!1,i=[0,0,0];this.requireState_(r.GluTesselator.tessState_.T_IN_CONTOUR),this.emptyCache&&(this.emptyCache_(),this.lastEdge_=null);for(var s=0;s<3;++s){var o=e[s];o<-r.GLU_TESS_MAX_COORD&&(o=-r.GLU_TESS_MAX_COORD,n=!0),o>r.GLU_TESS_MAX_COORD&&(o=r.GLU_TESS_MAX_COORD,n=!0),i[s]=o}n&&this.callErrorOrErrorData(r.errorType.GLU_TESS_COORD_TOO_LARGE);if(this.mesh===null){if(this.cacheCount<r.TESS_MAX_CACHE){this.cacheVertex_(i,t);return}this.emptyCache_()}this.addVertex_(i,t)},r.GluTesselator.prototype.gluTessBeginPolygon=function(e){this.requireState_(r.GluTesselator.tessState_.T_DORMANT),this.state=r.GluTesselator.tessState_.T_IN_POLYGON,this.cacheCount=0,this.emptyCache=!1,this.mesh=null,this.polygonData_=e},r.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(r.GluTesselator.tessState_.T_IN_POLYGON),this.state=r.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null,this.cacheCount>0&&(this.emptyCache=!0)},r.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(r.GluTesselator.tessState_.T_IN_CONTOUR),this.state=r.GluTesselator.tessState_.T_IN_POLYGON},r.GluTesselator.prototype.gluTessEndPolygon=function(){this.requireState_(r.GluTesselator.tessState_.T_IN_POLYGON),this.state=r.GluTesselator.tessState_.T_DORMANT,this.mesh===null&&this.emptyCache_(),r.normal.projectPolygon(this),r.sweep.computeInterior(this);if(!this.fatalError){var e=this.mesh;this.boundaryOnly?r.tessmono.setWindingNumber(e,1,!0):r.tessmono.tessellateInterior(e),this.mesh.checkMesh();if(this.callBegin_||this.callEnd_||this.callVertex_||this.callEdgeFlag_||this.callBeginData_||this.callEndData_||this.callVertexData_||this.callEdgeFlagData_)if(this.boundaryOnly)r.render.renderBoundary(this,this.mesh);else{var t=!!this.callEdgeFlag_||!!this.callEdgeFlagData_;r.render.renderMesh(this,this.mesh,t)}if(this.callMesh_){r.tessmono.discardExterior(this.mesh),this.callMesh_(this.mesh),this.mesh=null,this.polygonData_=null;return}}r.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},r.GluTesselator.prototype.makeDormant_=function(){this.mesh&&r.mesh.deleteMesh(this.mesh),this.state=r.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null},r.GluTesselator.prototype.requireState_=function(e){this.state!==e&&this.gotoState_(e)},r.GluTesselator.prototype.gotoState_=function(e){while(this.state!==e)if(this.state<e)switch(this.state){case r.GluTesselator.tessState_.T_DORMANT:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case r.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state){case r.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case r.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_END_POLYGON),this.makeDormant_()}},r.GluTesselator.prototype.addVertex_=function(e,t){var n=this.lastEdge_;n===null?(n=r.mesh.makeEdge(this.mesh),r.mesh.meshSplice(n,n.sym)):(r.mesh.splitEdge(n),n=n.lNext),n.org.data=t,n.org.coords[0]=e[0],n.org.coords[1]=e[1],n.org.coords[2]=e[2],n.winding=1,n.sym.winding=-1,this.lastEdge_=n},r.GluTesselator.prototype.cacheVertex_=function(e,t){var n=this.cache[this.cacheCount];n.data=t,n.coords[0]=e[0],n.coords[1]=e[1],n.coords[2]=e[2],++this.cacheCount},r.GluTesselator.prototype.emptyCache_=function(){this.mesh=new r.GluMesh;for(var e=0;e<this.cacheCount;e++){var t=this.cache[e];this.addVertex_(t.coords,t.data)}this.cacheCount=0,this.emptyCache=!1},r.GluTesselator.prototype.callBeginOrBeginData=function(e){this.callBeginData_?this.callBeginData_(e,this.polygonData_):this.callBegin_&&this.callBegin_(e)},r.GluTesselator.prototype.callVertexOrVertexData=function(e){this.callVertexData_?this.callVertexData_(e,this.polygonData_):this.callVertex_&&this.callVertex_(e)},r.GluTesselator.prototype.callEdgeFlagOrEdgeFlagData=function(e){this.callEdgeFlagData_?this.callEdgeFlagData_(e,this.polygonData_):this.callEdgeFlag_&&this.callEdgeFlag_(e)},r.GluTesselator.prototype.callEndOrEndData=function(){this.callEndData_?this.callEndData_(this.polygonData_):this.callEnd_&&this.callEnd_()},r.GluTesselator.prototype.callCombineOrCombineData=function(e,t,n){var r;return this.callCombineData_?r=this.callCombineData_(e,t,n,this.polygonData_):this.callCombine_&&(r=this.callCombine_(e,t,n)),r===undefined&&(r=null),r},r.GluTesselator.prototype.callErrorOrErrorData=function(e){this.callErrorData_?this.callErrorData_(e,this.polygonData_):this.callError_&&this.callError_(e)},r.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.inside=!1},r.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},r.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},r.GluHalfEdge.prototype.dst=function(){return this.sym.org},r.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},r.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},r.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},r.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},r.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},r.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},r.GluMesh=function(){this.vHead=new r.GluVertex,this.fHead=new r.GluFace,this.eHead=new r.GluHalfEdge,this.eHeadSym=new r.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},r.GluMesh.prototype.checkMesh=function(){if(!r.DEBUG)return;var e=this.fHead,t=this.vHead,n=this.eHead,i,s,o=e;for(o=e;(s=o.next)!==e;o=s){i=s.anEdge;do i=i.lNext;while(i!==s.anEdge)}var u,a=t;for(a=t;(u=a.next)!==t;a=u){i=u.anEdge;do i=i.oNext;while(i!==u.anEdge)}var f=n;for(f=n;(i=f.next)!==n;f=i);},r.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=null},r.PQHandleElem=function(){this.key=null,this.node=0},r.PQHandleElem.realloc=function(e,t){var n=new Array(t),i=0;if(e!==null)for(;i<e.length;i++)n[i]=e[i];for(;i<t;i++)n[i]=new r.PQHandleElem;return n},r.PQNode=function(){this.handle=0},r.PQNode.realloc=function(e,t){var n=new Array(t),i=0;if(e!==null)for(;i<e.length;i++)n[i]=e[i];for(;i<t;i++)n[i]=new r.PQNode;return n},r.PriorityQ=function(e){this.keys_=r.PriorityQ.prototype.PQKeyRealloc_(null,r.PriorityQ.INIT_SIZE_),this.order_=null,this.size_=0,this.max_=r.PriorityQ.INIT_SIZE_,this.initialized_=!1,this.leq_=e,this.heap_=new r.PriorityQHeap(this.leq_)},r.PriorityQ.INIT_SIZE_=32,r.PriorityQ.prototype.deleteQ=function(){this.heap_.deleteHeap(),this.heap_=null,this.order_=null,this.keys_=null},r.PriorityQ.prototype.init=function(){this.order_=[];for(var e=0;e<this.size_;e++)this.order_[e]=e;var t=function(e,t){return function(n,r){return t(e[n],e[r])?1:-1}}(this.keys_,this.leq_);this.order_.sort(t),this.max_=this.size_,this.initialized_=!0,this.heap_.init();if(r.DEBUG){var n=0,i=n+this.size_-1;for(e=n;e<i;++e);}},r.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_;return++this.size_>=this.max_&&(this.max_*=2,this.keys_=r.PriorityQ.prototype.PQKeyRealloc_(this.keys_,this.max_)),this.keys_[t]=e,-(t+1)},r.PriorityQ.prototype.PQKeyRealloc_=function(e,t){var n=new Array(t),r=0;if(e!==null)for(;r<e.length;r++)n[r]=e[r];for(;r<t;r++)n[r]=null;return n},r.PriorityQ.prototype.keyLessThan_=function(e,t){var n=this.keys_[e],r=this.keys_[t];return!this.leq_(r,n)},r.PriorityQ.prototype.keyGreaterThan_=function(e,t){var n=this.keys_[e],r=this.keys_[t];return!this.leq_(n,r)},r.PriorityQ.prototype.extractMin=function(){if(this.size_===0)return this.heap_.extractMin();var e=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var t=this.heap_.minimum();if(this.leq_(t,e))return this.heap_.extractMin()}do--this.size_;while(this.size_>0&&this.keys_[this.order_[this.size_-1]]===null);return e},r.PriorityQ.prototype.minimum=function(){if(this.size_===0)return this.heap_.minimum();var e=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var t=this.heap_.minimum();if(this.leq_(t,e))return t}return e},r.PriorityQ.prototype.isEmpty_=function(){return this.size_===0&&this.heap_.isEmpty()},r.PriorityQ.prototype.remove=function(e){if(e>=0){this.heap_.remove(e);return}e=-(e+1),this.keys_[e]=null;while(this.size_>0&&this.keys_[this.order_[this.size_-1]]===null)--this.size_},r.PriorityQHeap=function(e){this.nodes_=r.PQNode.realloc(null,r.PriorityQHeap.INIT_SIZE_+1),this.handles_=r.PQHandleElem.realloc(null,r.PriorityQHeap.INIT_SIZE_+1),this.size_=0,this.max_=r.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.leq_=e,this.nodes_[1].handle=1},r.PriorityQHeap.INIT_SIZE_=32,r.PriorityQHeap.prototype.deleteHeap=function(){this.handles_=null,this.nodes_=null},r.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},r.PriorityQHeap.prototype.insert=function(e){var t=++this.size_;t*2>this.max_&&(this.max_*=2,this.nodes_=r.PQNode.realloc(this.nodes_,this.max_+1),this.handles_=r.PQHandleElem.realloc(this.handles_,this.max_+1));var n;return this.freeList_===0?n=t:(n=this.freeList_,this.freeList_=this.handles_[n].node),this.nodes_[t].handle=n,this.handles_[n].node=t,this.handles_[n].key=e,this.initialized_&&this.floatUp_(t),n},r.PriorityQHeap.prototype.isEmpty=function(){return this.size_===0},r.PriorityQHeap.prototype.minimum=function(){return this.handles_[this.nodes_[1].handle].key},r.PriorityQHeap.prototype.extractMin=function(){var e=this.nodes_,t=this.handles_,n=e[1].handle,r=t[n].key;return this.size_>0&&(e[1].handle=e[this.size_].handle,t[e[1].handle].node=1,t[n].key=null,t[n].node=this.freeList_,this.freeList_=n,--this.size_>0&&this.floatDown_(1)),r},r.PriorityQHeap.prototype.remove=function(e){var t=this.nodes_,n=this.handles_,r=n[e].node;t[r].handle=t[this.size_].handle,n[t[r].handle].node=r,r<=--this.size_&&(r<=1||this.leq_(n[t[r>>1].handle].key,n[t[r].handle].key)?this.floatDown_(r):this.floatUp_(r)),n[e].key=null,n[e].node=this.freeList_,this.freeList_=e},r.PriorityQHeap.prototype.floatDown_=function(e){var t=this.nodes_,n=this.handles_,r=t[e].handle;for(;;){var i=e<<1;i<this.size_&&this.leq_(n[t[i+1].handle].key,n[t[i].handle].key)&&++i;var s=t[i].handle;if(i>this.size_||this.leq_(n[r].key,n[s].key)){t[e].handle=r,n[r].node=e;break}t[e].handle=s,n[s].node=e,e=i}},r.PriorityQHeap.prototype.floatUp_=function(e){var t=this.nodes_,n=this.handles_,r=t[e].handle;for(;;){var i=e>>1,s=t[i].handle;if(i===0||this.leq_(n[s].key,n[r].key)){t[e].handle=r,n[r].node=e;break}t[e].handle=s,n[s].node=e,e=i}},r.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},r.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},r.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},typeof module!="undefined"&&(module.exports=r),n("util/libtess",function(){}),n("shapes/Polygon",["../shapes/AbstractShape","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../util/ImageSource","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../shapes/SurfacePolygon","../geom/Vec2","../geom/Vec3","../util/libtess"],function(e,t,n,i,s,o,u,a,f,l,c,h,p,d,v,m){"use strict";var g=function(n,r){if(!n)throw new t(a.logMessage(a.LEVEL_SEVERE,"Polygon","constructor","missingBoundaries"));e.call(this,r),n.length>0&&n[0].latitude&&(n=[n],this._boundariesSpecifiedSimply=!0),this._boundaries=n,this._textureCoordinates=null,this.referencePosition=this.determineReferencePosition(this._boundaries),this._extrude=!1,this.scratchPoint=new v(0,0,0)};return g.prototype=Object.create(e.prototype),Object.defineProperties(g.prototype,{boundaries:{get:function(){return this._boundariesSpecifiedSimply?this._boundaries[0]:this._boundaries},set:function(e){if(!e)throw new t(a.logMessage(a.LEVEL_SEVERE,"Polygon","boundaries","missingBoundaries"));e.length>0&&e[0].latitude&&(e=[e],this._boundariesSpecifiedSimply=!0),this._boundaries=e,this.referencePosition=this.determineReferencePosition(this._boundaries),this.reset()}},textureCoordinates:{get:function(){return this._textureCoordinates},set:function(e){this._textureCoordinates=e,this.reset()}},extrude:{get:function(){return this._extrude},set:function(e){this._extrude=e,this.reset()}}}),g.prototype.determineReferencePosition=function(e){return e.length>0&&e[0].length>2?e[0][0]:null},g.prototype.mustGenerateGeometry=function(e){return this.currentData.boundaryPoints?this.currentData.drawInterior!==this.activeAttributes.drawInterior?!0:this.altitudeMode===WorldWind.ABSOLUTE?!1:this.currentData.isExpired:!0},g.prototype.hasCapTexture=function(){return this.textureCoordinates&&this.capImageSource()},g.prototype.capImageSource=function(){return this.activeAttributes.imageSource?typeof this.activeAttributes.imageSource=="string"||this.activeAttributes.imageSource instanceof o?this.activeAttributes.imageSource:Array.isArray(this.activeAttributes.imageSource)&&this.activeAttributes.imageSource[0]&&(typeof this.activeAttributes.imageSource[0]=="string"||this.activeAttributes.imageSource instanceof o)?this.activeAttributes.imageSource[0]:null:null},g.prototype.hasSideTextures=function(){return this.activeAttributes.imageSource&&Array.isArray(this.activeAttributes.imageSource)&&this.activeAttributes.imageSource.length>1},g.prototype.sideImageSource=function(e){if(e===0||this.activeAttributes.imageSource.length===2)return this.activeAttributes.imageSource[1];var t=this.activeAttributes.imageSource.length-1;return e=Math.min(e+1,t),this.activeAttributes.imageSource[e]},g.prototype.createSurfaceShape=function(){return new p(this.boundaries,null)},g.prototype.doMakeOrderedRenderable=function(e){if(!this.referencePosition)return null;if(!this.activeAttributes.drawInterior&&!this.activeAttributes.drawOutline)return null;if(!this.mustGenerateGeometry(e))return this;var t=this.currentData,n=t.referencePoint;e.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude,this._altitudeMode,n),t.transformationMatrix.setToTranslation(n[0],n[1],n[2]);var r=[];for(var s=0;s<this._boundaries.length;s++)r[s]=this._boundaries[s].slice(0),r[s].push(this._boundaries[s][0]);var o=this.computeBoundaryPoints(e,r);if(this.activeAttributes.drawInterior){var u=this.tessellatePolygon(e,o);if(u){t.capTriangles=new Float32Array(u.length);for(var a=0,f=u.length;a<f;a++)t.capTriangles[a]=u[a]}}t.boundaryPoints=o,t.drawInterior=this.activeAttributes.drawInterior,this.resetExpiration(t),t.refreshBuffers=!0,t.extent||(t.extent=new i);if(o.length===1)t.extent.setToPoints(o[0]);else{var l=[];for(s=0;s<o.length;s++)for(var c=0;c<o[s].length;c++)l.push(o[s][c]);t.extent.setToPoints(l)}return t.extent.translate(t.referencePoint),this},g.prototype.computeBoundaryPoints=function(e,t){var n=Number.MAX_VALUE,r=e.navigatorState.eyePoint,i=[],s=this._extrude?6:3,o=new v(0,0,0),u,a,f,l;for(var c=0;c<t.length;c++){u=(this._extrude?2:1)*t[c].length,i[c]=new Float32Array(u*3);for(var h=0,p=t[c].length;h<p;h++)a=t[c][h],e.surfacePointForMode(a.latitude,a.longitude,a.altitude,this.altitudeMode,o),l=o.distanceToSquared(r),l<n&&(n=l),o.subtract(this.currentData.referencePoint),f=s*h,i[c][f]=o[0],i[c][f+1]=o[1],i[c][f+2]=o[2],this._extrude&&(e.surfacePointForMode(a.latitude,a.longitude,0,WorldWind.CLAMP_TO_GROUND,o),l=o.distanceToSquared(r),l<n&&(n=l),o.subtract(this.currentData.referencePoint),i[c][f+3]=o[0],i[c][f+4]=o[1],i[c][f+5]=o[2])}return this.currentData.eyeDistance=Math.sqrt(n),i},g.prototype.tessellatePolygon=function(e,t){var n=[],i=0,s=this._extrude?6:3,o=this.hasCapTexture(),u,f;this.polygonTessellator||(this.polygonTessellator=new r.GluTesselator,this.polygonTessellator.gluTessCallback(r.gluEnum.GLU_TESS_VERTEX_DATA,function(e,t){t[t.length]=e[0],t[t.length]=e[1],t[t.length]=e[2],o&&(t[t.length]=e[3],t[t.length]=e[4])}),this.polygonTessellator.gluTessCallback(r.gluEnum.GLU_TESS_COMBINE,function(e,t,n){var r=[e[0],e[1],e[2]];if(o)for(var i=3;i<=4;i++){var s=0;for(var u=0;u<4;u++)n[u]>0&&(s+=n[u]*t[u][i]);r[i]=s}return r}),this.polygonTessellator.gluTessCallback(r.gluEnum.GLU_TESS_ERROR,function(e){i=e,a.logMessage(a.LEVEL_WARNING,"Polygon","tessellatePolygon","Tessellation error "+e+".")})),f=v.computeBufferNormal(t[0],s),f||(f=new v(0,0,0),e.globe.surfaceNormalAtLocation(this.referencePosition.latitude,this.referencePosition.longitude,f)),this.polygonTessellator.gluTessNormal(f[0],f[1],f[2]),this.currentData.capNormal=f,this.polygonTessellator.gluTessBeginPolygon(n);for(var l=0;l<t.length;l++){var c=0;this.polygonTessellator.gluTessBeginContour();var h=t[l];for(var p=0;p<h.length;p+=s)u=[h[p],h[p+1],h[p+2]],o&&(c<this.textureCoordinates[l].length?(u[3]=this.textureCoordinates[l][c][0],u[4]=this.textureCoordinates[l][c][1]):(u[3]=this.textureCoordinates[l][0][0],u[4]=this.textureCoordinates[l][1][1]),++c),this.polygonTessellator.gluTessVertex(u,u);this.polygonTessellator.gluTessEndContour()}return this.polygonTessellator.gluTessEndPolygon(),i===0?n:null},g.prototype.mustDrawVerticals=function(e){return this._extrude&&this.activeAttributes.drawOutline&&this.activeAttributes.drawVerticals&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND},g.prototype.doRenderOrdered=function(e){var t=this.currentData,n;e.pickingMode&&(n=e.uniquePickColor()),this.activeAttributes.drawInterior&&t.capTriangles&&t.capTriangles.length>0&&this.drawCap(e,n),this._extrude&&this.activeAttributes.drawInterior&&this.drawSides(e,n),this.activeAttributes.drawOutline&&this.drawOutline(e,n),t.refreshBuffers=!1;if(e.pickingMode){var r=new l(n,this.pickDelegate?this.pickDelegate:this,null,e.currentLayer,!1);e.resolvePick(r)}},g.prototype.drawCap=function(e,t){var n=e.currentGlContext,r=e.currentProgram,i=this.currentData,s=i.refreshBuffers,o=!!this.hasCapTexture(),u=this.activeAttributes.applyLighting,a=i.capTriangles.length/(o?5:3),f,l,c,h,p,d;r.loadTextureEnabled(n,!1),this.applyMvpMatrix(e),i.capVboCacheKey||(i.capVboCacheKey=e.gpuResourceCache.generateCacheKey()),f=e.gpuResourceCache.resourceForKey(i.capVboCacheKey),f||(f=n.createBuffer(),e.gpuResourceCache.putResource(i.capVboCacheKey,f,i.capTriangles.length*4),s=!0),n.bindBuffer(n.ARRAY_BUFFER,f),s&&(d=u?this.makeCapBufferWithNormals():i.capTriangles,n.bufferData(n.ARRAY_BUFFER,d,n.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1)),c=this.activeAttributes.interiorColor,l=c.alpha*e.currentLayer.opacity,n.depthMask(l>=1||e.pickingMode),r.loadColor(n,e.pickingMode?t:c),r.loadOpacity(n,e.pickingMode?l>0?1:0:l),h=12+(o?8:0)+(u?12:0),o&&!e.pickingMode&&(this.activeTexture=e.gpuResourceCache.resourceForKey(this.capImageSource()),this.activeTexture||(this.activeTexture=e.gpuResourceCache.retrieveTexture(e.currentGlContext,this.capImageSource())),p=this.activeTexture&&this.activeTexture.bind(e),p&&(r.loadTextureEnabled(n,!0),n.enableVertexAttribArray(r.vertexTexCoordLocation),n.vertexAttribPointer(r.vertexTexCoordLocation,2,n.FLOAT,!1,h,12),r.loadTextureUnit(n,n.TEXTURE0),r.loadModulateColor(n,e.pickingMode))),u&&!e.pickingMode&&(r.loadApplyLighting(n,!0),n.enableVertexAttribArray(r.normalVectorLocation),n.vertexAttribPointer(r.normalVectorLocation,3,n.FLOAT,!1,h,h-12)),n.vertexAttribPointer(r.vertexPointLocation,3,n.FLOAT,!1,h,0),n.drawArrays(n.TRIANGLES,0,a)},g.prototype.makeCapBufferWithNormals=function(){var e=this.currentData,t=e.capNormal,n=this.hasCapTexture()?5:3,r=n+3,i=e.capTriangles.length/n,s=e.capTriangles,o=new Float32Array(i*r),u=0;for(var a=0;a<i;a++){for(var f=0;f<n;f++)o[u++]=s[a*n+f];o[u++]=t[0],o[u++]=t[1],o[u++]=t[2]}return o},g.prototype.drawSides=function(e,t){var n=e.currentGlContext,r=e.currentProgram,i=this.currentData,s=i.refreshBuffers,o=this.hasSideTextures(),u=this.activeAttributes.applyLighting,a=3+(o?2:0)+(u?3:0),f=4*a,l,c,h,p,d,v;v=0;for(var m=0;m<i.boundaryPoints.length;m++)v+=i.boundaryPoints[m].length/6-1;i.sidesVboCacheKey||(i.sidesVboCacheKey=e.gpuResourceCache.generateCacheKey()),l=e.gpuResourceCache.resourceForKey(i.sidesVboCacheKey),!l||s?(d=this.makeSidesBuffer(v),i.numSideVertices=d.length/a,l||(l=n.createBuffer()),e.gpuResourceCache.putResource(i.sidesVboCacheKey,l,d.length*4),n.bindBuffer(n.ARRAY_BUFFER,l),n.bufferData(n.ARRAY_BUFFER,d,n.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1)):n.bindBuffer(n.ARRAY_BUFFER,l),h=this.activeAttributes.interiorColor,c=h.alpha*e.currentLayer.opacity,n.depthMask(c>=1||e.pickingMode),r.loadColor(n,e.pickingMode?t:h),r.loadOpacity(n,e.pickingMode?c>0?1:0:c);if(o&&!e.pickingMode){this.activeTexture=e.gpuResourceCache.resourceForKey(this.capImageSource()),this.activeTexture||(this.activeTexture=e.gpuResourceCache.retrieveTexture(e.currentGlContext,this.capImageSource())),u?(r.loadApplyLighting(n,!0),n.enableVertexAttribArray(r.normalVectorLocation)):r.loadApplyLighting(n,!1);for(var g=0;g<v;g++){var y=this.sideImageSource(g),b=e.gpuResourceCache.resourceForKey(y),w=g*6*f;y&&!b&&(b=e.gpuResourceCache.retrieveTexture(e.currentGlContext,y)),p=b&&b.bind(e),p?(r.loadTextureEnabled(n,!0),r.loadTextureUnit(n,n.TEXTURE0),n.enableVertexAttribArray(r.vertexTexCoordLocation),n.vertexAttribPointer(r.vertexTexCoordLocation,2,n.FLOAT,!1,f,w+12)):(r.loadTextureEnabled(n,!1),n.disableVertexAttribArray(r.vertexTexCoordLocation)),u&&n.vertexAttribPointer(r.normalVectorLocation,3,n.FLOAT,!1,f,w+20),n.vertexAttribPointer(r.vertexPointLocation,3,n.FLOAT,!1,f,w),n.drawArrays(n.TRIANGLES,0,6)}}else r.loadTextureEnabled(n,!1),u&&!e.pickingMode?(r.loadApplyLighting(n,!0),n.enableVertexAttribArray(r.normalVectorLocation),n.vertexAttribPointer(r.normalVectorLocation,3,n.FLOAT,!1,f,f-12)):r.loadApplyLighting(n,!1),n.vertexAttribPointer(r.vertexPointLocation,3,n.FLOAT,!1,f,0),n.drawArrays(n.TRIANGLES,0,i.numSideVertices)},g.prototype.makeSidesBuffer=function(e){var t=this.currentData,n=this.hasSideTextures(),r=this.activeAttributes.applyLighting,i=3+(n?2:0)+(r?3:0),s,o,u,a,f,l,c,h,p,m,g;u=e*2*3*i,s=new Float32Array(u),o=0,a=new v(0,0,0),f=new v(0,0,0),l=new v(0,0,0),c=new v(0,0,0),n?(h=new d(0,1),p=new d(0,0),m=new d(1,1),g=new d(1,0)):h=p=m=g=null;for(var y=0;y<t.boundaryPoints.length;y++){var b=t.boundaryPoints[y],w;for(var E=0;E<b.length-6;E+=6)a[0]=b[E],a[1]=b[E+1],a[2]=b[E+2],f[0]=b[E+3],f[1]=b[E+4],f[2]=b[E+5],l[0]=b[E+6],l[1]=b[E+7],l[2]=b[E+8],c[0]=b[E+9],c[1]=b[E+10],c[2]=b[E+11],w=r?v.computeTriangleNormal(a,f,l):null,this.addVertexToBuffer(a,h,w,s,o),o+=i,this.addVertexToBuffer(f,p,w,s,o),o+=i,this.addVertexToBuffer(l,m,w,s,o),o+=i,this.addVertexToBuffer(f,p,w,s,o),o+=i,this.addVertexToBuffer(c,g,w,s,o),o+=i,this.addVertexToBuffer(l,m,w,s,o),o+=i}return s},g.prototype.addVertexToBuffer=function(e,t,n,r,i){r[i++]=e[0],r[i++]=e[1],r[i++]=e[2],t&&(r[i++]=t[0],r[i++]=t[1]),n&&(r[i++]=n[0],r[i++]=n[1],r[i]=n[2])},g.prototype.drawOutline=function(e,t){var n=e.currentGlContext,r=e.currentProgram,i=this.currentData,s=i.refreshBuffers,o,u,a,f,l,c,h;r.loadTextureEnabled(n,!1),r.loadApplyLighting(n,!1),this.hasCapTexture()&&n.disableVertexAttribArray(r.vertexTexCoordLocation),this.activeAttributes.applyLighting&&n.disableVertexAttribArray(r.normalVectorLocation),i.boundaryVboCacheKeys||(this.currentData.boundaryVboCacheKeys=[]),this.applyMvpMatrixForOutline(e),r.loadTextureEnabled(n,!1),n.disableVertexAttribArray(r.vertexTexCoordLocation);for(var p=0;p<i.boundaryPoints.length;p++)o=i.boundaryPoints[p].length/3,i.boundaryVboCacheKeys[p]||(i.boundaryVboCacheKeys[p]=e.gpuResourceCache.generateCacheKey()),u=e.gpuResourceCache.resourceForKey(i.boundaryVboCacheKeys[p]),u||(u=n.createBuffer(),e.gpuResourceCache.putResource(i.boundaryVboCacheKeys[p],u,o*12),s=!0),n.bindBuffer(n.ARRAY_BUFFER,u),s&&(n.bufferData(n.ARRAY_BUFFER,i.boundaryPoints[p],n.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1)),f=this.activeAttributes.outlineColor,a=f.alpha*e.currentLayer.opacity,n.depthMask(a>=1||e.pickingMode),r.loadColor(n,e.pickingMode?t:f),r.loadOpacity(n,e.pickingMode?1:a),n.lineWidth(this.activeAttributes.outlineWidth),this._extrude?(l=24,c=o/2):(l=12,c=o),n.vertexAttribPointer(r.vertexPointLocation,3,n.FLOAT,!1,l,0),n.drawArrays(n.LINE_STRIP,0,c),this.mustDrawVerticals(e)&&(n.vertexAttribPointer(r.vertexPointLocation,3,n.FLOAT,!1,0,0),n.drawArrays(n.LINES,0,o-2))},g.prototype.beginDrawing=function(e){var t=e.currentGlContext;this.activeAttributes.drawInterior&&t.disable(t.CULL_FACE),e.findAndBindProgram(n),t.enableVertexAttribArray(e.currentProgram.vertexPointLocation);var r=!e.pickMode&&this.activeAttributes.applyLighting;r&&e.currentProgram.loadModelviewInverse(t,e.navigatorState.modelviewNormalTransform)},g.prototype.endDrawing=function(e){var t=e.currentGlContext;t.disableVertexAttribArray(e.currentProgram.vertexPointLocation),t.disableVertexAttribArray(e.currentProgram.normalVectorLocation),t.depthMask(!0),t.lineWidth(1),t.enable(t.CULL_FACE)},g}),n("shapes/SurfacePolyline",["../error/ArgumentError","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape"],function(e,t,n,r){"use strict";var i=function(n,i){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfacePolyline","constructor","The specified locations array is null or undefined."));r.call(this,i),this._boundaries=n,this._isInteriorInhibited=!0};return i.prototype=Object.create(r.prototype),i.staticStateKey=function(e){var t=r.staticStateKey(e);return t},i.prototype.computeStateKey=function(){return i.staticStateKey(this)},i}),n("formats/geojson/GeoJSONParser",["../../error/ArgumentError","../../util/Color","./GeoJSONConstants","./GeoJSONCRS","./GeoJSONFeature","./GeoJSONFeatureCollection","./GeoJSONGeometry","./GeoJSONGeometryCollection","./GeoJSONGeometryLineString","./GeoJSONGeometryMultiLineString","./GeoJSONGeometryMultiPoint","./GeoJSONGeometryMultiPolygon","./GeoJSONGeometryPoint","./GeoJSONGeometryPolygon","../../geom/Location","../../util/Logger","../../shapes/Placemark","../../shapes/PlacemarkAttributes","../../shapes/Polygon","../../geom/Position","../../util/proj4-src","../../layer/RenderableLayer","../../shapes/ShapeAttributes","../../shapes/SurfacePolygon","../../shapes/SurfacePolyline"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T){"use strict";var N=function(t){if(!t)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","constructor","missingUrl"));this._url=t,this._geoJSONObject=null,this._geoJSONType=null,this._crs=null,this._layer=null,this._shapeConfigurationCallback=this.defaultShapeConfigurationCallback,this.defaultPlacemarkAttributes=new g(null),this.defaultShapeAttributes=new S(null),this.setProj4jsAliases()};return Object.defineProperties(N.prototype,{url:{get:function(){return this._url}},geoJSONObject:{get:function(){return this._geoJSONObject}},geoJSONType:{get:function(){return this._geoJSONType}},crs:{get:function(){return this._crs}},layer:{get:function(){return this._layer}},shapeConfigurationCallback:{get:function(){return this._shapeConfigurationCallback}}}),N.prototype.load=function(e,t){e&&(this._shapeConfigurationCallback=e),this._layer=t||new E,this.requestUrl(this.url)},N.prototype.defaultShapeConfigurationCallback=function(e,t){var n={},r=t.name||t.Name||t.NAME;r&&(n.name=r);if(e.isPointType()||e.isMultiPointType())n.attributes=this.defaultPlacemarkAttributes;else if(e.isLineStringType()||e.isMultiLineStringType())n.attributes=this.defaultShapeAttributes;else if(e.isPolygonType()||e.isMultiPolygonType())n.attributes=this.defaultShapeAttributes;return n},N.prototype.requestUrl=function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="text",t.onreadystatechange=function(){t.readyState===4&&(t.status===200?this.parse(t.response):v.log(v.LEVEL_WARNING,"GeoJSON retrieval failed ("+t.statusText+"): "+e))}.bind(this),t.onerror=function(){v.log(v.LEVEL_WARNING,"GeoJSON retrieval failed: "+e)},t.ontimeout=function(){v.log(v.LEVEL_WARNING,"GeoJSON retrieval timed out: "+e)},t.send(null)},N.prototype.parse=function(t){try{this._geoJSONObject=JSON.parse(t)}catch(r){console.log(r)}finally{if(this.geoJSONObject){if(Object.prototype.toString.call(this.geoJSONObject)==="[object Array]")throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","parse","invalidGeoJSONObjectLength"));if(!this.geoJSONObject.hasOwnProperty(n.FIELD_TYPE))throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","parse","missingGeoJSONType"));this.setGeoJSONType(),this.setGeoJSONCRS()}}},N.prototype.setGeoJSONCRS=function(){if(this.geoJSONObject[n.FIELD_CRS]){this._crs=new r(this.geoJSONObject[n.FIELD_CRS][n.FIELD_TYPE],this.geoJSONObject[n.FIELD_CRS][n.FIELD_PROPERTIES]);var e=function(){this.addRenderablesForGeoJSON(this.layer)}.bind(this);this.crs.setCRSString(e)}else this.addRenderablesForGeoJSON(this.layer)},N.prototype.addRenderablesForGeoJSON=function(t){if(!t)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForGeoJSON","missingLayer"));switch(this.geoJSONType){case n.TYPE_FEATURE:var r=new i(this.geoJSONObject[n.FIELD_GEOMETRY],this.geoJSONObject[n.FIELD_PROPERTIES],this.geoJSONObject[n.FIELD_ID],this.geoJSONObject[n.FIELD_BBOX]);this.addRenderablesForFeature(t,r);break;case n.TYPE_FEATURE_COLLECTION:var o=new s(this.geoJSONObject[n.FIELD_FEATURES],this.geoJSONObject[n.FIELD_BBOX]);this.addRenderablesForFeatureCollection(t,o);break;case n.TYPE_GEOMETRY_COLLECTION:var a=new u(this.geoJSONObject[n.FIELD_GEOMETRIES],this.geoJSONObject[n.FIELD_BBOX]);this.addRenderablesForGeometryCollection(t,a,null);break;default:this.addRenderablesForGeometry(t,this.geoJSONObject,null)}},N.prototype.addRenderablesForGeometry=function(t,r,i){if(!t)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForGeometry","missingLayer"));if(!r)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForGeometry","missingGeometry"));switch(r[n.FIELD_TYPE]){case n.TYPE_POINT:var s=new h(r[n.FIELD_COORDINATES],r[n.FIELD_TYPE],r[n.FIELD_BBOX]);this.addRenderablesForPoint(t,s,i?i:null);break;case n.TYPE_MULTI_POINT:var o=new l(r[n.FIELD_COORDINATES],r[n.FIELD_TYPE],r[n.FIELD_BBOX]);this.addRenderablesForMultiPoint(t,o,i?i:null);break;case n.TYPE_LINE_STRING:var u=new a(r[n.FIELD_COORDINATES],r[n.FIELD_TYPE],r[n.FIELD_BBOX]);this.addRenderablesForLineString(t,u,i?i:null);break;case n.TYPE_MULTI_LINE_STRING:var d=new f(r[n.FIELD_COORDINATES],r[n.FIELD_TYPE],r[n.FIELD_BBOX]);this.addRenderablesForMultiLineString(t,d,i?i:null);break;case n.TYPE_POLYGON:var m=new p(r[n.FIELD_COORDINATES],r[n.FIELD_TYPE],r[n.FIELD_BBOX]);this.addRenderablesForPolygon(t,m,i?i:null);break;case n.TYPE_MULTI_POLYGON:var g=new c(r[n.FIELD_COORDINATES],r[n.FIELD_TYPE],r[n.FIELD_BBOX]);this.addRenderablesForMultiPolygon(t,g,i?i:null);break;default:}},N.prototype.addRenderablesForPoint=function(t,n,r){if(!t)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForPoint","missingLayer"));if(!n)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForPoint","missingGeometry"));var i=this.shapeConfigurationCallback(n,r);if(!this.crs||this.crs.isCRSSupported()){var s=n.coordinates[0],o=n.coordinates[1],u=n.coordinates[2]?n.coordinates[2]:0,a=this.getReprojectedIfRequired(o,s,this.crs),f=new b(a[1],a[0],u),l=new m(f,!1,i&&i.attributes?i.attributes:null);l.altitudeMode=WorldWind.RELATIVE_TO_GROUND,i&&i.name&&(l.label=i.name),t.addRenderable(l)}},N.prototype.addRenderablesForMultiPoint=function(t,n,r){if(!t)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiPoint","missingLayer"));if(!n)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiPoint","missingGeometry"));var i=this.shapeConfigurationCallback(n,r);if(!this.crs||this.crs.isCRSSupported())for(var s=0,o=n.coordinates.length;s<o;s+=1){var u=n.coordinates[s][0],a=n.coordinates[s][1],f=n.coordinates[s][2]?n.coordinates[s][2]:0,l=this.getReprojectedIfRequired(a,u,this.crs),c=new b(l[1],l[0],f),h=new m(c,!1,i&&i.attributes?i.attributes:null);h.altitudeMode=WorldWind.RELATIVE_TO_GROUND,i&&i.name&&(h.label=i.name),t.addRenderable(h)}},N.prototype.addRenderablesForLineString=function(t,n,r){if(!t)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForLineString","missingLayer"));if(!n)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForLineString","missingGeometry"));var i=this.shapeConfigurationCallback(n,r);if(!this.crs||this.crs.isCRSSupported()){var s=[];for(var o=0,u=n.coordinates;o<u.length;o++){var a=u[o][0],f=u[o][1],l=this.getReprojectedIfRequired(f,a,this.crs),c=new d(l[1],l[0]);s.push(c)}var h;h=new T(s,i&&i.attributes?i.attributes:null),t.addRenderable(h)}},N.prototype.addRenderablesForMultiLineString=function(t,n,r){if(!t)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiLineString","missingLayer"));if(!n)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiLineString","missingGeometry"));var i=this.shapeConfigurationCallback(n,r);if(!this.crs||this.crs.isCRSSupported())for(var s=0,o=n.coordinates;s<o.length;s++){var u=[];for(var a=0,f=o[s];a<f.length;a++){var l=f[a][0],c=f[a][1],h=this.getReprojectedIfRequired(c,l,this.crs),p=new d(h[1],h[0]);u.push(p)}var m;m=new T(u,i&&i.attributes?i.attributes:null),t.addRenderable(m)}},N.prototype.addRenderablesForPolygon=function(t,n,r){if(!t)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForPolygon","missingLayer"));if(!n)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForPolygon","missingGeometry"));var i=this.shapeConfigurationCallback(n,r);if(!this.crs||this.crs.isCRSSupported())for(var s=0,o=n.coordinates;s<o.length;s++){var u=[];for(var a=0,f=o[s];a<f.length;a++){var l=f[a][0],c=f[a][1],h=this.getReprojectedIfRequired(c,l,this.crs),p=new d(h[1],h[0]);u.push(p)}var m;m=new x(u,i&&i.attributes?i.attributes:null),t.addRenderable(m)}},N.prototype.addRenderablesForMultiPolygon=function(t,n,r){if(!t)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiPolygon","missingLayer"));if(!n)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiPolygon","missingGeometry"));var i=this.shapeConfigurationCallback(n,r);if(!this.crs||this.crs.isCRSSupported())for(var s=0,o=n.coordinates;s<o.length;s++){var u=[];for(var a=0;a<o[s].length;a++){var f=[];for(var l=0,c=o[s][a];l<c.length;l++){var h=c[l][0],p=c[l][1],m=this.getReprojectedIfRequired(p,h,this.crs),g=new d(m[1],m[0]);f.push(g)}u.push(f)}var y;y=new x(u,i&&i.attributes?i.attributes:null),t.addRenderable(y)}},N.prototype.addRenderablesForGeometryCollection=function(t,r,i){if(!t)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForGeometryCollection","missingLayer"));if(!r)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForGeometryCollection","missingGeometryCollection"));for(var s=0,o=r.geometries;s<o.length;s++)o[s].hasOwnProperty(n.FIELD_TYPE)&&this.addRenderablesForGeometry(t,o[s],i)},N.prototype.addRenderablesForFeature=function(t,r){if(!t)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForFeature","missingLayer"));if(!r)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForFeature","missingFeature"));if(r.geometry.type===n.TYPE_GEOMETRY_COLLECTION){var i=new u(r.geometry.geometries,r.bbox);this.addRenderablesForGeometryCollection(t,i,r.properties)}else this.addRenderablesForGeometry(t,r.geometry,r.properties)},N.prototype.addRenderablesForFeatureCollection=function(t,r){if(!t)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForFeatureCollection","missingLayer"));if(!r)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","addRenderablesForFeatureCollection","missingFeatureCollection"));if(r.features.length>0)for(var s=0;s<r.features.length;s++){var o=new i(r.features[s][n.FIELD_GEOMETRY],r.features[s][n.FIELD_PROPERTIES],r.features[s][n.FIELD_ID],r.features[s][n.FIELD_BBOX]);this.addRenderablesForFeature(t,o)}},N.prototype.setGeoJSONType=function(){switch(this.geoJSONObject[n.FIELD_TYPE]){case n.TYPE_POINT:this._geoJSONType=n.TYPE_POINT;break;case n.TYPE_MULTI_POINT:this._geoJSONType=n.TYPE_MULTI_POINT;break;case n.TYPE_LINE_STRING:this._geoJSONType=n.TYPE_LINE_STRING;break;case n.TYPE_MULTI_LINE_STRING:this._geoJSONType=n.TYPE_MULTI_LINE_STRING;break;case n.TYPE_POLYGON:this._geoJSONType=n.TYPE_POLYGON;break;case n.TYPE_MULTI_POLYGON:this._geoJSONType=n.TYPE_MULTI_POLYGON;break;case n.TYPE_GEOMETRY_COLLECTION:this._geoJSONType=n.TYPE_GEOMETRY_COLLECTION;break;case n.TYPE_FEATURE:this._geoJSONType=n.TYPE_FEATURE;break;case n.TYPE_FEATURE_COLLECTION:this._geoJSONType=n.TYPE_FEATURE_COLLECTION;break;default:throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","setGeoJSONType","invalidGeoJSONType"))}},N.prototype.getReprojectedIfRequired=function(t,r,i){if(!t&&t!==0)throw new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","getReprojectedIfRequired","missingLatitude"));if(!r&&r!==0)throw console.log(r),new e(v.logMessage(v.LEVEL_SEVERE,"GeoJSON","getReprojectedIfRequired","missingLongitude"));return!i||i.isDefault()?[r,t]:w(i.projectionString,n.EPSG4326_CRS,[r,t])},N.prototype.setProj4jsAliases=function(){w.defs([["urn:ogc:def:crs:OGC:1.3:CRS84",w.defs("EPSG:4326")],["urn:ogc:def:crs:EPSG::3857",w.defs("EPSG:3857")]])},N}),n("projections/ProjectionEquirectangular",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger","../geom/Vec3"],function(e,t,n,r,i){"use strict";var s=function(){n.call(this,"Equirectangular",!0,null)};return s.prototype=Object.create(n.prototype),Object.defineProperties(s.prototype,{stateKey:{get:function(){return"projection equirectangular "}}}),s.prototype.geographicToCartesian=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesian","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesian","missingResult"));return a[0]=n.equatorialRadius*s*e.DEGREES_TO_RADIANS+(u?u[0]:0),a[1]=n.equatorialRadius*i*e.DEGREES_TO_RADIANS,a[2]=o,a},s.prototype.geographicToCartesianGrid=function(n,s,o,u,a,f,l,c){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","missingGlobe"));if(!s)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","missingSector"));if(!a||a.length<o*u)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!c)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","missingResult"));var h=n.equatorialRadius,p=s.minLatitude*e.DEGREES_TO_RADIANS,d=s.maxLatitude*e.DEGREES_TO_RADIANS,v=s.minLongitude*e.DEGREES_TO_RADIANS,m=s.maxLongitude*e.DEGREES_TO_RADIANS,g=(d-p)/(o>1?o-1:1),y=(m-v)/(u>1?u-1:1),b=f?f:new i(0,0,0),w=l?l[0]:0,E,S,x=0,T=0,N,C,k;for(E=0,N=p;E<o;E++,N+=g){E===o-1&&(N=d),k=h*N-b[1];for(S=0,C=v;S<u;S++,C+=y)S===u-1&&(C=m),c[T++]=h*C-b[0]+w,c[T++]=k,c[T++]=a[x++]-b[2]}return c},s.prototype.cartesianToGeographic=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","cartesianToGeographic","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","cartesianToGeographic","missingResult"));return a.latitude=s/n.equatorialRadius*e.RADIANS_TO_DEGREES,a.longitude=(i-(u?u[0]:0))/n.equatorialRadius*e.RADIANS_TO_DEGREES,a.altitude=o,a},s}),n("globe/ZeroElevationModel",["../error/ArgumentError","../globe/ElevationModel","../geom/Location","../util/Logger","../geom/Sector"],function(e,t,n,r,i){"use strict";var s=function(){t.call(this,i.FULL_SPHERE,new n(45,45),1," "," ",150,150),this.displayName="Zero Elevations",this.timestamp=Date.now(),this.minElevation=0,this.maxElevation=0};return s.prototype=Object.create(t.prototype),s.prototype.minAndMaxElevationsForSector=function(e){return[0,0]},s.prototype.elevationAtLocation=function(e,t){return 0},s.prototype.elevationsForGrid=function(t,n,i,s,o){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"ZeroElevationModel","elevationsForSector","missingSector"));if(n<=0||i<=0)throw new e(r.logMessage(r.LEVEL_SEVERE,"ZeroElevationModel","elevationsForSector","numLat or numLon is less than 1"));if(!o||o.length<n*i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ZeroElevationModel","elevationsForSector","missingArray"));for(var u=0,a=o.length;u<a;u++)o[u]=0;return 0},s}),n("globe/Globe2D",["../globe/Globe","../projections/ProjectionEquirectangular","../globe/ZeroElevationModel"],function(e,t,n){"use strict";var r=function(){e.call(this,new n,new t)};return r.prototype=Object.create(e.prototype),r}),n("util/GoToAnimator",["../geom/Location","../util/Logger","../geom/Position","../geom/Vec3"],function(e,t,n,r){"use strict";var i=function(e){if(!e)throw new ArgumentError(t.logMessage(t.LEVEL_SEVERE,"GoToAnimator","constructor","missingWorldWindow"));this.wwd=e,this.animationFrequency=20,this.travelTime=3e3,this.cancelled=!1};return i.prototype.cancel=function(){this.cancelled=!0},i.prototype.goTo=function(i,s){if(!i)throw new ArgumentError(t.logMessage(t.LEVEL_SEVERE,"GoToAnimator","goTo","missingPosition"));this.completionCallback=s,this.cancelled=!1,this.targetPosition=new n(i.latitude,i.longitude,i.altitude||this.wwd.navigator.range),this.startPosition=new n(this.wwd.navigator.lookAtLocation.latitude,this.wwd.navigator.lookAtLocation.longitude,this.wwd.navigator.range),this.startTime=Date.now();var o=this.travelTime,u=e.greatCircleDistance(this.startPosition,this.targetPosition),a,f=this.wwd.globe.computePointFromLocation(this.startPosition.latitude,this.startPosition.longitude,new r(0,0,0)),l=this.wwd.globe.computePointFromLocation(this.targetPosition.latitude,this.targetPosition.longitude,new r(0,0,0));this.maxAltitude=f.distanceTo(l);var c=this.wwd.navigator.currentState().pixelSizeAtDistance(this.startPosition.altitude)*this.wwd.canvas.clientWidth/this.wwd.globe.equatorialRadius;u<=2*c&&(this.maxAltitude=this.startPosition.altitude),this.maxAltitudeReachedTime=this.maxAltitude<=this.wwd.navigator.range?Date.now():null,this.maxAltitude>this.startPosition.altitude?(a=Math.max(0,this.maxAltitude-this.startPosition.altitude),a+=Math.abs(this.targetPosition.altitude-this.maxAltitude)):a=Math.abs(this.targetPosition.altitude-this.startPosition.altitude);var h=Math.max(u,a/this.wwd.globe.equatorialRadius);if(h===0)return;h<2*c&&(o=Math.min(h/c*this.travelTime,this.travelTime)),o=Math.max(1,o),this.panVelocity=u/o,this.rangeVelocity=a/o;var p=this,d=function(){if(p.cancelled){p.completionCallback&&p.completionCallback(p);return}p.update()?setTimeout(d,p.animationFrequency):p.completionCallback&&p.completionCallback(p)};setTimeout(d,this.animationFrequency)},i.prototype.update=function(){var e=new n(this.wwd.navigator.lookAtLocation.latitude,this.wwd.navigator.lookAtLocation.longitude,this.wwd.navigator.range),t=this.updateRange(e);return t=this.updateLocation(e)||t,this.wwd.redraw(),t},i.prototype.updateRange=function(e){var t=!1,n,r;return this.maxAltitudeReachedTime?(r=Date.now()-this.maxAltitudeReachedTime,this.maxAltitude>this.targetPosition.altitude?(n=this.maxAltitude-this.rangeVelocity*r,n=Math.max(n,this.targetPosition.altitude)):(n=this.maxAltitude+this.rangeVelocity*r,n=Math.min(n,this.targetPosition.altitude)),this.wwd.navigator.range=n,t=Math.abs(this.wwd.navigator.range-this.targetPosition.altitude)>1):(r=Date.now()-this.startTime,n=Math.min(this.startPosition.altitude+this.rangeVelocity*r,this.maxAltitude),Math.abs(this.wwd.navigator.range-n)<1&&(this.maxAltitudeReachedTime=Date.now()),this.wwd.navigator.range=n,t=!0),t},i.prototype.updateLocation=function(t){var n=Date.now()-this.startTime,r=e.greatCircleDistance(this.startPosition,t),i=e.greatCircleDistance(t,this.targetPosition),s=e.greatCircleAzimuth(t,this.targetPosition),o=this.panVelocity*n,u=Math.min(o-r,i),a=e.greatCircleLocation(t,s,u,new e(0,0)),f=!1;return this.wwd.navigator.lookAtLocation.latitude=a.latitude,this.wwd.navigator.lookAtLocation.longitude=a.longitude,u<1/this.wwd.globe.equatorialRadius&&(f=!0),!f},i}),n("util/HighlightController",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"HighlightController","constructor","missingWorldWindow"));this.worldWindow=n;var r=[],i=function(e){var t=e.clientX,i=e.clientY,s=r.length>0;for(var o=0;o<r.length;o++)r[o].highlighted=!1;r=[];var u=n.pick(n.canvasCoordinates(t,i));u.objects.length>0&&(s=!0);if(u.objects.length>0)for(var a=0;a<u.objects.length;a++)u.objects[a].isTerrain||(u.objects[a].userObject.highlighted=!0,r.push(u.objects[a].userObject));s&&n.redraw()};this.worldWindow.addEventListener("mousemove",i);var s=new WorldWind.TapRecognizer(this.worldWindow,i)};return n}),n("layer/LandsatRestLayer",["../error/ArgumentError","../geom/Location","../util/Logger","../geom/Sector","../layer/TiledImageLayer","../util/LevelRowColumnUrlBuilder","../util/WWUtil"],function(e,t,n,r,i,s,o){"use strict";var u=function(e,n,u){var a=o.urlPath(e+"/"+n);i.call(this,r.FULL_SPHERE,new t(36,36),10,"image/png",a,512,512),this.displayName=u,this.pickEnabled=!1,this.urlBuilder=new s(e,n)};return u.prototype=Object.create(i.prototype),u}),n("navigate/Navigator",["../error/ArgumentError","../util/Logger","../geom/Matrix","../navigate/NavigatorState","../geom/Position","../error/UnsupportedOperationError","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u){"use strict";var a=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"Navigator","constructor","missingWorldWindow"));this.worldWindow=n,this.heading=0,this.tilt=0,this.roll=0,this.nearDistance=1,this.farDistance=1e7};return a.prototype.currentState=function(){throw new s(t.logMessage(t.LEVEL_SEVERE,"Navigator","currentState","abstractInvocation"))},a.prototype.currentStateForModelview=function(s){if(!s)throw new e(t.logMessage(t.LEVEL_SEVERE,"Navigator","currentStateForModelview","missingMatrix"));var a=this.worldWindow.globe,f=u.max(a.equatorialRadius,a.polarRadius),l=s.extractEyePoint(new o(0,0,0)),c=a.computePositionFromPoint(l[0],l[1],l[2],new i(0,0,0)),h=this.worldWindow.viewport,p=this.worldWindow.depthBits,d,v,m=n.fromIdentity();return this.farDistance=u.horizonDistanceForGlobeRadius(f,c.altitude),this.farDistance<1e3&&(this.farDistance=1e3),this.nearDistance=u.perspectiveNearDistanceForFarDistance(this.farDistance,10,p),d=c.altitude-a.elevationAtLocation(c.latitude,c.longitude),d>0&&(v=u.perspectiveNearDistance(h.width,h.height,d),this.nearDistance>v&&(this.nearDistance=v)),this.nearDistance<1&&(this.nearDistance=1),m.setToPerspectiveProjection(h.width,h.height,this.nearDistance,this.farDistance),new r(s,m,h,this.heading,this.tilt)},a}),n("gesture/PanRecognizer",["../gesture/GestureRecognizer"],function(e){"use strict";var t=function(t,n){e.call(this,t,n),this.minNumberOfTouches=1,this.maxNumberOfTouches=Number.MAX_VALUE,this.interpretDistance=20};return t.prototype=Object.create(e.prototype),t.prototype.mouseDown=function(e){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},t.prototype.touchMove=function(e){if(this.state==WorldWind.POSSIBLE)this.shouldInterpret()&&(this.shouldRecognize()?this.state=WorldWind.BEGAN:this.state=WorldWind.FAILED);else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.CHANGED},t.prototype.touchEnd=function(e){if(this.touchCount==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.ENDED},t.prototype.touchCancel=function(e){if(this.touchCount==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.CANCELLED},t.prototype.prepareToRecognize=function(){this.translationX=0,this.translationY=0},t.prototype.shouldInterpret=function(){var e=this.translationX,t=this.translationY,n=Math.sqrt(e*e+t*t);return n>this.interpretDistance},t.prototype.shouldRecognize=function(){var e=this.touchCount;return e!=0&&e>=this.minNumberOfTouches&&e<=this.maxNumberOfTouches},t}),n("gesture/PinchRecognizer",["../gesture/GestureRecognizer"],function(e){"use strict";var t=function(t,n){e.call(this,t,n),this._scale=1,this._offsetScale=1,this.referenceDistance=0,this.interpretThreshold=20,this.weight=.4,this.pinchTouches=[]};return t.prototype=Object.create(e.prototype),Object.defineProperties(t.prototype,{scale:{get:function(){return this._scale*this._offsetScale}}}),t.prototype.reset=function(){e.prototype.reset.call(this),this._scale=1,this._offsetScale=1,this.referenceDistance=0,this.pinchTouches=[]},t.prototype.mouseDown=function(e){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},t.prototype.touchStart=function(e){this.pinchTouches.length<2&&this.pinchTouches.push(e)==2&&(this.referenceDistance=this.currentPinchDistance(),this._offsetScale*=this._scale,this._scale=1)},t.prototype.touchMove=function(e){if(this.pinchTouches.length==2)if(this.state==WorldWind.POSSIBLE)this.shouldRecognize()&&(this.state=WorldWind.BEGAN);else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED){var t=this.currentPinchDistance(),n=Math.abs(t/this.referenceDistance),r=this.weight;this._scale=this._scale*(1-r)+n*r,this.state=WorldWind.CHANGED}},t.prototype.touchEnd=function(e){var t=this.pinchTouches.indexOf(e);t!=-1&&this.pinchTouches.splice(t,1);if(this.touchCount==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.ENDED},t.prototype.touchCancel=function(e){var t=this.pinchTouches.indexOf(e);t!=-1&&this.pinchTouches.splice(t,1);if(this.touchCount==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.CANCELLED},t.prototype.prepareToRecognize=function(){this.referenceDistance=this.currentPinchDistance(),this._scale=1},t.prototype.shouldRecognize=function(){var e=this.currentPinchDistance();return Math.abs(e-this.referenceDistance)>this.interpretThreshold},t.prototype.currentPinchDistance=function(){var e=this.pinchTouches[0],t=this.pinchTouches[1],n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(n*n+r*r)},t}),n("gesture/RotationRecognizer",["../geom/Angle","../gesture/GestureRecognizer"],function(e,t){"use strict";var n=function(e,n){t.call(this,e,n),this._rotation=0,this._offsetRotation=0,this.referenceAngle=0,this.interpretThreshold=20,this.weight=.4,this.rotationTouches=[]};return n.prototype=Object.create(t.prototype),Object.defineProperties(n.prototype,{rotation:{get:function(){return this._rotation+this._offsetRotation}}}),n.prototype.reset=function(){t.prototype.reset.call(this),this._rotation=0,this._offsetRotation=0,this.referenceAngle=0,this.rotationTouches=[]},n.prototype.mouseDown=function(e){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},n.prototype.touchStart=function(e){this.rotationTouches.length<2&&this.rotationTouches.push(e)==2&&(this.referenceAngle=this.currentTouchAngle(),this._offsetRotation+=this._rotation,this._rotation=0)},n.prototype.touchMove=function(t){if(this.rotationTouches.length==2)if(this.state==WorldWind.POSSIBLE)this.shouldRecognize()&&(this.state=WorldWind.BEGAN);else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED){var n=this.currentTouchAngle(),r=e.normalizedDegrees(n-this.referenceAngle),i=this.weight;this._rotation=this._rotation*(1-i)+r*i,this.state=WorldWind.CHANGED}},n.prototype.touchEnd=function(e){var t=this.rotationTouches.indexOf(e);t!=-1&&this.rotationTouches.splice(t,1);if(this.touchCount==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.ENDED},n.prototype.touchCancel=function(e){var t=this.rotationTouches.indexOf(e);if(t!=-1){this.rotationTouches.splice(t,1);if(this.touchCount==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.CANCELLED}},n.prototype.prepareToRecognize=function(){this.referenceAngle=this.currentTouchAngle(),this._rotation=0},n.prototype.shouldRecognize=function(){var t=this.currentTouchAngle(),n=e.normalizedDegrees(t-this.referenceAngle);return Math.abs(n)>this.interpretThreshold},n.prototype.currentTouchAngle=function(){var t=this.rotationTouches[0],n=this.rotationTouches[1],r=t.clientX-n.clientX,i=t.clientY-n.clientY;return Math.atan2(i,r)*e.RADIANS_TO_DEGREES},n}),n("gesture/TiltRecognizer",["../gesture/PanRecognizer"],function(e){"use strict";var t=function(t,n){e.call(this,t,n),this.maxTouchDistance=250,this.maxTouchDivergence=50};return t.LEFT=1,t.RIGHT=2,t.UP=4,t.DOWN=8,t.prototype=Object.create(e.prototype),t.prototype.shouldInterpret=function(){for(var e=0,t=this.touchCount;e<t;e++){var n=this.touch(e),r=n.translationX,i=n.translationY,s=Math.sqrt(r*r+i*i);if(s>this.interpretDistance)return!0}return!1},t.prototype.shouldRecognize=function(){var e=this.touchCount;if(e<2)return!1;var n=this.touch(0),r=this.touch(1),i=n.clientX-r.clientX,s=n.clientY-r.clientY,o=Math.sqrt(i*i+s*s);if(o>this.maxTouchDistance)return!1;var u=n.translationX-r.translationX,a=n.translationY-r.translationY,f=Math.sqrt(u*u+a*a);if(f>this.maxTouchDivergence)return!1;var l=t.UP|t.DOWN,c=this.touchDirection(n)&l,h=this.touchDirection(r)&l;return(c&h)!=0},t.prototype.touchDirection=function(e){var n=e.translationX,r=e.translationY,i=0;return Math.abs(n)>Math.abs(r)?(i|=n<0?t.LEFT:0,i|=n>0?t.RIGHT:0):(i|=r<0?t.UP:0,i|=r>0?t.DOWN:0),i},t}),n("navigate/LookAtNavigator",["../geom/Angle","../gesture/DragRecognizer","../geom/Frustum","../gesture/GestureRecognizer","../geom/Line","../geom/Location","../util/Logger","../geom/Matrix","../navigate/Navigator","../gesture/PanRecognizer","../gesture/PinchRecognizer","../geom/Position","../gesture/RotationRecognizer","../gesture/TiltRecognizer","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){"use strict";var g=function(e){function n(e){e.preventDefault()}a.call(this,e),e.addEventListener("mousedown",n),e.addEventListener("touchstart",n),e.addEventListener("contextmenu",n),e.addEventListener("wheel",n),window.PointerEvent&&e.canvas.style.setProperty("touch-action","none"),this.lookAtLocation=new s(30,-110),this.range=1e7,this.enable2DLimits=!0;var r=this;this.primaryDragRecognizer=new t(e,function(e){r.handlePanOrDrag(e)}),this.secondaryDragRecognizer=new t(e,function(e){r.handleSecondaryDrag(e)}),this.secondaryDragRecognizer.button=2,this.panRecognizer=new f(e,function(e){r.handlePanOrDrag(e)}),this.pinchRecognizer=new l(e,function(e){r.handlePinch(e)}),this.rotationRecognizer=new h(e,function(e){r.handleRotation(e)}),this.tiltRecognizer=new p(e,function(e){r.handleTilt(e)}),e.addEventListener("wheel",function(e){r.handleWheelEvent(e)}),this.panRecognizer.recognizeSimultaneouslyWith(this.pinchRecognizer),this.panRecognizer.recognizeSimultaneouslyWith(this.rotationRecognizer),this.pinchRecognizer.recognizeSimultaneouslyWith(this.rotationRecognizer),this.panRecognizer.requireRecognizerToFail(this.tiltRecognizer),this.pinchRecognizer.requireRecognizerToFail(this.tiltRecognizer),this.rotationRecognizer.requireRecognizerToFail(this.tiltRecognizer),this.beginPoint=new d(0,0),this.lastPoint=new d(0,0),this.beginHeading=0,this.beginTilt=0,this.beginRange=0,this.lastRotation=0};return g.prototype=Object.create(a.prototype),g.prototype.currentState=function(){this.applyLimits();var e=this.worldWindow.globe,t=new c(this.lookAtLocation.latitude,this.lookAtLocation.longitude,0),n=u.fromIdentity();return n.multiplyByLookAtModelview(t,this.range,this.heading,this.tilt,this.roll,e),this.currentStateForModelview(n)},g.prototype.handlePanOrDrag=function(e){this.worldWindow.globe.is2D()?this.handlePanOrDrag2D(e):this.handlePanOrDrag3D(e)},g.prototype.handlePanOrDrag3D=function(t){var n=t.state,r=t.translationX,i=t.translationY;if(n==WorldWind.BEGAN)this.lastPoint.set(0,0);else if(n==WorldWind.CHANGED){var s=this.worldWindow.canvas,o=this.worldWindow.globe,u=m.max(o.equatorialRadius,o.polarRadius),a=m.max(1,this.range),f=m.perspectivePixelSize(s.clientWidth,s.clientHeight,a),l=(i-this.lastPoint[1])*f,c=-(r-this.lastPoint[0])*f,h=l/u*e.RADIANS_TO_DEGREES,p=c/u*e.RADIANS_TO_DEGREES,d=Math.sin(this.heading*e.DEGREES_TO_RADIANS),v=Math.cos(this.heading*e.DEGREES_TO_RADIANS);this.lookAtLocation.latitude+=h*v-p*d,this.lookAtLocation.longitude+=h*d+p*v,this.lastPoint.set(r,i),this.applyLimits(),this.worldWindow.redraw()}},g.prototype.handlePanOrDrag2D=function(e){var t=e.state,n=e.clientX,r=e.clientY,i=e.translationX,s=e.translationY;if(t==WorldWind.BEGAN)this.beginPoint.set(n,r),this.lastPoint.set(n,r);else if(t==WorldWind.CHANGED){var o=this.lastPoint[0],a=this.lastPoint[1],f=this.beginPoint[0]+i,l=this.beginPoint[1]+s;this.lastPoint.set(f,l);var c=this.currentState(),h=this.worldWindow.globe,p=c.rayFromScreenPoint(this.worldWindow.canvasCoordinates(o,a)),d=new v(0,0,0),m=new v(0,0,0),g=new v(0,0,0);if(!h.intersectsLine(p,d))return;p=c.rayFromScreenPoint(this.worldWindow.canvasCoordinates(f,l));if(!h.intersectsLine(p,m))return;var y=u.fromIdentity();y.copy(c.modelview),y.multiplyByTranslation(m[0]-d[0],m[1]-d[1],m[2]-d[2]),y.extractEyePoint(p.origin),y.extractForwardVector(p.direction);if(!h.intersectsLine(p,g))return;var b=y.extractViewingParameters(g,this.roll,h,{});this.lookAtLocation.copy(b.origin),this.range=b.range,this.heading=b.heading,this.tilt=b.tilt,this.roll=b.roll,this.applyLimits(),this.worldWindow.redraw()}},g.prototype.handleSecondaryDrag=function(e){var t=e.state,n=e.translationX,r=e.translationY;if(t==WorldWind.BEGAN)this.beginHeading=this.heading,this.beginTilt=this.tilt;else if(t==WorldWind.CHANGED){var i=180*n/this.worldWindow.canvas.clientWidth,s=90*r/this.worldWindow.canvas.clientHeight;this.heading=this.beginHeading+i,this.tilt=this.beginTilt+s,this.applyLimits(),this.worldWindow.redraw()}},g.prototype.handlePinch=function(e){var t=e.state,n=e.scale;t==WorldWind.BEGAN?this.beginRange=this.range:t==WorldWind.CHANGED&&n!=0&&(this.range=this.beginRange/n,this.applyLimits(),this.worldWindow.redraw())},g.prototype.handleRotation=function(e){var t=e.state,n=e.rotation;t==WorldWind.BEGAN?this.lastRotation=0:t==WorldWind.CHANGED&&(this.heading-=n-this.lastRotation,this.lastRotation=n,this.applyLimits(),this.worldWindow.redraw())},g.prototype.handleTilt=function(e){var t=e.state,n=e.translationY;if(t==WorldWind.BEGAN)this.beginTilt=this.tilt;else if(t==WorldWind.CHANGED){var r=-90*n/this.worldWindow.canvas.clientHeight;this.tilt=this.beginTilt+r,this.applyLimits(),this.worldWindow.redraw()}},g.prototype.handleWheelEvent=function(e){var t;e.deltaMode==WheelEvent.DOM_DELTA_PIXEL?t=e.deltaY:e.deltaMode==WheelEvent.DOM_DELTA_LINE?t=e.deltaY*40:e.deltaMode==WheelEvent.DOM_DELTA_PAGE&&(t=e.deltaY*400);var n=1+t/1e3;this.range*=n,this.applyLimits(),this.worldWindow.redraw()},g.prototype.applyLimits=function(){this.lookAtLocation.latitude=m.clamp(this.lookAtLocation.latitude,-90,90),this.lookAtLocation.longitude=e.normalizedDegreesLongitude(this.lookAtLocation.longitude),this.range=m.clamp(this.range,1,Number.MAX_VALUE),this.heading=e.normalizedDegrees(this.heading),this.tilt=m.clamp(this.tilt,0,90),this.roll=e.normalizedDegrees(this.roll);if(this.worldWindow.globe.is2D()&&this.enable2DLimits){var t=2*Math.PI*this.worldWindow.globe.equatorialRadius;this.range=m.clamp(this.range,1,t),this.tilt=0}},g}),n("cache/MemoryCacheListener",["../util/Logger","../error/UnsupportedOperationError"],function(e,t){"use strict";var n=function(){};return n.prototype.entryRemoved=function(n,r){throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCacheListener","entryRemoved","abstractInvocation"))},n.prototype.removalError=function(n,r,i){throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCacheListener","removalError","abstractInvocation"))},n}),n("util/NominatimGeocoder",["../util/Logger"],function(e){"use strict";var t=function(){this.service="http://open.mapquestapi.com/nominatim/v1/search/"};return t.prototype.lookup=function(e,t,n){var r=this.service+e.replace(" ","%20")+"?format=json",i=new XMLHttpRequest,s=this;r+="&key="+(n||"lUvVRchXGGDh5Xwk3oidrXeIDAAevOUS"),i.open("GET",r,!0),i.onreadystatechange=function(){if(i.readyState===4&&i.status===200){var e=JSON.parse(i.responseText);t(s,e)}},i.send(null)},t}),n("layer/OpenStreetMapImageLayer",["../geom/Angle","../util/Color","../geom/Location","../geom/Sector","../layer/MercatorTiledImageLayer"],function(e,t,n,r,i){"use strict";var s=function(e){this.imageSize=256,e=e||"Open Street Map",i.call(this,new r(-85.05,85.05,-180,180),new n(85.05,180),19,"image/png",e,this.imageSize,this.imageSize),this.displayName=e,this.pickEnabled=!1,this.destCanvas=document.createElement("canvas"),this.destContext=this.destCanvas.getContext("2d"),this.urlBuilder={urlForTile:function(e,t){return"http://otile1.mqcdn.com/tiles/1.0.0/osm/"+(e.level.levelNumber+1)+"/"+e.column+"/"+e.row+".png"}}};return s.prototype=Object.create(i.prototype),s.prototype.doRender=function(e){i.prototype.doRender.call(this,e),this.inCurrentFrame&&(e.screenCreditController.addStringCredit("©OpenStreetMap",t.DARK_GRAY),e.screenCreditController.addStringCredit("Tiles Courtesy of MapQuest",t.DARK_GRAY))},s.prototype.createTopLevelTiles=function(e){this.topLevelTiles=[],this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,1)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,1))},s.prototype.mapSizeForLevel=function(e){return 256<<e+1},s}),n("shapes/Path",["../shapes/AbstractShape","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../shapes/SurfacePolyline","../geom/Vec2","../geom/Vec3"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){"use strict";var d=function(n,r){if(!n)throw new t(o.logMessage(o.LEVEL_SEVERE,"Path","constructor","missingPositions"));e.call(this,r),this._positions=n,this._pathType=WorldWind.GREAT_CIRCLE,this._terrainConformance=10,this._numSubSegments=10,this.referencePosition=this.determineReferencePosition(this._positions),this.scratchPoint=new p(0,0,0)};return d.prototype=Object.create(e.prototype),Object.defineProperties(d.prototype,{positions:{get:function(){return this._positions},set:function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Path","constructor","missingPositions"));this._positions=e,this.referencePosition=this.determineReferencePosition(this._positions),this.reset()}},followTerrain:{get:function(){return this._followTerrain},set:function(e){this._followTerrain=e,this.reset()}},terrainConformance:{get:function(){return this._terrainConformance},set:function(e){this._terrainConformance=e,this.reset()}},numSubSegments:{get:function(){return this._numSubSegments},set:function(e){this._numSubSegments=e>=0?e:0,this.reset()}},pathType:{get:function(){return this._pathType},set:function(e){this._pathType=e,this.reset()}},extrude:{get:function(){return this._extrude},set:function(e){this._extrude=e,this.reset()}}}),d.prototype.determineReferencePosition=function(e){return e.length>0?e[0]:null},d.prototype.mustGenerateGeometry=function(e){return this.currentData.tessellatedPoints?this.currentData.drawInterior!==this.activeAttributes.drawInterior||this.currentData.drawVerticals!==this.activeAttributes.drawVerticals?!0:!this.followTerrain&&this.currentData.numSubSegments!==this.numSubSegments?!0:this.followTerrain&&this.currentData.terrainConformance!==this.terrainConformance?!0:this.altitudeMode===WorldWind.ABSOLUTE?!1:this.currentData.isExpired:!0},d.prototype.createSurfaceShape=function(){return new c(this.positions,null)},d.prototype.doMakeOrderedRenderable=function(e){if(!this.referencePosition)return null;if(!this.mustGenerateGeometry(e))return this;var t=this.currentData.referencePoint;e.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude,this._altitudeMode,t),this.currentData.transformationMatrix.setToTranslation(t[0],t[1],t[2]);var n=this.makeTessellatedPositions(e);if(n.length<2)return null;var i=this.computeRenderedPath(e,n);return this.currentData.tessellatedPoints=i,this.currentData.drawInterior=this.activeAttributes.drawInterior,this.currentData.drawVerticals=this.activeAttributes.drawVerticals,this.currentData.numSubSegments=this.numSubSegments,this.currentData.terrainConformance=this.terrainConformance,this.resetExpiration(this.currentData),this.currentData.fillVbo=!0,this.currentData.extent||(this.currentData.extent=new r),this.currentData.extent.setToPoints(i),this.currentData.extent.translate(this.currentData.referencePoint),this},d.prototype.makeTessellatedPositions=function(e){var t=[],n=e.navigatorState,r=this.mustDrawVerticals(e),i=new p(0,0,0),s=new p(0,0,0),o=this._positions[0],u,a,f;r&&(this.currentData.verticalIndices=new Int16Array(this.positions.length*2),this.currentData.verticalIndices[0]=0,this.currentData.verticalIndices[1]=1),t.push(o),e.surfacePointForMode(o.latitude,o.longitude,o.altitude,this._altitudeMode,i);for(var l=1,c=this._positions.length;l<c;l++){u=this._positions[l],e.surfacePointForMode(u.latitude,u.longitude,u.altitude,this._altitudeMode,s),a=n.eyePoint.distanceTo(i),f=n.pixelSizeAtDistance(a),i.distanceTo(s)<f*8&&this.altitudeMode!==WorldWind.ABSOLUTE?t.push(u):this.makeSegment(e,o,u,i,s,t),o=u,i.copy(s);if(r){var h=2*(t.length-1);this.currentData.verticalIndices[l*2]=h,this.currentData.verticalIndices[l*2+1]=h+1}}return t},d.prototype.makeSegment=function(e,t,n,r,i,o){var u=e.navigatorState,a=u.eyePoint,l=new s(0,0),c=0,h,p,d,v,m,g;if(this._pathType===WorldWind.LINEAR&&!this._followTerrain){r.equals(i)||o.push(n);return}this._pathType===WorldWind.LINEAR?d=s.linearDistance(t,n):this._pathType===WorldWind.RHUMB_LINE?d=s.rhumbDistance(t,n):d=s.greatCircleDistance(t,n),this._altitudeMode!==WorldWind.CLAMP_TO_GROUND&&(c=.5*(t.altitude+n.altitude)),h=d*(e.globe.equatorialRadius+c*e.verticalExaggeration);if(h<=0)return;this._pathType===WorldWind.LINEAR?p=s.linearAzimuth(t,n):this._pathType===WorldWind.RHUMB_LINE?p=s.rhumbAzimuth(t,n):p=s.greatCircleAzimuth(t,n),this.scratchPoint.copy(r);for(v=0,m=0;v<1;){this._followTerrain?m+=this._terrainConformance*u.pixelSizeAtDistance(this.scratchPoint.distanceTo(a)):m+=h/this._numSubSegments;if(h<m||h-m<1e-9)break;v=m/h,g=v*d,this._pathType===WorldWind.LINEAR?s.linearLocation(t,p,g,l):this._pathType===WorldWind.RHUMB_LINE?s.rhumbLocation(t,p,g,l):s.greatCircleLocation(t,p,g,l),l.altitude=(1-v)*t.altitude+v*n.altitude,o.push(new f(l.latitude,l.longitude,l.altitude)),this._followTerrain&&e.surfacePointForMode(l.latitude,l.longitude,l.altitude,WorldWind.CLAMP_TO_GROUND,this.scratchPoint)}o.push(n)},d.prototype.computeRenderedPath=function(e,t){var n=this.mustDrawInterior(e)||this.mustDrawVerticals(e),r=Number.MAX_VALUE,i=e.navigatorState.eyePoint,s=(n?2:1)*t.length,o=new Float32Array(s*3),u=n?6:3,a=new p(0,0,0),f,l,c,h;this._followTerrain&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND?f=WorldWind.RELATIVE_TO_GROUND:f=this.altitudeMode;for(var d=0,v=t.length;d<v;d++)l=t[d],e.surfacePointForMode(l.latitude,l.longitude,l.altitude,f,a),h=a.distanceToSquared(i),h<r&&(r=h),a.subtract(this.currentData.referencePoint),c=u*d,o[c]=a[0],o[c+1]=a[1],o[c+2]=a[2],n&&(e.surfacePointForMode(l.latitude,l.longitude,0,WorldWind.CLAMP_TO_GROUND,a),h=a.distanceToSquared(i),h<r&&(r=h),a.subtract(this.currentData.referencePoint),o[c+3]=a[0],o[c+4]=a[1],o[c+5]=a[2]);return this.currentData.pointBufferHasExtrusionPoints=n,this.currentData.eyeDistance=Math.sqrt(r),o},d.prototype.mustDrawInterior=function(e){return this.activeAttributes.drawInterior&&this._extrude&&this._altitudeMode!==WorldWind.CLAMP_TO_GROUND},d.prototype.mustDrawVerticals=function(e){return this.activeAttributes.drawOutline&&this.activeAttributes.drawVerticals&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND},d.prototype.doRenderOrdered=function(e){var t=e.currentGlContext,n=e.currentProgram,r=this.currentData,i=r.tessellatedPoints.length/3,s,o,u,f,l,c;this.applyMvpMatrix(e),r.vboCacheKey||(r.vboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.vboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(this.currentData.vboCacheKey,s,r.tessellatedPoints.length*4),r.fillVbo=!0),t.bindBuffer(t.ARRAY_BUFFER,s),r.fillVbo&&(t.bufferData(t.ARRAY_BUFFER,r.tessellatedPoints,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1)),n.loadTextureEnabled(t,!1),e.pickingMode&&(f=e.uniquePickColor()),this.mustDrawInterior(e)&&(u=this.activeAttributes.interiorColor,o=u.alpha*e.currentLayer.opacity,o<1&&!e.pickingMode&&t.depthMask(!1),n.loadColor(t,e.pickingMode?f:u),n.loadOpacity(t,e.pickingMode?o>0?1:0:o),t.vertexAttribPointer(n.vertexPointLocation,3,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,i)),this.activeAttributes.drawOutline&&((this.mustDrawVerticals(e)&&this.mustDrawInterior(e)||this.altitudeMode===WorldWind.CLAMP_TO_GROUND)&&this.applyMvpMatrixForOutline(e),u=this.activeAttributes.outlineColor,o=u.alpha*e.currentLayer.opacity,o<1&&!e.pickingMode&&t.depthMask(!1),n.loadColor(t,e.pickingMode?f:u),n.loadOpacity(t,e.pickingMode?1:o),t.lineWidth(this.activeAttributes.outlineWidth),this.currentData.pointBufferHasExtrusionPoints?(l=24,c=i/2):(l=12,c=i),t.vertexAttribPointer(n.vertexPointLocation,3,t.FLOAT,!1,l,0),t.drawArrays(t.LINE_STRIP,0,c),this.mustDrawVerticals(e)&&(r.verticalIndicesVboCacheKey||(r.verticalIndicesVboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.verticalIndicesVboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(r.verticalIndicesVboCacheKey,s,r.verticalIndices.length*4),r.fillVbo=!0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),r.fillVbo&&(t.bufferData(t.ELEMENT_ARRAY_BUFFER,r.verticalIndices,t.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1)),t.vertexAttribPointer(n.vertexPointLocation,3,t.FLOAT,!1,0,0),t.drawElements(t.LINES,r.verticalIndices.length,t.UNSIGNED_SHORT,0))),r.fillVbo=!1;if(e.pickingMode){var h=new a(f,this.pickDelegate?this.pickDelegate:this,null,e.currentLayer,!1);e.resolvePick(h)}},d.prototype.beginDrawing=function(e){var t=e.currentGlContext;this.mustDrawInterior(e)&&t.disable(t.CULL_FACE),e.findAndBindProgram(n),t.enableVertexAttribArray(e.currentProgram.vertexPointLocation)},d.prototype.endDrawing=function(e){var t=e.currentGlContext;t.disableVertexAttribArray(e.currentProgram.vertexPointLocation),t.depthMask(!0),t.lineWidth(1),t.enable(t.CULL_FACE)},d}),n("util/PeriodicTimeSequence",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"PeriodicTimeSequence","constructor","missingString"));var i=r.split("/");if(i.length!==3)throw new e(t.logMessage(t.LEVEL_SEVERE,"PeriodicTimeSequence","constructor","The interval string "+r+" does not contain 3 elements."));this.sequenceString=r,this.startTime=new Date(i[0]),this.endTime=new Date(i[1]),this.intervalMilliseconds=this.endTime.getTime()-this.startTime.getTime(),this._currentTime=this.startTime,this.infiniteInterval=this.startTime.getTime()==this.endTime.getTime(),this.period=n.parsePeriodString(i[2],!1)};return Object.defineProperties(n.prototype,{currentTime:{get:function(){return this._currentTime},set:function(e){this._currentTime=e}},scaleForCurrentTime:{get:function(){return this.currentTime?(this.currentTime.getTime()-this.startTime.getTime())/this.intervalMilliseconds:1}}}),n.prototype.next=function(){return this.currentTime?this.currentTime.getTime()>=this.endTime.getTime()&&!this.infiniteInterval?this.currentTime=null:this.currentTime=n.incrementTime(this.currentTime,this.period):this.currentTime=this.startTime,this.currentTime},n.prototype.previous=function(){return this.currentTime?this.currentTime.getTime()===this.startTime.getTime()?this.currentTime=null:this.currentTime=this.getTimeForScale(.9999*this.scaleForCurrentTime):this.currentTime=this.endTime,this.currentTime},n.prototype.reset=function(){this.currentTime=null},n.prototype.getTimeForScale=function(e){if(e<=0)return this.startTime;if(e>=1)return this.endTime;var t=new Date(this.startTime.getTime()),r=t,i=0;for(i=0;i<e;i=(t.getTime()-this.startTime.getTime())/this.intervalMilliseconds)r=t,t=n.incrementTime(t,this.period);return r},n.incrementTime=function(e,t){var r=new Date(e.getTime());return t[0]!=0&&r.setUTCFullYear(r.getUTCFullYear()+t[0]),t[1]!=0&&n.addMonths(r,t[1]),t[2]!=0&&r.setUTCDate(r.getUTCDate()+7*t[2]),t[3]!=0&&r.setUTCDate(r.getUTCDate()+t[3]),t[4]!=0&&r.setUTCHours(r.getUTCHours()+t[4]),t[5]!=0&&r.setUTCMinutes(r.getUTCMinutes()+t[5]),t[6]!=0&&r.setUTCSeconds(r.getUTCSeconds()+t[6]),r},n.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0},n.getDaysInMonth=function(e,t){return[31,n.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},n.addMonths=function(e,t){var r=e.getUTCDate();return e.setUTCDate(1),e.setUTCMonth(e.getUTCMonth()+t),e.setUTCDate(Math.min(r,n.getDaysInMonth(e.getUTCFullYear(),e.getUTCMonth()))),e},n.parsePeriodString=function(n,r){var i=r?r:!1,s=[2,3,4,5,7,8,9],o=[0,0,0,0,0,0,0],u=[0,12,4,7,24,60,60],a;n=n.toUpperCase();if(!n)return o;if(typeof n!="string")throw new e(t.logMessage(t.LEVEL_SEVERE,"PeriodicTimeSequence","parsePeriodString","Invalid ISO8601 period string '"+n+"'"));if(!(a=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(n)))throw new e(t.logMessage(t.LEVEL_SEVERE,"PeriodicTimeSequence","parsePeriodString","String '"+n+"' is not a valid ISO8601 period."));for(var f=0;f<s.length;f++){var l=s[f];o[f]=a[l]?+a[l].replace(/[A-Za-z]+/g,""):0}if(i)for(f=o.length-1;f>0;f--)o[f]>=u[f]&&(o[f-1]=o[f-1]+Math.floor(o[f]/u[f]),o[f]=o[f]%u[f]);return o},n}),n("projections/ProjectionGnomonic",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger","../geom/Sector","../util/WWMath"],function(e,t,n,r,i,s){"use strict";var o=function(e){this.north=e!=="South";var t=this.north?new i(30,90,-180,180):new i(-90,-30,-180,180);n.call(this,"Polar Gnomonic",!1,t),this._pole=e,this.displayName=this.north?"North Gnomonic":"South Gnomonic",this._stateKey="projection polar gnomonic "+this._pole+" "};return o.prototype=Object.create(n.prototype),Object.defineProperties(o.prototype,{pole:{get:function(){return this._pole},set:function(e){this._pole=e,this.north=this._pole!=="South",this.projectionLimits=this.north?new i(30,90,-180,180):new i(-90,-30,-180,180),this._stateKey="projection polar gnomonic "+this._pole+" "}},stateKey:{get:function(){return this._stateKey}}}),o.prototype.geographicToCartesian=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","geographicToCartesian","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","geographicToCartesian","missingResult"));if(this.north&&i===90||!this.north&&i===-90)a[0]=0,a[1]=0,a[2]=o;else{var f=this.north?1:-1,l=n.equatorialRadius/Math.tan(i*e.DEGREES_TO_RADIANS);a[0]=l*Math.sin(s*e.DEGREES_TO_RADIANS)*f,a[1]=l*-Math.cos(s*e.DEGREES_TO_RADIANS),a[2]=o}return a},o.prototype.geographicToCartesianGrid=function(n,i,o,u,a,f,l,c){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","geographicToCartesianGrid","missingGlobe"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","geographicToCartesianGrid","missingSector"));if(!a||a.length<o*u)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!c)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","geographicToCartesianGrid","missingResult"));var h=i.minLatitude*e.DEGREES_TO_RADIANS,p=i.maxLatitude*e.DEGREES_TO_RADIANS,d=i.minLongitude*e.DEGREES_TO_RADIANS,v=i.maxLongitude*e.DEGREES_TO_RADIANS,m=(p-h)/(o>1?o-1:1),g=(v-d)/(u>1?u-1:1),y=this.projectionLimits.minLatitude*e.DEGREES_TO_RADIANS,b=this.projectionLimits.maxLatitude*e.DEGREES_TO_RADIANS,w=this.north?1:-1,E=f?f:new Vec3(0,0,0),S,x,T=0,N=0,C,k,L,A;for(S=0,C=h;S<o;S++,C+=m){S===o-1&&(C=p),L=s.clamp(C,y,b),A=n.equatorialRadius/Math.tan(L);if(this.north&&L===Math.PI/2||!this.north&&L===-Math.PI/2)A=0;for(x=0,k=d;x<u;x++,k+=g)x===u-1&&(k=v),c[N++]=A*Math.sin(k)*w-E[0],c[N++]=A*-Math.cos(k)-E[1],c[N++]=a[T++]-E[2]}return c},o.prototype.cartesianToGeographic=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","cartesianToGeographic","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","cartesianToGeographic","missingResult"));var f=Math.sqrt(i*i+s*s),l;return f<1e-4?(a.latitude=this.north?90:-90,a.longitude=0,a.altitude=o):(l=Math.atan2(f,n.equatorialRadius),l>Math.PI&&(l=Math.PI),a.latitude=Math.asin(Math.cos(l)*(this.north?1:-1))*e.RADIANS_TO_DEGREES,a.longitude=Math.atan2(i,s*(this.north?-1:1))*e.RADIANS_TO_DEGREES,a.altitude=o),a},o.prototype.northTangentAtLocation=function(n,i,s,o){if(!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","northTangentAtLocation","missingResult"));return o[0]=Math.sin(s*e.DEGREES_TO_RADIANS)*(this.north?-1:1),o[1]=Math.cos(s*e.DEGREES_TO_RADIANS),o[2]=0,o},o.prototype.northTangentAtPoint=function(e,n,i,s,o,u){if(!u)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionGnomonic","northTangentAtLocation","missingResult"));var a=Math.sqrt(n*n+i*i);return a<1e-4?(u[0]=0,u[1]=1,u[2]=0):(u[0]=n/a*(this.north?-1:1),u[1]=i/a*(this.north?-1:1),u[2]=0),u},o}),n("projections/ProjectionMercator",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger","../geom/Sector","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o){"use strict";var u=function(){n.call(this,"Mercator",!0,new i(-78,78,-180,180))};return u.prototype=Object.create(n.prototype),u.prototype.geographicToCartesian=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesian","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesian","missingResult"));i>this.projectionLimits.maxLatitude&&(i=this.projectionLimits.maxLatitude),i<this.projectionLimits.minLatitude&&(i=this.projectionLimits.minLatitude);var f=Math.sqrt(n.eccentricitySquared),l=Math.sin(i*e.DEGREES_TO_RADIANS),c=(1+l)/(1-l)*Math.pow((1-f*l)/(1+f*l),f);return a[0]=n.equatorialRadius*s*e.DEGREES_TO_RADIANS+(u?u[0]:0),a[1]=.5*n.equatorialRadius*Math.log(c),a[2]=o,a},Object.defineProperties(u.prototype,{stateKey:{get:function(){return"projection mercator "}}}),u.prototype.geographicToCartesianGrid=function(n,i,u,a,f,l,c,h){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","missingGlobe"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","missingSector"));if(!f||f.length<u*a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!h)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","missingResult"));var p=n.equatorialRadius,d=Math.sqrt(n.eccentricitySquared),v=i.minLatitude*e.DEGREES_TO_RADIANS,m=i.maxLatitude*e.DEGREES_TO_RADIANS,g=i.minLongitude*e.DEGREES_TO_RADIANS,y=i.maxLongitude*e.DEGREES_TO_RADIANS,b=(m-v)/(u>1?u-1:1),w=(y-g)/(a>1?a-1:1),E=this.projectionLimits.minLatitude*e.DEGREES_TO_RADIANS,S=this.projectionLimits.maxLatitude*e.DEGREES_TO_RADIANS,x=l?l:new s(0,0,0),T=c?c[0]:0,N,C,k=0,L=0,A,O,M,_,D,P;for(N=0,A=v;N<u;N++,A+=b){N===u-1&&(A=m),M=o.clamp(A,E,S),_=Math.sin(M),D=(1+_)/(1-_)*Math.pow((1-d*_)/(1+d*_),d),P=p*Math.log(D)*.5-x[1];for(C=0,O=g;C<a;C++,O+=w)C===a-1&&(O=y),h[L++]=p*O-x[0]+T,h[L++]=P,h[L++]=f[k++]-x[2]}return h},u.prototype.cartesianToGeographic=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","cartesianToGeographic","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","cartesianToGeographic","missingResult"));var f=n.eccentricitySquared,l=f*f,c=l*f,h=c*f,p=Math.pow(Math.E,-s/n.equatorialRadius),d=Math.PI/2-2*Math.atan(p),v=f/2+5*l/24+c/12+13*h/360,m=7*l/48+29*c/240+811*h/11520,g=7*c/120+81*h/1120,y=4279*h/161280,b=d-m+y,w=v-3*g,E=2*m-8*y,S=4*g,x=8*y,T=Math.sin(2*d),N=b+T*(w+T*(E+T*(S+x*T)));return a.latitude=N*e.RADIANS_TO_DEGREES,a.longitude=(i-(u?u[0]:0))/n.equatorialRadius*e.RADIANS_TO_DEGREES,a.altitude=o,a},u}),n("projections/ProjectionPolarEquidistant",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger"],function(e,t,n,r){"use strict";var i=function(e){n.call(this,"Polar Equidistant",!1,null),this._pole=e,this.north=e!=="South",this.displayName=this.north?"North Polar":"South Polar",this._stateKey="projection polar equidistant "+this._pole+" "};return i.prototype=Object.create(n.prototype),Object.defineProperties(i.prototype,{pole:{get:function(){return this._pole},set:function(e){this._pole=e,this.north=this._pole!=="South",this._stateKey="projection polar equidistant "+this._pole+" "}},stateKey:{get:function(){return this._stateKey}}}),i.prototype.geographicToCartesian=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesian","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesian","missingResult"));if(this.north&&i===90||!this.north&&i===-90)a[0]=0,a[1]=0,a[2]=o;else{var f=this.north?-1:1,l=n.equatorialRadius*(Math.PI/2+i*e.DEGREES_TO_RADIANS*f);a[0]=l*Math.sin(s*e.DEGREES_TO_RADIANS),a[1]=l*Math.cos(s*e.DEGREES_TO_RADIANS)*f,a[2]=o}return a},i.prototype.geographicToCartesianGrid=function(n,i,s,o,u,a,f,l){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesianGrid","missingGlobe"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesianGrid","missingSector"));if(!u||u.length<s*o)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!l)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesianGrid","missingResult"));var c=n.equatorialRadius,h=i.minLatitude*e.DEGREES_TO_RADIANS,p=i.maxLatitude*e.DEGREES_TO_RADIANS,d=i.minLongitude*e.DEGREES_TO_RADIANS,v=i.maxLongitude*e.DEGREES_TO_RADIANS,m=(p-h)/(s>1?s-1:1),g=(v-d)/(o>1?o-1:1),y=this.north?-1:1,b=a?a:new Vec3(0,0,0),w=Math.PI/2,E,S,x=0,T=0,N=new Float64Array(o),C=new Float64Array(o),k,L,A;for(S=0,L=d;S<o;S++,L+=g)S===o-1&&(L=v),N[S]=Math.cos(L),C[S]=Math.sin(L);for(E=0,k=h;E<s;E++,k+=m){E===s-1&&(k=p),A=c*(w+k*y);if(this.north&&k===w||!this.north&&k===-w)A=0;for(S=0;S<o;S++)l[T++]=A*C[S]-b[0],l[T++]=A*N[S]*y-b[1],l[T++]=u[x++]-b[2]}return l},i.prototype.cartesianToGeographic=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","cartesianToGeographic","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","cartesianToGeographic","missingResult"));var f=Math.sqrt(i*i+s*s),l;return f<1e-4?(a.latitude=this.north?90:-90,a.longitude=0,a.altitude=o):(l=f/n.equatorialRadius,l>Math.PI&&(l=Math.PI),a.latitude=Math.asin(Math.cos(l)*(this.north?1:-1))*e.RADIANS_TO_DEGREES,a.longitude=Math.atan2(i,s*(this.north?-1:1))*e.RADIANS_TO_DEGREES,a.altitude=o),a},i.prototype.northTangentAtLocation=function(n,i,s,o){if(!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","northTangentAtLocation","missingResult"));return o[0]=Math.sin(s*e.DEGREES_TO_RADIANS)*(this.north?-1:1),o[1]=Math.cos(s*e.DEGREES_TO_RADIANS),o[2]=0,o},i.prototype.northTangentAtPoint=function(e,n,i,s,o,u){if(!u)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","northTangentAtLocation","missingResult"));var a=Math.sqrt(n*n+i*i);return a<1e-4?(u[0]=0,u[1]=1,u[2]=0):(u[0]=n/a*(this.north?-1:1),u[1]=i/a*(this.north?-1:1),u[2]=0),u},i}),n("projections/ProjectionUPS",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger","../geom/Sector","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o){"use strict";var u=function(e){this.north=e!=="South";var t=this.north?new i(0,90,-180,180):new i(-90,0,-180,180);n.call(this,"Uniform Polar Stereographic",!1,t),this._pole=e,this.displayName=this.north?"North UPS":"South UPS",this._stateKey="projection ups "+this._pole+" "};return u.prototype=Object.create(n.prototype),Object.defineProperties(u.prototype,{pole:{get:function(){return this._pole},set:function(e){this._pole=e,this.north=this._pole!=="South",this.projectionLimits=this.north?new i(0,90,-180,180):new i(-90,0,-180,180),this._stateKey="projection ups "+this._pole+" "}},stateKey:{get:function(){return this._stateKey}}}),u.prototype.geographicToCartesian=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesian","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesian","missingResult"));if(this.north&&i===90||!this.north&&i===-90)a[0]=0,a[1]=0,a[2]=o;else{var f=this.north?1:-1,l=i*e.DEGREES_TO_RADIANS,c=s*e.DEGREES_TO_RADIANS,h=.994,p=Math.sqrt(n.eccentricitySquared),d=Math.sqrt(Math.pow(1+p,1+p)*Math.pow(1-p,1-p)),v,m,g;if(this.north&&l<0||!this.north&&l>0)l=0;v=Math.sin(l*f),m=Math.sqrt((1-v)/(1+v)*Math.pow((1+p*v)/(1-p*v),p)),g=2*n.equatorialRadius*h*m/d,a[0]=g*Math.sin(c),a[1]=-g*Math.cos(c)*f,a[2]=o}return a},u.prototype.geographicToCartesianGrid=function(n,i,u,a,f,l,c,h){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesianGrid","missingGlobe"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesianGrid","missingSector"));if(!f||f.length<u*a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!h)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesianGrid","missingResult"));var p=n.equatorialRadius,d=i.minLatitude*e.DEGREES_TO_RADIANS,v=i.maxLatitude*e.DEGREES_TO_RADIANS,m=i.minLongitude*e.DEGREES_TO_RADIANS,g=i.maxLongitude*e.DEGREES_TO_RADIANS,y=(v-d)/(u>1?u-1:1),b=(g-m)/(a>1?a-1:1),w=this.projectionLimits.minLatitude*e.DEGREES_TO_RADIANS,E=this.projectionLimits.maxLatitude*e.DEGREES_TO_RADIANS,S=.994,x=Math.sqrt(n.eccentricitySquared),T=Math.sqrt(Math.pow(1+x,1+x)*Math.pow(1-x,1-x)),N=this.north?1:-1,C=l?l:new s(0,0,0),k,L,A=0,O=0,M,_,D,P,H,B;for(k=0,M=d;k<u;k++,M+=y){k===u-1&&(M=v),D=o.clamp(M,w,E),P=Math.sin(D*N),H=Math.sqrt((1-P)/(1+P)*Math.pow((1+x*P)/(1-x*P),x)),B=2*p*S*H/T;for(L=0,_=m;L<a;L++,_+=b)L===a-1&&(_=g),h[O++]=B*Math.sin(_)-C[0],h[O++]=-B*Math.cos(_)*N-C[1],h[O++]=f[A++]-C[2]}return h},u.prototype.cartesianToGeographic=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","cartesianToGeographic","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","cartesianToGeographic","missingResult"));var f=Math.atan2(i,s*(this.north?-1:1)),l=.994,c=Math.sqrt(n.eccentricitySquared),h=Math.sqrt(i*i+s*s),p=Math.sqrt(Math.pow(1+c,1+c)*Math.pow(1-c,1-c)),d=h*p/(2*n.equatorialRadius*l),v=n.eccentricitySquared,m=v*v,g=m*v,y=g*v,b=Math.PI/2-2*Math.atan(d),w=v/2+5*m/24+g/12+13*y/360,E=7*m/48+29*g/240+811*y/11520,S=7*g/120+81*y/1120,x=4279*y/161280,T=b-E+x,N=w-3*S,C=2*E-8*x,k=4*S,L=8*x,A=Math.sin(2*b),O=T+A*(N+A*(C+A*(k+L*A)));return O*=this.north?1:-1,a.latitude=O*e.RADIANS_TO_DEGREES,a.longitude=f*e.RADIANS_TO_DEGREES,a.altitude=o,a},u.prototype.northTangentAtLocation=function(n,i,s,o){if(!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","northTangentAtLocation","missingResult"));return o[0]=Math.sin(s*e.DEGREES_TO_RADIANS)*(this.north?-1:1),o[1]=Math.cos(s*e.DEGREES_TO_RADIANS),o[2]=0,o},u.prototype.northTangentAtPoint=function(e,n,i,s,o,u){if(!u)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","northTangentAtLocation","missingResult"));var a=Math.sqrt(n*n+i*i);return a<1e-4?(u[0]=0,u[1]=1,u[2]=0):(u[0]=n/a*(this.north?-1:1),u[1]=i/a*(this.north?-1:1),u[2]=0),u},u}),n("util/ByteBuffer",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"ByteBuffer","constructor","missingArray"));this.array=r,this.data=new DataView(r),this.position=0,this._order=n.LITTLE_ENDIAN};return n.prototype.getByte=function(){var e=this.data.getUint8(this.position);return this.position+=n.BYTE_SIZE,e},n.prototype.getByteArray=function(e){var t=new Uint8Array(this.array,this.position,e);return this.position+=n.BYTE_SIZE*e,t},n.prototype.getInt16=function(){var e=this.data.getInt16(this.position,this._order);return this.position+=n.INT16_SIZE,e},n.prototype.getInt16Array=function(e){var t=new Int16Array(this.array,this.position,e);return this.position+=n.INT16_SIZE*e,t},n.prototype.getInt32=function(){var e=this.data.getInt32(this.position,this._order);return this.position+=n.INT32_SIZE,e},n.prototype.getInt32Array=function(e){var t=new Int32Array(this.array,this.position,e);return this.position+=n.INT32_SIZE*e,t},n.prototype.getFloat=function(){var e=this.data.getFloat32(this.position,this._order);return this.position+=n.FLOAT_SIZE,e},n.prototype.getFloatArray=function(e){var t=new Float32Array(this.array,this.position,e);return this.position+=n.FLOAT_SIZE*e,t},n.prototype.getDouble=function(){var e=this.data.getFloat64(this.position,this._order);return this.position+=n.DOUBLE_SIZE,e},n.prototype.getDoubleArray=function(e){var t;if(this.position%8!=0){var r=this.array.slice(this.position,this.position+e*n.DOUBLE_SIZE);t=new Float64Array(r)}else t=new Float64Array(this.array,this.position,e);return this.position+=n.DOUBLE_SIZE*e,t},n.prototype.skipBytes=function(e){this.position+=e*n.BYTE_SIZE},n.prototype.skipInt16s=function(e){this.position+=e*n.INT16_SIZE},n.prototype.skipInt32s=function(e){this.position+=e*n.INT32_SIZE},n.prototype.skipFloats=function(e){this.position+=e*n.FLOAT_SIZE},n.prototype.skipDoubles=function(e){this.position+=e*n.DOUBLE_SIZE},n.prototype.seek=function(e){this.position=e},n.prototype.order=function(e){this._order=e},n.prototype.limit=function(){return this.data.byteLength},n.prototype.hasRemaining=function(){return this.position<this.data.byteLength},n.BIG_ENDIAN=!1,n.LITTLE_ENDIAN=!0,n.BYTE_SIZE=1,n.INT16_SIZE=2,n.INT32_SIZE=4,n.FLOAT_SIZE=4,n.DOUBLE_SIZE=8,n}),n("formats/shapefile/DBaseField",["../../error/ArgumentError","../../util/ByteBuffer","../../formats/shapefile/DBaseFile","../../util/Logger"],function(e,t,n,r){"use strict";var i=function(t,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"DBaseField","constructor","missingAttributeName"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"DBaseField","constructor","missingBuffer"));this.name=null,this.type=null,this.typeCode=-1,this.length=-1,this.decimals=-1,this.readFieldDescriptor(t,n)};return i.prototype.getName=function(){return this.name},i.prototype.getType=function(){return this.type},i.prototype.getLength=function(){return this.length},i.prototype.getDecimals=function(){return this.decimals},i.prototype.readFieldDescriptor=function(e,n){n.order(t.LITTLE_ENDIAN);var s=n.position;this.name=e.readNullTerminatedString(n,i.FIELD_NAME_LENGTH),n.seek(s+i.FIELD_NAME_LENGTH),this.typeCode=String.fromCharCode(n.getByte()),this.type=i.getFieldType(this.typeCode);if(this.type==null)throw new Error(r.log(r.LEVEL_SEVERE,"Shapefile dBase encountered unsupported field type: "+this.typeCode));n.skipBytes(4),this.length=n.getByte(),this.decimals=n.getByte(),n.seek(s+i.FIELD_DESCRIPTOR_LENGTH)},i.getFieldType=function(e){switch(e){case"C":return i.TYPE_CHAR;case"D":return i.TYPE_DATE;case"F":return i.TYPE_NUMBER;case"L":return i.TYPE_BOOLEAN;case"N":return i.TYPE_NUMBER;default:return null}},i.prototype.toString=function(){return this.name+"("+this.typeCode+")"},i.TYPE_CHAR="DBase.FieldTypeChar",i.TYPE_NUMBER="DBase.FieldTypeNumber",i.TYPE_DATE="DBase.FieldTypeDate",i.TYPE_BOOLEAN="DBase.FieldTypeBoolean",i.FIELD_NAME_LENGTH=11,i.FIELD_DESCRIPTOR_LENGTH=32,i}),n("formats/shapefile/DBaseRecord",["../../error/ArgumentError","../../util/ByteBuffer","../../formats/shapefile/DBaseField","../../formats/shapefile/DBaseFile","../../util/Logger"],function(e,t,n,r,i){"use strict";var s=function(t,n,r){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"DBaseRecord","constructor","missingAttributeName"));if(!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"DBaseRecord","constructor","missingBuffer"));this.deleted=!1,this.recordNumber=r,this.values=null,this.readFromBuffer(t,n,r)};return s.prototype.isDeleted=function(){return this.deleted},s.prototype.getRecordNumber=function(){return this.recordNumber},s.prototype.readFromBuffer=function(e,r,s){r.order(t.LITTLE_ENDIAN),this.recordNumber=s;var o=r.getByte();this.deleted=o==42;var u=e.getFields();this.values={};for(var a=0,f=u.length;a<f;a+=1){var l=u[a],c=l.getName(),h=e.readNullTerminatedString(r,l.getLength()).trim();try{if(l.getType()==n.TYPE_BOOLEAN){var p=h.charAt(0);this.values[c]=p=="t"||p=="T"||p=="Y"||p=="y"}else l.getType()==n.TYPE_CHAR?this.values[c]=h:l.getType()==n.TYPE_DATE?this.values[c]=new Date(h):l.getType()==n.TYPE_NUMBER&&(this.values[c]=+h)}catch(d){i.log(i.LEVEL_WARNING,"Shapefile attribute parsing error:"+l.toString()+" -> "+h.toString()+" ["+d+"]")}}},s}),n("formats/shapefile/DBaseFile",["../../error/ArgumentError","../../util/ByteBuffer","../../formats/shapefile/DBaseField","../../formats/shapefile/DBaseRecord","../../util/Logger"],function(e,t,n,r,i){"use strict";var s=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"DBaseFile","constructor","missingUrl"));this.url=t,this.header=null,this.fields=null,this.buffer=null,this.boolean=!0,this.numRecordsRead=0,this._completionCallback=null};return s.prototype.getLastModificationDate=function(){return this.header.lastModificationDate},s.prototype.getNumberOfRecords=function(){return this.header.numberOfRecords},s.prototype.getHeaderLength=function(){return this.header.headerLength},s.prototype.getRecordLength=function(){return this.header.recordLength},s.prototype.getNumberOfFields=function(){return(this.header.headerLength-1-s.FIXED_HEADER_LENGTH)/s.FIELD_DESCRIPTOR_LENGTH},s.prototype.getFields=function(){return this.fields},s.prototype.hasNext=function(){return this.numRecordsRead<this.header.numberOfRecords},s.prototype.nextRecord=function(){return this.numRecordsRead>=this.getNumberOfRecords()?null:this.readNextRecord(this._buffer,this.numRecordsRead)},s.prototype.load=function(e){this._completionCallback=e,this.requestUrl(this.url)},s.prototype.requestUrl=function(e){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){n.readyState===4&&(n.status===200?(this._buffer=new t(n.response),this.parse(),!this._completionCallback||this._completionCallback(this)):(i.log(i.LEVEL_WARNING,"DBaseFile retrieval failed ("+n.statusText+"): "+e),!this._completionCallback||this._completionCallback(this)))}.bind(this),n.onerror=function(){i.log(i.LEVEL_WARNING,"DBaseFile retrieval failed: "+e),!this._completionCallback||this._completionCallback(this)},n.ontimeout=function(){i.log(i.LEVEL_WARNING,"DBaseFile retrieval timed out: "+e),!this._completionCallback||this._completionCallback(this)},n.send(null)},s.prototype.parse=function(){this.header=this.readHeader(this._buffer),this.fields=this.readFieldDescriptors(this._buffer,this.getNumberOfFields())},s.prototype.readHeader=function(e){var n=e.position;e.order(t.LITTLE_ENDIAN);var r=e.getByte();if(r>5)throw new Error("???");var i=e.getByte(),o=e.getByte(),u=e.getByte(),a=e.getInt32(),f=e.getInt16(),l=e.getInt16(),c={year:1900+i,month:o-1,day:u},h={fileCode:r,lastModificationDate:c,numberOfRecords:a,headerLength:f,recordLength:l};return e.seek(n+s.FIXED_HEADER_LENGTH),h},s.prototype.readFieldDescriptors=function(e,t){var r=e.position,i=[];for(var o=0;o<t;o+=1)i[o]=new n(this,e);var u=this.header.headerLength-s.FIXED_HEADER_LENGTH;return e.seek(r+u),i},s.prototype.readNextRecord=function(){return this.readRecordFromBuffer(this._buffer,++this.numRecordsRead)},s.prototype.readNextRecord=function(e,t){return new r(this,e,t)},s.prototype.readNullTerminatedString=function(e,t){if(t<=0)return 0;var n="";for(var r=0;r<t;r+=1){var i=e.getByte();if(i==0)break;n+=String.fromCharCode(i)}return this.isStringEmpty(n)?"":n},s.prototype.isStringEmpty=function(e){return e.length<=0||s.isStringFilled(e,32)||s.isStringFilled(e,42)},s.isStringFilled=function(e,t){if(e.length<=0)return!1;for(var n=0;n<e.length;n++)if(e.charAt(n)!=t)return!1;return!0},s.FIXED_HEADER_LENGTH=32,s.FIELD_DESCRIPTOR_LENGTH=32,s}),n("formats/shapefile/PrjFile",["../../error/ArgumentError","../../util/Logger","../../error/NotYetImplementedError"],function(e,t,n){"use strict";var r=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"DBaseFile","constructor","missingUrl"));this._url=n,this._completionCallback=null,this._params=null};return Object.defineProperties(r.prototype,{url:{get:function(){return this._url}},coordinateSystem:{get:function(){return this.params?this.params[r.COORDINATE_SYSTEM]:null}},params:{get:function(){return this._params}}}),r.prototype.load=function(e){this._completionCallback=e,this.requestUrl(this._url)},r.prototype.requestUrl=function(e){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){if(n.readyState===4){if(n.status===200){var r=String.fromCharCode.apply(null,new Uint8Array(n.response));this._params=this.decodeOGCCoordinateSystem(r)}else t.log(t.LEVEL_WARNING,"PrjFile retrieval failed ("+n.statusText+"): "+e);!this._completionCallback||this._completionCallback(this)}}.bind(this),n.onerror=function(){t.log(t.LEVEL_WARNING,"PrjFile retrieval failed: "+e),!this._completionCallback||this._completionCallback(this)}.bind(this),n.ontimeout=function(){t.log(t.LEVEL_WARNING,"PrjFile retrieval timed out: "+e),!this._completionCallback||this._completionCallback(this)}.bind(this),n.send(null)},r.prototype.decodeOGCCoordinateSystem=function(i){i||new e(t.logMessage(t.LEVEL_SEVERE,"PrjFile","decodeOGCCoordinateSystem","missingText"));var s={};i=i.trim().toUpperCase();if(r.GEOGCS_WKT_PATTERN.test(i))s[r.COORDINATE_SYSTEM]=r.COORDINATE_SYSTEM_GEOGRAPHIC;else{var o=i.match(r.PROJCS_WKT_PATTERN);if(!!o)throw s[PrfFile.COORDINATE_SYSTEM]=r.COORDINATE_SYSTEM_PROJECTED,new n(t.log(t.LEVEL_SEVERE,"PrjFile implementation  for projected coordinate systems in incomplete."));s[r.COORDINATE_SYSTEM]=r.COORDINATE_SYSTEM_UNKNOWN}return s},r.prototype.isUnknownCoordinateSystem=function(){return!this.params||this.params.coordinateSystem===r.COORDINATE_SYSTEM_UNKNOWN},r.prototype.isKnownCoordinateSystem=function(){return!!this.params&&this.params.coordinateSystem!==r.COORDINATE_SYSTEM_UNKNOWN},r.prototype.isGeographicCoordinateSystem=function(){return!!this.params&&this.params.coordinateSystem===r.COORDINATE_SYSTEM_GEOGRAPHIC},r.prototype.isProjectedCoordinateSystem=function(){return!!this.params&&this.params.coordinateSystem===r.COORDINATE_SYSTEM_PROJECTED},r.GEOGCS_WKT_PATTERN=new RegExp("\\{*GEOGCS[\\[\\(](.*)[\\]\\)]\\}*"),r.PROJCS_WKT_PATTERN=new RegExp("\\{*PROJCS[\\[\\(](.*)[\\]\\)]\\}*"),r.UTM_NAME_WKT_PATTERN=new RegExp(".*UTM.*ZONE.*?(\\d+).*?([\\w\\s]+).*?"),r.COORDINATE_SYSTEM="Coordinate_system",r.COORDINATE_SYSTEM_GEOGRAPHIC="Coordinate_system_geographic",r.COORDINATE_SYSTEM_PROJECTED="Coordinate_system_projected",r.COORDINATE_SYSTEM_UNKNOWN="Coordinate_system_unknown",r.PROJECTION_NAME="Projection_name",r.PROJECTION_UTM="Projection_UTM",r.PROJECTION_ZONE="Projection_zone",r.PROJECTION_HEMISPHERE="Projection_hemisphere",r.PROJECTION_HEMISPHERE_NORTH="Projection_hemisphere_north",r.PROJECTION_HEMISPHERE_SOUTH="Projection_hemisphere_south",r}),n("formats/shapefile/ShapefileRecord",["../../geom/Angle","../../error/ArgumentError","../../util/ByteBuffer","../../geom/Location","../../util/Logger","../../formats/shapefile/Shapefile"],function(e,t,n,r,i,s){"use strict";var o=function(e,n){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"ShapefileRecord","constructor","The specified shapefile is null or undefined"));if(!n)throw new t(i.logMessage(i.LEVEL_SEVERE,"ShapefileRecord","constructor","The specified buffer is null or undefined"));this._shapefile=e,this._recordNumber=-1,this._attributes={},this._numberOfParts=0,this._firstPartNumber=0,this._lastPartNumber=0,this._numberOfPoints=0,this._boundingRectangle=[],this._zRange=null,this._zValues=null,this._mRange=null,this._mValues=null,this._contentLengthInBytes=-1,this._buffer=n,this._isNormalized=!1,this._parts=[],this.readRecord()};return Object.defineProperties(o.prototype,{shapefile:{get:function(){return this._shapefile}},recordNumber:{get:function(){return this._recordNumber}},attributes:{get:function(){return this._attributes}},numberOfParts:{get:function(){return this._numberOfParts}},firstPartNumber:{get:function(){return this._firstPartNumber}},lastPartNumber:{get:function(){return this._lastPartNumber}},numberOfPoints:{get:function(){return this._numberOfPoints}},boundingRectangle:{get:function(){return this._boundingRectangle}},zRange:{get:function(){return this._zRange}},zValues:{get:function(){return this._zValues}},mRange:{get:function(){return this._mRange}},mValues:{get:function(){return this._mValues}}}),o.prototype.pointBuffer=function(e){return e>=0&&e<this._parts.length?this._parts[e]:null},o.prototype.readRecord=function(){this.readHeader(),this._buffer.order(n.LITTLE_ENDIAN);var e=this._buffer.getInt32(),t=this.shapefile.getShapeType(e);this.validateShapeType(t),this.readContents()},o.prototype.readHeader=function(){this._buffer.order(n.BIG_ENDIAN),this._recordNumber=this._buffer.getInt32(),this._contentLengthInBytes=this._buffer.getInt32()*2},o.prototype.validateShapeType=function(e){if(e!==this.shapefile.NULL&&e!==this.shapefile.shapeType)throw new Error(i.log(i.LEVEL_SEVERE,"Shapefile record is not supported."))},o.prototype.readNullContents=function(){this._numberOfParts=0,this._numberOfPoints=0,this._parts=null,this._boundingRectangle=null,this._buffer.seek(this._contentLengthInBytes-n.INT32_SIZE)},o.prototype.readPointContents=function(){this._numberOfParts=1,this._firstPartNumber=0,this._lastPartNumber=this._numberOfParts-1,this._numberOfPoints=1,this._parts=[this._buffer.getDoubleArray(2)];var e=this._parts[0][1],t=this._parts[0][0];this._boundingRectangle=[e,e,t,t],this.isZType()&&this.readZ(!0),this.isMeasureType()&&this.readOptionalMeasures(!0)},o.prototype.readPolylineContents=function(){var e=this.shapefile.readBoundingRectangle(this._buffer);this._boundingRectangle=e.coords,this._isNormalized=e.isNormalized,this._numberOfParts=this._buffer.getInt32(),this._firstPartNumber=0,this._lastPartNumber=this._numberOfParts-1,this._numberOfPoints=this._buffer.getInt32();if(this._numberOfParts>0&&this._numberOfPoints>0){var t=this._buffer.getInt32Array(this.numberOfParts);for(var n=0;n<this.numberOfParts;n+=1){var r=n==this.numberOfParts-1?this._numberOfPoints-t[n]:t[n+1]-t[n];this._parts[n]=this._buffer.getDoubleArray(r*2),o.normalizeLocations(this._parts[n])}}this.isZType()&&this.readZ(!1),this.isMeasureType()&&this.readOptionalMeasures(!1)},o.prototype.readMultiPointContents=function(){var e=this.shapefile.readBoundingRectangle(this._buffer);this._boundingRectangle=e.coords,this._isNormalized=e.isNormalized,this._numberOfParts=1,this._numberOfPoints=this._buffer.getInt32(),this._parts=[this._buffer.getDoubleArray(this._numberOfPoints*2)],o.normalizeLocations(this._parts[0]),this.isZType()&&this.readZ(!1),this.isMeasureType()&&this.readOptionalMeasures(!1)},o.prototype.readZ=function(e){if(e){this._zValues=this._buffer.getDoubleArray(1);var t=this._zValues[0];this._zRange=[t,t]}else this._zRange=this._buffer.getDoubleArray(2),this._zValues=this._buffer.getDoubleArray(this.numberOfPoints)},o.prototype.readOptionalMeasures=function(e){if(this._buffer.hasRemaining()&&this._buffer.limit()-this._buffer.position>=this.numberOfPoints*8)if(e){this._mValues=this._buffer.getDoubleArray(1);var t=this._mValues[0];this._mRange=[t,t]}else this._mRange=this._buffer.getDoubleArray(2),this._mValues=this._buffer.getDoubleArray(this.numberOfPoints)},o.normalizeLocations=function(t){for(var n=0,r=t.length;n<r;n+=2){var i=t[n],s=t[n+1];t[n]=e.normalizedDegreesLongitude(i),t[n+1]=e.normalizedDegreesLatitude(s)}},o.prototype.isPointType=function(){return this.shapefile.isPointType()},o.prototype.isMultiPointType=function(){return this.shapefile.isMultiPointType()},o.prototype.isPolylineType=function(){return this.shapefile.isPolylineType()},o.prototype.isPolygonType=function(){return this.shapefile.isPolygonType()},o.prototype.isZType=function(){return this.shapefile.isZType()},o.prototype.isMeasureType=function(){return this.shapefile.isMeasureType()},o.prototype.setAttributes=function(e){this._attributes=e},o.RECORD_HEADER_LENGTH=8,o}),n("formats/shapefile/ShapefileRecordMultiPoint",["../../util/ByteBuffer","../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(e,t,n){"use strict";var r=function(e,t){n.call(this,e,t)};return r.prototype=Object.create(n.prototype),r.prototype.readContents=function(){this.readMultiPointContents()},r}),n("formats/shapefile/ShapefileRecordNull",["../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(e,t){"use strict";var n=function(e,n){t.call(this,e,n)};return n.prototype=Object.create(t.prototype),n.prototype.readContents=function(){this.readNullContents()},n}),n("formats/shapefile/ShapefileRecordPoint",["../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(e,t){"use strict";var n=function(e,n){t.call(this,e,n)};return n.prototype=Object.create(t.prototype),n.prototype.readContents=function(){this.readPointContents()},n}),n("formats/shapefile/ShapefileRecordPolygon",["../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(e,t){"use strict";var n=function(e,n){t.call(this,e,n)};return n.prototype=Object.create(t.prototype),n.prototype.readContents=function(){this.readPolylineContents()},n}),n("formats/shapefile/ShapefileRecordPolyline",["../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(e,t){"use strict";var n=function(e,n){t.call(this,e,n)};return n.prototype=Object.create(t.prototype),n.prototype.readContents=function(){this.readPolylineContents()},n}),n("formats/shapefile/Shapefile",["../../geom/Angle","../../error/ArgumentError","../../util/ByteBuffer","../../util/Color","../../formats/shapefile/DBaseFile","../../geom/Location","../../util/Logger","../../error/NotYetImplementedError","../../shapes/Path","../../shapes/Placemark","../../shapes/PlacemarkAttributes","../../shapes/Polygon","../../geom/Position","../../formats/shapefile/PrjFile","../../layer/RenderableLayer","../../shapes/ShapeAttributes","../../formats/shapefile/ShapefileRecord","../../formats/shapefile/ShapefileRecordMultiPoint","../../formats/shapefile/ShapefileRecordNull","../../formats/shapefile/ShapefileRecordPoint","../../formats/shapefile/ShapefileRecordPolygon","../../formats/shapefile/ShapefileRecordPolyline","../../shapes/SurfacePolygon","../../shapes/SurfacePolyline"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x){"use strict";var T=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Shapefile","constructor","missingUrl"));this._url=e,this._shapeType=null,this._layer=null,this._shapeConfigurationCallback=this.defaultShapeConfigurationCallback,this._parserCompletionCallback=this.defaultParserCompletionCallback,this._buffer=null,this.attributeFile=new i(e.replace(".shp",".dbf")),this.projectionFile=new p(e.replace(".shp",".prj")),this.defaultPlacemarkAttributes=new l(null),this.defaultShapeAttributes=new v(null)};return Object.defineProperties(T.prototype,{url:{get:function(){return this._url}},shapeType:{get:function(){return this._shapeType}},layer:{get:function(){return this._layer}},parserCompletionCallback:{get:function(){return this._parserCompletionCallback}},shapeConfigurationCallback:{get:function(){return this._shapeConfigurationCallback}}}),T.prototype.load=function(e,t,n){e&&(this._parserCompletionCallback=e),t&&(this._shapeConfigurationCallback=t),this._layer=n||new d;var r=function(){var e=function(){this.requestUrl(this.url)}.bind(this);this.attributeFile.load(e)}.bind(this);this.projectionFile.load(r)},T.prototype.defaultParserCompletionCallback=function(e){this.addRenderablesForShapefile(this.layer)},T.prototype.defaultShapeConfigurationCallback=function(e,t){var n={},r=e.values.name||e.values.Name||e.values.NAME;r&&(n.name=r);if(t.isPointType())n.attributes=this.defaultPlacemarkAttributes;else if(t.isMultiPointType())n.attributes=this.defaultPlacemarkAttributes;else if(t.isPolylineType())n.attributes=this.defaultShapeAttributes;else if(t.isPolygonType()){n.attributes=this.defaultShapeAttributes;var i=e.values.height||e.values.Height||e.values.HEIGHT;i&&(n.height=i)}return n},T.prototype.addRenderablesForShapefile=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Shapefile","addRenderablesForShapefile","missingLayer"));this.isPointType()?this.addRenderablesForPoints(e):this.isMultiPointType()?this.addRenderablesForMultiPoints(e):this.isPolylineType()?this.addRenderablesForPolylines(e):this.isPolygonType()&&this.addRenderablesForPolygons(e)},T.prototype.addRenderablesForPoints=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Shapefile","addRenderablesForPoints","missingLayer"));for(var n=this.next();!!n;n=this.next()){var r=this.shapeConfigurationCallback(n.attributes,n),i=r&&r.altitude?r.altitude:0;if(!r)continue;for(var s=0,u=n.numberOfParts;s<u;s+=1){var a=n.pointBuffer(s);for(var l=0,c=a.length;l<c;l+=2){var p=a[l],d=a[l+1],v=new h(d,p,i),m=new f(v,!1,r.attributes);m.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND,r.highlightAttributes&&(m.highlightAttributes=r.highlightAttributes),r.name&&(m.label=r.name),e.addRenderable(m)}}}},T.prototype.addRenderablesForMultiPoints=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Shapefile","addRenderablesForMultiPoints","missingLayer"));for(var n=this.next();!!n;n=this.next()){var r=this.shapeConfigurationCallback(n.attributes,n),i=r&&r.altitude?r.altitude:0;if(!r)continue;for(var s=0,u=n.numberOfParts;s<u;s+=1){var a=n.pointBuffer(s);for(var l=0,c=a.length;l<c;l+=2){var p=a[l],d=a[l+1],v=new h(d,p,i),m=new f(v,!1,r.attributes);m.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND,r.highlightAttributes&&(m.highlightAttributes=r.highlightAttributes),r.name&&(m.label=r.name),e.addRenderable(m)}}}},T.prototype.addRenderablesForPolylines=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Shapefile","addRenderablesForPolylines","missingLayer"));for(var n=this.next();!!n;n=this.next()){var r=this.shapeConfigurationCallback(n.attributes,n),i=r&&r.altitude?r.altitude:0;if(!r)continue;for(var u=0,f=n.numberOfParts;u<f;u+=1){var l=n.pointBuffer(u),c=[];for(var p=0,d=l.length;p<d;p+=2){var v=l[p],m=l[p+1],g=i?new h(m,v,i):new s(m,v);c.push(g)}var y;i?(y=new a(c,r.attributes),y.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND):y=new x(c,r.attributes),r.highlightAttributes&&(y.highlightAttributes=r.highlightAttributes),r.name&&(y.displayName=r.name),e.addRenderable(y)}}},T.prototype.addRenderablesForPolygons=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Shapefile","addRenderablesForPolygons","missingLayer"));for(var n=this.next();!!n;n=this.next()){var r=this.shapeConfigurationCallback(n.attributes,n),i=[],u,a=r.height,f=r.altitude;for(var l=0,p=n.numberOfParts;l<p;l+=1){var d=n.pointBuffer(l),v=[];for(var m=0,g=d.length-2;m<g;m+=2){var y=d[m],b=d[m+1];a?u=new h(b,y,a):f?u=new h(b,y,f):u=new s(b,y),v.push(u)}i.push(v)}var w;a?(w=new c(i,r.attributes),w.extrude=!0,w.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND):f?(w=new c(i,r.attributes),w.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND):w=new S(i,r.attributes),r.highlightAttributes&&(w.highlightAttributes=r.highlightAttributes),r.name&&(w.displayName=r.name),e.addRenderable(w)}},T.prototype.next=function(){while(this._buffer.position<this._buffer.limit()){var e=this.readRecord(this._buffer);if(!(e instanceof y))return e}return null},T.prototype.requestUrl=function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onreadystatechange=function(){t.readyState===4&&(t.status===200?(this._buffer=new n(t.response),this.parse()):o.log(o.LEVEL_WARNING,"Shapefile retrieval failed ("+t.statusText+"): "+e),!this._parserCompletionCallback||this._parserCompletionCallback(this))}.bind(this),t.onerror=function(){o.log(o.LEVEL_WARNING,"Shapefile retrieval failed: "+e),!this._parserCompletionCallback||this._parserCompletionCallback(this)},t.ontimeout=function(){o.log(o.LEVEL_WARNING,"Shapefile retrieval timed out: "+e),!this._parserCompletionCallback||this._parserCompletionCallback(this)},t.send(null)},T.prototype.parse=function(){try{var e=this.readHeader(this._buffer);this._shapeType=e.shapeType}catch(t){console.log(t)}finally{}},T.prototype.readHeader=function(e){e.order(n.BIG_ENDIAN);var t=e.getInt32();if(t!=T.FILE_CODE)throw new Error(o.log(o.LEVEL_SEVERE,"Shapefile header is invalid"));e.skipInt32s(5);var r=e.getInt32();e.order(n.LITTLE_ENDIAN);var i=e.getInt32(),s=e.getInt32(),u=this.readBoundingRectangle(e),a=this.getShapeType(s);if(a==null)throw new Error(o.log(o.LEVEL_SEVERE,"Shapefile type is unsupported: "+s.toString()));var f={fileLength:r*2,version:i,shapeType:a,boundingRectangle:u.coords,normalizePoints:u.isNormalized};return e.skipDoubles(4),f},T.prototype.readBoundingRectangle=function(e){return this.projectionFile?this.projectionFile.isGeographicCoordinateSystem()?this.readGeographicBoundingRectangle(e):this.projectionFile.isProjectedCoordinateSystem()?this.readProjectedBoundingRectangle(e):this.readUnspecifiedBoundingRectangle(e):this.readUnspecifiedBoundingRectangle(e)},T.prototype.readUnspecifiedBoundingRectangle=function(e){var t=this.readBoundingRectangleCoordinates(e);return{coords:t,isNormalized:!1}},T.prototype.readGeographicBoundingRectangle=function(t){var n=this.readBoundingRectangleCoordinates(t),r=!1,i=0;n[0]<-90&&(i=e.normalizedDegreesLatitude(n[0]),n[0]=90,r=!0,n[1]<i&&(n[1]=i)),n[1]>90&&(i=e.normalizedDegreesLatitude(n[1]),n[1]=90,r=!0,n[0]>i&&(n[0]=i));if(n[2]<-180||n[3]>180)n[2]=-180,n[3]=180,r=!0;return{coords:n,isNormalized:r}},T.prototype.readProjectedBoundingRectangle=function(e){throw new u(o.log(o.LEVEL_SEVERE,"Shapefile.readProjectedBoundingRectangle() not yet implemented"))},T.prototype.readBoundingRectangleCoordinates=function(e){var t=e.getDouble(),n=e.getDouble(),r=e.getDouble(),i=e.getDouble();return[n,i,t,r]},T.prototype.readRecord=function(e){var t=this.createRecord(e);if(t!=null&&this.attributeFile!=null&&this.attributeFile.hasNext()){var n=this.attributeFile.nextRecord();t.setAttributes(n)}return t},T.prototype.createRecord=function(e){return this.isNullType()?this.createNull(e):this.isPointType()?this.createPoint(e):this.isMultiPointType()?this.createMultiPoint(e):this.isPolygonType()?this.createPolygon(e):this.isPolylineType()?this.createPolyline(e):null},T.prototype.createNull=function(e){return new y(this,e)},T.prototype.createPoint=function(e){return new b(this,e)},T.prototype.createMultiPoint=function(e){return new g(this,e)},T.prototype.createPolyline=function(e){return new E(this,e)},T.prototype.createPolygon=function(e){return new w(this,e)},T.prototype.getShapeType=function(e){switch(e){case 0:return T.NULL;case 1:return T.POINT;case 3:return T.POLYLINE;case 5:return T.POLYGON;case 8:return T.MULTI_POINT;case 11:return T.POINT_Z;case 13:return T.POLYLINE_Z;case 15:return T.POLYGON_Z;case 18:return T.MULTI_POINT_Z;case 21:return T.POINT_M;case 23:return T.POLYLINE_M;case 25:return T.POLYGON_M;case 28:return T.MULTI_POINT_M;default:return null}},T.prototype.isMeasureType=function(){return T.measureTypes.hasOwnProperty(this._shapeType)},T.prototype.isZType=function(){return T.zTypes.hasOwnProperty(this._shapeType)},T.prototype.isNullType=function(){return this._shapeType===T.NULL},T.prototype.isPointType=function(){return T.pointTypes.hasOwnProperty(this._shapeType)},T.prototype.isMultiPointType=function(){return T.multiPointTypes.hasOwnProperty(this._shapeType)},T.prototype.isPolylineType=function(){return T.polylineTypes.hasOwnProperty(this._shapeType)},T.prototype.isPolygonType=function(){return T.polygonTypes.hasOwnProperty(this._shapeType)},T.NULL="null",T.POINT="point",T.MULTI_POINT="multiPoint",T.POLYLINE="polyline",T.POLYGON="polygon",T.POINT_M=T.POINT+"M",T.MULTI_POINT_M=T.MULTI_POINT+"M",T.POLYLINE_M=T.POLYLINE+"M",T.POLYGON_M=T.POLYGON+"M",T.POINT_Z=T.POINT+"Z",T.MULTI_POINT_Z=T.MULTI_POINT+"Z",T.POLYLINE_Z=T.POLYLINE+"Z",T.POLYGON_Z=T.POLYGON+"Z",T.SHAPE_MULTI_PATCH="multiPatch",T.measureTypes={pointM:T.POINT_M,pointZ:T.POINT_Z,multiPointM:T.MULTI_POINT_M,multiPointZ:T.MULTI_POINT_Z,polylineM:T.POLYLINE_M,polylineZ:T.POLYLINE_Z,polygonM:T.POLYGON_M,polygonZ:T.POLYGON_Z},T.zTypes={pointZ:T.POINT_Z,multiPointZ:T.MULTI_POINT_Z,polylineZ:T.POLYLINE_Z,polygonZ:T.POLYGON_Z},T.pointTypes={point:T.POINT,pointZ:T.POINT_Z,pointM:T.POINT_M},T.multiPointTypes={multiPoint:T.MULTI_POINT,multiPointZ:T.MULTI_POINT_Z,multiPointM:T.MULTI_POINT_M},T.polylineTypes={polyline:T.POLYLINE,polylineZ:T.POLYLINE_Z,polylineM:T.POLYLINE_M},T.polygonTypes={polygon:T.POLYGON,polygonZ:T.POLYGON_Z,polygonM:T.POLYGON_M},T.FILE_CODE=9994,T}),n("layer/ShowTessellationLayer",["../shaders/BasicProgram","../layer/Layer"],function(e,t){"use strict";var n=function(){t.call(this,"Show Tessellation"),this.enableTerrainGeometry=!0,this.enableTerrainExtent=!1};return n.prototype=Object.create(t.prototype),n.prototype.doRender=function(e){try{this.beginRendering(e),this.enableTerrainGeometry&&this.drawTerrainGeometry(e),this.enableTerrainExtent&&this.drawTerrainExtent(e)}finally{this.endRendering(e)}},n.prototype.beginRendering=function(e){var t=e.currentGlContext;t.depthMask(!1)},n.prototype.endRendering=function(e){var t=e.currentGlContext;t.depthMask(!0)},n.prototype.drawTerrainGeometry=function(t){if(!t.terrain||!t.terrain.tessellator)return;var n=t.currentGlContext,r=t.terrain,i=r.tessellator,s=r.surfaceGeometry,o,u;try{o=t.findAndBindProgram(e),i.beginRendering(t);for(var a=0,f=s.length;a<f;a++)u=s[a],i.beginRenderingTile(t,u),o.loadColorComponents(n,1,1,1,.3),i.renderWireframeTile(t,u),o.loadColorComponents(n,1,0,0,.6),i.renderTileOutline(t,u),i.endRenderingTile(t,u)}finally{i.endRendering(t)}},n.prototype.drawTerrainExtent=function(e){var t=e.terrain.surfaceGeometry,n;for(var r=0,i=t.length;r<i;r++)n=t[r],n.extent.render(e)},n}),n("shapes/SurfaceEllipse",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape","../util/WWMath"],function(e,t,n,r,i,s,o){"use strict";var u=function(e,n,i,o,a){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceEllipse","constructor","missingLocation"));if(n<0||i<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceEllipse","constructor","Radius is negative."));s.call(this,a),this._center=e,this._majorRadius=n,this._minorRadius=i,this._heading=o,this._intervals=u.DEFAULT_NUM_INTERVALS};return u.prototype=Object.create(s.prototype),Object.defineProperties(u.prototype,{center:{get:function(){return this._center},set:function(e){this.stateKeyInvalid=!0,this._center=e}},majorRadius:{get:function(){return this._majorRadius},set:function(e){this.stateKeyInvalid=!0,this._majorRadius=e}},minorRadius:{get:function(){return this._minorRadius},set:function(e){this.stateKeyInvalid=!0,this._minorRadius=e}},heading:{get:function(){return this._heading},set:function(e){this.stateKeyInvalid=!0,this._heading=e}},intervals:{get:function(){return this._intervals},set:function(e){this.stateKeyInvalid=!0,this._intervals=e}}}),u.staticStateKey=function(e){var t=s.staticStateKey(e);return t+" ce "+e.center.toString()+" ma "+e.majorRadius.toString()+" mi "+e.minorRadius.toString()+" he "+e.heading.toString()+" in "+e.intervals.toString()},u.prototype.computeStateKey=function(){return u.staticStateKey(this)},u.prototype.computeBoundaries=function(t){if(this.majorRadius==0&&this.minorRadius==0)return null;var r=t.globe,i=1+Math.max(u.MIN_NUM_INTERVALS,this.intervals),s=2*Math.PI/(i-1),a=r.radiusAt(this.center.latitude,this.center.longitude);this._boundaries=new Array(i);for(var f=0;f<i;f++){var l=f!=i-1?f*s:0,c=this.majorRadius*Math.cos(l),h=this.minorRadius*Math.sin(l),p=Math.sqrt(c*c+h*h),d=Math.PI/2-(Math.acos(c/p)*o.signum(h)-this.heading*e.DEGREES_TO_RADIANS);this._boundaries[f]=n.greatCircleLocation(this.center,d*e.RADIANS_TO_DEGREES,p/a,new n(0,0))}},u.MIN_NUM_INTERVALS=8,u.DEFAULT_NUM_INTERVALS=64,u}),n("shapes/SurfaceCircle",["../error/ArgumentError","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceEllipse"],function(e,t,n,r){"use strict";var i=function(n,i,s){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceCircle","constructor","missingLocation"));if(i<0)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceCircle","constructor","Radius is negative"));r.call(this,n,i,i,0,s),this._radius=i};return i.prototype=Object.create(r.prototype),Object.defineProperties(i.prototype,{radius:{get:function(){return this._radius},set:function(e){this.stateKeyInvalid=!0,this._radius=e}}}),i.staticStateKey=function(e){var t=r.staticStateKey(e);return t+" ra "+e.radius.toString()},i.prototype.computeStateKey=function(){return i.staticStateKey(this)},i}),n("shapes/SurfaceRectangle",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape","../util/WWMath"],function(e,t,n,r,i,s,o){"use strict";var u=function(e,n,i,o,u){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceRectangle","constructor","missingLocation"));if(n<0||i<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceRectangle","constructor","Size is negative."));s.call(this,u),this._center=e,this._width=n,this._height=i,this._heading=o};return u.prototype=Object.create(s.prototype),Object.defineProperties(u.prototype,{center:{get:function(){return this._center},set:function(e){this.stateKeyInvalid=!0,this._center=e}},width:{get:function(){return this._width},set:function(e){this.stateKeyInvalid=!0,this._width=e}},height:{get:function(){return this._height},set:function(e){this.stateKeyInvalid=!0,this._height=e}},heading:{get:function(){return this._heading},set:function(e){this.stateKeyInvalid=!0,this._heading=e}}}),u.staticStateKey=function(e){var t=s.staticStateKey(e);return t+" ce "+e.center.toString()+" wi "+e.width.toString()+" he "+e.height.toString()+" hd "+e.heading.toString()},u.prototype.computeStateKey=function(){return u.staticStateKey(this)},u.prototype.computeBoundaries=function(e){var t=.5*this.width,n=.5*this.height,r=e.globe.radiusAt(this.center.latitude,this.center.longitude);this._boundaries=new Array(4),this.addLocation(0,-t,-n,r),this.addLocation(1,t,-n,r),this.addLocation(2,t,n,r),this.addLocation(3,-t,n,r)},u.prototype.addLocation=function(t,r,i,s){var u=Math.sqrt(r*r+i*i),a=Math.PI/2-(Math.acos(r/u)*o.signum(i)-this.heading*e.DEGREES_TO_RADIANS);this._boundaries[t]=n.greatCircleLocation(this.center,a*e.RADIANS_TO_DEGREES,u/s,new n(0,0))},u}),n("render/SurfaceRenderable",["../util/Logger","../error/UnsupportedOperationError"],function(e,t){"use strict";var n=function(){throw this.displayName="Renderable",this.enabled=!0,new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceRenderable","constructor","abstractInvocation"))};return n.prototype.renderSurface=function(n){throw new t(e.logMessage(e.LEVEL_SEVERE,"SurfaceRenderable","renderSurface","abstractInvocation"))},n}),n("shapes/SurfaceSector",["../error/ArgumentError","../geom/Location","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape"],function(e,t,n,r,i){"use strict";var s=function(t,r){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"SurfaceSector","constructor","missingSector"));i.call(this,r),this._sector=t};return s.prototype=Object.create(i.prototype),s.staticStateKey=function(e){var t=i.staticStateKey(e);return t},s.prototype.computeStateKey=function(){return s.staticStateKey(this)},s.prototype.computeBoundaries=function(e){var n=this._sector;this._boundaries=new Array(4),this._boundaries[0]=new t(n.minLatitude,n.minLongitude),this._boundaries[1]=new t(n.maxLatitude,n.minLongitude),this._boundaries[2]=new t(n.maxLatitude,n.maxLongitude),this._boundaries[3]=new t(n.minLatitude,n.maxLongitude)},s}),n("gesture/TapRecognizer",["../gesture/GestureRecognizer"],function(e){"use strict";var t=function(t,n){e.call(this,t,n),this.numberOfTaps=1,this.numberOfTouches=1,this.maxTouchMovement=20,this.maxTapDuration=500,this.maxTapInterval=400,this.taps=[],this.timeout=null};return t.prototype=Object.create(e.prototype),t.prototype.reset=function(){e.prototype.reset.call(this),this.taps=[],this.cancelFailAfterDelay()},t.prototype.mouseDown=function(e){if(this.state!=WorldWind.POSSIBLE)return;this.state=WorldWind.FAILED},t.prototype.touchStart=function(e){if(this.state!=WorldWind.POSSIBLE)return;var t;this.touchCount>this.numberOfTouches?this.state=WorldWind.FAILED:this.touchCount==1?(t={touchCount:this.touchCount,clientX:this.clientX,clientY:this.clientY},this.taps.push(t),this.failAfterDelay(this.maxTapDuration)):(t=this.taps[this.taps.length-1],t.touchCount=this.touchCount,t.clientX=this.clientX,t.clientY=this.clientY)},t.prototype.touchMove=function(e){if(this.state!=WorldWind.POSSIBLE)return;var t=this.translationX,n=this.translationY,r=Math.sqrt(t*t+n*n);r>this.maxTouchMovement&&(this.state=WorldWind.FAILED)},t.prototype.touchEnd=function(e){if(this.state!=WorldWind.POSSIBLE)return;if(this.touchCount!=0)return;var t=this.taps.length,n=this.taps[t-1];n.touchCount!=this.numberOfTouches?this.state=WorldWind.FAILED:t==this.numberOfTaps?(this.clientX=this.taps[0].clientX,this.clientY=this.taps[0].clientY,this.state=WorldWind.RECOGNIZED):this.failAfterDelay(this.maxTapInterval)},t.prototype.touchCancel=function(e){if(this.state!=WorldWind.POSSIBLE)return;this.state=WorldWind.FAILED},t.prototype.failAfterDelay=function(e){var t=this;t.timeout&&window.clearTimeout(t.timeout),t.timeout=window.setTimeout(function(){t.timeout=null,t.state==WorldWind.POSSIBLE&&(t.state=WorldWind.FAILED)},e)},t.prototype.cancelFailAfterDelay=function(){var e=this;e.timeout&&(window.clearTimeout(e.timeout),e.timeout=null)},t}),n("layer/TectonicPlatesLayer",["../error/ArgumentError","../util/Color","../geom/Location","../util/Logger","../layer/RenderableLayer","../shapes/ShapeAttributes","../shapes/SurfacePolygon"],function(e,t,n,r,i,s,o){"use strict";var u=function(e){i.call(this,"Tectonic Plates"),e?this._attributes=e:(this._attributes=new s(null),this._attributes.drawInterior=!1,this._attributes.drawOutline=!0,this._attributes.outlineColor=t.RED),this.loadPlateData()};return u.prototype=Object.create(i.prototype),Object.defineProperties(o.prototype,{attributes:{get:function(){return this._attributes},set:function(e){e&&this.renderables.map(function(t,n,r){t.attributes=e})}}}),u.prototype.loadPlateData=function(){var e="http://worldwindserver.net/webworldwind/data/TectonicPlates.json",t=new XMLHttpRequest;t.open("GET",e,!0),t.onreadystatechange=function(){t.readyState===4&&(t.status===200?this.parse(t.responseText):r.log(r.LEVEL_WARNING,"Tectonic plate data retrieval failed ("+t.statusText+"): "+e))}.bind(this),t.onerror=function(){r.log(r.LEVEL_WARNING,"Tectonic plate data retrieval failed: "+e)},t.ontimeout=function(){r.log(r.LEVEL_WARNING,"Tectonic plate data retrieval timed out: "+e)},t.send(null)},u.prototype.parse=function(e){var t=JSON.parse(e),r=this;t.features.map(function(e,t,i){var s=[];e.geometry.coordinates.map(function(e,t,r){s.push(new n(e[1],e[0]))});var u=new o(s,r._attributes);r.addRenderable(u)})},u}),n("util/TileFactory",["../util/Logger","../error/UnsupportedOperationError"],function(e,t){"use strict";var n=function(){};return n.prototype.createTile=function(n,r,i,s){throw new t(e.logMessage(e.LEVEL_SEVERE,"TileFactory","createTile","abstractInvocation"))},n}),n("shapes/TriangleMesh",["../shapes/AbstractMesh","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../util/ImageSource","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../shapes/SurfacePolygon","../geom/Vec2","../geom/Vec3"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){"use strict";var v=function(n,r,i){if(!n)throw new t(u.logMessage(u.LEVEL_SEVERE,"TriangleMesh","constructor","missingPositions"));if(n.length<1)throw new t(u.logMessage(u.LEVEL_SEVERE,"TriangleMesh","constructor","missingPositions"));if(n.length>65536)throw new t(u.logMessage(u.LEVEL_SEVERE,"TriangleMesh","constructor","Too many positions. Must be fewer than 65537. Use TriangleMesh.split to split the shape."));if(!r)throw new t(u.logMessage(u.LEVEL_SEVERE,"TriangleMesh","constructor","Indices array is null or undefined"));if(r.length<3)throw new t(u.logMessage(u.LEVEL_SEVERE,"TriangleMesh","constructor","Too few indices."));e.call(this,i),this._positions=n,this._indices=r,this.referencePosition=this._positions[0]};return v.prototype=Object.create(e.prototype),Object.defineProperties(v.prototype,{positions:{get:function(){return this._positions},set:function(e){if(!e)throw new t(u.logMessage(u.LEVEL_SEVERE,"TriangleMesh","positions","missingPositions"));this._positions=e,this.referencePosition=this._positions[0],this.reset()}},indices:{get:function(){return this._indices},set:function(e){if(!e)throw new t(u.logMessage(u.LEVEL_SEVERE,"TriangleMesh","indices","Indices array is null or undefined"));this._indices=e,this.meshIndices=null,this.reset()}},outlineIndices:{get:function(){return this._outlineIndices},set:function(e){this._outlineIndices=e,this.meshOutlineIndices=null,this.reset()}},textureCoordinates:{get:function(){return this._textureCoordinates},set:function(e){if(e&&e.length!=this._positions.length)throw new t(u.logMessage(u.LEVEL_SEVERE,"TriangleMesh","textureCoordinates","Number of texture coordinates is inconsistent with the currently specified positions."));this._textureCoordinates=e,this.reset(),this.texCoords=null}}}),v.prototype.createSurfaceShape=function(){if(this._outlineIndices){var e=[];for(var t=0;t<this._outlineIndices.length;t++)e.push(this._positions[this._outlineIndices[t]]);return new h(e,null)}return null},v.prototype.computeMeshPoints=function(e,t){var n=Number.MAX_VALUE,r=e.navigatorState.eyePoint,i=new Float32Array(this._positions.length*3),s=new d(0,0,0),o=0,u,a;for(var f=0;f<this._positions.length;f++)u=this._positions[f],e.surfacePointForMode(u.latitude,u.longitude,u.altitude*this._altitudeScale,this.altitudeMode,s),a=s.distanceToSquared(r),a<n&&(n=a),s.subtract(this.currentData.referencePoint),i[o++]=s[0],i[o++]=s[1],i[o++]=s[2];return t.eyeDistance=Math.sqrt(n),i},v.prototype.computeTexCoords=function(){if(!this._textureCoordinates)return null;var e=new Float32Array(2*this._textureCoordinates.length),t=0;for(var n=0,r=this._textureCoordinates.length;n<r;n++){var i=this._textureCoordinates[n];e[t++]=i[0],e[t++]=i[1]}return e},v.prototype.computeMeshIndices=function(){var e=new Uint16Array(this._indices.length);for(var t=0,n=this._indices.length;t<n;t++)e[t]=this._indices[t];return e},v.prototype.computeOutlineIndices=function(){if(!this._outlineIndices)return null;var e=new Uint16Array(this._outlineIndices.length);for(var t=0;t<this._outlineIndices.length;t++)e[t]=this._outlineIndices[t];return e},v.split=function(e,t,n,r){var i=[],s=[],o=[],u=[],a=[],f,l;for(var c=0;c<=t.length;c++){if(c===t.length||i.length>65533&&o.length%3===0){if(i.length>0){var h={positions:i,indices:o};n&&(h.textureCoords=s);if(r){var p=[];for(var d=0;d<r.length;d++)f=r[d],l=u[f],l&&p.push(u[r[d]]);h.outlineIndices=p}a.push(h)}if(c===t.length)break;i=[],o=[],u=[]}f=t[c],l=u[f],l||(l=i.length,u[f]=l,i.push(e[f]),n&&s.push(n[f])),o.push(l)}return a},v}),n("layer/ViewControlsLayer",["../geom/Angle","../error/ArgumentError","../layer/Layer","../geom/Location","../util/Logger","../util/Offset","../shapes/ScreenImage","../geom/Vec2","../util/WWUtil"],function(e,t,n,r,i,s,o,u,a){"use strict";var f=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"ViewControlsLayer","constructor","missingWorldWindow"));n.call(this,"View Controls"),this.wwd=e,this.placement=new s(WorldWind.OFFSET_FRACTION,0,WorldWind.OFFSET_FRACTION,0),this.alignment=new s(WorldWind.OFFSET_FRACTION,0,WorldWind.OFFSET_FRACTION,0),this.exaggerationIncrement=.01,this.zoomIncrement=.04,this.headingIncrement=1,this.tiltIncrement=1,this.fieldOfViewIncrement=.1,this.panIncrement=.001,this._inactiveOpacity=.5,this._activeOpacity=1;var r=new s(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0),a=WorldWind.configuration.baseUrl+"images/view/";this.panControl=new o(r.clone(),a+"view-pan-64x64.png"),this.zoomInControl=new o(r.clone(),a+"view-zoom-in-32x32.png"),this.zoomOutControl=new o(r.clone(),a+"view-zoom-out-32x32.png"),this.headingLeftControl=new o(r.clone(),a+"view-heading-left-32x32.png"),this.headingRightControl=new o(r.clone(),a+"view-heading-right-32x32.png"),this.tiltUpControl=new o(r.clone(),a+"view-pitch-up-32x32.png"),this.tiltDownControl=new o(r.clone(),a+"view-pitch-down-32x32.png"),this.exaggerationUpControl=new o(r.clone(),a+"view-elevation-up-32x32.png"),this.exaggerationDownControl=new o(r.clone(),a+"view-elevation-down-32x32.png"),this.fovNarrowControl=new o(r.clone(),a+"view-fov-narrow-32x32.png"),this.fovWideControl=new o(r.clone(),a+"view-fov-wide-32x32.png"),this.fovNarrowControl.enabled=!1,this.fovWideControl.enabled=!1,this.controls=[this.panControl,this.zoomInControl,this.zoomOutControl,this.headingLeftControl,this.headingRightControl,this.tiltUpControl,this.tiltDownControl,this.exaggerationUpControl,this.exaggerationDownControl,this.fovNarrowControl,this.fovWideControl];for(var f=0;f<this.controls.length;f++)this.controls[f].imageOffset=r.clone(),this.controls[f].opacity=this._inactiveOpacity,this.controls[f]===this.panControl?this.controls[f].size=64:this.controls[f].size=32;this.panControlCenter=new u(0,0),this.isTouchDevice=!1,this.pickEnabled=!1,this.setupInteraction()};return f.prototype=Object.create(n.prototype),Object.defineProperties(f.prototype,{showPanControl:{get:function(){return this.panControl.enabled},set:function(e){this.panControl.enabled=e}},showZoomControl:{get:function(){return this.zoomInControl.enabled},set:function(e){this.zoomInControl.enabled=e,this.zoomOutControl.enabled=e}},showHeadingControl:{get:function(){return this.headingLeftControl.enabled},set:function(e){this.headingLeftControl.enabled=e,this.headingRightControl.enabled=e}},showTiltControl:{get:function(){return this.tiltUpControl.enabled},set:function(e){this.tiltUpControl.enabled=e,this.tiltDownControl.enabled=e}},showExaggerationControl:{get:function(){return this.exaggerationUpControl.enabled},set:function(e){this.exaggerationUpControl.enabled=e,this.exaggerationDownControl.enabled=e}},showFieldOfViewControl:{get:function(){return this.fovNarrowControl.enabled},set:function(e){this.fovNarrowControl.enabled=e,this.fovWideControl.enabled=e}},inactiveOpacity:{get:function(){return this._inactiveOpacity},set:function(e){this._inactiveOpacity=e;for(var t=0;t<this.controls.length;t++)this.controls[t].opacity=e}},activeOpacity:{get:function(){return this._activeOpacity},set:function(e){this._activeOpacity=e;for(var t=0;t<this.controls.length;t++)this.controls[t].opacity=e}}}),f.prototype.doRender=function(e){var t=0,n=64,r,i,s,o;this.inCurrentFrame=!1,this.showPanControl&&(t+=this.panControl.size,this.inCurrentFrame=!0),this.showZoomControl&&(t+=this.zoomInControl.size,this.inCurrentFrame=!0),this.showHeadingControl&&(t+=this.headingLeftControl.size,this.inCurrentFrame=!0),this.showTiltControl&&(t+=this.tiltDownControl.size,this.inCurrentFrame=!0),this.showExaggerationControl&&(t+=this.exaggerationDownControl.size,this.inCurrentFrame=!0),this.showFieldOfViewControl&&(t+=this.fovNarrowControl.size,this.inCurrentFrame=!0),i=this.placement.offsetForSize(e.navigatorState.viewport.width,e.navigatorState.viewport.height),r=this.alignment.offsetForSize(t,n),s=i[0]-r[0],o=i[1]-r[1],this.showPanControl&&(this.panControl.screenOffset.x=s,this.panControl.screenOffset.y=o,this.panControl.render(e),this.panControlCenter[0]=s+this.panControl.size/2,this.panControlCenter[1]=o+this.panControl.size/2,s+=this.panControl.size),this.showZoomControl&&(this.zoomOutControl.screenOffset.x=s,this.zoomOutControl.screenOffset.y=o,this.zoomInControl.screenOffset.x=s,this.zoomInControl.screenOffset.y=o+this.zoomOutControl.size,this.zoomOutControl.render(e),this.zoomInControl.render(e),s+=this.zoomOutControl.size),this.showHeadingControl&&(this.headingRightControl.screenOffset.x=s,this.headingRightControl.screenOffset.y=o,this.headingLeftControl.screenOffset.x=s,this.headingLeftControl.screenOffset.y=o+this.headingLeftControl.size,this.headingRightControl.render(e),this.headingLeftControl.render(e),s+=this.headingLeftControl.size),this.showTiltControl&&(this.tiltDownControl.screenOffset.x=s,this.tiltDownControl.screenOffset.y=o,this.tiltUpControl.screenOffset.x=s,this.tiltUpControl.screenOffset.y=o+this.tiltDownControl.size,this.tiltDownControl.render(e),this.tiltUpControl.render(e),s+=this.tiltDownControl.size),this.showExaggerationControl&&(this.exaggerationDownControl.screenOffset.x=s,this.exaggerationDownControl.screenOffset.y=o,this.exaggerationUpControl.screenOffset.x=s,this.exaggerationUpControl.screenOffset.y=o+this.exaggerationDownControl.size,this.exaggerationUpControl.render(e),this.exaggerationDownControl.render(e),s+=this.exaggerationDownControl.size),this.showFieldOfViewControl&&(this.fovNarrowControl.screenOffset.x=s,this.fovNarrowControl.screenOffset.y=o,this.fovWideControl.screenOffset.x=s,this.fovWideControl.screenOffset.y=o+this.fovNarrowControl.size,this.fovNarrowControl.render(e),this.fovWideControl.render(e))},f.prototype.setupInteraction=function(){var e=this.wwd,t=this,n=function(n){if(!t.enabled)return;if(t.isTouchDevice)return;var r,i;t.highlightedControl&&(t.highlight(t.highlightedControl,!1),t.wwd.redraw()),n.type&&n.type==="mouseup"&&n.which===1&&t.activeControl?(t.activeControl=null,t.activeOperation=null,n.preventDefault()):(t.activeOperation?(t.activeOperation.call(t,n,null),n.preventDefault()):(r=t.pickControl(e.canvasCoordinates(n.clientX,n.clientY)),i=t.determineOperation(n,r),i&&i.call(t,n,r)),t.handleHighlight(n,r),t.wwd.redraw())};e.addEventListener("mousedown",n),e.addEventListener("mouseup",n),e.addEventListener("mousemove",n),window.addEventListener("mouseup",n),window.addEventListener("mousemove",n);var r=function(n){this.isTouchDevice=!0;if(!t.enabled)return;t.highlightedControl&&(t.highlight(t.highlightedControl,!1),t.wwd.redraw());if(!n.type||n.type!=="touchend"&&n.type!=="touchcancel")if(t.activeOperation)t.activeOperation.call(t,n,null),n.preventDefault();else{var r,i=n.changedTouches.item(0),s;r=t.pickControl(e.canvasCoordinates(i.clientX,i.clientY)),s=t.determineOperation(n,r),s&&s.call(t,n,r)}else t.activeControl&&t.isCurrentTouch(n)&&(t.activeControl=null,t.activeOperation=null,n.preventDefault());t.handleHighlight(n,r),t.wwd.redraw()};e.addEventListener("touchstart",r),e.addEventListener("touchend",r),e.addEventListener("touchcancel",r),e.addEventListener("touchmove",r)},f.prototype.isControl=function(e){for(var t=0;t<this.controls.length;t++)if(this.controls[t]==e)return!0;return!1},f.prototype.pickControl=function(e){var t=e[0],n=this.wwd.canvas.height-e[1],r;for(var i=0;i<this.controls.length;i++){r=this.controls[i];if(r.enabled&&t>=r.screenOffset.x&&t<=r.screenOffset.x+r.size&&n>=r.screenOffset.y&&n<=r.screenOffset.y+r.size)return r}return null},f.prototype.determineOperation=function(e,t){var n=null;if(t&&t instanceof o)if(t===this.panControl)n=this.handlePan;else if(t===this.zoomInControl||t===this.zoomOutControl)n=this.handleZoom;else if(t===this.headingLeftControl||t===this.headingRightControl)n=this.handleHeading;else if(t===this.tiltUpControl||t===this.tiltDownControl)n=this.handleTilt;else if(t===this.exaggerationUpControl||t===this.exaggerationDownControl)n=this.handleExaggeration;else if(t===this.fovNarrowControl||t===this.fovWideControl)n=this.handleFov;return n},f.prototype.isCurrentTouch=function(e){for(var t=0;t<e.changedTouches.length;t++)if(e.changedTouches.item(t).identifier===this.currentTouchId)return!0;return!1},f.prototype.handlePan=function(t,n){if(t.type==="mousedown"||t.type==="mousemove")this.currentEventPoint=this.wwd.canvasCoordinates(t.clientX,t.clientY);else if(t.type==="touchstart"||t.type==="touchmove"){var i=t.changedTouches.item(0);this.currentEventPoint=this.wwd.canvasCoordinates(i.clientX,i.clientY)}if(t.type==="mousedown"&&t.which===1||t.type==="touchstart"){this.activeControl=n,this.activeOperation=this.handlePan,t.preventDefault(),t.type==="touchstart"&&(this.currentTouchId=t.changedTouches.item(0).identifier);var s=this,o=function(){if(s.activeControl){var t=s.panControlCenter[0]-s.currentEventPoint[0],n=s.panControlCenter[1]-(s.wwd.viewport.height-s.currentEventPoint[1]),i=s.wwd.navigator.lookAtLocation.latitude,u=s.wwd.navigator.lookAtLocation.longitude,a=s.panIncrement*(s.wwd.navigator.range/s.wwd.globe.radiusAt(i,u)),f=s.wwd.navigator.heading+Math.atan2(t,n)*e.RADIANS_TO_DEGREES,l=a*Math.sqrt(t*t+n*n);r.greatCircleLocation(s.wwd.navigator.lookAtLocation,f,-l,s.wwd.navigator.lookAtLocation),s.wwd.redraw(),setTimeout(o,50)}};setTimeout(o,50)}},f.prototype.handleZoom=function(e,t){if(e.type==="mousedown"&&e.which===1||e.type==="touchstart"){this.activeControl=t,this.activeOperation=this.handleZoom,e.preventDefault(),e.type==="touchstart"&&(this.currentTouchId=e.changedTouches.item(0).identifier);var n=this,r=function(){n.activeControl&&(n.activeControl===n.zoomInControl?n.wwd.navigator.range*=1-n.zoomIncrement:n.activeControl===n.zoomOutControl&&(n.wwd.navigator.range*=1+n.zoomIncrement),n.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},f.prototype.handleHeading=function(e,t){if(e.type==="mousedown"&&e.which===1||e.type==="touchstart"){this.activeControl=t,this.activeOperation=this.handleHeading,e.preventDefault(),e.type==="touchstart"&&(this.currentTouchId=e.changedTouches.item(0).identifier);var n=this,r=function(){n.activeControl&&(n.activeControl===n.headingLeftControl?n.wwd.navigator.heading+=n.headingIncrement:n.activeControl===n.headingRightControl&&(n.wwd.navigator.heading-=n.headingIncrement),n.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},f.prototype.handleTilt=function(e,t){if(e.type==="mousedown"&&e.which===1||e.type==="touchstart"){this.activeControl=t,this.activeOperation=this.handleTilt,e.preventDefault(),e.type==="touchstart"&&(this.currentTouchId=e.changedTouches.item(0).identifier);var n=this,r=function(){n.activeControl&&(n.activeControl===n.tiltUpControl?n.wwd.navigator.tilt=Math.max(0,n.wwd.navigator.tilt-n.tiltIncrement):n.activeControl===n.tiltDownControl&&(n.wwd.navigator.tilt=Math.min(90,n.wwd.navigator.tilt+n.tiltIncrement)),n.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},f.prototype.handleExaggeration=function(e,t){if(e.type==="mousedown"&&e.which===1||e.type==="touchstart"){this.activeControl=t,this.activeOperation=this.handleExaggeration,e.preventDefault(),e.type==="touchstart"&&(this.currentTouchId=e.changedTouches.item(0).identifier);var n=this,r=function(){n.activeControl&&(n.activeControl===n.exaggerationUpControl?n.wwd.verticalExaggeration+=n.exaggerationIncrement:n.activeControl===n.exaggerationDownControl&&(n.wwd.verticalExaggeration=Math.max(1,n.wwd.verticalExaggeration-n.exaggerationIncrement)),n.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},f.prototype.handleFov=function(e,t){if(e.type==="mousedown"&&e.which===1||e.type==="touchstart"){this.activeControl=t,this.activeOperation=this.handleFov,e.preventDefault(),e.type==="touchstart"&&(this.currentTouchId=e.changedTouches.item(0).identifier);var n=this,r=function(){n.activeControl&&(n.activeControl===n.fovWideControl?n.wwd.navigator.fieldOfView=Math.max(90,n.wwd.navigator.fieldOfView+n.fieldOfViewIncrement):n.activeControl===n.fovNarrowControl&&(n.wwd.navigator.fieldOfView=Math.min(0,n.wwd.navigator.fieldOfView-n.fieldOfViewIncrement)),n.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},f.prototype.handleHighlight=function(e,t){this.activeControl?this.highlight(this.activeControl,!0):t&&this.isControl(t)&&this.highlight(t,!0)},f.prototype.highlight=function(e,t){e.opacity=t?this._activeOpacity:this._inactiveOpacity,t?this.highlightedControl=e:this.highlightedControl=null},f}),n("ogc/WmsLayerCapabilities",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n,r){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsLayerCapabilities","constructor","Layer element is null or undefined."));this.parent=r,this.layers,this.name,this.title,this.abstract,this.keywordList,this.identifiers,this.metadataUrls,this.dataUrls,this.featureListUrls,this.assembleLayer(n)};return Object.defineProperties(n.prototype,{capability:{get:function(){var e=this;while(e&&e instanceof n)e=e.parent;return e}},queryable:{get:function(){return n.replace(this,"_queryable")}},cascaded:{get:function(){return n.replace(this,"_cascaded")}},opaque:{get:function(){return n.replace(this,"_opaque")}},noSubsets:{get:function(){return n.replace(this,"_noSubsets")}},fixedWidth:{get:function(){return n.replace(this,"_fixedWidth")}},fixedHeight:{get:function(){return n.replace(this,"_fixedHeight")}},styles:{get:function(){return n.accumulate(this,"_styles",[])}},crses:{get:function(){return n.accumulate(this,"_crses",[])}},srses:{get:function(){return n.accumulate(this,"_srses",[])}},geographicBoundingBox:{get:function(){return n.replace(this,"_geographicBoundingBox")}},latLonBoundingBox:{get:function(){return n.replace(this,"_latLonBoundingBox")}},boundingBoxes:{get:function(){return n.replace(this,"_boundingBoxes")}},dimensions:{get:function(){var e=[],t=this;while(t&&t instanceof n)t._dimensions&&t._dimensions.length>0&&t._dimensions.forEach(function(t){var n=t.name,r=!0;e.forEach(function(e){e.name===n&&(r=!1)}),r&&e.push(t)}),t=t.parent;return e.length>0?e:undefined}},extents:{get:function(){var e=[],t=this;while(t&&t instanceof n)t._extents&&t._extents.length>0&&t._extents.forEach(function(t){var n=t.name,r=!0;e.forEach(function(e){e.name===n&&(r=!1)}),r&&e.push(t)}),t=t.parent;return e.length>0?e:undefined}},attribution:{get:function(){return n.replace(this,"_attribution")}},authorityUrls:{get:function(){return n.accumulate(this,"_authorityUrls",[])}},minScaleDenominator:{get:function(){return n.replace(this,"_minScaleDenominator")}},maxScaleDenominator:{get:function(){return n.replace(this,"_maxScaleDenominator")}},scaleHint:{get:function(){return n.replace(this,"_scaleHint")}}}),n.accumulate=function(e,t,r){while(e&&e instanceof n){var i=e[t];if(i)for(var s=0;s<i.length;s++)r.push(i[s]);e=e.parent}return r.length>0?r:null},n.replace=function(e,t){while(e&&e instanceof n){var r=e[t];if(r)return r;e=e.parent}},n.prototype.assembleLayer=function(e){var t,r,i,s;r=e.getAttribute("queryable"),r&&(this._queryable=r==="1"||r==="true"),r=e.getAttribute("opaque"),r&&(this._opaque=r==="1"||r==="true"),r=e.getAttribute("noSubsets"),r&&(this._noSubsets=r==="1"||r==="true"),r=e.getAttribute("cascaded"),r&&(this._cascaded=parseInt("10")),r=e.getAttribute("fixedWidth"),r&&(this._fixedWidth=parseInt("10")),r=e.getAttribute("fixedHeight"),r&&(this._fixedHeight=parseInt("10"));var o=e.children||e.childNodes;for(i=0;i<o.length;i++){var u=o[i];if(u.localName==="Layer")this.layers||(this.layers=[]),this.layers.push(new n(u,this));else if(u.localName==="Name")this.name=u.textContent;else if(u.localName==="Title")this.title=u.textContent;else if(u.localName==="Abstract")this.abstract=u.textContent;else if(u.localName==="KeywordList"){this.keywordList=this.keywordList||[];var a=u.children||u.childNodes;for(var f=0;f<a.length;f++){var l=a[f];l.localName==="Keyword"&&this.keywordList.push(l.textContent)}}else u.localName==="Style"?(this._styles||(this._styles=[]),this._styles.push(n.assembleStyle(u))):u.localName==="CRS"?(this._crses||(this._crses=[]),this._crses.push(u.textContent)):u.localName==="SRS"?(this._srses||(this._srses=[]),this._srses.push(u.textContent)):u.localName==="EX_GeographicBoundingBox"?this._geographicBoundingBox=n.assembleGeographicBoundingBox(u):u.localName==="LatLonBoundingBox"?this._geographicBoundingBox=n.assembleLatLonBoundingBox(u):u.localName==="BoundingBox"?(this._boundingBoxes||(this._boundingBoxes=[]),this._boundingBoxes.push(n.assembleBoundingBox(u))):u.localName==="Dimension"?(this._dimensions||(this._dimensions=[]),this._dimensions.push(n.assembleDimension(u))):u.localName==="Extent"?(this._extents||(this._extents=[]),this._extents.push(n.assembleDimension(u))):u.localName==="Attribution"?this._attribution=n.assembleAttribution(u):u.localName==="AuthorityURL"?(this._authorityUrls||(this._authorityUrls=[]),this._authorityUrls.push(n.assembleAuthorityUrl(u))):u.localName==="Identifier"?(this.identifiers||(this.identifiers=[]),this.identifiers.push(n.assembleIdentifier(u))):u.localName==="MetadataURL"?(this.metadataUrls||(this.metadataUrls=[]),this.metadataUrls.push(n.assembleMetadataUrl(u))):u.localName==="DataURL"?(this.dataUrls||(this.dataUrls=[]),this.dataUrls.push(n.assembleUrl(u))):u.localName==="FeatureListURL"?(this.featureListUrls||(this.featureListUrls=[]),this.featureListUrls.push(n.assembleUrl(u))):u.localName==="MinScaleDenominator"?this._minScaleDenominator=parseFloat(u.textContent):u.localName==="MaxScaleDenominator"?this._maxScaleDenominator=parseFloat(u.textContent):u.localName==="ScaleHint"&&(this._scaleHint={},this._scaleHint.min=n.getFloatAttribute(u,"min"),this._scaleHint.max=n.getFloatAttribute(u,"max"))}},n.assembleStyle=function(e){var t={},r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="Name"?t.name=s.textContent:s.localName==="Title"?t.title=s.textContent:s.localName==="Abstract"?t.abstract=s.textContent:s.localName==="LegendURL"?(t.legendUrls||(t.legendUrls=[]),t.legendUrls.push(n.assembleLegendUrl(s))):s.localName==="StyleSheetURL"?t.styleSheetUrl=n.assembleUrl(s):s.localName==="StyleURL"&&(t.styleUrl=n.assembleUrl(s))}return t},n.assembleGeographicBoundingBox=function(e){var t={},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="westBoundLongitude"?t.westBoundLongitude=parseFloat(i.textContent):i.localName==="eastBoundLongitude"?t.eastBoundLongitude=parseFloat(i.textContent):i.localName==="southBoundLatitude"?t.southBoundLatitude=parseFloat(i.textContent):i.localName==="northBoundLatitude"&&(t.northBoundLatitude=parseFloat(i.textContent))}return t},n.assembleLatLonBoundingBox=function(e){var t={};return t.minx=n.getFloatAttribute(e,"minx"),t.miny=n.getFloatAttribute(e,"miny"),t.maxx=n.getFloatAttribute(e,"maxx"),t.maxy=n.getFloatAttribute(e,"maxy"),t},n.assembleBoundingBox=function(e){var t={};return t.crs=e.getAttribute("CRS"),t.minx=n.getFloatAttribute(e,"minx"),t.miny=n.getFloatAttribute(e,"miny"),t.maxx=n.getFloatAttribute(e,"maxx"),t.maxy=n.getFloatAttribute(e,"maxy"),t.resx=n.getFloatAttribute(e,"resx"),t.resy=n.getFloatAttribute(e,"resy"),t},n.assembleDimension=function(e){var t={};return t.name=e.getAttribute("name"),t.units=e.getAttribute("units"),t.unitSymbol=e.getAttribute("unitSymbol"),t.default=e.getAttribute("default"),t.multipleValues=e.getAttribute("multipleValues"),t.multipleValues&&(t.multipleValues=t.multipleValues==="true"||t.multipleValues==="1"),t.nearestValue=e.getAttribute("nearestValue"),t.nearestValue&&(t.nearestValue=t.nearestValue==="true"||t.nearestValue==="1"),t.current=e.getAttribute("current"),t.current&&(t.current=t.current==="true"||t.current==="1"),t.content=e.textContent,t},n.assembleAttribution=function(e){var t={},r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="Title"?t.title=s.textContent:s.localName==="OnlineResource"?t.url=s.getAttribute("xlink:href"):s.localName==="LogoUrul"&&(t.logoUrl=n.assembleLogoUrl(s))}return t},n.assembleAuthorityUrl=function(e){var t={};t.name=e.getAttribute("name");var n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="OnlineResource"&&(t.url=i.getAttribute("xlink:href"))}return t},n.assembleIdentifier=function(e){var t={};return t.authority=e.getAttribute("authority"),t.content=e.textContent,t},n.assembleMetadataUrl=function(e){var t={};t.type=e.getAttribute("type");var n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="Format"?t.format=i.textContent:i.localName==="OnlineResource"&&(t.url=i.getAttribute("xlink:href"))}return t},n.assembleLegendUrl=function(e){var t={};t.width=n.getIntegerAttribute(e,"width"),t.height=n.getIntegerAttribute(e,"height");var r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="Format"?t.format=s.textContent:s.localName==="OnlineResource"&&(t.url=s.getAttribute("xlink:href"))}return t},n.assembleLogoUrl=function(e){var t={};t.width=n.getIntegerAttribute(e,"width"),t.height=n.getIntegerAttribute(e,"height");var r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="Format"?t.format=s.textContent:s.localName==="OnlineResource"&&(t.url=s.getAttribute("xlink:href"))}return t},n.assembleUrl=function(e){var t={},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="Format"?t.format=i.textContent:i.localName==="OnlineResource"&&(t.url=i.getAttribute("xlink:href"))}return t},n.getIntegerAttribute=function(e,t){var n=e.getAttribute(t);return n?n=parseInt(n):n=undefined,n},n.getFloatAttribute=function(e,t){var n=e.getAttribute(t);return n?n=parseFloat(n):n=undefined,n},n}),n("ogc/WmsCapabilities",["../error/ArgumentError","../util/Logger","../ogc/WmsLayerCapabilities"],function(e,t,n){"use strict";var r=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsCapabilities","constructor","No XML DOM specified."));this.assembleDocument(n)};return r.prototype.assembleDocument=function(e){var t=e.documentElement;this.version=t.getAttribute("version"),this.updateSequence=t.getAttribute("updateSequence");var n=t.children||t.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="Service"?this.service=this.assembleService(i):i.localName==="Capability"&&(this.capability=this.assembleCapability(i))}},r.prototype.assembleService=function(e){var t={capsDoc:this},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="Name"?t.name=i.textContent:i.localName==="Title"?t.title=i.textContent:i.localName==="Abstract"?t.abstract=i.textContent:i.localName==="KeywordList"?t.keywordList=this.assembleKeywordList(i):i.localName==="OnlineResource"?t.onlineResource=i.getAttribute("xlink:href"):i.localName==="Fees"?t.fees=i.textContent:i.localName==="AccessConstraints"?t.accessConstraints=i.textContent:i.localName=="LayerLimit"?t.layerLimit=parseInt(i.textContent):i.localName=="MaxWidth"?t.maxWidth=parseInt(i.textContent):i.localName=="MaxHeight"?t.maxHeight=parseInt(i.textContent):i.localName==="ContactInformation"&&(t.contactInformation=this.assembleContactInformation(i))}return t},r.prototype.assembleKeywordList=function(e){var t=[],n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="Keyword"&&t.push(i.textContent)}return t},r.prototype.assembleContactInformation=function(e){var t={},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="ContactPersonPrimary"?t.contactPersonPrimary=this.assembleContactPersonPrimary(i):i.localName==="ContactPosition"?t.contactPosition=i.textContent:i.localName==="ContactVoiceTelephone"?t.contactVoiceTelephone=i.textContent:i.localName==="ContactFacsimileTelephone"?t.contactFacsimileTelephone=i.textContent:i.localName==="ContactElectronicMailAddress"?t.contactElectronicMailAddress=i.textContent:i.localName==="ContactAddress"&&(t.contactAddress=this.assembleContactAddress(i))}return t},r.prototype.assembleContactPersonPrimary=function(e){var t={},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="ContactPerson"?t.contactPerson=i.textContent:i.localName==="ContactOrganization"&&(t.contactOrganization=i.textContent)}return t},r.prototype.assembleContactAddress=function(e){var t={},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="AddressType"?t.addressType=i.textContent:i.localName==="Address"?t.address=i.textContent:i.localName==="City"?t.city=i.textContent:i.localName==="StateOrProvince"?t.stateOrProvince=i.textContent:i.localName==="PostCode"?t.postCode=i.textContent:i.localName==="Country"&&(t.country=i.textContent)}return t},r.prototype.assembleCapability=function(e){var t={capsDoc:this},r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="Request"?t.request=this.assembleRequests(s):s.localName==="Exception"?t.exception=this.assembleException(s):s.localName==="Layer"&&(t.layers=t.layers||[],t.layers.push(new n(s,t)))}return t},r.prototype.assembleRequests=function(e){var t={},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="GetCapabilities"?t.getCapabilities=this.assembleRequest(i):i.localName==="GetMap"?t.getMap=this.assembleRequest(i):i.localName==="GetFeatureInfo"&&(t.getFeatureInfo=this.assembleRequest(i))}return t},r.prototype.assembleRequest=function(e){var t={name:e.localName},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];if(i.localName==="Format")t.formats=t.formats||[],t.formats.push(i.textContent);else if(i.localName==="DCPType"){var s=i.children||i.childNodes;for(var o=0;o<s.length;o++){var u=s[o];if(u.localName==="HTTP"){var a=u.children||u.childNodes;for(var f=0;f<a.length;f++){var l=a[f];if(l.localName==="Get"){var c=l.children||l.childNodes;for(var h=0;h<c.length;h++){var p=c[h];p.localName==="OnlineResource"&&(t.url=p.getAttribute("xlink:href"))}}}}}}}return t},r.prototype.assembleException=function(e){var t={},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="Format"&&(t.formats=t.formats||[],t.formats.push(i.textContent))}return t},r}),n("layer/WmsLayer",["../error/ArgumentError","../geom/Location","../util/Logger","../util/PeriodicTimeSequence","../geom/Sector","../layer/TiledImageLayer","../util/WmsUrlBuilder"],function(e,t,n,r,i,s,o){"use strict";var u=function(t,r){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"WmsLayer","constructor","No configuration specified."));var i=t.service+t.layerNames+t.styleNames;r&&(i+=r),s.call(this,t.sector,t.levelZeroDelta,t.numLevels,t.format,i,t.size,t.size),this.displayName=t.title,this.pickEnabled=!1,this.urlBuilder=new o(t.service,t.layerNames,t.styleNames,t.version,r),t.coordinateSystem&&(this.urlBuilder.crs=t.coordinateSystem),this.timeString=r};return u.prototype=Object.create(s.prototype),u.formLayerConfiguration=function(e){var n={title:e.title,version:e.capability.capsDoc.version},r=e.geographicBoundingBox||e.latLonBoundingBox;r&&r.westBoundLongitude?n.sector=new i(r.southBoundLatitude,r.northBoundLatitude,r.westBoundLongitude,r.eastBoundLongitude):r&&r.minx?n.sector=new i(r.miny,r.maxy,r.minx,r.maxx):n.sector=i.FULL_SPHERE,n.levelZeroDelta=new t(36,36),n.numLevels=19,n.size=256,n.layerNames=e.name;var s=e.capability.request.getMap,o=s.formats;o.indexOf("image/png")>=0?n.format="image/png":o.indexOf("image/jpeg")>=0?n.format="image/jpeg":o.indexOf("image/tiff")>=0?n.format="image/tiff":o.indexOf("image/gif")>=0&&(n.format="image/gif"),n.service=s.url;var a=e.crses;a||(a=e.srses);if(a)if(a.indexOf("EPSG:4326")>=0||a.indexOf("epsg:4326")>=0)n.coordinateSystem="EPSG:4326";else if(a.indexOf("CRS84")>=0||a.indexOf("CRS:84")>=0)n.coordinateSystem="CRS:84";var f=u.parseTimeDimensions(e);return f&&f.length>0&&(n.timeSequences=f),n},u.parseTimeDimensions=function(e){var t=e.extents||e.dimensions,n=null;if(t){n=[];for(var i=0;i<t.length;i++){var s=t[i];if(s.name.toLowerCase()==="time"&&(!s.units||s.units.toLowerCase()==="iso8601")){var o=s.content.split(",");for(var u=0;u<o.length;u++){var a=o[u],f=a.split("/");f.length===1?n.push(new Date(a)):f.length===3&&n.push(new r(a))}}}}return n},u}),n("layer/WmsTimeDimensionedLayer",["../error/ArgumentError","../layer/Layer","../util/Logger","../layer/WmsLayer"],function(e,t,n,r){"use strict";var i=function(r){if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"WmsTimeDimensionedLayer","constructor","No configuration specified."));t.call(this,"WMS Time Dimensioned Layer"),this.config=r,this.displayName=r.title,this.pickEnabled=!1,this.layers={}};return i.prototype=Object.create(t.prototype),i.prototype.doRender=function(e){if(this.time){var t=this.time.toISOString(),n=this.layers[t];n||(n=new r(this.config,t),this.layers[t]=n),n.opacity=this.opacity,n.doRender(e),this.inCurrentFrame=n.inCurrentFrame}},i}),n("ogc/OwsLanguageString",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"LanguageString","constructor","missingDomElement"));this.value=n.textContent;var r=n.getAttribute("lang");r&&(this.lang=r)};return n}),n("ogc/OwsConstraint",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"OwsConstraint","constructor","missingDomElement"));this.name=n.getAttribute("name");var r=n.children;for(var i=0;i<r.length;i++){var s=r[i];if(s.localName==="AllowedValues"){this.allowedValues=this.allowedValues||[];for(var o=0;o<s.children.length;o++)s.children[o].localName==="Value"&&this.allowedValues.push(s.children[o].textContent)}else s.localName==="AnyValue"?this.anyValue=!0:s.localName==="NoValues"&&(this.noValues=!0)}};return n}),n("ogc/OwsOperationsMetadata",["../error/ArgumentError","../util/Logger","../ogc/OwsConstraint"],function(e,t,n){"use strict";var r=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"OwsOperationsMetadata","constructor","missingDomElement"));var i=n.children;for(var s=0;s<i.length;s++){var o=i[s];o.localName==="Operation"&&(this.operation=this.operation||[],this.operation.push(r.assembleOperation(o)))}};return r.assembleOperation=function(e){var t={};t.name=e.getAttribute("name");var n=e.children;for(var i=0;i<n.length;i++){var s=n[i];s.localName==="DCP"&&(t.dcp=t.dcp||[],t.dcp.push(r.assembleDcp(s)))}return t},r.assembleDcp=function(e){var t={},n=e.children;for(var i=0;i<n.length;i++){var s=n[i];s.localName==="HTTP"&&(t.http=r.assembleHttp(s))}return t},r.assembleHttp=function(e){var t={},n=e.children;for(var i=0;i<n.length;i++){var s=n[i];s.localName==="Get"&&(t.get=t.get||[],t.get.push(r.assembleGet(s)))}return t},r.assembleGet=function(e){var t={};t.href=e.getAttribute("xlink:href");var r=e.children;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="Constraint"&&(t.constraint=t.constraint||[],t.constraint.push(new n(s)))}return t},r}),n("ogc/OwsServiceIdentification",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"OwsServiceIdentification","constructor","missingDomElement"));var r=n.children;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="ServiceType"?this.serviceType=s.textContent:s.localName==="ServiceTypeVersion"?this.serviceTypeVersion=s.textContent:s.localName==="Profile"?(this.profile=this.profiles||[],this.profile.push(s.textContent)):s.localName==="Title"?(this.title=this.title||[],this.title.push(s.textContent)):s.localName==="Abstract"?(this.abstract=this.title||[],this.abstract.push(s.textContent)):s.localName==="Fees"?this.fees=s.textContent:s.localName==="AccessConstraints"&&(this.accessConstraints=this.accessConstraints||[],this.accessConstraints.push(s.textContent))}};return n}),n("ogc/OwsServiceProvider",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"OwsServiceProvider","constructor","missingDomElement"));var r=n.children;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="ProviderName"?this.providerName=s.textContent:s.localName==="ProviderSite"&&(this.providerSite=s.getAttribute("xlink:href"))}};return n}),n("ogc/WmtsLayerCapabilities",["../error/ArgumentError","../util/Logger","../ogc/OwsLanguageString","../ogc/WmsCapabilities"],function(e,t,n,r){"use strict";var i=function(n,r){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmtsLayerCapabilities","constructor","missingDomElement"));this.capabilities=r,this.identifier,this.title,this.abstract,this.keywords,this.wgs84BoundingBox,this.boundingBox,this.styles,this.formats,this.infoFormat,this.dimension,this.metadata,this.tileMatrixSetLink,this.resourceUrl,this.assembleLayer(n)};return i.prototype.assembleLayer=function(e){var t=e.children||e.childNodes;for(var r=0;r<t.length;r++){var s=t[r];s.localName==="Identifier"?this.identifier=s.textContent:s.localName==="Title"?(this.title=this.title||[],this.title.push(new n(s))):s.localName==="Abstract"?(this.abstract=this.abstract||[],this.abstract.push(new n(s))):s.localName==="WGS84BoundingBox"?this.wgs84BoundingBox=i.assembleBoundingBox(s):s.localName==="BoundingBox"?(this.boundingBox=this.boundingBox||[],this.boundingBox.push(i.assembleBoundingBox(s))):s.localName==="Style"?(this.style=this.style||[],this.style.push(i.assembleStyle(s))):s.localName==="Format"?(this.format=this.format||[],this.format.push(s.textContent)):s.localName==="InfoFormat"?(this.infoFormat=this.infoFormat||[],this.infoFormat.push(s.textContent)):s.localName==="Dimension"?(this.dimension=this.dimension||[],this.dimension.push(i.assembleDimension(s))):s.localName==="Metadata"?(this.metadata=this.metadata||[],this.metadata.push(i.assembleMetadata(s))):s.localName==="ResourceURL"?(this.resourceUrl=this.resourceUrl||[],this.resourceUrl.push(i.assembleResourceUrl(s))):s.localName==="TileMatrixSetLink"&&(this.tileMatrixSetLink=this.tileMatrixSetLink||[],this.tileMatrixSetLink.push(i.assembleTileMatrixSetLink(s)))}},i.assembleStyle=function(e){var t={};t.isDefault=e.getAttribute("isDefault");var r=e.children||e.childNodes;for(var s=0;s<r.length;s++){var o=r[s];o.localName==="Identifier"?t.identifier=o.textContent:o.localName==="Title"?(t.title=t.title||[],t.title.push(new n(o))):o.localName==="Abstract"?(t.abstract=t.abstract||[],t.abstract.push(new n(o))):o.localName==="LegendURL"&&(t.legendUrl=t.legendUrl||[],t.legendUrl.push(i.assembleLegendUrl(o)))}return t},i.assembleBoundingBox=function(e){var t={},n=e.getAttribute("crs");n&&(t.crs=n);var r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];if(s.localName==="LowerCorner"){var o=s.textContent.split(" ");t.lowerCorner=[parseFloat(o[0]),parseFloat(o[1])]}else if(s.localName==="UpperCorner"){var u=s.textContent.split(" ");t.upperCorner=[parseFloat(u[0]),parseFloat(u[1])]}}return t},i.assembleDimension=function(e){var t={},r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="Identifier"?t.identifier=s.textContent:s.localName==="Title"?(t.title=t.title||[],t.title.push(new n(s))):s.localName==="Abstract"?(t.abstract=t.abstract||[],t.abstract.push(new n(s))):s.localName==="UOM"?t.uom={name:s.getAttribute("name"),reference:s.getAttribute("reference")}:s.localName=="UnitSymbol"?t.unitSymbol=s.textContent:s.localName==="Default"?t.default=s.textContent:s.localName==="Current"?t.current=s.textContent==="true":s.localName==="Value"&&(t.value=t.value||[],t.value.push(s.textContent))}return t},i.assembleMetadata=function(e){var t={};return t},i.assembleResourceUrl=function(e){var t={};return t.format=e.getAttribute("format"),t.resourceType=e.getAttribute("resourceType"),t.template=e.getAttribute("template"),t},i.assembleLegendUrl=function(e){var t={};return t.format=e.getAttribute("format"),t.minScaleDenominator=e.getAttribute("minScaleDenominator"),t.maxScaleDenominator=e.getAttribute("maxScaleDenominator"),t.href=e.getAttribute("xlink:href"),t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t},i.assembleTileMatrixSetLink=function(e){var t={},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var s=n[r];s.localName==="TileMatrixSet"?t.tileMatrixSet=s.textContent:s.localName==="TileMatrixSetLimits"&&(t.tileMatrixSetLimits=i.assembleTileMatrixSetLimits(s))}return t},i.assembleTileMatrixSetLimits=function(e){var t={},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var s=n[r];s.localName==="TileMatrixLimits"&&(t.tileMatrixLimits=t.tileMatrixLimits||[],t.tileMatrixLimits.push(i.assembleTileMatrixLimits(s)))}return t},i.assembleTileMatrixLimits=function(e){var t={},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="TileMatrix"?t.tileMatrix=i.textContent:i.localName==="MinTileRow"?t.minTileRow=parseInt(i.textContent):i.localName==="MaxTileRow"?t.maxTileRow=parseInt(i.textContent):i.localName==="MinTileCol"?t.minTileCol=parseInt(i.textContent):i.localName==="maxTileCol"&&(t.maxTileCol=parseInt(i.textContent))}return t},i}),n("ogc/WmtsCapabilities",["../error/ArgumentError","../util/Logger","../ogc/OwsLanguageString","../ogc/OwsOperationsMetadata","../ogc/OwsServiceIdentification","../ogc/OwsServiceProvider","../ogc/WmsCapabilities","../ogc/WmtsLayerCapabilities"],function(e,t,n,r,i,s,o,u){"use strict";var a=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmtsCapabilities","constructor","No XML DOM specified."));this.assembleDocument(n)};return a.prototype.assembleDocument=function(e){var t=e.documentElement;this.version=t.getAttribute("version"),this.updateSequence=t.getAttribute("updateSequence");var n=t.children||t.childNodes;for(var o=0;o<n.length;o++){var u=n[o];u.localName==="ServiceIdentification"?this.serviceIdentification=new i(u):u.localName==="ServiceProvider"?this.serviceProvider=new s(u):u.localName==="OperationsMetadata"?this.operationsMetadata=new r(u):u.localName==="Contents"&&(this.contents=this.assembleContents(u))}this.resolveTileMatrixSetLinks()},a.prototype.assembleContents=function(e){var n={},r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];if(s.localName==="Layer"){n.layer=n.layer||[];try{n.layer.push(new u(s,this))}catch(o){t.logMessage(t.LEVEL_SEVERE,"WmtsCapabilities","constructor","Exception reading WMTS layer description: "+o.message)}}else if(s.localName==="TileMatrixSet"){n.tileMatrixSet=n.tileMatrixSet||[];try{n.tileMatrixSet.push(a.assembleTileMatrixSet(s))}catch(o){t.logMessage(t.LEVEL_SEVERE,"WmtsCapabilities","constructor","Exception reading WMTS tile matrix set description: "+o.message)}}}return n},a.assembleTileMatrixSet=function(e){var t={},r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="Identifier"?t.identifier=s.textContent:s.localName==="SupportedCRS"?t.supportedCRS=s.textContent:s.localName==="WellKnownScaleSet"?t.wellKnownScaleSet=s.textContent:s.localName==="BoundingBox"?t.boundingBox=u.assembleBoundingBox(s):s.localName==="TileMatrix"?(t.tileMatrix=t.tileMatrix||[],t.tileMatrix.push(a.assembleTileMatrix(s))):s.localName==="Title"?(t.title=t.title||[],t.title.push(new n(s))):s.localName==="Abstract"&&(t.abstract=t.abstract||[],t.abstract.push(new n(s)))}for(var o=0;o<t.tileMatrix.length;o++)t.tileMatrix[o].levelNumber=o;return t},a.assembleTileMatrix=function(e){var t={},r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];if(s.localName==="Identifier")t.identifier=s.textContent;else if(s.localName==="Title")t.title=tileMatrixSet.title||[],t.title.push(new n(s));else if(s.localName==="Abstract")t.abstract=tileMatrixSet.abstract||[],t.abstract.push(new n(s));else if(s.localName==="ScaleDenominator")t.scaleDenominator=parseFloat(s.textContent);else if(s.localName==="TileWidth")t.tileWidth=parseFloat(s.textContent);else if(s.localName==="TileHeight")t.tileHeight=parseFloat(s.textContent);else if(s.localName==="MatrixWidth")t.matrixWidth=parseFloat(s.textContent);else if(s.localName==="MatrixHeight")t.matrixHeight=parseFloat(s.textContent);else if(s.localName==="TopLeftCorner"){var o=s.textContent.split(" ");t.topLeftCorner=[parseFloat(o[0]),parseFloat(o[1])]}}return t},a.prototype.resolveTileMatrixSetLinks=function(){for(var e=0;e<this.contents.layer.length;e++){var t=this.contents.layer[e];for(var n=0;n<t.tileMatrixSetLink.length;n++){var r=t.tileMatrixSetLink[n];for(var i=0;i<this.contents.tileMatrixSet.length;i++)if(this.contents.tileMatrixSet[i].identifier===r.tileMatrixSet){r.tileMatrixSetRef=this.contents.tileMatrixSet[i];break}}}},a.prototype.getGetTileKvpAddress=function(){for(var e=0;e<this.operationsMetadata.operation.length;e++){var t=this.operationsMetadata.operation[e];if(t.name==="GetTile")return t.dcp[0].http.get[0].href}return null},a}),n("layer/WmtsLayerTile",["../geom/Angle","../error/ArgumentError","../geom/BoundingBox","../util/Logger","../geom/Vec3","../util/WWUtil"],function(e,t,n,r,i,s){"use strict";var o=function(t,n,r,i,s){this.sector=t,this.tileMatrix=n,this.row=r,this.column=i,this.imagePath=s,this.texelSize=t.deltaLatitude()*e.DEGREES_TO_RADIANS/n.tileHeight,this.tileKey=n.levelNumber.toString()+"."+r.toString()+"."+i.toString(),this.gpuCacheKey=s};return o.prototype.isEqual=function(e){return e?e.tileKey?this.tileKey==e.tileKey:!1:!1},o.prototype.distanceTo=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Tile","distanceTo","missingVector"));var n=e[0],i=e[1],s=e[2],o,u,a,f=this.samplePoints,l=Number.POSITIVE_INFINITY;for(var c=0,h=f.length;c<h;c+=3)o=n-f[c],u=i-f[c+1],a=s-f[c+2],l=Math.min(l,o*o+u*u+a*a);return Math.sqrt(l)},o.prototype.subdivide=function(e,n){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"WmtsLayerTile","subdivide","The specified tile matrix is null or undefined."));if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"WmtsLayerTile","subdivide","The specified tile factory is null or undefined."));var i,s,o,u,a=[];return i=e.matrixHeight/this.tileMatrix.matrixHeight,s=e.matrixWidth/this.tileMatrix.matrixWidth,o=i*this.row,u=s*this.column,a.push(n.createTile(e,o,u)),o=i*this.row,u=s*this.column+1,a.push(n.createTile(e,o,u)),o=i*this.row+1,u=s*this.column,a.push(n.createTile(e,o,u)),o=i*this.row+1,u=s*this.column+1,a.push(n.createTile(e,o,u)),a},o.prototype.subdivideToCache=function(e,n,i){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Tile","subdivideToCache","The specified tile matrix is null or undefined."));if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"Tile","subdivideToCache","The specified tile factory is null or undefined."));var s=i?i.entryForKey(this.tileKey):null;return s||(s=this.subdivide(e,n),s&&i&&i.putEntry(this.tileKey,s,s.length)),s},o.prototype.mustSubdivide=function(e,t){var n=e.globe.equatorialRadius*this.texelSize,r=this.distanceTo(e.navigatorState.eyePoint),i=e.navigatorState.pixelSizeAtDistance(r);return n>Math.max(t*i,.5)},o.prototype.update=function(e){var t=e.globe.elevationTimestamp(),n=e.verticalExaggeration,r=e.globeStateKey;if(this.updateTimestamp!=t||this.updateVerticalExaggeration!=n||this.updateGlobeStateKey!=r)this.doUpdate(e),e.frameStatistics.incrementTileUpdateCount(1),this.updateTimestamp=t,this.updateVerticalExaggeration=n,this.updateGlobeStateKey=r},o.prototype.doUpdate=function(e){var t=e.globe,r=e.verticalExaggeration,o=t.minAndMaxElevationsForSector(this.sector),u=o?o[0]*r:0,a=o?o[1]*r:0;u==a&&(u=a+10),this.extent||(this.extent=new n),this.extent.setToSector(this.sector,t,u,a),this.samplePoints||(this.sampleElevations=new Float64Array(9),this.samplePoints=new Float64Array(3*this.sampleElevations.length)),s.fillArray(this.sampleElevations,.5*(u+a)),t.computePointsForGrid(this.sector,3,3,this.sampleElevations,i.ZERO,this.samplePoints),this.referencePoint||(this.referencePoint=new i(0,0,0)),t.computePointFromPosition(this.sector.centroidLatitude(),this.sector.centroidLongitude(),0,this.referencePoint)},o.prototype.bind=function(e){var t=e.gpuResourceCache.resourceForKey(this.gpuCacheKey);return t&&t.bind(e)?!0:this.fallbackTile?this.fallbackTile.bind(e):!1},o.prototype.applyInternalTransform=function(e,t){},o}),n("layer/WmtsLayer",["../util/AbsentResourceList","../error/ArgumentError","../util/Logger","../geom/Sector","../layer/Layer","../cache/MemoryCache","../render/Texture","../util/WmsUrlBuilder","../layer/WmtsLayerTile","../util/WWMath","../util/WWUtil"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(o,a,f){if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"WmtsLayer","constructor","No layer configuration specified."));i.call(this,"WMTS Layer"),this.layerIdentifier=o.identifier,this.styleIdentifier=a,this.timeString=f;var l=o.format;l.indexOf("image/png")>=0?this.imageFormat="image/png":l.indexOf("image/jpeg")>=0?this.imageFormat="image/jpeg":l.indexOf("image/tiff")>=0?this.imageFormat="image/tiff":l.indexOf("image/gif")>=0?this.imageFormat="image/gif":this.imageFormat=l[0];if(!this.imageFormat)throw new t(n.logMessage(n.LEVEL_SEVERE,"WmtsLayer","constructor","Layer does not provide a supported image format."));if(o.resourceUrl&&o.resourceUrl.length>1){for(var h=0;h<o.resourceUrl.length;h++)if(this.imageFormat===o.resourceUrl[h].format){this.resourceUrl=o.resourceUrl[h].template;break}}else this.serviceUrl=o.capabilities.getGetTileKvpAddress(),this.serviceUrl&&(this.serviceUrl=u.fixGetMapString(this.serviceUrl));if(!this.resourceUrl&&!this.serviceUrl)throw new t(n.logMessage(n.LEVEL_SEVERE,"WmtsLayer","constructor","No resource URL or KVP GetTile service URL specified in WMTS capabilities."));if(this.styleIdentifier){var p=!1;for(var h=0;h<o.style.length;h++)if(o.style[h].identifier===this.styleIdentifier){p=!0;break}p||(n.logMessage(n.LEVEL_WARNING,"WmtsLayer","constructor","The specified style identifier is not available. The server's default style will be used."),this.styleIdentifier=null)}if(!this.styleIdentifier)for(h=0;h<o.style.length;h++)if(o.style[h].isDefault){this.styleIdentifier=o.style[h].identifier;break}this.styleIdentifier||n.logMessage(n.LEVEL_WARNING,"WmtsLayer","constructor","No default style available. A style will not be specified in tile requests.");var d,v=null,m=null;for(h=0;h<o.tileMatrixSetLink.length;h++)d=o.tileMatrixSetLink[h].tileMatrixSetRef,c.isEpsg4326Crs(d.supportedCRS)?v=v||d:c.isEpsg3857Crs(d.supportedCRS)&&(m=m||d);this.tileMatrixSet=v||m;if(!this.tileMatrixSet)throw new t(n.logMessage(n.LEVEL_SEVERE,"WmtsLayer","constructor","No supported Tile Matrix Set could be found."));if(o.wgs84BoundingBox)this.sector=new r(o.wgs84BoundingBox.lowerCorner[1],o.wgs84BoundingBox.upperCorner[1],o.wgs84BoundingBox.lowerCorner[0],o.wgs84BoundingBox.upperCorner[0]);else if(this.tileMatrixSet.boundingBox&&WmtsLayerCapabilities.isEpsg4326Crs(this.tileMatrixSet.boundingBox.crs))this.sector=new r(this.tileMatrixSet.boundingBox.lowerCorner[1],this.tileMatrixSet.boundingBox.upperCorner[1],this.tileMatrixSet.boundingBox.lowerCorner[0],this.tileMatrixSet.boundingBox.upperCorner[0]);else if(WmtsLayerCapabilities.isEpsg4326Crs(this.tileMatrixSet.supportedCRS))throw new t(n.logMessage(n.LEVEL_SEVERE,"WmtsLayer","constructor","No EPSG:4326 bounding box was specified in the layer or tile matrix set capabilities."));this.cachePath=(this.resourceUrl||this.serviceUrl)+this.layerIdentifier+this.styleIdentifier+this.tileMatrixSet.identifier,f&&(this.cachePath=this.cachePath+f),o.title.length>0?this.displayName=o.title[0].value:this.displayName=o.identifier,this.pickEnabled=!1,this.currentTiles=[],this.currentTilesInvalid=!0,this.tileCache=new s(500,400),this.currentRetrievals=[],this.absentResourceList=new e(3,5e4),this.pickEnabled=!1,this.detailControl=1.75};return c.prototype=Object.create(i.prototype),c.prototype.doRender=function(e){if(!e.terrain)return;if(this.currentTilesInvalid||!this.lasTtMVP||!e.navigatorState.modelviewProjection.equals(this.lasTtMVP)||e.globeStateKey!=this.lastGlobeStateKey)this.currentTilesInvalid=!1,this.assembleTiles(e);this.lasTtMVP=e.navigatorState.modelviewProjection,this.lastGlobeStateKey=e.globeStateKey,this.currentTiles.length>0&&(e.surfaceTileRenderer.renderTiles(e,this.currentTiles,this.opacity),e.frameStatistics.incrementImageTileCount(this.currentTiles.length),this.inCurrentFrame=!0)},c.prototype.isLayerInView=function(e){return e.terrain&&e.terrain.sector&&e.terrain.sector.intersects(this.sector)},c.prototype.isTileVisible=function(e,t){return e.globe.projectionLimits&&!t.sector.overlaps(e.globe.projectionLimits)?!1:t.extent.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)},c.prototype.assembleTiles=function(e){this.currentTiles=[],(!this.topLevelTiles||this.topLevelTiles.length===0)&&this.createTopLevelTiles(e);for(var t=0,n=this.topLevelTiles.length;t<n;t++){var r=this.topLevelTiles[t];r.update(e),this.currentAncestorTile=null,this.isTileVisible(e,r)&&this.addTileOrDescendants(e,r)}},c.prototype.addTileOrDescendants=function(e,t){if(this.tileMeetsRenderingCriteria(e,t)){this.addTile(e,t);return}var n=null;try{if(this.isTileTextureInMemory(e,t)||t.tileMatrix.levelNumber===0)n=this.currentAncestorTile,this.currentAncestorTile=t;var r=this.tileMatrixSet.tileMatrix[t.tileMatrix.levelNumber+1],i=t.subdivideToCache(r,this,this.tileCache);for(var s=0,o=i.length;s<o;s++){var u=i[s];u.update(e),this.sector.intersects(u.sector)&&this.isTileVisible(e,u)&&this.addTileOrDescendants(e,u)}}finally{n&&(this.currentAncestorTile=n)}},c.prototype.addTile=function(e,t){t.fallbackTile=null;var n=e.gpuResourceCache.resourceForKey(t.imagePath);if(n){this.currentTiles.push(t),this.expiration&&this.isTextureExpired(n)&&this.retrieveTileImage(e,t);return}this.retrieveTileImage(e,t),this.currentAncestorTile&&this.isTileTextureInMemory(e,this.currentAncestorTile)&&this.currentTiles.push(this.currentAncestorTile)},c.prototype.isTextureExpired=function(e){return this.expiration&&e.creationTime.getTime()<=this.expiration.getTime()},c.prototype.isTileTextureInMemory=function(e,t){return e.gpuResourceCache.containsResource(t.imagePath)},c.prototype.tileMeetsRenderingCriteria=function(e,t){var n=this.detailControl;if(t.sector.minLatitude>=75||t.sector.maxLatitude<=-75)n*=1.2;return t.tileMatrix.levelNumber===this.tileMatrixSet.tileMatrix.length-1||!t.mustSubdivide(e,n)},c.prototype.retrieveTileImage=function(e,t){if(this.currentRetrievals.indexOf(t.imagePath)<0){if(this.absentResourceList.isResourceAbsent(t.imagePath))return;var r=this.resourceUrlForTile(t,this.imageFormat),i=new Image,s=t.imagePath,o=e.gpuResourceCache,u=e.currentGlContext.canvas,a=this;if(!r){this.currentTilesInvalid=!0;return}i.onload=function(){n.log(n.LEVEL_INFO,"Image retrieval succeeded: "+r);var f=a.createTexture(e,t,i);a.removeFromCurrentRetrievals(s);if(f){o.putResource(s,f,f.size),a.currentTilesInvalid=!0,a.absentResourceList.unmarkResourceAbsent(s);var l=document.createEvent("Event");l.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),u.dispatchEvent(l)}},i.onerror=function(){a.removeFromCurrentRetrievals(s),a.absentResourceList.markResourceAbsent(s),n.log(n.LEVEL_WARNING,"Image retrieval failed: "+r)},this.currentRetrievals.push(s),i.crossOrigin="anonymous",i.src=r}},c.prototype.resourceUrlForTile=function(e,t){var n;return this.resourceUrl?(n=this.resourceUrl.replace("{Style}",this.styleIdentifier).replace("{TileMatrixSet}",this.tileMatrixSet.identifier).replace("{TileMatrix}",e.tileMatrix.identifier).replace("{TileCol}",e.column).replace("{TileRow}",e.row),this.timeString&&n.replace("{Time}",this.timeString)):(n=this.serviceUrl+"service=WMTS&request=GetTile&version=1.0.0",n+="&Layer="+this.layerIdentifier,this.styleIdentifier&&(n+="&Style="+this.styleIdentifier),n+="&Format="+t,this.timeString&&(n+="&Time="+this.timeString),n+="&TileMatrixSet="+this.tileMatrixSet.identifier,n+="&TileMatrix="+e.tileMatrix.identifier,n+="&TileRow="+e.row,n+="&TileCol="+e.column),n},c.prototype.removeFromCurrentRetrievals=function(e){var t=this.currentRetrievals.indexOf(e);t>-1&&this.currentRetrievals.splice(t,1)},c.prototype.createTopLevelTiles=function(e){var t=this.tileMatrixSet.tileMatrix[0];this.topLevelTiles=[];for(var n=0;n<t.matrixHeight;n++)for(var r=0;r<t.matrixWidth;r++)this.topLevelTiles.push(this.createTile(t,n,r))},c.prototype.createTile=function(e,t,n){if(c.isEpsg4326Crs(this.tileMatrixSet.supportedCRS))return this.createTile4326(e,t,n);if(c.isEpsg3857Crs(this.tileMatrixSet.supportedCRS))return this.createTile3857(e,t,n)},c.prototype.createTile4326=function(e,t,n){var i=this.sector.deltaLatitude()/e.matrixHeight,s=this.sector.deltaLongitude()/e.matrixWidth,o=e.topLeftCorner[0]-t*i,u=o-i,a=e.topLeftCorner[1]+s*n,f=a+s,l=new r(u,o,a,f);return this.makeTile(l,e,t,n)},c.prototype.createTile3857=function(e,t,n){e.mapWidth||this.computeTileMatrixValues3857(e);var i=f.clamp(n*e.tileWidth-.5,0,e.mapWidth),s=f.clamp(t*e.tileHeight-.5,0,e.mapHeight),o=f.clamp(i+e.tileWidth+.5,0,e.mapWidth),u=f.clamp(s+e.tileHeight+.5,0,e.mapHeight),a,l,c,h,p,d;a=i/e.mapWidth,l=u/e.mapHeight,h=e.topLeftCorner[0]+a*e.tileMatrixDeltaX,c=e.topLeftCorner[1]-l*e.tileMatrixDeltaY;var v=f.epsg3857ToEpsg4326(h,c);a=o/e.mapWidth,l=s/e.mapHeight,d=e.topLeftCorner[0]+a*e.tileMatrixDeltaX,p=e.topLeftCorner[1]-l*e.tileMatrixDeltaY;var m=f.epsg3857ToEpsg4326(d,p),g=new r(v[0],m[0],v[1],m[1]);return this.makeTile(g,e,t,n)},c.prototype.computeTileMatrixValues3857=function(e){var t=e.scaleDenominator*28e-5,n=e.tileWidth*t,r=e.tileHeight*t,i=e.topLeftCorner[0]+n*e.matrixWidth,s=e.topLeftCorner[1]-r*e.matrixHeight,o=[i,s],u=e.topLeftCorner;e.tileMatrixDeltaX=o[0]-u[0],e.tileMatrixDeltaY=u[1]-o[1],e.mapWidth=e.tileWidth*e.matrixWidth,e.mapHeight=e.tileHeight*e.matrixHeight},c.prototype.makeTile=function(e,t,n,r){var i=this.cachePath+"-layer/"+t.identifier+"/"+n+"/"+r+"."+l.suffixForMimeType(this.imageFormat);return new a(e,t,n,r,i)},c.prototype.createTexture=function(e,t,n){if(c.isEpsg4326Crs(this.tileMatrixSet.supportedCRS))return new o(e.currentGlContext,n);if(c.isEpsg3857Crs(this.tileMatrixSet.supportedCRS))return this.createTexture3857(e,t,n)},c.prototype.createTexture3857=function(e,t,n){this.destCanvas||(this.destCanvas=document.createElement("canvas"),this.destContext=this.destCanvas.getContext("2d"));var r=e.canvas2D,i=e.ctx2D,s,u=this.destCanvas,a=this.destContext,l=a.createImageData(n.width,n.height),c=t.sector,h=f.gudermannianInverse(c.minLatitude),p=f.gudermannianInverse(c.maxLatitude),d,v,m,g,y,b,w;r.width=n.width,r.height=n.height,u.width=n.width,u.height=n.height,i.drawImage(n,0,0,n.width,n.height),s=i.getImageData(0,0,n.width,n.height);for(var E=0;E<1;E++)for(var S=0;S<n.height;S++){b=1-S/(n.height-1),d=b*c.deltaLatitude()+c.minLatitude,v=f.gudermannianInverse(d),w=1-(v-h)/(p-h),w=f.clamp(w,0,1),m=Math.floor(w*(n.height-1));for(var x=0;x<n.width;x++)g=4*(x+m*n.width),y=4*(x+S*n.width),l.data[y]=s.data[g],l.data[y+1]=s.data[g+1],l.data[y+2]=s.data[g+2],l.data[y+3]=s.data[g+3]}return a.putImageData(l,0,0),new o(e.currentGlContext,u)},c.isEpsg4326Crs=function(e){return e.indexOf("EPSG")>=0&&e.indexOf("4326")>=0},c.isEpsg3857Crs=function(e){return e.indexOf("EPSG")>=0&&(e.indexOf("3857")>=0||e.indexOf("900913")>=0)},c}),n("WorldWindow",["./error/ArgumentError","./render/DrawContext","./globe/EarthElevationModel","./util/FrameStatistics","./globe/Globe","./globe/Globe2D","./util/GoToAnimator","./cache/GpuResourceCache","./util/Logger","./navigate/LookAtNavigator","./navigate/NavigatorState","./pick/PickedObjectList","./geom/Rectangle","./geom/Sector","./shapes/SurfaceShape","./shapes/SurfaceShapeTileBuilder","./globe/Terrain","./geom/Vec2"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){"use strict";var y=function(s,u){function d(e){p.handleContextLost(e)}function v(e){p.handleContextRestored(e)}function m(e){p.handleRedrawEvent(e)}if(!window.WebGLRenderingContext)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","constructor","The specified canvas does not support WebGL."));var l=document.getElementById(s);if(!l)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","constructor","The specified canvas name is not in the document."));var c=this.createContext(l);this.drawContext=new t(c),this.eventListeners={},this.redrawRequested=!0,this.redrawRequestId=null,this.canvas=l,this.depthBits=c.getParameter(c.DEPTH_BITS),this.viewport=new h(0,0,c.drawingBufferWidth,c.drawingBufferHeight),this.globe=new i(u||new n),this.layers=[],this.navigator=new f(this),this.verticalExaggeration=1,this.deepPicking=!1,this.subsurfaceMode=!1,this.surfaceOpacity=1,this.frameStatistics=new r,this.goToAnimator=new o(this),this._redrawCallbacks=[],this._orderedRenderingFilters=[function(e){p.declutter(e,1)},function(e){p.declutter(e,2)}],this.pixelScale=1;var p=this;this.canvas.addEventListener("webglcontextlost",d,!1),this.canvas.addEventListener("webglcontextrestored",v,!1),this.canvas.addEventListener(WorldWind.REDRAW_EVENT_TYPE,m,!1),window.addEventListener(WorldWind.REDRAW_EVENT_TYPE,m,!1),this.animationFrameLoop()};return Object.defineProperties(y.prototype,{orderedRenderingFilters:{get:function(){return this._orderedRenderingFilters}},redrawCallbacks:{get:function(){return this._redrawCallbacks}}}),y.prototype.canvasCoordinates=function(e,t){var n=this.canvas.getBoundingClientRect(),r=e-(n.left+this.canvas.clientLeft),i=t-(n.top+this.canvas.clientTop);return new g(r,i)},y.prototype.addEventListener=function(t,n){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","addEventListener","missingType"));if(!n)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","addEventListener","missingListener"));var r=this,i=this.eventListeners[t];i||(i={listeners:[],callback:function(e){e.worldWindow=r;for(var t=0,n=i.listeners.length;t<n;t++)i.listeners[t](e)}},this.eventListeners[t]=i);var s=i.listeners.indexOf(n);s==-1&&(i.listeners.splice(0,0,n),i.listeners.length==1&&this.canvas.addEventListener(t,i.callback,!1))},y.prototype.removeEventListener=function(t,n){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","removeEventListener","missingType"));if(!n)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","removeEventListener","missingListener"));var r=this.eventListeners[t];if(!r)return;var i=r.listeners.indexOf(n);i!=-1&&(r.listeners.splice(i,1),r.listeners.length==0&&this.canvas.removeEventListener(t,r.callback,!1))},y.prototype.redraw=function(){this.redrawRequested=!0},y.prototype.pick=function(t){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","pick","missingPoint"));return this.drawContext.currentGlContext.isContextLost()?new c:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.pickPoint=t,this.drawFrame(),this.drawContext.objectsAtPickPoint)},y.prototype.pickTerrain=function(t){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","pickTerrain","missingPoint"));return this.drawContext.currentGlContext.isContextLost()?new c:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.pickTerrainOnly=!0,this.drawContext.pickPoint=t,this.drawFrame(),this.drawContext.objectsAtPickPoint)},y.prototype.pickShapesInRegion=function(t){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","pickShapesInRegion","missingRectangle"));return this.drawContext.currentGlContext.isContextLost()?new c:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.regionPicking=!0,this.drawContext.pickRectangle=new h(t.x,this.canvas.height-t.y,t.width,t.height),this.drawFrame(),this.drawContext.objectsAtPickPoint)},y.prototype.createContext=function(e){var t={antialias:!1,stencil:!0},n=e.getContext("webgl",t);n||(n=e.getContext("experimental-webgl",t));var r=n.getContextAttributes();return this.hasStencilBuffer=r.stencil,n},y.prototype.handleContextLost=function(e){a.log(a.LEVEL_INFO,"WebGL context event: "+e.statusMessage),e.preventDefault(),this.drawContext.contextLost(),window.cancelAnimationFrame(this.redrawRequestId)},y.prototype.handleContextRestored=function(e){a.log(a.LEVEL_INFO,"WebGL context event: "+e.statusMessage),this.drawContext.contextRestored(),this.redraw(),this.animationFrameLoop()},y.prototype.handleRedrawEvent=function(e){this.redraw()},y.prototype.animationFrameLoop=function(){function t(){e.animationFrameLoop()}this.redrawIfNeeded();var e=this;this.redrawRequestId=window.requestAnimationFrame(t)},y.prototype.redrawIfNeeded=function(){this.resize();if(!this.redrawRequested)return;try{this.redrawRequested=!1,this.drawContext.previousRedrawTimestamp=this.drawContext.timestamp,this.callRedrawCallbacks(WorldWind.BEFORE_REDRAW),this.resetDrawContext(),this.drawFrame()}catch(e){a.logMessage(a.LEVEL_SEVERE,"WorldWindow","redrawIfNeeded","Exception occurred during redrawing.\n"+e.toString())}finally{this.callRedrawCallbacks(WorldWind.AFTER_REDRAW),this.drawContext.redrawRequested&&(this.redrawRequested=!0)}},y.prototype.resize=function(){var e=this.drawContext.currentGlContext,t=e.canvas.clientWidth*this.pixelScale,n=e.canvas.clientHeight*this.pixelScale;if(e.canvas.width!=t||e.canvas.height!=n)e.canvas.width=t,e.canvas.height=n,e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),this.viewport=new h(0,0,e.drawingBufferWidth,e.drawingBufferHeight),this.redrawRequested=!0},y.prototype.resetDrawContext=function(){this.globe.offset=0;var e=this.drawContext;e.reset(),e.globe=this.globe,e.layers=this.layers,e.navigatorState=this.navigator.currentState(),e.verticalExaggeration=this.verticalExaggeration,e.surfaceOpacity=this.surfaceOpacity,e.deepPicking=this.deepPicking,e.frameStatistics=this.frameStatistics,e.pixelScale=this.pixelScale,e.update()},y.prototype.drawFrame=function(){try{this.drawContext.frameStatistics.beginFrame(),this.beginFrame(),this.drawContext.globe.is2D()&&this.drawContext.globe.continuous?this.do2DContiguousRepaint():this.doNormalRepaint()}finally{this.endFrame(),this.drawContext.frameStatistics.endFrame()}},y.prototype.doNormalRepaint=function(){this.createTerrain(),this.clearFrame(),this.deferOrderedRendering=!1,this.drawContext.pickingMode?this.drawContext.makePickFrustum()&&(this.doPick(),this.resolvePick()):(this.doDraw(),this.subsurfaceMode&&this.hasStencilBuffer&&(this.redrawSurface(),this.drawScreenRenderables()))},y.prototype.do2DContiguousRepaint=function(){this.createTerrain2DContiguous(),this.clearFrame(),this.drawContext.pickingMode?this.drawContext.makePickFrustum()&&(this.pick2DContiguous(),this.resolvePick()):this.draw2DContiguous()},y.prototype.resolvePick=function(){this.drawContext.pickTerrainOnly?this.resolveTerrainPick():this.drawContext.regionPicking?this.resolveRegionPick():this.resolveTopPick()},y.prototype.beginFrame=function(){var e=this.drawContext.currentGlContext;e.enable(e.BLEND),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.depthFunc(e.LEQUAL),this.drawContext.pickingMode&&(this.drawContext.makePickFramebuffer(),this.drawContext.bindFramebuffer(this.drawContext.pickFramebuffer))},y.prototype.endFrame=function(){var e=this.drawContext.currentGlContext;e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.blendFunc(e.ONE,e.ZERO),e.depthFunc(e.LESS),e.clearColor(0,0,0,1),this.drawContext.bindFramebuffer(null),this.drawContext.bindProgram(null)},y.prototype.clearFrame=function(){var e=this.drawContext,t=e.currentGlContext;t.clearColor(e.clearColor.red,e.clearColor.green,e.clearColor.blue,e.clearColor.alpha),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},y.prototype.doDraw=function(){this.drawContext.renderShapes=!0,this.subsurfaceMode&&this.hasStencilBuffer?(this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawContext.currentGlContext.clear(this.drawContext.currentGlContext.DEPTH_BUFFER_BIT|this.drawContext.currentGlContext.STENCIL_BUFFER_BIT),this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.ALWAYS,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE),this.drawOrderedRenderables(),this.drawContext.screenCreditController.drawCredits(this.drawContext))):(this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawOrderedRenderables(),this.drawScreenRenderables()),this.drawContext.screenCreditController.drawCredits(this.drawContext))},y.prototype.redrawSurface=function(){this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.EQUAL,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.KEEP,this.drawContext.currentGlContext.KEEP,this.drawContext.currentGlContext.KEEP),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!1),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST)},y.prototype.doPick=function(){this.drawContext.terrain&&this.drawContext.terrain.pick(this.drawContext),this.drawContext.pickTerrainOnly||(this.subsurfaceMode&&this.hasStencilBuffer?(this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawContext.currentGlContext.clear(this.drawContext.currentGlContext.DEPTH_BUFFER_BIT|this.drawContext.currentGlContext.STENCIL_BUFFER_BIT),this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.ALWAYS,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE),this.drawOrderedRenderables(),this.drawContext.terrain.pick(this.drawContext),this.drawScreenRenderables())):(this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawOrderedRenderables(),this.drawScreenRenderables())))},y.prototype.createTerrain=function(){var e=this.drawContext;e.terrain=this.globe.tessellator.tessellate(e),e.frameStatistics.setTerrainTileCount(e.terrain?e.terrain.surfaceGeometry.length:0)},y.prototype.makeCurrent=function(e){var t=this.drawContext;t.globe.offset=e,t.globeStateKey=t.globe.stateKey;switch(e){case-1:t.terrain=this.terrainLeft;break;case 0:t.terrain=this.terrainCenter;break;case 1:t.terrain=this.terrainRight}},y.prototype.createTerrain2DContiguous=function(){var e=this.drawContext;this.terrainCenter=null,e.globe.offset=0,e.globeStateKey=e.globe.stateKey,e.globe.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)&&(this.terrainCenter=e.globe.tessellator.tessellate(e)),this.terrainRight=null,e.globe.offset=1,e.globeStateKey=e.globe.stateKey,e.globe.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)&&(this.terrainRight=e.globe.tessellator.tessellate(e)),this.terrainLeft=null,e.globe.offset=-1,e.globeStateKey=e.globe.stateKey,e.globe.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)&&(this.terrainLeft=e.globe.tessellator.tessellate(e))},y.prototype.draw2DContiguous=function(){var e="";this.terrainCenter&&(e+=" 0 ",this.makeCurrent(0),this.deferOrderedRendering=this.terrainLeft||this.terrainRight,this.doDraw()),this.terrainRight&&(e+=" 1 ",this.makeCurrent(1),this.deferOrderedRendering=this.terrainLeft||this.terrainLeft,this.doDraw()),this.deferOrderedRendering=!1,this.terrainLeft&&(e+=" -1 ",this.makeCurrent(-1),this.doDraw()),this.subsurfaceMode&&this.hasStencilBuffer&&(this.deferOrderedRendering=!0,this.terrainCenter&&(e+=" 0 ",this.makeCurrent(0),this.redrawSurface()),this.terrainRight&&(e+=" 1 ",this.makeCurrent(1),this.redrawSurface()),this.terrainLeft&&(e+=" -1 ",this.makeCurrent(-1),this.redrawSurface())),this.drawScreenRenderables()},y.prototype.pick2DContiguous=function(){this.terrainCenter&&(this.makeCurrent(0),this.deferOrderedRendering=this.terrainLeft||this.terrainRight,this.doPick()),this.terrainRight&&(this.makeCurrent(1),this.deferOrderedRendering=this.terrainLeft||this.terrainLeft,this.doPick()),this.deferOrderedRendering=!1,this.terrainLeft&&(this.makeCurrent(-1),this.doPick())},y.prototype.drawLayers=function(e){var t=Date.now(),n=this.drawContext,r=n.layers,i;n.accumulateOrderedRenderables=e;for(var s=0,o=r.length;s<o;s++){i=r[s];if(i){n.currentLayer=i;try{i.render(n)}catch(u){a.log(a.LEVEL_SEVERE,"Error while rendering layer "+i.displayName+".\n"+u.toString())}}}var f=Date.now();n.frameStatistics.layerRenderingTime=f-t},y.prototype.addLayer=function(e){this.layers.push(e)},y.prototype.removeLayer=function(e){if(!e)return;var t=-1;for(var n=0,r=this.layers.length;n<r;n++)if(this.layers[n]==e){t=n;break}t>=0&&this.layers.splice(t,1)},y.prototype.insertLayer=function(e,t){t&&this.layers.splice(e,0,t)},y.prototype.drawSurfaceRenderables=function(){var e=this.drawContext,t;e.reverseSurfaceRenderables();while(t=e.popSurfaceRenderable())try{t.renderSurface(e)}catch(n){a.logMessage(a.LEVEL_WARNING,"WorldWindow","drawSurfaceRenderables","Error while rendering a surface renderable.\n"+n.message)}},y.prototype.drawOrderedRenderables=function(){var e=Date.now(),t=this.drawContext,n;t.sortOrderedRenderables();if(this._orderedRenderingFilters)for(var r=0;r<this._orderedRenderingFilters.length;r++)this._orderedRenderingFilters[r](this.drawContext);t.orderedRenderingMode=!0;while(n=t.popOrderedRenderable())try{n.renderOrdered(t)}catch(i){a.logMessage(a.LEVEL_WARNING,"WorldWindow","drawOrderedRenderables","Error while rendering an ordered renderable.\n"+i.message)}t.orderedRenderingMode=!1,t.frameStatistics.orderedRenderingTime=Date.now()-e},y.prototype.drawScreenRenderables=function(){var e=this.drawContext,t;while(t=e.nextScreenRenderable())try{t.renderOrdered(e)}catch(n){a.logMessage(a.LEVEL_WARNING,"WorldWindow","drawOrderedRenderables","Error while rendering a screen renderable.\n"+n.message)}},y.prototype.resolveTopPick=function(){if(this.drawContext.objectsAtPickPoint.objects.length==0)return;var e=this.drawContext.objectsAtPickPoint,t=this.drawContext.readPickColor(this.drawContext.pickPoint),n=null,r=null;if(t){for(var i=0,s=e.objects.length;i<s;i++){var o=e.objects[i];o.isTerrain&&(r=o);if(o.color.equals(t)){o.isOnTop=!0,n=o;if(r)break}}this.drawContext.deepPicking||(e.clear(),n&&e.add(n),r&&r!=n&&e.add(r))}else e.clear()},y.prototype.resolveTerrainPick=function(){var e=this.drawContext.objectsAtPickPoint,t;for(var n=0,r=e.objects.length;n<r;n++){t=e.objects[n];if(t.isTerrain){t.isOnTop=!0;break}}},y.prototype.resolveRegionPick=function(){if(this.drawContext.objectsAtPickPoint.objects.length==0)return;var e=this.drawContext.objectsAtPickPoint,t=this.drawContext.readPickColors(this.drawContext.pickRectangle),n,r;for(var i=0,s=e.objects.length;i<s;i++){n=e.objects[i];if(!n)continue;var o=n.color.toByteString();r=t[o],r?n.isOnTop=!0:n.userObject instanceof d&&(e.objects.splice(i,1),i-=1)}},y.prototype.callRedrawCallbacks=function(e){for(var t=0,n=this._redrawCallbacks.length;t<n;t++)try{this._redrawCallbacks[t](this,e)}catch(r){a.log(a.LEVEL_SEVERE,"Exception calling redraw callback.\n"+r.toString())}},y.prototype.goTo=function(e,t){this.goToAnimator.goTo(e,t)},y.prototype.declutter=function(t,n){if(!n)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","declutter","Group ID is null, undefined or 0."));var r=[];for(var i=0;i<t.orderedRenderables.length;i++){var s=t.orderedRenderables[i].orderedRenderable;s.declutterGroup===n&&r.push(s)}var o=[];for(var u=0;u<r.length;u++){var f=r[u],l=f.screenBounds;l&&l.intersectsRectangles(o)?f.targetVisibility=0:(f.targetVisibility=1,l&&o.push(l))}},y}),n("util/WWMessage",[],function(){"use strict";var e=function(e,t){this.type=e,this.source=t};return e}),n("WorldWind",["./error/AbstractError","./geom/Angle","./shapes/Annotation","./shapes/AnnotationAttributes","./error/ArgumentError","./shaders/BasicProgram","./shaders/BasicTextureProgram","./layer/BingAerialLayer","./layer/BingAerialWithLabelsLayer","./layer/BingRoadsLayer","./layer/BingWMSLayer","./layer/BlueMarbleLayer","./layer/BMNGLandsatLayer","./layer/BMNGLayer","./layer/BMNGOneImageLayer","./geom/BoundingBox","./gesture/ClickRecognizer","./util/Color","./shapes/Compass","./layer/CompassLayer","./layer/CoordinatesDisplayLayer","./layer/DigitalGlobeTiledImageLayer","./gesture/DragRecognizer","./render/DrawContext","./globe/EarthElevationModel","./globe/EarthRestElevationModel","./globe/ElevationModel","./util/Font","./util/FrameStatistics","./layer/FrameStatisticsLayer","./render/FramebufferTexture","./render/FramebufferTile","./render/FramebufferTileController","./geom/Frustum","./shapes/GeographicMesh","./projections/GeographicProjection","./shapes/GeographicText","./formats/geojson/GeoJSONParser","./gesture/GestureRecognizer","./globe/Globe","./globe/Globe2D","./util/GoToAnimator","./shaders/GpuProgram","./cache/GpuResourceCache","./shaders/GpuShader","./util/HighlightController","./util/ImageSource","./render/ImageTile","./util/Insets","./layer/LandsatRestLayer","./layer/Layer","./util/Level","./util/LevelRowColumnUrlBuilder","./util/LevelSet","./geom/Line","./geom/Location","./util/Logger","./navigate/LookAtNavigator","./geom/Matrix","./cache/MemoryCache","./cache/MemoryCacheListener","./layer/MercatorTiledImageLayer","./navigate/Navigator","./navigate/NavigatorState","./util/NominatimGeocoder","./error/NotYetImplementedError","./util/Offset","./layer/OpenStreetMapImageLayer","./gesture/PanRecognizer","./shapes/Path","./util/PeriodicTimeSequence","./pick/PickedObject","./pick/PickedObjectList","./gesture/PinchRecognizer","./shapes/Placemark","./shapes/PlacemarkAttributes","./geom/Plane","./shapes/Polygon","./geom/Position","./projections/ProjectionEquirectangular","./projections/ProjectionGnomonic","./projections/ProjectionMercator","./projections/ProjectionPolarEquidistant","./projections/ProjectionUPS","./projections/ProjectionWgs84","./geom/Rectangle","./render/Renderable","./layer/RenderableLayer","./layer/RestTiledImageLayer","./gesture/RotationRecognizer","./shapes/ScreenImage","./shapes/ScreenText","./geom/Sector","./shapes/ShapeAttributes","./formats/shapefile/Shapefile","./layer/ShowTessellationLayer","./shapes/SurfaceImage","./shapes/SurfaceCircle","./shapes/SurfaceEllipse","./shapes/SurfacePolygon","./shapes/SurfacePolyline","./shapes/SurfaceRectangle","./render/SurfaceRenderable","./shapes/SurfaceSector","./shapes/SurfaceShape","./shapes/SurfaceShapeTile","./shapes/SurfaceShapeTileBuilder","./render/SurfaceTile","./render/SurfaceTileRenderer","./shaders/SurfaceTileRendererProgram","./gesture/TapRecognizer","./layer/TectonicPlatesLayer","./globe/Terrain","./globe/TerrainTile","./globe/TerrainTileList","./globe/Tessellator","./shapes/Text","./shapes/TextAttributes","./render/TextSupport","./render/Texture","./render/TextureTile","./util/Tile","./layer/TiledImageLayer","./util/TileFactory","./gesture/TiltRecognizer","./gesture/Touch","./shapes/TriangleMesh","./error/UnsupportedOperationError","./geom/Vec2","./geom/Vec3","./layer/ViewControlsLayer","./ogc/WmsCapabilities","./layer/WmsLayer","./ogc/WmsLayerCapabilities","./layer/WmsTimeDimensionedLayer","./util/WmsUrlBuilder","./ogc/WmtsCapabilities","./layer/WmtsLayer","./ogc/WmtsLayerCapabilities","./WorldWindow","./util/WWMath","./util/WWMessage","./util/WWUtil","./globe/ZeroElevationModel"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht,Bt,jt,Ft,It,qt,Rt,Ut,zt,Wt,Xt,Vt,$t,Jt,Kt,Qt,Gt,Yt,Zt,en,tn,nn,rn,sn,on,un,an,fn,ln,cn,hn,pn,dn,vn,mn,gn,yn,bn,wn,En,Sn,xn,Tn,Nn,Cn,kn,Ln,An,On,Mn,_n,Dn,Pn,Hn,Bn){"use strict";var jn={VERSION:"0.0.0",ABSOLUTE:"absolute",AFTER_REDRAW:"afterRedraw",BEFORE_REDRAW:"beforeRedraw",BEGAN:"began",CANCELLED:"cancelled",CHANGED:"changed",CLAMP_TO_GROUND:"clampToGround",EARTH_RADIUS:6371e3,EAST:"east",ENDED:"ended",FAILED:"failed",GREAT_CIRCLE:"greatCircle",LINEAR:"linear",MULTI_POINT:"multiPoint",NORTH:"north",NULL:"null",OFFSET_FRACTION:"fraction",OFFSET_INSET_PIXELS:"insetPixels",OFFSET_PIXELS:"pixels",POINT:"point",POLYLINE:"polyline",POLYGON:"polygon",POSSIBLE:"possible",RECOGNIZED:"recognized",REDRAW_EVENT_TYPE:"WorldWindRedraw",RELATIVE_TO_GLOBE:"relativeToGlobe",RELATIVE_TO_GROUND:"relativeToGround",RELATIVE_TO_SCREEN:"relativeToScreen",RHUMB_LINE:"rhumbLine",SOUTH:"south",WEST:"west"};return jn.AbstractError=e,jn.Angle=t,jn.Annotation=n,jn.AnnotationAttributes=r,jn.ArgumentError=i,jn.BasicProgram=s,jn.BasicTextureProgram=o,jn.BingAerialLayer=u,jn.BingAerialWithLabelsLayer=a,jn.BingRoadsLayer=f,jn.BingWMSLayer=l,jn.BlueMarbleLayer=c,jn.BMNGLandsatLayer=h,jn.BMNGLayer=p,jn.BMNGOneImageLayer=d,jn.BoundingBox=v,jn.ClickRecognizer=m,jn.Color=g,jn.Compass=y,jn.CompassLayer=b,jn.CoordinatesDisplayLayer=w,jn.DigitalGlobeTiledImageLayer=E,jn.DragRecognizer=S,jn.DrawContext=x,jn.EarthElevationModel=T,jn.EarthRestElevationModel=N,jn.ElevationModel=C,jn.Font=k,jn.FrameStatistics=L,jn.FrameStatisticsLayer=A,jn.FramebufferTexture=O,jn.FramebufferTile=M,jn.FramebufferTileController=_,jn.Frustum=D,jn.GeographicMesh=P,jn.GeographicProjection=H,jn.GeographicText=B,jn.GeoJSONParser=j,jn.GestureRecognizer=F,jn.Globe=I,jn.Globe2D=q,jn.GoToAnimator=R,jn.GpuProgram=U,jn.GpuResourceCache=z,jn.GpuShader=W,jn.HighlightController=X,jn.ImageSource=V,jn.ImageTile=$,jn.Insets=J,jn.LandsatRestLayer=K,jn.Layer=Q,jn.Level=G,jn.LevelRowColumnUrlBuilder=Y,jn.LevelSet=Z,jn.Line=et,jn.Location=tt,jn.Logger=nt,jn.LookAtNavigator=rt,jn.Matrix=it,jn.MemoryCache=st,jn.MemoryCacheListener=ot,jn.MercatorTiledImageLayer=ut,jn.Navigator=at,jn.NavigatorState=ft,jn.NominatimGeocoder=lt,jn.NotYetImplementedError=ct,jn.Offset=ht,jn.OpenStreetMapImageLayer=pt,jn.PanRecognizer=dt,jn.Path=vt,jn.PeriodicTimeSequence=mt,jn.PickedObject=gt,jn.PickedObjectList=yt,jn.PinchRecognizer=bt,jn.Placemark=wt,jn.PlacemarkAttributes=Et,jn.Plane=St,jn.Polygon=xt,jn.Position=Tt,jn.ProjectionEquirectangular=Nt,jn.ProjectionGnomonic=Ct,jn.ProjectionMercator=kt,jn.ProjectionPolarEquidistant=Lt,jn.ProjectionUPS=At,jn.ProjectionWgs84=Ot,jn.Rectangle=Mt,jn.Renderable=_t,jn.RenderableLayer=Dt,jn.RestTiledImageLayer=Pt,jn.RotationRecognizer=Ht,jn.ScreenText=jt,jn.ScreenImage=Bt,jn.Sector=Ft,jn.ShapeAttributes=It,jn.Shapefile=qt,jn.ShowTessellationLayer=Rt,jn.SurfaceImage=Ut,jn.SurfaceCircle=zt,jn.SurfaceEllipse=Wt,jn.SurfacePolygon=Xt,jn.SurfacePolyline=Vt,jn.SurfaceRectangle=$t,jn.SurfaceRenderable=Jt,jn.SurfaceSector=Kt,jn.SurfaceShape=Qt,jn.SurfaceShapeTile=Gt,jn.SurfaceShapeTileBuilder=Yt,jn.SurfaceTile=Zt,jn.SurfaceTileRenderer=en,jn.SurfaceTileRendererProgram=tn,jn.TapRecognizer=nn,jn.TectonicPlatesLayer=rn,jn.Terrain=sn,jn.TerrainTile=on,jn.TerrainTileList=un,jn.Tessellator=an,jn.Text=fn,jn.TextAttributes=ln,jn.TextSupport=cn,jn.Texture=hn,jn.TextureTile=pn,jn.Tile=dn,jn.TiledImageLayer=vn,jn.TileFactory=mn,jn.TiltRecognizer=gn,jn.Touch=yn,jn.TriangleMesh=bn,jn.UnsupportedOperationError=wn,jn.Vec2=En,jn.Vec3=Sn,jn.ViewControlsLayer=xn,jn.WmsCapabilities=Tn,jn.WmsLayer=Nn,jn.WmsLayerCapabilities=Cn,jn.WmsTimeDimensionedLayer=kn,jn.WmsUrlBuilder=Ln,jn.WmtsCapabilities=An,jn.WmtsLayer=On,jn.WmtsLayerCapabilities=Mn,jn.WWMath=Dn,jn.WWMessage=Pn,jn.WWUtil=Hn,jn.WorldWindow=_n,jn.ZeroElevationModel=Bn,jn.configuration={gpuCacheSize:25e7,baseUrl:Hn.worldwindlibLocation()||Hn.currentUrlSansFilePart()+"/../"},jn.BingMapsKey=null,window.WorldWind=jn,jn}),t("WorldWind")});